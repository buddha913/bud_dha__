<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="utf-8"/>
<title>X ÌÅ¨Î¶¨ÏóêÏù¥ÌÑ∞ ÎßàÏù∏ÎìúÏâêÏñ¥ Î∂ÑÏÑùÍ∏∞ 5.0</title>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<!-- CSV ÌååÏÑú -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<!-- ÌîÑÎ°úÏ†ùÌä∏Î≥Ñ ÏõêÌòï Í∑∏ÎûòÌîÑÏö© -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@3.3.0/dist/chartjs-chart-financial.umd.min.js"></script>
<!-- ‚úÖ STEP 2 -->
<style>
  html {
  scroll-behavior: smooth;
}

:root {
  --bg: #f3f7ff;
  --bg-soft: #f8fbff;
  --sidebar-bg: #ffffff;
  --card-bg: #ffffff;
  --card-soft: #f9fbff;
  --accent: #4f46e5;
  --accent-soft: #e0e7ff;
  --accent-2: #06b6d4;
  --accent-3: #22c55e;
  --text-main: #0f172a;
  --text-muted: #6b7280;
  --border-soft: rgba(148,163,184,.35);

  --grade-s: #f59e0b;
  --grade-a: #38bdf8;
  --grade-b: #22c55e;
  --grade-c: #a855f7;
  --grade-d: #9ca3af;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:
    radial-gradient(circle at 0% 0%, #e0f2fe, transparent 55%),
    radial-gradient(circle at 100% 0%, #ffe4f5, transparent 55%),
    linear-gradient(180deg,#eef4ff,#f9fafb);
  color:var(--text-main);
  min-height:100vh;
}

.layout{
  display:flex;
  min-height:100vh;
}

/* ========== SIDEBAR ========== */
.sidebar{
  width:230px;
  background:var(--sidebar-bg);
  backdrop-filter: blur(18px) saturate(160%);
  color:#111827;
  padding:20px 18px;
  display:flex;
  flex-direction:column;
  gap:24px;
  box-shadow: 10px 0 35px rgba(148,163,184,.45);
  position:relative;
  z-index:10;
  transition:width .2s ease;
  overflow:hidden;
  border-right:1px solid rgba(209,213,219,.9);
}

.sidebar-toggle{
  position:absolute;
  top:0;
  right:-6px;
  width:12px;
  height:100%;
  border:none;
  background:transparent;
  padding:0;
  cursor:pointer;
  z-index:20;
}
.sidebar-toggle::before{
  content:"‚ü®";
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  width:24px;
  height:24px;
  border-radius:999px;
  background:linear-gradient(135deg,#4f46e5,#06b6d4);
  color:#f9fafb;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:14px;
  box-shadow:0 10px 24px rgba(79,70,229,.65);
  opacity:0;
  transition:opacity .15s ease;
}
.sidebar-toggle:hover::before{
  opacity:1;
}

.side-profile{
  display:flex;
  gap:12px;
  align-items:center;
  margin-top:18px;
}
.side-login-btn{
  margin-top:6px;
  padding:4px 8px;
  font-size:11px;
  border-radius:999px;
  border:1px solid rgba(148,163,184,.6);
  background:rgba(248,250,252,.9);
  cursor:pointer;
}
.side-login-btn:hover{
  background:#e5edff;
}

.side-auth-pill{
  margin-top:10px;
  padding:10px 12px;
  border-radius:16px;
  background:linear-gradient(135deg,#eff6ff,#e0f2fe);
  border:1px solid rgba(148,163,184,0.6);
  display:flex;
  flex-direction:column;
  gap:6px;
}
html.dark-theme .side-auth-pill{
  background:linear-gradient(135deg,#020617,#030712);
  border-color:rgba(30,64,175,0.85);
}
.side-auth-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:11px;
}
.side-auth-label{
  font-weight:600;
  color:#0f172a;
}
html.dark-theme .side-auth-label{
  color:#e5e7eb;
}
.side-auth-status{
  font-size:11px;
  color:#6b7280;
}
html.dark-theme .side-auth-status{
  color:#9ca3af;
}
.side-auth-main-btn{
  margin-top:4px;
  width:100%;
  border-radius:999px;
  padding:6px 10px;
  font-size:11px;
  font-weight:600;
  border:none;
  cursor:pointer;
  background:#111827;
  color:#f9fafb;
}
.side-auth-main-btn--secondary{
  background:transparent;
  border:1px solid rgba(148,163,184,0.75);
  color:#111827;
}
html.dark-theme .side-auth-main-btn--secondary{
  color:#e5e7eb;
}
.side-auth-main-btn:hover{
  filter:brightness(1.05);
}
.side-auth-caption{
  margin:0;
  margin-top:2px;
  font-size:10px;
  color:#6b7280;
}
html.dark-theme .side-auth-caption{
  color:#9ca3af;
}
.side-avatar{
  width:44px;height:44px;
  border-radius:999px;
  border:2px solid rgba(248,250,252,.9);
  overflow:hidden;
  box-shadow:0 8px 18px rgba(148,163,184,.7);
}
.side-avatar img{width:100%;height:100%;object-fit:cover}
.side-name{font-size:15px;font-weight:700;}
.side-handle{
  font-size:12px;color:#6b7280;
  text-decoration:none;
}

.side-nav{
  display:flex;
  flex-direction:column;
  gap:6px;
  margin-top:12px;
}
.side-nav-item{
  display:flex;
  align-items:center;
  gap:8px;
  padding:8px 10px;
  border-radius:12px;
  font-size:13px;
  color:#4b5563;
  cursor:pointer;
  text-decoration:none;
  transition:background .15s ease, transform .1s ease, box-shadow .15s ease;
}
.side-nav-item:hover{
  background:rgba(191,219,254,.6);
  transform:translateX(2px);
  box-shadow:0 6px 16px rgba(148,163,184,.4);
}
.side-nav-item span.icon{
  width:20px;height:20px;
  border-radius:9px;
  background:linear-gradient(135deg,#e0f2fe,#e5e7eb);
  display:flex;align-items:center;justify-content:center;
  font-size:12px;
  flex-shrink:0;
}
.side-label{
  white-space:nowrap;
}
.side-nav-item.active{
  background:linear-gradient(135deg,#4f46e5,#06b6d4);
  color:#f9fafb;
  box-shadow:0 10px 24px rgba(79,70,229,.7);
}
.side-nav-item.active span.icon{
  background:rgba(15,23,42,.9);
  color:#e5e7eb;
}

.side-footer{
  margin-top:auto;
  font-size:11px;
  color:#9ca3af;
}
.side-badge{
  margin-top:6px;
  padding:8px 10px;
  border-radius:14px;
  background:radial-gradient(circle at 0% 0%,#4f46e5,#06b6d4);
  font-size:12px;
  color:#f9fafb;
  text-align:left;
  box-shadow:0 14px 28px rgba(15,23,42,.65);
}

/* ========== SIDEBAR COLLAPSE ========== */
.layout.collapsed .sidebar{
  width:70px;
}
.layout.collapsed .side-name,
.layout.collapsed .side-handle,
.layout.collapsed .side-label,
.layout.collapsed .side-footer{
  display:none;
}
.layout.collapsed .side-profile{
  justify-content:center;
}
.layout.collapsed .sidebar-toggle::before{
  content:"‚ü©";
}

/* ========== MAIN AREA ========== */
.main{
  flex:1;
  padding:20px 24px 32px;
  max-width:calc(100vw - 230px);
  overflow-x:hidden;
  transition:max-width .2s ease;
}
.layout.collapsed .main{
  max-width:calc(100vw - 70px);
}

.top-nav{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:16px;
  flex-wrap:wrap;
  gap:8px;
}
.top-title{
  font-size:20px;
  font-weight:800;
}
.top-sub{
  font-size:12px;
  color:var(--text-muted);
}
.top-cta{
  display:flex;
  gap:8px;
  align-items:center;
}
.lang-toggle{
  display:flex;
  gap:4px;
  align-items:center;
  font-size:11px;
}

.lang-btn{
  border-radius:999px;
  border:1px solid rgba(209,213,219,1);
  background:#ffffff;
  padding:4px 8px;
  font-size:11px;
  cursor:pointer;
}

.lang-btn.active{
  background:linear-gradient(135deg,#4f46e5,#06b6d4);
  color:#f9fafb;
  border-color:transparent;
}

.top-link{
  font-size:12px;
  padding:7px 12px;
  border-radius:999px;
  border:1px solid #c7d2fe;
  background:var(--card-soft);
  color:var(--accent);
  text-decoration:none;
  display:inline-flex;
  align-items:center;
  gap:6px;
}

/* HERO */
.hero-card{
  background:
    radial-gradient(circle at 0% 0%, #c7d2fe, transparent 45%),
    radial-gradient(circle at 100% 0%, #a5f3fc, transparent 45%),
    linear-gradient(135deg,#f9fafb,#eef2ff);
  border-radius:24px;
  padding:18px 18px 16px;
  border:1px solid rgba(191,219,254,.9);
  display:flex;
  flex-direction:column;
  gap:10px;
  box-shadow:0 22px 45px rgba(148,163,184,.45);
}
.hero-top-row{
  display:flex;
  justify-content:space-between;
  gap:12px;
  align-items:flex-start;
  flex-wrap:wrap;
}
.hero-main-title{
  font-size:17px;
  font-weight:800;
  color:#111827;
}
.hero-desc{
  font-size:12px;
  color:#4b5563;
  margin-top:4px;
  line-height:1.4;
}
.hero-pill{
  font-size:11px;
  padding:5px 10px;
  border-radius:999px;
  background:rgba(255,255,255,.95);
  border:1px solid rgba(148,163,184,.5);
  display:inline-flex;
  align-items:center;
  gap:6px;
  margin-top:6px;
}
.hero-dot{
  width:8px;height:8px;border-radius:999px;
  background:#22c55e;
  box-shadow:0 0 0 5px rgba(34,197,94,.2);
}

.hero-upload-row{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  align-items:center;
  margin-top:4px;
}
.file-input-wrap{position:relative;display:inline-block;overflow:hidden}
.file-input-wrap input[type="file"]{position:absolute;inset:0;opacity:0;cursor:pointer}
.file-input-fake{
  padding:8px 14px;border-radius:999px;border:1px solid rgba(148,163,184,.7);
  font-size:12px;display:inline-flex;align-items:center;gap:8px;
  background:rgba(255,255,255,.95);cursor:pointer;white-space:nowrap;
  color:#111827;
}
.file-hint{font-size:11px;color:#4b5563}

.range-tabs{
  margin-top:10px;
  display:flex;
  gap:6px;
  flex-wrap:wrap;
}
.range-tab{
  padding:4px 10px;
  border-radius:999px;
  font-size:11px;
  border:1px solid rgba(148,163,184,.7);
  background:rgba(255,255,255,.9);
  color:#4b5563;
  cursor:pointer;
  transition:background .15s ease, transform .1s ease;
}
.range-tab:hover{
  transform:translateY(-1px);
}
.range-tab.active{
  background:linear-gradient(135deg,#4f46e5,#06b6d4);
  border-color:transparent;
  color:#f9fafb;
}

.badge{
  display:inline-flex;gap:6px;padding:4px 9px;border-radius:999px;
  border:1px solid rgba(148,163,184,.6);font-size:11px;color:#4b5563;
  background:rgba(255,255,255,.85);margin-top:2px;
}
.badge-dot{width:7px;height:7px;border-radius:999px;background:#a5b4fc}

.error{color:#ef4444;font-size:12px;margin-top:4px}

/* GRID (ÎåÄÏãúÎ≥¥Îìú) */
.grid-1{
  margin-top:18px;
  display:grid;
  grid-template-columns:2.2fr 1.4fr;
  gap:16px;
  align-items:flex-start;
}

.column-main{
  display:flex;
  flex-direction:column;
  gap:16px;
}
.column-side{
  display:flex;
  flex-direction:column;
  gap:16px;
}

.card{
  border-radius:18px;
  background:var(--card-bg);
  border:1px solid rgba(203,213,225,.8);
  padding:14px 14px 16px;
  box-shadow:0 10px 25px rgba(148,163,184,.25);
}
.card-soft{
  background:var(--card-soft);
}

.summary-grid{
  display:grid;
  grid-template-columns:repeat(4,minmax(0,1fr));
  gap:10px;
  margin-top:10px;
}

@media (max-width:1100px){
  .grid-1{
    grid-template-columns:1fr;
  }
}

@media (max-width:960px){
  .layout{
    flex-direction:column;
  }
  .sidebar{
    width:100%;
    flex-direction:row;
    align-items:center;
    justify-content:space-between;
  }
  .layout.collapsed .sidebar{
    width:100%;
  }
  .main{
    max-width:100%;
    padding:16px;
  }
}  /* üëà Ïó¨Í∏∞ÏóêÏÑú mediaÎ•º Íº≠ Îã´ÏïÑÏ§ò! */

/* Dashboard 3√ó3 Î©îÏù∏ Í∑∏Î¶¨Îìú */
.dash-grid{
  margin-top:16px;
  display:grid;
  grid-template-columns:repeat(3,minmax(0,1fr));
  gap:12px;
}

.dash-cell{
  background:var(--card-bg);
  border-radius:20px;
  padding:12px 14px 14px;
  box-shadow:0 14px 40px rgba(15,23,42,0.28);
  border:1px solid rgba(148,163,184,0.35);
  display:flex;
  flex-direction:column;
  min-height:120px;
}

.dash-cell-header{
  display:flex;
  flex-direction:column;
  gap:2px;
  margin-bottom:6px;
}

.dash-cell-title{
  font-size:13px;
  font-weight:700;
}

.dash-cell-sub{
  font-size:11px;
  color:var(--text-muted);
}

.dash-chart-wrap{
  margin-top:4px;
  height:90px;
}

.dash-chart-wrap canvas{
  width:100%;
  height:100%;
}

.dash-price{
  margin-top:6px;
  font-size:12px;
  color:var(--text-main);
}

.dash-news-list{
  list-style:none;
  padding:0;
  margin:4px 0 0;
  display:flex;
  flex-direction:column;
  gap:4px;
  font-size:12px;
}

.dash-news-list li{
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}

.dash-news-placeholder{
  color:var(--text-muted);
}

.dash-projects-wrap{
  margin-top:4px;
  font-size:12px;
  display:flex;
  flex-direction:column;
  gap:4px;
}

.dash-project-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:6px;
}

.dash-project-name{
  font-weight:600;
}

.dash-project-rank{
  font-size:11px;
  color:var(--text-muted);
}

.dash-extra-body{
  margin-top:6px;
  font-size:12px;
}

/* ÏûëÏùÄ ÌôîÎ©¥ÏóêÏÑú 1Ïó¥ ÎòêÎäî 2Ïó¥Î°ú Î≥ÄÍ≤Ω */
@media (max-width: 1080px){
  .dash-grid{
    grid-template-columns:repeat(2,minmax(0,1fr));
  }
  #dash-leader{
    grid-column:span 2;
  }
}
@media (max-width: 720px){
  .dash-grid{
    grid-template-columns:1fr;
  }
  #dash-leader{
    grid-column:span 1;
  }
}
/* ÏÑ±Ïû• Í∑∏ÎûòÌîÑ Ïπ¥Îìú */
.growth-card{
  margin-top:16px;
}

.growth-card-title{
  font-size:14px;
  font-weight:700;
  margin-bottom:4px;
}

.growth-card-sub{
  font-size:11px;
  color:var(--text-muted);
}

.growth-chart-wrap{
  margin-top:10px;
}

/* ÏöîÏïΩ Ïπ¥Îìú (ÏõêÍ∏Ä Í∞úÏàò / ÌèâÍ∑† Ïä§ÏΩîÏñ¥ / Ìä∏Î¶ºÎìú ÌèâÍ∑† / Í∞ÄÏû• ÌÑ∞ÏßÑ Í∏Ä) */
.summary-grid{
  margin-top:14px;
  display:grid;
  grid-template-columns:repeat(4,minmax(0,1fr));
  gap:12px;
}

/* ÏöîÏïΩ Ïπ¥Îìú (ÏõêÍ∏Ä Í∞úÏàò / ÌèâÍ∑† Ïä§ÏΩîÏñ¥ / Ìä∏Î¶ºÎìú ÌèâÍ∑† / Í∞ÄÏû• ÌÑ∞ÏßÑ Í∏Ä) */
.summary-grid{
  margin-top:14px;
  display:grid;
  grid-template-columns:repeat(4,minmax(0,1fr));
  gap:12px;
}

.summary-card{
  position:relative;
  overflow:hidden;
  border-radius:18px;
  padding:14px 16px;
  display:flex;
  align-items:center;
  gap:12px;
  color:#f9fafb;
  box-shadow:0 16px 40px rgba(15,23,42,.25);
  border:1px solid rgba(148,163,184,.45);
}

/* Ïπ¥ÎìúÎ≥Ñ Í∑∏ÎùºÎîîÏñ∏Ìä∏ ÏÉâ */
.summary-card--posts{
  background:linear-gradient(135deg,#6366f1,#3b82f6);
}
.summary-card--avg{
  background:linear-gradient(135deg,#0ea5e9,#22c55e);
}
.summary-card--trimmed{
  background:linear-gradient(135deg,#ec4899,#8b5cf6);
}
.summary-card--best{
  background:linear-gradient(135deg,#14b8a6,#38bdf8);
}

/* ÏôºÏ™Ω ÎèôÍ∑∏ÎûÄ ÎßÅ */
.summary-ring{
  width:46px;
  height:46px;
  border-radius:999px;
  border:3px solid rgba(248,250,252,.75);
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(15,23,42,.18);
  backdrop-filter:blur(6px);
  flex-shrink:0;
}
.summary-ring span{
  font-size:18px;
}

.summary-text{
  display:flex;
  flex-direction:column;
  gap:2px;
}

.summary-label{
  font-size:11px;
  opacity:0.9;
}
.summary-value{
  font-size:18px;
  font-weight:800;
}
.summary-sub{
  font-size:10px;
  opacity:0.9;
}


.section-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;
  margin-bottom:10px;
  gap:8px;
}
.section-title{
  font-size:14px;
  font-weight:700;
  display:flex;
  gap:6px;
  align-items:center;
}
.section-sub{
  font-size:11px;
  color:var(--text-muted);
}

.grade-legend{
  display:flex;
  gap:6px;
  flex-wrap:wrap;
  font-size:10px;
  color:var(--text-muted);
}
.grade-dot{width:8px;height:8px;border-radius:999px}
.grade-dot.s{background:var(--grade-s)}
.grade-dot.a{background:var(--grade-a)}
.grade-dot.b{background:var(--grade-b)}
.grade-dot.c{background:var(--grade-c)}
.grade-dot.d{background:var(--grade-d)}

.grade-tabs{
  display:flex;
  gap:6px;
  flex-wrap:wrap;
  margin-bottom:10px;
}
.grade-tab{
  padding:4px 10px;
  border-radius:999px;
  font-size:11px;
  border:1px solid rgba(209,213,219,.9);
  background:#ffffff;
  color:var(--text-muted);
  cursor:pointer;
  display:flex;
  gap:6px;
  align-items:center;
  transition:background .15s ease, transform .1s ease;
}
.grade-tab:hover{
  transform:translateY(-1px);
}
.grade-tab-dot{width:8px;height:8px;border-radius:999px}
.grade-tab.active{
  background:linear-gradient(135deg,#4f46e5,#06b6d4);
  color:#f9fafb;
  border-color:transparent;
}

.table-wrap{
  width:100%;overflow:auto;border-radius:14px;
  border:1px solid rgba(226,232,240,.9);
  background:#ffffff;
}
table{width:100%;border-collapse:collapse;min-width:680px;font-size:11px}
th,td{padding:8px;border-bottom:1px solid rgba(226,232,240,1);vertical-align:top}
th{
  background:#f8fafc;
  color:#6b7280;
  text-transform:uppercase;
  font-size:10px;
  position:sticky;top:0;z-index:1;
}
tr:last-child td{border-bottom:none}
tbody tr:hover td{background:#f9fafb}

.grade-badge{
  display:inline-flex;min-width:24px;padding:3px 7px;border-radius:999px;
  font-size:11px;font-weight:700;justify-content:center;
}
.grade-badge.s{background:rgba(251,191,36,.12);border:1px solid rgba(251,191,36,.8);color:var(--grade-s)}
.grade-badge.a{background:rgba(56,189,248,.12);border:1px solid rgba(56,189,248,.8);color:var(--grade-a)}
.grade-badge.b{background:rgba(34,197,94,.12);border:1px solid rgba(34,197,94,.8);color:var(--grade-b)}
.grade-badge.c{background:rgba(168,85,247,.12);border:1px solid rgba(168,85,247,.8);color:var(--grade-c)}
.grade-badge.d{background:rgba(148,163,184,.16);border:1px solid rgba(148,163,184,1);color:var(--grade-d)}

.stat-chip{
  display:inline-flex;gap:3px;font-size:10px;color:var(--text-muted);
  padding:2px 6px;border-radius:999px;border:1px solid rgba(209,213,219,1);
  background:#f9fafb;
}
.stat-chip strong{color:#111827}
.link-pill{
  padding:3px 7px;border-radius:999px;font-size:10px;
  border:1px solid rgba(59,130,246,.9);
  background:rgba(239,246,255,1);color:#1d4ed8;text-decoration:none;
  white-space:nowrap;
}

.leader-input-row{
  margin-bottom:10px;display:flex;gap:8px;flex-wrap:wrap;align-items:center;
}
.leader-input{
  flex:1;min-width:200px;
  border-radius:999px;border:1px solid rgba(209,213,219,1);
  background:#ffffff;color:#111827;
  padding:8px 14px;font-size:12px;
}
.leader-btn{
  border-radius:999px;border:none;
  background:linear-gradient(135deg,#4f46e5,#06b6d4);
  color:white;font-size:12px;padding:8px 16px;
  cursor:pointer;font-weight:600;
  box-shadow:0 10px 22px rgba(79,70,229,.45);
}
.leader-btn:disabled{opacity:.5;cursor:default}
.leader-note{font-size:11px;color:var(--text-muted);margin-top:2px}
.empty{font-size:12px;color:var(--text-muted);padding:8px 4px;text-align:center}

.text-main{font-size:11px;word-break:break-word;}
.text-meta{font-size:10px;color:var(--text-muted);margin-top:2px;}
.grade-chip{font-size:11px;color:var(--text-muted);}

.sort-select{
  border-radius:999px;
  border:1px solid rgba(209,213,219,1);
  background:#ffffff;
  color:#374151;
  font-size:11px;
  padding:4px 8px;
}

/* ÌîÑÎ°úÏ†ùÌä∏ Î∑∞ Ï∂îÍ∞Ä Ïä§ÌÉÄÏùº */
.project-charts-row{
  overflow:hidden;
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  justify-content:center;
}
.project-chart-single{
  flex:1;
  min-width:220px;
  max-width:320px;
}
.project-charts-row canvas{
  width:100% !important;
  height:160px;
}
.project-chart-title{
  font-size:13px;
  font-weight:600;
  color:var(--text-main);
  text-align:center;
  margin-bottom:8px;
}
.project-chart-wrap,
.project-grade-chart-wrap{
  width:100%;
  max-width:420px;
  margin:0 auto 12px;
}
.project-detail-controls{
  margin-top:14px;
  margin-bottom:8px;
  display:flex;
  gap:8px;
  align-items:center;
  flex-wrap:wrap;
  font-size:12px;
}
.project-select{
  border-radius:999px;
  border:1px solid rgba(209,213,219,1);
  background:#ffffff;
  padding:6px 10px;
  font-size:12px;
}

/* ÏΩîÏπò Î¥á Ïπ¥Îìú */
.bot-card{
  background:
    radial-gradient(circle at 0% 0%, #e0f2fe, transparent 55%),
    radial-gradient(circle at 100% 0%, #ddd6fe, transparent 55%),
    #ffffff;
  position:relative;
  overflow:hidden;
}
.bot-chip{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:4px 9px;
  border-radius:999px;
  font-size:11px;
  background:rgba(15,23,42,.05);
  border:1px solid rgba(148,163,184,.5);
  margin-bottom:6px;
}
.bot-output{
  font-size:11px;
  color:#111827;
  line-height:1.5;
  white-space:pre-line;
}
.bot-hint{
  font-size:10px;
  color:var(--text-muted);
  margin-top:6px;
}
  

/* ===== YAP Ïã†Ìò∏ Ïπ¥Îìú ===== */
.yap-card .yap-main{
  display:flex;
  flex-direction:column;
  gap:10px;
}
.yap-level{
  font-size:18px;
  font-weight:700;
  margin-top:2px;
}
.yap-sub{
  font-size:11px;
  color:var(--text-muted);
  margin-top:4px;
}
.yap-metrics{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-top:6px;
}
.yap-metric{
  flex:1 1 70px;
  font-size:11px;
}
.yap-metric-label{
  color:var(--text-muted);
  margin-bottom:2px;
}
.yap-metric-value{
  font-weight:600;
  font-size:13px;
}
/* YAP Í∞ÄÏ§ëÏπò ÌÜ†Í∏Ä */
.yap-boost-toggles{
  margin-top:6px;
  display:flex;
  flex-direction:column;
  gap:3px;
}
.yap-toggle{
  display:flex;
  align-items:center;
  gap:6px;
  font-size:10px;
  color:var(--text-muted);
  cursor:pointer;
}
.yap-toggle input{
  width:14px;
  height:14px;
}
/* ===== ÏïºÌïë ÌîåÎûòÎÑà Ï†ÑÏö© Î†àÏù¥ÏïÑÏõÉ ===== */
.yap-layout{
  display:grid;
  grid-template-columns:minmax(0,1.2fr) minmax(0,1.3fr);
  gap:16px;
  margin-top:8px;
}
@media (max-width:1024px){
  .yap-layout{
    grid-template-columns:1fr;
  }
}
.yap-form-grid{
  display:grid;
  grid-template-columns:repeat(2,minmax(0,1fr));
  gap:8px;
}
.yap-form-grid-1{
  display:grid;
  grid-template-columns:1fr;
  gap:8px;
}
.yap-label{
  font-size:11px;
  font-weight:600;
  margin-bottom:2px;
}
.yap-input,
.yap-select{
  width:100%;
  padding:7px 9px;
  border-radius:10px;
  border:1px solid rgba(209,213,219,1);
  background:#ffffff;
  font-size:12px;
}
.yap-input::placeholder{
  color:#9ca3af;
}
.yap-add-btn{
  margin-top:8px;
  width:100%;
  border:none;
  border-radius:999px;
  padding:8px 0;
  font-size:13px;
  font-weight:600;
  cursor:pointer;
  background:linear-gradient(135deg,#4f46e5,#06b6d4);
  color:#f9fafb;
  box-shadow:0 10px 24px rgba(79,70,229,.45);
}
.yap-list-empty{
  font-size:12px;
  color:var(--text-muted);
}
.yap-item{
  display:grid;
  grid-template-columns:auto minmax(0,1fr) auto;
  gap:8px;
  align-items:flex-start;
  padding:8px 9px;
  border-radius:12px;
  border:1px solid rgba(226,232,240,1);
  background:#f9fafb;
  margin-bottom:6px;
  font-size:11px;
}
.yap-item.done{
  opacity:.6;
  text-decoration:line-through;
}
.yap-tags{
  margin-top:2px;
  display:flex;
  flex-wrap:wrap;
  gap:4px;
}
.yap-tag{
  padding:2px 6px;
  border-radius:999px;
  border:1px solid rgba(209,213,219,1);
  background:#ffffff;
}
.yap-delete{
  border:none;
  background:transparent;
  color:#9ca3af;
  cursor:pointer;
  font-size:12px;
}

/* ===== InfoFi Î¶¨ÎçîÎ≥¥Îìú  ===== */
.infofi-hero{
  margin-top:8px;
  margin-bottom:12px;
}
.infofi-hero-title{
  font-size:14px;
  font-weight:700;
  margin-bottom:4px;
}
.infofi-hero-sub{
  font-size:11px;
  color:var(--text-muted);
  line-height:1.5;
}
.infofi-search-row{
  margin-top:10px;
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  align-items:center;
}
.infofi-search-input{
  flex:1;
  min-width:220px;
  border-radius:999px;
  border:1px solid rgba(209,213,219,1);
  background:#ffffff;
  padding:9px 14px;
  font-size:12px;
}
.infofi-search-btn{
  border-radius:999px;
  border:none;
  padding:9px 16px;
  font-size:12px;
  font-weight:600;
  cursor:pointer;
  background:linear-gradient(135deg,#4f46e5,#06b6d4);
  color:#f9fafb;
  box-shadow:0 10px 22px rgba(79,70,229,.45);
}
.infofi-handle-label{
  margin-top:8px;
  font-size:12px;
  color:var(--text-muted);
}
.infofi-handle-label b{
  color:#111827;
}
.infofi-hint{
  margin-top:6px;
  font-size:11px;
  color:var(--text-muted);
}
.infofi-projects-grid{
  display:flex;
  flex-direction:column;
  gap:12px;
}
.infofi-project-card{
  border-radius:16px;
  border:1px solid rgba(226,232,240,1);
  background:#f9fafb;
  padding:10px 12px 12px;
}
.infofi-project-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:6px;
  gap:8px;
}
.infofi-header-left{
  display:flex;
  align-items:center;
  gap:10px;
}
.infofi-logo{
  width:32px;
  height:32px;
  border-radius:50%;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:14px;
  font-weight:700;
  background:#e0f2fe;
  color:#0369a1;
  flex-shrink:0;
}
.infofi-logo img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}

.infofi-project-main{
  display:flex;
  flex-direction:column;
  gap:2px;
}
.infofi-project-name{
  font-size:13px;
  font-weight:700;
}
.infofi-project-meta{
  font-size:11px;
  color:var(--text-muted);
}
.infofi-badge{
  font-size:10px;
  padding:3px 7px;
  border-radius:999px;
  border:1px solid rgba(191,219,254,1);
  background:#eff6ff;
  color:#1d4ed8;
}
.infofi-table-wrap{
  margin-top:6px;
}
.infofi-table{
  width:100%;
  border-collapse:collapse;
  font-size:11px;
}
.infofi-table th,
.infofi-table td{
  padding:6px 6px;
  border-bottom:1px solid rgba(226,232,240,1);
}
.infofi-table th{
  background:#f8fafc;
  color:var(--text-muted);
  text-align:left;
  font-size:10px;
}
.infofi-table tr:last-child td{
  border-bottom:none;
}
.infofi-empty{
  font-size:12px;
  color:var(--text-muted);
  text-align:center;
  padding:8px 4px;
}
@media (max-width:768px){
  .infofi-project-card{
    padding:10px 10px 12px;
  }
}

/* ===== Îã§ÌÅ¨ Î™®Îìú ===== */
html.dark-theme{
  --bg:#020617;
  --bg-soft:#020617;
  --sidebar-bg:#020617;
  --card-bg:#020617;
  --card-soft:#020617;
  --text-main:#e5e7eb;
  --text-muted:#9ca3af;
  --border-soft:rgba(30,64,175,.7);
}
html.dark-theme body{
  background:#020617;
}
html.dark-theme .sidebar{
  border-right-color:rgba(30,64,175,.8);
  box-shadow:10px 0 35px rgba(15,23,42,.9);
}
html.dark-theme .card,
html.dark-theme .dash-cell{
  box-shadow:0 18px 45px rgba(15,23,42,.85);
}
html.dark-theme .top-sub,
html.dark-theme .section-sub{
  color:var(--text-muted);
}

/* Îã§ÌÅ¨ Î™®Îìú ÌÜ†Í∏Ä */
.side-theme{
  margin-top:8px;
}
.theme-toggle-label{
  display:inline-flex;
  align-items:center;
  gap:6px;
  font-size:11px;
  color:var(--text-muted);
  cursor:pointer;
}
.theme-toggle-label input{
  width:32px;
  height:16px;
  border-radius:999px;
  appearance:none;
  -webkit-appearance:none;
  background:rgba(148,163,184,.6);
  position:relative;
  outline:none;
  cursor:pointer;
}
.theme-toggle-label input::before{
  content:"";
  position:absolute;
  top:2px;
  left:2px;
  width:12px;
  height:12px;
  border-radius:999px;
  background:#f9fafb;
  transition:transform .18s ease;
}
.theme-toggle-label input:checked{
  background:linear-gradient(135deg,#4f46e5,#06b6d4);
}
.theme-toggle-label input:checked::before{
  transform:translateX(14px);
}
.theme-toggle-text{
  opacity:.9;
}

/* YAP ÌûàÌä∏Îßµ */
.yap-heatmap-card{
  margin-top:12px;
}
.yap-heatmap{
  margin-top:6px;
  display:flex;
  flex-wrap:wrap;
  gap:4px;
  min-height:22px;
}
.yap-heatbox{
  width:18px;
  height:18px;
  border-radius:4px;
  border:1px solid rgba(148,163,184,.45);
  box-shadow:0 2px 4px rgba(148,163,184,.35);
}
.yap-heatbox.level-1{background:#e0f2fe;}
.yap-heatbox.level-2{background:#bfdbfe;}
.yap-heatbox.level-3{background:#a5b4fc;}
.yap-heatbox.level-4{background:#f9a8d4;}
.yap-heatbox.level-5{background:#fb7185;}
.yap-heatmap-legend{
  display:flex;
  align-items:center;
  gap:6px;
  font-size:10px;
  color:var(--text-muted);
  margin-top:4px;
}
.yap-heatmap-legend-bar{
  display:inline-flex;
  gap:2px;
}
.yap-heatmap-legend-bar span{
  width:14px;
  height:10px;
  border-radius:4px;
}
.yap-heatmap-legend-bar .lvl-1{background:#e0f2fe;}
.yap-heatmap-legend-bar .lvl-2{background:#bfdbfe;}
.yap-heatmap-legend-bar .lvl-3{background:#a5b4fc;}
.yap-heatmap-legend-bar .lvl-4{background:#f9a8d4;}
.yap-heatmap-legend-bar .lvl-5{background:#fb7185;}


/* Í∏ÄÏì∞Í∏∞ ÌÜ†Í∏Ä */
.community-toggle{
  display:flex;
  flex-direction:column;
  gap:4px;
  margin-bottom:8px;
}
.community-toggle-btn{
  align-self:flex-start;
  border-radius:999px;
  border:1px solid rgba(209,213,219,1);
  padding:6px 14px;
  font-size:12px;
  background:#f9fafb;
  cursor:pointer;
}
/* InfoFi Ï∂úÏ≤ò */
.infofi-source-note{
  margin-top:6px;
  font-size:11px;
  color:var(--text-muted);
}
.infofi-source-note a{
  color:var(--accent);
  text-decoration:underline;
}

/* ===== Ïª§ÎÆ§ÎãàÌã∞ ÌÉ≠ ===== */
.community-layout{
  margin-top:8px;
  max-width:880px;
  margin-left:auto;
  margin-right:auto;
}
@media (max-width: 900px){
  .community-layout{
    grid-template-columns:1fr;
  }
}
.community-form{
  display:flex;
  flex-direction:column;
  gap:8px;
}
.community-form-label{
  font-size:11px;
  font-weight:600;
  color:var(--text-main);
}
.community-textarea{
  width:100%;
  min-height:80px;
  padding:8px 10px;
  border-radius:12px;
  border:1px solid rgba(209,213,219,1);
  resize:vertical;
  font-size:12px;
}
.community-input{
  width:100%;
  padding:7px 10px;
  border-radius:999px;
  border:1px solid rgba(209,213,219,1);
  font-size:12px;
}
.community-submit{
  align-self:flex-end;
  margin-top:4px;
  border:none;
  border-radius:999px;
  padding:8px 16px;
  font-size:12px;
  font-weight:600;
  cursor:pointer;
  background:linear-gradient(135deg,#4f46e5,#06b6d4);
  color:#f9fafb;
  box-shadow:0 10px 22px rgba(79,70,229,.45);
}
.community-hint{
  font-size:11px;
  color:var(--text-muted);
}
.community-list{
  display:flex;
  flex-direction:column;
  gap:8px;
}
.community-empty{
  font-size:12px;
  color:var(--text-muted);
}
.community-post{
  border-radius:14px;
  border:1px solid rgba(226,232,240,1);
  background:#f9fafb;
  padding:8px 10px;
  font-size:12px;
}
.community-meta{
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:11px;
  color:var(--text-muted);
  margin-bottom:4px;
}
.community-body{
  font-size:12px;
  white-space:pre-wrap;
  word-break:break-word;
}
.community-link{
  display:inline-flex;
  align-items:center;
  gap:4px;
  margin-top:4px;
  font-size:11px;
  color:#1d4ed8;
  text-decoration:none;
}
.community-actions{
  margin-top:6px;
  display:flex;
  gap:8px;
  align-items:center;
  font-size:11px;
  color:var(--text-muted);
}
.community-action-btn{
  border:none;
  background:transparent;
  cursor:pointer;
  font-size:11px;
  display:inline-flex;
  align-items:center;
  gap:3px;
  color:var(--text-muted);
}
.community-replies{
  margin-top:6px;
  padding-left:10px;
  border-left:2px solid rgba(209,213,219,0.8);
  display:flex;
  flex-direction:column;
  gap:6px;
}
.community-reply{
  font-size:11px;
}
.community-reply-meta{
  font-size:10px;
  color:var(--text-muted);
  margin-bottom:2px;
}

/* ===== YAP Î≤ÑÌçº Í≤åÏù¥ÏßÄ ===== */
.yap-gauge-card{
  background:
    radial-gradient(circle at 0% 0%, #e0f2fe, transparent 55%),
    radial-gradient(circle at 100% 0%, #ddd6fe, transparent 55%),
    #ffffff;
}
.yap-gauge-main{
  margin-top:6px;
  display:flex;
  flex-direction:column;
  gap:10px;
  font-size:12px;
}
.yap-gauge-percent-row{
  display:flex;
  align-items:baseline;
  gap:10px;
}
.yap-gauge-percent{
  font-size:26px;
  font-weight:800;
}
.yap-gauge-level{
  font-size:13px;
  color:var(--text-muted);
}
.yap-gauge-bar{
  position:relative;
  width:100%;
  height:10px;
  border-radius:999px;
  background:rgba(226,232,240,1);
  overflow:hidden;
  box-shadow:inset 0 1px 3px rgba(15,23,42,.15);
}
.yap-gauge-fill{
  position:absolute;
  left:0;
  top:0;
  bottom:0;
  width:0%;
  border-radius:999px;
  background:linear-gradient(90deg,#22c55e,#facc15,#fb7185);
  transition:width .25s ease;
}
.yap-gauge-sub{
  font-size:11px;
  color:var(--text-muted);
}
.yap-gauge-legend{
  margin:6px 0 0;
  padding-left:18px;
  font-size:11px;
  color:var(--text-muted);
}
.yap-gauge-legend li{
  margin-bottom:2px;
}
.yap-gauge-metrics{
  margin-top:10px;
  display:flex;
  flex-wrap:wrap;
  gap:8px;
}
.metric-chip{
  flex:1 1 120px;
  min-width:120px;
  padding:6px 8px;
  border-radius:10px;
  background:rgba(15,23,42,0.02);
  border:1px solid rgba(148,163,184,0.2);
}
.metric-label{
  font-size:10px;
  color:var(--text-muted);
  margin-bottom:2px;
}
.metric-value{
  font-size:13px;
  font-weight:600;
}
.yap-gauge-forecast{
  margin-top:10px;
  padding:8px 9px;
  border-radius:12px;
  background:rgba(56,189,248,0.04);
  border:1px dashed rgba(56,189,248,0.7);
}
.forecast-title{
  font-size:11px;
  font-weight:600;
  margin-bottom:2px;
}
.forecast-value{
  font-size:13px;
  font-weight:700;
  margin-bottom:2px;
}
.forecast-sub{
  font-size:10px;
  color:var(--text-muted);
}
.yap-gauge-highlight{
  margin-top:10px;
  padding:8px 9px;
  border-radius:12px;
  background:rgba(139,92,246,0.04);
  border:1px solid rgba(139,92,246,0.4);
}
.highlight-title{
  font-size:11px;
  font-weight:600;
  margin-bottom:4px;
}
.highlight-body{
  display:flex;
  flex-direction:column;
  gap:2px;
  font-size:10px;
}
.highlight-row{
  display:flex;
  justify-content:space-between;
  gap:6px;
}
.highlight-label{
  color:var(--text-muted);
}
.highlight-value{
  font-weight:500;
  text-align:right;
  max-width:230px;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}
.highlight-value a{
  color:var(--accent);
  text-decoration:none;
  font-weight:500;
}
.highlight-value a:hover{
  text-decoration:underline;
}
.yap-gauge-note{
  margin-top:10px;
  padding:8px 9px;
  border-radius:12px;
  background:rgba(15,23,42,0.02);
  border:1px dashed rgba(148,163,184,0.5);
}
.yap-gauge-note .note-title{
  font-size:11px;
  font-weight:600;
  margin-bottom:4px;
}
.yap-gauge-note .note-list{
  margin:0;
  padding-left:16px;
  font-size:10px;
  color:var(--text-muted);
}
.yap-gauge-note .note-list li{
  margin-bottom:2px;
}

/* Supabase Auth Bar */
.auth-bar{
  position:fixed;
  top:8px;
  right:8px;
  padding:6px 10px;
  background:rgba(15,23,42,0.92);
  color:#e5e7eb;
  font-size:12px;
  border-radius:999px;
  display:flex;
  align-items:center;
  gap:8px;
  z-index:40;
  box-shadow:0 10px 25px rgba(15,23,42,0.45);
}
.auth-bar button{
  border:1px solid rgba(148,163,184,0.7);
  border-radius:999px;
  padding:3px 9px;
  background:#020617;
  color:#e5e7eb;
  font-size:11px;
  cursor:pointer;
}
.auth-bar button:hover{
  background:#0f172a;
}


/* Supabase Auth Panel (slide-in) */
.auth-overlay{
  position:fixed;
  inset:0;
  background:rgba(15,23,42,0.55);
  display:none;
  align-items:stretch;
  justify-content:flex-end;
  z-index:50;
}
.auth-overlay.visible{
  display:flex;
}
.auth-panel{
  width:360px;
  max-width:100%;
  background:linear-gradient(180deg,#ffffff,#f9fbff);
  color:#111827;
  box-shadow:-24px 0 50px rgba(15,23,42,0.9);
  padding:20px 22px 22px;
  display:flex;
  flex-direction:column;
  gap:12px;
  border-radius:20px 0 0 20px;
}
html.dark-theme .auth-panel{
  background:linear-gradient(180deg,#020617,#020617);
  color:#e5e7eb;
}
.auth-panel-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:8px;
  margin-bottom:4px;
}
.auth-panel-title{
  font-size:16px;
  font-weight:700;
}
.auth-panel-sub{
  font-size:12px;
  color:var(--text-muted,#6b7280);
}
html.dark-theme .auth-panel-sub{
  color:var(--text-muted,#9ca3af);
}
.auth-close-btn{
  border:none;
  background:transparent;
  color:var(--text-muted,#9ca3af);
  font-size:18px;
  cursor:pointer;
}

.auth-tabs{
  display:flex;
  gap:6px;
  margin-top:8px;
}
.auth-tab{
  flex:1;
  border-radius:999px;
  border:1px solid rgba(148,163,184,0.7);
  background:transparent;
  padding:6px 8px;
  font-size:11px;
  cursor:pointer;
  color:#6b7280;
}
.auth-tab.active{
  background:#111827;
  color:#f9fafb;
  border-color:#111827;
}
html.dark-theme .auth-tab{
  border-color:rgba(148,163,184,0.7);
  color:#9ca3af;
}
html.dark-theme .auth-tab.active{
  background:#f9fafb;
  color:#020617;
  border-color:#f9fafb;
}
.auth-extra{
  margin-top:6px;
  display:flex;
  flex-direction:column;
  gap:4px;
}
.auth-link-btn{
  border:none;
  background:transparent;
  padding:0;
  font-size:11px;
  text-decoration:underline;
  cursor:pointer;
  color:#4f46e5;
  align-self:flex-start;
}
html.dark-theme .auth-link-btn{
  color:#a5b4fc;
}
.auth-extra-hint{
  margin:0;
  font-size:10px;
  color:var(--text-muted,#9ca3af);
}
.auth-form{
  display:flex;
  flex-direction:column;
  gap:6px;
  margin-top:6px;
}
.auth-label{
  font-size:11px;
  color:#6b7280;
}
html.dark-theme .auth-label{
  color:#9ca3af;
}
.auth-input{
  width:100%;
  border-radius:12px;
  border:1px solid rgba(148,163,184,0.7);
  background:#f9fafb;
  color:#111827;
  padding:8px 11px;
  font-size:13px;
}
html.dark-theme .auth-input{
  background:#020617;
  color:#e5e7eb;
}
.auth-input::placeholder{
  color:#9ca3af;
}
.auth-input:focus{
  outline:none;
  border-color:var(--accent,#4f46e5);
  box-shadow:0 0 0 1px rgba(79,70,229,0.25);
}
.auth-submit-btn{
  margin-top:8px;
  border:none;
  border-radius:999px;
  padding:10px 14px;
  font-size:13px;
  font-weight:600;
  cursor:pointer;
  background:linear-gradient(135deg,#4f46e5,#06b6d4);
  color:#f9fafb;
  box-shadow:0 10px 22px rgba(79,70,229,0.45);
}
.auth-submit-btn:hover{
  filter:brightness(1.03);
}
.auth-hint{
  font-size:11px;
  color:var(--text-muted,#9ca3af);
  margin-top:2px;
}
</style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
    /* MUDDHA ÏÉà ÏÇ¨Ïù¥ÎìúÎ∞î Ïä§ÌÉÄÏùº (Ï†ê + Í∑∏Î£π ÌÉÄÏù¥ÌãÄ) */
    .sidebar{
      background:rgba(255,255,255,0.96);
      border-radius:24px;
      box-shadow:0 22px 60px rgba(148,163,184,0.5);
      border:1px solid rgba(226,232,240,0.9);
    }
    .side-nav{
      display:flex;
      flex-direction:column;
      gap:4px;
      margin-top:14px;
    }
    .side-section-title{
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:0.16em;
      color:#9ca3af;
      margin:10px 8px 2px;
    }
    .side-nav-item{
      display:flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:999px;
      font-size:13px;
      color:#4b5563;
      text-decoration:none;
      cursor:pointer;
      transition:background 0.15s ease, box-shadow 0.15s ease, transform 0.08s ease;
    }
    .side-nav-item:hover{
      background:rgba(226,232,240,0.9);
      transform:translateX(2px);
    }
    .side-nav-item.active{
      background:linear-gradient(90deg,#4f46e5,#06b6d4);
      color:#f9fafb;
      box-shadow:0 12px 30px rgba(79,70,229,0.55);
    }
    .side-nav-item .side-label{
      white-space:nowrap;
    }
    .nav-dot{
      width:8px;
      height:8px;
      border-radius:999px;
      background:#cbd5f5;
      flex-shrink:0;
    }
    .side-nav-item.active .nav-dot{
      background:#ffffff;
    }
    /* collapse Î™®ÎìúÏóêÏÑúÎèÑ Ï†ê Ïú†ÏßÄ */
    .layout.collapsed .nav-dot{
      margin:0 auto;
    }
  </style>
<style>

  /* ===== MUDDHA Pastel Preview Ïä§ÌÉÄÏùº Ïò§Î≤ÑÎùºÏù¥Îìú ===== */
  body{
    background:
      radial-gradient(circle at 0% 0%, rgba(125,211,252,0.45) 0, transparent 45%),
      radial-gradient(circle at 100% 100%, rgba(244,114,182,0.45) 0, transparent 45%),
      linear-gradient(145deg,#f9fafb,#eef2ff);
  }

  .main{
    padding:16px 18px 24px;
    max-width:1280px;
    margin:0 auto;
  }

  /* ÏÉÅÎã® ÌÉëÎ∞îÎ•º ÎØ∏Î¶¨Î≥¥Í∏∞ top-bar ÎäêÎÇåÏúºÎ°ú */
  .top-nav{
    background:rgba(255,255,255,0.9);
    border-radius:22px;
    padding:10px 16px;
    box-shadow:0 18px 40px rgba(148,163,184,0.25);
    border:1px solid rgba(221,231,255,0.9);
    backdrop-filter:blur(16px);
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    margin-bottom:14px;
    position:sticky;
    top:12px;
    z-index:5;
  }
  .top-title{
    font-size:18px;
    font-weight:700;
    letter-spacing:-0.03em;
    color:#0f172a;
  }
  .top-sub{
    font-size:12px;
    color:#6b7280;
    margin-top:2px;
  }
  .top-cta{
    display:flex;
    align-items:center;
    gap:10px;
  }

  /* Ïπ¥Îìú/ÎåÄÏãúÎ≥¥Îìú ÏÖÄÏùÑ ÌååÏä§ÌÖî Î∞ïÏä§Î°ú */
  .card,
  .dash-cell,
  .csv-card,
  .leaderboard-card,
  .community-card{
    background:rgba(255,255,255,0.9) !important;
    border-radius:22px !important;
    box-shadow:0 18px 40px rgba(148,163,184,0.25) !important;
    border:1px solid rgba(221,231,255,0.9) !important;
    backdrop-filter:blur(16px);
  }

  .dash-cell-title,
  .section-title{
    font-weight:600;
  }

  /* ÏÑπÏÖò Í∞ÑÍ≤© ÏïΩÍ∞Ñ Ï§ÑÏù¥Í∏∞ */
  #view-dashboard,
  #view-csv,
  #view-leaderboard,
  #view-infofi,
  #view-yap-gauge,
  #view-cookie,
  #view-community,
  #view-history,
  #view-projects,
  #view-yapping,
  #view-guide{
    padding-top:6px;
  }

</style>
<style>
.tag-pill{
  font-size:11px;
  padding:4px 9px;
  border-radius:999px;
  background:rgba(219,234,254,0.9);
  color:#1d4ed8;
  display:inline-flex;
  align-items:center;
  gap:6px;
}
.tag-pill-dot{
  width:6px;
  height:6px;
  border-radius:999px;
  background:#60a5fa;
}
.user-pill{
  display:flex;
  align-items:center;
  gap:8px;
  padding:4px 8px;
  border-radius:999px;
  background:rgba(248,250,252,0.9);
  border:1px solid rgba(226,232,240,0.9);
}
.user-avatar{
  width:26px;
  height:26px;
  border-radius:999px;
  background:linear-gradient(135deg,#38bdf8,#a855f7);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:13px;
  color:#ffffff;
  font-weight:600;
}
.user-info{
  display:flex;
  flex-direction:column;
  gap:2px;
}
.user-name{
  font-size:12px;
  font-weight:600;
}
.user-handle{
  font-size:10px;
  color:#9ca3af;
}
</style>
<style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", sans-serif;
      background:
        radial-gradient(circle at 0% 0%, rgba(125, 211, 252, 0.45) 0, transparent 45%),
        radial-gradient(circle at 100% 100%, rgba(244, 114, 182, 0.45) 0, transparent 45%),
        linear-gradient(145deg, #f9fafb, #eef2ff);
      color: #0f172a;
      display: flex;
      align-items: stretch;
      justify-content: stretch;
      padding: 16px;
      gap: 16px;
    }
    .app-shell {
      display: flex;
      flex: 1;
      max-width: 1280px;
      margin: 0 auto;
      gap: 16px;
    }
    .sidebar {
      width: 240px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 22px;
      padding: 18px 14px;
      box-shadow: 0 18px 50px rgba(148, 163, 184, 0.35);
      border: 1px solid rgba(221, 231, 255, 0.9);
      backdrop-filter: blur(20px);
      display: flex;
      flex-direction: column;
      gap: 18px;
    }
    .logo-row {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 0 4px;
    }
    .logo-circle {
      width: 32px;
      height: 32px;
      border-radius: 14px;
      background: conic-gradient(from 180deg, #38bdf8, #a855f7, #f472b6, #38bdf8);
      padding: 2px;
    }
    .logo-circle-inner {
      width: 100%;
      height: 100%;
      border-radius: inherit;
      background: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 16px;
      letter-spacing: -0.08em;
      color: #4b5563;
    }
    .logo-text-main {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: -0.04em;
    }
    .logo-text-sub {
      font-size: 11px;
      color: #9ca3af;
    }

    .nav-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #9ca3af;
      padding: 0 6px;
      margin: 10px 0 4px;
    }
    .nav {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-top: 4px;
    }
    .nav-item,
    .sub-nav-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      border-radius: 12px;
      font-size: 13px;
      color: #4b5563;
      cursor: pointer;
      transition: background 0.15s ease, transform 0.1s ease;
    }
    .nav-item:hover,
    .sub-nav-item:hover {
      background: rgba(226, 232, 240, 0.9);
      transform: translateX(2px);
    }
    .nav-item.active,
    .sub-nav-item.active {
      background: linear-gradient(90deg, rgba(56, 189, 248, 0.18), rgba(168, 85, 247, 0.18));
      color: #111827;
      font-weight: 600;
      transform: translateX(2px);
    }
    .nav-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #c4d4ff;
      flex-shrink: 0;
    }
    .nav-item.active .nav-dot,
    .sub-nav-item.active .nav-dot {
      background: #6366f1;
    }

    .nav-item.parent {
      justify-content: space-between;
    }
    .nav-item-label-wrap {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .nav-chevron {
      font-size: 11px;
      color: #9ca3af;
      transition: transform 0.18s ease;
    }
    .nav-item.parent.open .nav-chevron {
      transform: rotate(90deg);
    }

    .sub-nav {
      margin-left: 20px;
      margin-top: 2px;
      display: none;
      flex-direction: column;
      gap: 2px;
    }
    .sub-nav.open {
      display: flex;
    }
    .sub-nav-item {
      font-size: 12px;
      padding: 7px 10px;
    }

    .pill-info {
      margin-top: 10px;
      font-size: 11px;
      padding: 8px 10px;
      border-radius: 16px;
      background: rgba(239, 246, 255, 0.9);
      color: #1d4ed8;
      line-height: 1.35;
    }
    .pill-info b { color: #111827; }
    .sidebar-footer {
      margin-top: auto;
      font-size: 10px;
      color: #9ca3af;
      padding: 0 6px;
    }

    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .top-bar {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 22px;
      padding: 10px 16px;
      box-shadow: 0 18px 40px rgba(148, 163, 184, 0.25);
      border: 1px solid rgba(221, 231, 255, 0.9);
      backdrop-filter: blur(16px);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }
    .top-left {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .page-title {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: -0.03em;
    }
    .page-sub {
      font-size: 12px;
      color: #6b7280;
    }
    .top-right {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .tag-pill {
      font-size: 11px;
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(219, 234, 254, 0.9);
      color: #1d4ed8;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .tag-pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #60a5fa;
    }
    .user-pill {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(248, 250, 252, 0.9);
      border: 1px solid rgba(226, 232, 240, 0.9);
      cursor: default;
    }
    .user-avatar {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      background: linear-gradient(135deg, #38bdf8, #a855f7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      color: #ffffff;
      font-weight: 600;
    }
    .user-info {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .user-name {
      font-size: 12px;
      font-weight: 600;
    }
    .user-handle {
      font-size: 10px;
      color: #9ca3af;
    }

    .grid {
      flex: 1;
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.2fr);
      grid-auto-rows: minmax(0, auto);
      gap: 12px;
      margin-top: 4px;
    }
    .card {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 22px;
      padding: 14px 14px 12px;
      box-shadow: 0 18px 40px rgba(148, 163, 184, 0.25);
      border: 1px solid rgba(221, 231, 255, 0.9);
      backdrop-filter: blur(16px);
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-height: 0;
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    .card-title {
      font-size: 13px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .card-sub {
      font-size: 11px;
      color: #9ca3af;
    }
    .badge-soft {
      font-size: 10px;
      padding: 3px 7px;
      border-radius: 999px;
      background: rgba(239, 246, 255, 0.9);
      color: #1d4ed8;
    }
    .placeholder-box {
      margin-top: 6px;
      border-radius: 16px;
      border: 1px dashed rgba(148, 163, 184, 0.7);
      padding: 10px 12px;
      font-size: 12px;
      color: #4b5563;
      background: rgba(248, 250, 252, 0.9);
      line-height: 1.5;
    }
    .placeholder-title {
      font-weight: 600;
      margin-bottom: 4px;
    }
    .placeholder-list {
      margin-top: 4px;
      padding-left: 16px;
      font-size: 11px;
      color: #6b7280;
    }
    .placeholder-list li { margin-bottom: 2px; }

    .section {
      display: none;
      flex: 1;
      flex-direction: column;
    }
    .section.active {
      display: flex;
    }

    .section-note {
      font-size: 11px;
      color: #6b7280;
      margin: 4px 2px 0;
    }

    @media (max-width: 980px) {
      body { padding: 10px; }
      .app-shell {
        flex-direction: column;
      }
      .sidebar {
        width: 100%;
        flex-direction: row;
        align-items: flex-start;
        gap: 14px;
        padding: 12px;
      }
      .grid {
        grid-template-columns: minmax(0, 1fr);
      }
      .sidebar-footer {
        display: none;
      }
    }
  
  .cookie-project-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 16px;
    margin-top: 16px;
  }
  .cookie-project-card {
    background: rgba(255,255,255,0.8);
    border-radius: 16px;
    padding: 14px 16px;
    box-shadow: 0 10px 30px rgba(32, 46, 120, 0.16);
  }
  .dark .cookie-project-card {
    background: rgba(13,20,40,0.96);
  }
  .cookie-project-card-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
  }
  .cookie-project-logo {
    width: 32px;
    height: 32px;
    border-radius: 999px;
    background: linear-gradient(135deg,#ffb347,#ff5e62);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:14px;
    font-weight:700;
    color:#fff;
  }
  .cookie-project-head-main {
    display:flex;
    flex-direction:column;
    gap:2px;
  }
  .cookie-project-name {
    font-weight:600;
    font-size:14px;
  }
  .cookie-project-meta {
    font-size:11px;
    opacity:0.7;
  }
  .cookie-project-card-body {
    display:grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap:10px;
    margin-top:6px;
  }
  @media (max-width: 900px){
    .cookie-project-card-body {
      grid-template-columns: minmax(0, 1fr);
    }
  }
  .cookie-project-segment {
    background: rgba(255,255,255,0.7);
    border-radius: 12px;
    padding: 8px 10px;
  }
  .dark .cookie-project-segment {
    background: rgba(10,16,35,0.96);
  }
  .cookie-seg-title {
    font-size:11px;
    font-weight:600;
    opacity:0.7;
    margin-bottom:4px;
  }

  /* MUDDHA pastel stat tables */
  .muddha-seg-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 11px;
    table-layout: fixed;
  }
  .muddha-seg-table thead {
    display: table-header-group;
  }
  .muddha-seg-table thead th {
    padding: 2px 4px 4px;
    font-weight: 600;
    color: #6b7280;
    text-align: center;
    border-bottom: 1px solid rgba(229,231,235,0.9);
    position: static !important;
    background: transparent !important;
    z-index: auto !important;
  }
  .muddha-seg-table tbody td {
    padding: 3px 4px;
    border-bottom: 1px solid rgba(243,244,246,1);
  }
  .muddha-seg-table tbody tr:last-child td {
    border-bottom: none;
  }
  .muddha-seg-table td:nth-child(1) {
    width: 32px;
    text-align: left;
    color: #4b5563;
  }
  .muddha-seg-table td:nth-child(2) {
    text-align: right;
    font-variant-numeric: tabular-nums;
  }
  .muddha-seg-table td:nth-child(3) {
    text-align: right;
    font-weight: 600;
    font-variant-numeric: tabular-nums;
  }
  .cookie-seg-table {
    width:100%;
    border-collapse:collapse;
    font-size:11px;
  }
  .cookie-seg-table thead {
    display: none;
  }

  /* Í∞ïÏ†ú: Cookie Ïπ¥Îìú ÎÇ¥Î∂Ä MS% Ïª¨Îüº Í∏ÄÏûê ÏßÑÌïòÍ≤å, Ìï≠ÏÉÅ Î≥¥Ïù¥ÎèÑÎ°ù */
  .cookie-seg-table td:nth-child(3),
  .cookie-seg-table th:nth-child(3) {
    display: table-cell !important;
    text-align: right;
    color: #2563eb !important;  /* ÏßÑÌïú ÌååÎûë */
    font-weight: 600;
    opacity: 1 !important;
  }

  .cookie-seg-table th,
  .cookie-seg-table td {
    padding:3px 4px;
    text-align:left;
  }
  .cookie-seg-table thead {
    opacity:0.7;
  }

  
  /* Ensure 3rd column (MS%) in Cookie tables is always visible */
  .cookie-seg-table td:nth-child(3),
  .cookie-seg-table th:nth-child(3) {
    display: table-cell !important;
    text-align: right;
  }
/* Cookie: hide raw list table under cards */
  #view-cookie .infofi-results .table-wrap {
    display: none;
  }

  /* Cookie: make project logo circle a bit bigger */
  .cookie-project-logo {
    width: 40px;
    height: 40px;
    font-size: 16px;
  }

  .cookie-project-logo.has-img {
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    color: transparent;
  }

  /* Í∞ïÏ†ú: Cookie Ïπ¥Îìú ÎÇ¥Î∂Ä MS% Ïª¨Îüº Í∏ÄÏûê ÏßÑÌïòÍ≤å, Ìï≠ÏÉÅ Í≤ÄÏ†ïÏúºÎ°ú Î≥¥Ïù¥ÎèÑÎ°ù */
  .cookie-seg-table td:nth-child(3),
  .cookie-seg-table th:nth-child(3) {
    display: table-cell !important;
    text-align: right !important;
    color: #000000 !important;      /* ÏôÑÏ†Ñ Í≤ÄÏ†ï */
    font-weight: 700 !important;    /* ÍµµÍ≤å */
    opacity: 1 !important;          /* Ìà¨Î™ÖÎèÑ Ï†úÍ±∞ */
    mix-blend-mode: normal !important;
    filter: none !important;
  }

/* FULL OPACITY FIX */
.cookie-seg-table, 
.cookie-seg-table td, 
.cookie-seg-table th {
  opacity: 1 !important;
  mix-blend-mode: normal !important;
  color: #000 !important;
  font-weight: 600 !important;
}
</style>
<style>
/* Layout A: desktop-focused fixed width */
.layout.app-shell{
  max-width:1280px;
  margin:0 auto;
  width:100%;
  overflow-x:auto;
}
.main{
  max-width:1280px;
  min-width:980px;
}

/* Cookie Ïπ¥Îìú Í∑∏Î¶¨Îìú */
.cookie-project-cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
  gap: 20px;
}

/* Cookie Ïπ¥Îìú ÌÖåÏù¥Î∏î Ï†ïÎ†¨/Ìè≠ ÌÜµÏùº */
.cookie-project-card .muddha-seg-table{
  width:100%;
  table-layout:fixed;
  min-width:0 !important;
}
.cookie-project-card .muddha-seg-table th,
.cookie-project-card .muddha-seg-table td{
  padding:3px 4px !important;
  border-bottom:1px solid rgba(243,244,246,1);
}
.cookie-project-card .muddha-seg-table th:nth-child(1){
  text-align:left;
}
.cookie-project-card .muddha-seg-table th:nth-child(2),
.cookie-project-card .muddha-seg-table th:nth-child(3){
  text-align:right;
}
.cookie-project-card .muddha-seg-table td:nth-child(1){
  text-align:left;
  width:28%;
}
.cookie-project-card .muddha-seg-table td:nth-child(2){
  text-align:right;
  width:36%;
  font-variant-numeric:tabular-nums;
}
.cookie-project-card .muddha-seg-table td:nth-child(3){
  text-align:right;
  width:36%;
  font-variant-numeric:tabular-nums;
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
</head>
<body>
<div class="layout app-shell">
<!-- AUTH BAR -->
<!-- AUTH PANEL (slide-in) -->
<div class="auth-overlay" id="auth-overlay">
<div class="auth-panel">
<div class="auth-panel-header">
<div>
<div class="auth-panel-title" id="auth-mode-label">Î°úÍ∑∏Ïù∏ / ÌöåÏõêÍ∞ÄÏûÖ</div>
<div class="auth-panel-sub">Ïù¥Î©îÏùº ÌïòÎÇòÎ°ú Í∞ÑÎã®ÌïòÍ≤å Î°úÍ∑∏Ïù∏ÌïòÍ±∞ÎÇò, Ï≤òÏùåÏù¥Î©¥ Î∞îÎ°ú Í≥ÑÏ†ïÏùÑ ÎßåÎì§ Ïàò ÏûàÏñ¥Ïöî.</div>
</div>
<button class="auth-close-btn" id="auth-close-btn" type="button">√ó</button>
</div>
<div class="auth-tabs">
<button class="auth-tab active" id="auth-tab-login" type="button">Ïù¥Î©îÏùº Î°úÍ∑∏Ïù∏</button>
<button class="auth-tab" id="auth-tab-signup" type="button">ÏÉà Í≥ÑÏ†ï ÎßåÎì§Í∏∞</button>
</div>
<form class="auth-form" id="auth-form">
<label class="auth-label" for="auth-email">Ïù¥Î©îÏùº</label>
<input class="auth-input" id="auth-email" placeholder="example@mindshare.app" required="" type="email"/>
<label class="auth-label" for="auth-password">ÎπÑÎ∞ÄÎ≤àÌò∏</label>
<input class="auth-input" id="auth-password" placeholder="8Ïûê Ïù¥ÏÉÅ ÏûÖÎ†•Ìï¥ Ï£ºÏÑ∏Ïöî" required="" type="password"/>
<button class="auth-submit-btn" id="auth-submit-btn" type="submit">Ïù¥Î©îÏùºÎ°ú Î°úÍ∑∏Ïù∏</button>
<div class="auth-hint">‚Äª Í∞ôÏùÄ Ïù¥Î©îÏùº¬∑ÎπÑÎ∞ÄÎ≤àÌò∏ Ï°∞Ìï©Ïù¥Î©¥ Í∞ôÏùÄ Í≥ÑÏ†ïÏúºÎ°ú Ïù∏ÏãùÎèºÏöî.</div>
<div class="auth-extra">
<button class="auth-link-btn" id="auth-forgot-password" type="button">ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûäÏúºÏÖ®ÎÇòÏöî?</button>
<p class="auth-extra-hint">ÌòÑÏû¨Îäî ÌÖåÏä§Ìä∏Ïö© Î°úÍ∑∏Ïù∏Ïù¥Îùº Ïù¥Î©îÏùºÏùÑ ÏûäÏñ¥Î≤ÑÎ¶¨Î©¥ ÏÉà Ïù¥Î©îÏùºÎ°ú ÏÉà Í≥ÑÏ†ïÏùÑ ÎßåÎì§Ïñ¥ÏÑú ÏÇ¨Ïö©Ìï¥Ïïº Ìï¥Ïöî.</p>
</div>
</form>
</div>
</div>
<!-- SIDEBAR -->
<aside class="sidebar">
<button class="sidebar-toggle" id="sidebar-toggle">‚ü®</button>
<div>
<div class="side-profile">
<div class="side-avatar">
<img alt="avatar" id="side-avatar-img" src="https://unavatar.io/twitter/bud_dha__"/>
</div>
<div>
<div class="side-name" id="side-username">Í≤åÏä§Ìä∏</div>
<a class="side-handle" href="https://twitter.com" id="side-handle-link" target="_blank">@ÏùµÎ™Ö</a>
</div>
</div>
<div class="side-auth-pill">
<div class="side-auth-header">
<span class="side-auth-label">ÎßàÏù∏ÎìúÏâêÏñ¥ Í≥ÑÏ†ï</span>
<span class="side-auth-status" id="auth-status">Î°úÍ∑∏Ïù∏ Ïïà Îê®</span>
</div>
<button class="side-auth-main-btn" id="auth-login-btn" type="button">Ïù¥Î©îÏùºÎ°ú ÏãúÏûëÌïòÍ∏∞</button>
<button class="side-auth-main-btn side-auth-main-btn--secondary" id="auth-logout-btn" style="display:none;" type="button">Î°úÍ∑∏ÏïÑÏõÉ</button>
<p class="side-auth-caption">CSV Ï†ÄÏû•¬∑Ïª§ÎÆ§ÎãàÌã∞ Í∏ÄÏì∞Í∏∞¬∑YAP Í≤åÏù¥ÏßÄ Ïó∞Îèô</p>
</div>
<div class="side-nav">
<div class="side-section-title">Î©îÏù∏</div>
<div class="side-nav-item active" data-view="dashboard">
<span class="nav-dot"></span><span class="side-label" id="nav-dashboard-label">ÎåÄÏãúÎ≥¥Îìú</span>
</div>
<div class="side-nav-item" data-view="csv">
<span class="nav-dot"></span><span class="side-label" id="nav-csv-label">CSV Î∂ÑÏÑù</span>
</div>
<div class="side-nav-item" data-view="leaderboard">
<span class="nav-dot"></span><span class="side-label" id="nav-leaderboard-label">Î¶¨ÎçîÎ≥¥Îìú</span>
</div>
<div class="side-section-title">KAITO</div>
<div class="side-nav-item" data-view="infofi">
<span class="nav-dot"></span><span class="side-label" id="nav-infofi-label">Kaito Î¶¨ÎçîÎ≥¥Îìú</span>
</div>
<div class="side-nav-item" data-view="yap-gauge">
<span class="nav-dot"></span><span class="side-label" id="nav-yapgauge-label">YAP Í≤åÏù¥ÏßÄ</span>
</div>
<div class="side-section-title">COOKIE</div>
<div class="side-nav-item" data-view="cookie">
<span class="nav-dot"></span><span class="side-label" id="nav-cookie-label">Cookie Î¶¨ÎçîÎ≥¥Îìú</span>
</div>
<div class="side-section-title">Í∏∞ÌÉÄ</div>
<div class="side-nav-item" data-view="guide">
<span class="nav-dot"></span><span class="side-label" id="nav-guide-label">ÏÇ¨Ïö©Î∞©Î≤ï ¬∑ ÏÑ§Ï†ï</span>
</div>
<div class="side-nav-item" data-view="history">
<span class="nav-dot"></span><span class="side-label" id="nav-history-label">ÎÇ¥ ÌûàÏä§ÌÜ†Î¶¨</span>
</div>
<div class="side-nav-item" data-view="projects">
<span class="nav-dot"></span><span class="side-label" id="nav-projects-label">ÌîÑÎ°úÏ†ùÌä∏Î≥Ñ ÎßàÏù∏ÎìúÏâêÏñ¥</span>
</div>
<div class="side-nav-item" data-view="yapping">
<span class="nav-dot"></span><span class="side-label" id="nav-yapping-label">ÏïºÌïë ÌîåÎûòÎÑà</span>
</div>
<div class="side-nav-item" data-view="community">
<span class="nav-dot"></span><span class="side-label" id="nav-community-label">Ïª§ÎÆ§ÎãàÌã∞</span>
</div>
<a class="side-nav-item" href="https://buddha913.github.io/crypto-fullcourse/" target="_blank">
<span class="nav-dot"></span><span class="side-label" id="nav-course-label">ÌÅ¨Î¶ΩÌÜ† ÌíÄÏΩîÏä§</span>
</a>
</div>
</div>
<div class="side-footer">
      InfoFi Creator Console (Beta)
      <div class="side-badge">
        Ïò§ÎäòÎèÑ Ìïú Î≤à<br/>ÎßàÏâê ÌÑ∞Ìä∏Î†§Î≥ºÍπå? üí•
      </div>
<div class="side-theme">
<label class="theme-toggle-label">
<input id="theme-toggle" type="checkbox"/>
<span class="theme-toggle-text">Dark</span>
</label>
</div>
</div>
</aside>
<!-- MAIN -->
<main class="main">
<!-- ‚ñº‚ñº Dashboard ÌôîÎ©¥ ‚ñº‚ñº -->
<div id="view-dashboard">
<div class="top-nav">
<div class="top-left">
<div class="top-title">MUDDHA ¬∑ Mindshare Analyzer</div>
<div class="top-sub">X CSV¬∑Kaito¬∑Cookie¬∑InfoFi Îç∞Ïù¥ÌÑ∞Î•º Ìïú Î≤àÏóê ÏóÆÏñ¥ÏÑú Î≥¥Îäî MUDDHA Î©îÏù∏ ÎåÄÏãúÎ≥¥ÎìúÏûÖÎãàÎã§.</div>
</div>
<div class="top-cta">
<div class="tag-pill">
<span class="tag-pill-dot"></span>
            Nav v3 ¬∑ Î¶¨ÎçîÎ≥¥Îìú = Í∏∞Ï°¥ MUDDHA Ï†êÏàò
          </div>
<div class="user-pill">
<div class="user-avatar">MD</div>
<div class="user-info">
<div class="user-name">Î°úÍ∑∏Ïù∏ ÏûêÎ¶¨</div>
<div class="user-handle">@supabase Auth Ïó∞Îèô ÏòàÏ†ï</div>
</div>
</div>
</div>
</div><div class="section-note">Ï†ÑÏ≤¥ Í≥ÑÏ†ïÏùò ÎßàÏù∏ÎìúÏâêÏñ¥ ÌùêÎ¶ÑÍ≥º BTC/ETH/ÌôòÏú®, MUDDHA Î¶¨ÎçîÎ≥¥ÎìúÎ•º Ìïú ÌôîÎ©¥ÏóêÏÑú Î≥¥Îäî Ìôà ÌÉ≠ÏûÖÎãàÎã§.</div>
<!-- Dashboard ÏÉÅÎã®: ÏÑ±Ïû• Í∑∏ÎûòÌîÑ + ÏöîÏïΩ Ïπ¥Îìú -->
<div class="grid-1 dashboard-summary-grid">
<div class="column-main">
<section class="card growth-card">
<div class="growth-card-title" id="growth-title">üìà Í≥ÑÏ†ï ÏÑ±Ïû• Í∑∏ÎûòÌîÑ</div>
<div class="growth-card-sub" id="growth-sub">
        ÏµúÍ∑º Í∏∞Í∞Ñ ÎèôÏïà ÏõêÍ∏Ä Í∞úÏàò / ÌèâÍ∑† Ïä§ÏΩîÏñ¥ Ï∂îÏù¥Î•º Í∑∏ÎûòÌîÑÎ°ú Î≥¥Ïó¨Ï§çÎãàÎã§.
      </div>
<div class="growth-chart-wrap">
<!-- ÎÇòÏ§ëÏóê JSÏóêÏÑú Ï±ÑÏö∏ Ï∫îÎ≤ÑÏä§ -->
<canvas height="140" id="growth-chart"></canvas>
</div>
</section>
</div>
<div class="column-side">
<section class="card">
<div class="section-header">
<div>
<div class="section-title">ÏöîÏïΩ Ïπ¥Îìú (Ìè¨Ïä§Ìä∏ / Ï†êÏàò / Ìä∏Î¶ºÎìú / ÏµúÍ≥† ÌÑ∞ÏßÑ Í∏Ä)</div>
<div class="section-sub">CSVÎ•º ÏóÖÎ°úÎìúÌïòÎ©¥ Ï¥ù ÏõêÍ∏Ä Ïàò ¬∑ ÌèâÍ∑† Ïä§ÏΩîÏñ¥ ¬∑ Ìä∏Î¶ºÎìú ÌèâÍ∑† ¬∑ ÏµúÍ≥† Í∏ÄÏùÑ Ìïú Î≤àÏóê Î≥¥Ïó¨Ï§ÑÍ≤å.</div>
</div>
</div>
<div class="summary-grid" id="summary" style="display:none"></div>
</section>
</div>
</div>
<!-- Î©îÏù∏ Í∑∏Î¶¨Îìú: BTC/ETH/Ïù¥Ïäà ¬∑ ÌôòÏú® ¬∑ Î¶¨ÎçîÎ≥¥Îìú -->
<div class="dash-grid">
<!-- 1Ìñâ: BTC / ETH / Ïò§ÎäòÏùò Ïù¥Ïäà -->
<section class="dash-cell dash-asset" id="dash-btc">
<div class="dash-cell-header">
<div class="dash-cell-title">BTC</div>
<div class="dash-cell-sub">Ïã§ÏãúÍ∞Ñ Í∞ÄÍ≤© Í∑∏ÎûòÌîÑ (USD)</div>
</div>
<div class="dash-chart-wrap">
<canvas height="90" id="btc-chart"></canvas>
</div>
<div class="dash-price" id="btc-price-text">Î°úÎìú Ï§ë...</div>
</section>
<section class="dash-cell dash-asset" id="dash-eth">
<div class="dash-cell-header">
<div class="dash-cell-title">ETH</div>
<div class="dash-cell-sub">Ïã§ÏãúÍ∞Ñ Í∞ÄÍ≤© Í∑∏ÎûòÌîÑ (USD)</div>
</div>
<div class="dash-chart-wrap">
<canvas height="90" id="eth-chart"></canvas>
</div>
<div class="dash-price" id="eth-price-text">Î°úÎìú Ï§ë...</div>
</section>
<!-- 2Ìñâ: ÏõêÌôî / Îã¨Îü¨ / ÌîÑÎ°úÏ†ùÌä∏ -->
<section class="dash-cell dash-projects" id="dash-projects">
<div class="dash-cell-header">
<div class="dash-cell-title">üî• ÏÑúÎ≤Ñ Í∏∞Î∞ò ÌîÑÎ°úÏ†ùÌä∏ Top5 (Beta)</div>
<div class="dash-cell-sub" id="csv-server-top5-sub">CSVÎ•º ÏóÖÎ°úÎìúÌïòÎ©¥ ÏÑúÎ≤Ñ Í∏∞Ï§Ä ÏÉÅÏúÑ 5Í∞ú ÌîÑÎ°úÏ†ùÌä∏Î•º Ïó¨Í∏∞Ïóê Î≥¥Ïó¨Ï§ÑÍ≤å.</div>
</div>
<div class="dash-projects-wrap" id="csv-server-top5-body">
<div class="empty">ÏïÑÏßÅ ÏÑúÎ≤Ñ Î∂ÑÏÑù Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§.</div>
</div>
</section>
<!-- 3Ìñâ: MUDDHA Î¶¨ÎçîÎ≥¥Îìú TOP 10 / Í≥µÎ∞±¬∑Ï∂îÏ≤ú -->
<section class="dash-cell dash-leader" id="dash-leader" style="grid-column:span 3;">
<div class="dash-cell-header">
<div class="dash-cell-title">MUDDHA Î¶¨ÎçîÎ≥¥Îìú TOP 10</div>
<div class="dash-cell-sub">CSV Í∏∞Î∞ò ÎßàÏù∏ÎìúÏâêÏñ¥ Î¶¨ÎçîÎ≥¥Îìú ÏÉÅÏúÑ 10Î™Ö</div>
</div>
<div class="table-wrap" id="dashboard-leaderboard-wrap">
<div class="empty">Î¶¨ÎçîÎ≥¥ÎìúÎ•º Î∂àÎü¨Ïò§Îäî Ï§ë...</div>
</div>
</section>
</div>
</div>
<!-- ‚ñ≤‚ñ≤ Dashboard ÎÅù ‚ñ≤‚ñ≤ -->
<!-- ‚ñº‚ñº ÏÇ¨Ïö©Î∞©Î≤ï ÌôîÎ©¥ ‚ñº‚ñº -->
<div id="view-guide" style="display:none;">
<div class="top-nav">
<div>
<div class="top-title">MUDDHA ÏÇ¨Ïö©Î∞©Î≤ï</div>
<div class="top-sub">
            X Ïï†ÎÑêÎ¶¨Ìã±Ïä§ CSVÎßå ÏûàÏúºÎ©¥ ÎÇ¥ Í≥ÑÏ†ïÏùò ÎßàÏù∏ÎìúÏâêÏñ¥Î•º Ìïú Î≤àÏóê ÏßÑÎã®ÌïòÎäî Í∞ÄÏù¥ÎìúÏïº.
          </div>
</div>
</div><div class="section-note">CSV Îã§Ïö¥Î°úÎìú Î∞©Î≤ïÍ≥º MUDDHA ÏÇ¨Ïö©Î≤ïÏùÑ Îã®Í≥ÑÎ≥ÑÎ°ú Ï†ïÎ¶¨Ìïú Í∞ÄÏù¥ÎìúÏûÖÎãàÎã§.</div>
<section class="card card-soft" style="margin-top:8px; max-width:920px;">
<div class="section-header">
<div class="section-title">1. X Ïï†ÎÑêÎ¶¨Ìã±Ïä§ CSV Í∞ÄÏ†∏Ïò§Í∏∞</div>
</div>
<div style="font-size:12px; line-height:1.8; color:var(--text-main);">
<ol style="padding-left:18px; margin:0;">
<li>Ïò§Î•∏Ï™Ω ÏÉÅÎã® ÌîÑÎ°úÌïÑ Î©îÎâ¥ÏóêÏÑú <b>Premium</b> Î©îÎâ¥Î•º ÎàåÎü¨ <b>X Premium</b> ÌôîÎ©¥ÏúºÎ°ú Ïù¥ÎèôÌïúÎã§.</li>
<li>ÏôºÏ™Ω Î©îÎâ¥ÏóêÏÑú <b>Ïï†ÎÑêÎ¶¨Ìã±Ïä§(Analytics)</b>Î•º ÌÅ¥Î¶≠ÌïúÎã§.</li>
<li>ÏÉÅÎã® ÌÉ≠ÏóêÏÑú <b>ÏöîÏïΩ</b> ÎåÄÏã† <b>ÏΩòÌÖêÏ∏†</b> ÌÉ≠ÏúºÎ°ú Ïù¥ÎèôÌïúÎã§.</li>
<li>Î∏åÎùºÏö∞Ï†ÄÎ•º Ï†ÑÏ≤¥ ÌôîÎ©¥(Ï∞ΩÎ™®ÎìúÍ∞Ä ÏïÑÎãå Ï†ÑÏ≤¥Î™®Îìú)ÏúºÎ°ú Ïº† Îí§, Ìëú Ïò§Î•∏Ï™Ω ÏúÑÏùò
              <b>‚¨áÔ∏é ÎÇ¥Î†§Î∞õÍ∏∞ ÏïÑÏù¥ÏΩò</b>ÏùÑ ÌÅ¥Î¶≠Ìï¥ CSVÎ•º Ï†ÄÏû•ÌïúÎã§.</li>
<li>Î≥¥ÌÜµ ÌååÏùº Ïù¥Î¶ÑÏù¥
              <code style="font-size:11px; background:#f3f4f6; padding:2px 4px; border-radius:4px;">
                account_analytics_content_YYYY-MM-DD_YYYY-MM-DD.csv
              </code>
              Ïù¥Îü∞ ÌòïÌÉúÎ°ú Ï†ÄÏû•ÎêúÎã§.
            </li>
</ol>
</div>
</section>
<section class="card card-soft" style="margin-top:10px; max-width:920px;">
<div class="section-header">
<div class="section-title">2. MUDDHA Î∂ÑÏÑùÍ∏∞Ïóê CSV Ïò¨Î¶¨Í∏∞</div>
</div>
<div style="font-size:12px; line-height:1.8; color:var(--text-main);">
<ol style="padding-left:18px; margin:0;">
<li>ÏôºÏ™Ω ÏÇ¨Ïù¥ÎìúÎ∞îÏóêÏÑú <b>CSVÎ°ú Î∂ÑÏÑù</b> ÌÉ≠ÏùÑ ÌÅ¥Î¶≠ÌïúÎã§.</li>
<li>ÌôîÎ©¥ ÏÉÅÎã®Ïùò <b>CSV ÌååÏùº ÏÑ†ÌÉùÌïòÍ∏∞</b> Î≤ÑÌäºÏùÑ ÎàåÎü¨, Î∞©Í∏à Ï†ÄÏû•Ìïú CSV ÌååÏùºÏùÑ ÏÑ†ÌÉùÌïúÎã§.</li>
<li>ÌååÏùºÏùÑ Ïò¨Î¶¨Î©¥ ÏûêÎèôÏúºÎ°ú Îç∞Ïù¥ÌÑ∞Í∞Ä Î°úÎî©ÎêòÍ≥†, <b>Ï†ÑÏ≤¥ / 7D / 30D</b> Í∞ôÏùÄ Í∏∞Í∞Ñ ÌÉ≠ÏùÑ ÎàåÎü¨ÏÑú
              Î≥¥Í≥† Ïã∂ÏùÄ Íµ¨Í∞ÑÏùÑ Î∞îÍøÄ Ïàò ÏûàÎã§.</li>
<li>ÎãµÍ∏Ä(Î¶¨ÌîåÎùºÏù¥)ÏùÄ ÏûêÎèôÏúºÎ°ú Ï†úÏô∏ÎêòÍ≥†, <b>ÏõêÍ∏Ä Í∏∞Ï§Ä</b>ÏúºÎ°úÎßå Ï†êÏàòÏôÄ Îì±Í∏âÏù¥ Í≥ÑÏÇ∞ÎêúÎã§.</li>
</ol>
</div>
</section>
<section class="card card-soft" style="margin-top:10px; max-width:920px;">
<div class="section-header">
<div class="section-title">3. Ïù¥ Î∂ÑÏÑùÍ∏∞Î°ú Î≥º Ïàò ÏûàÎäî Í≤ÉÎì§</div>
</div>
<div style="font-size:12px; line-height:1.8; color:var(--text-main);">
<ul style="padding-left:18px; margin:0;">
<li><b>ÏöîÏïΩ Ïπ¥Îìú</b> ‚Äì ÏõêÍ∏Ä Í∞úÏàò, ÌèâÍ∑† Ïä§ÏΩîÏñ¥, Ìä∏Î¶ºÎìú ÌèâÍ∑†, Í∞ÄÏû• ÌÑ∞ÏßÑ Í∏ÄÏùÑ Ìïú Ï§ÑÎ°ú ÌôïÏù∏.</li>
<li><b>Í≥ÑÏ†ï ÏÑ±Ïû• Í∑∏ÎûòÌîÑ</b> ‚Äì ÎÇ†ÏßúÎ≥Ñ ÏõêÍ∏Ä Ïàò / ÌèâÍ∑† Ïä§ÏΩîÏñ¥ ÌùêÎ¶ÑÏùÑ Ìïú Î≤àÏóê Î≥∏Îã§.</li>
<li><b>YAP ÌûàÌä∏Îßµ</b> ‚Äì ÎÇ†ÏßúÎ≥Ñ YAP ÏÉÅÏäπ Ïã†Ìò∏ Í∞ïÎèÑÎ•º ÏÉâÏúºÎ°ú ÌëúÏãú.</li>
<li><b>ÎßàÏù∏ÎìúÏâêÏñ¥ Ìè≠Î∞ú Top 10</b> ‚Äì Ïä§ÏΩîÏñ¥¬∑ÎÖ∏Ï∂ú¬∑Ï∞∏Ïó¨¬∑Î∂ÅÎßàÌÅ¨¬∑Ïã†Í∑ú ÌåîÎ°úÏö∞ Í∏∞Ï§Ä ÏÉÅÏúÑ Í∏Ä.</li>
<li><b>Îì±Í∏âÎ≥Ñ ÎåÄÌëú Í∏Ä (S~D)</b> ‚Äì S, A, B, C, D Îì±Í∏âÎ≥ÑÎ°ú ÎåÄÌëú Í≤åÏãúÍ∏ÄÏùÑ Î™®ÏïÑÎ≥∏Îã§.</li>
<li><b>ÏΩîÏπò Î¥á</b> ‚Äì ÏµúÍ∑º ÏÑ±Í≥ºÎ•º Î∞îÌÉïÏúºÎ°ú Í≥ÑÏ†ïÏù¥ <b>Ïßà Ï§ëÏã¨Ïù∏ÏßÄ / Ïñë Ï§ëÏã¨Ïù∏ÏßÄ</b> Ìïú Ï§ÑÎ°ú ÏöîÏïΩ.</li>
<li><b>YAP Ïã†Ìò∏ Ïπ¥Îìú</b> ‚Äì Ìä∏Î¶ºÎìú Ï†êÏàò ¬∑ ÌèâÍ∑† Ï†êÏàò ¬∑ ÏõêÍ∏Ä ÏàòÎ•º Ïù¥Ïö©Ìïú YAP ÏÉÅÏäπ Ïó¨Î∂Ä.</li>
</ul>
</div>
</section>
<section class="card card-soft" style="margin-top:10px; max-width:920px;">
<div class="section-header">
<div class="section-title">4. Î¶¨ÎçîÎ≥¥Îìú &amp; ÌûàÏä§ÌÜ†Î¶¨ÍπåÏßÄ ÌôúÏö©ÌïòÍ∏∞</div>
</div>
<div style="font-size:12px; line-height:1.8; color:var(--text-main);">
<ul style="padding-left:18px; margin:0;">
<li><b>Î¶¨ÎçîÎ≥¥Îìú</b> ‚Äì CSV Î∂ÑÏÑù ÌõÑ ÎÇ¥ Ìï∏Îì§ÏùÑ ÏûÖÎ†•ÌïòÍ≥†, <b>ÌòÑÏû¨ Î∂ÑÏÑù Í≤∞Í≥º Ï†ÄÏû•</b>ÏùÑ ÎàåÎü¨ Í∏∞Î°ùÏùÑ ÏåìÎäîÎã§.</li>
<li><b>ÎÇ¥ ÌûàÏä§ÌÜ†Î¶¨</b> ‚Äì ÏóÖÎ°úÎìúÌñàÎçò CSVÎ≥Ñ ÏöîÏïΩÏù¥ ÏãúÍ∞ÑÏàúÏúºÎ°ú Ï†ïÎ¶¨ÎêúÎã§.</li>
<li><b>ÌîÑÎ°úÏ†ùÌä∏Î≥Ñ ÎßàÏù∏ÎìúÏâêÏñ¥</b> ‚Äì Ìä∏Ïúó Î≥∏Î¨∏Ïùò ÌÇ§ÏõåÎìú Í∏∞Î∞òÏúºÎ°ú ÌîÑÎ°úÏ†ùÌä∏Î≥Ñ ÎπÑÏ§ëÏùÑ Î≥∏Îã§.</li>
</ul>
<p style="font-size:11px; color:var(--text-muted); margin-top:8px;">
            ‚Äª Î™®Îì† Îç∞Ïù¥ÌÑ∞Îäî <b>ÌòÑÏû¨ Î∏åÎùºÏö∞Ï†ÄÏùò localStorage</b>ÏóêÎßå Ï†ÄÏû•ÎêòÍ≥†, ÏÑúÎ≤ÑÎ°ú Ï†ÑÏÜ°ÎêòÏßÄ ÏïäÎäîÎã§.
          </p>
</div>
</section>
</div>
<!-- ‚ñ≤‚ñ≤ ÏÇ¨Ïö©Î∞©Î≤ï ÌôîÎ©¥ ÎÅù ‚ñ≤‚ñ≤ -->
<!-- ‚ñº‚ñº CSV Î∂ÑÏÑù ÌôîÎ©¥ ‚ñº‚ñº -->
<div id="view-csv">
<div class="top-nav">
<div>
<div class="top-title">X ÌÅ¨Î¶¨ÏóêÏù¥ÌÑ∞ ÎßàÏù∏ÎìúÏâêÏñ¥ Î∂ÑÏÑùÍ∏∞</div>
<div class="top-sub">X Ïï†ÎÑêÎ¶¨Ìã±Ïä§ CSVÎ•º Ïò¨Î¶¨Í≥†, Í∏Ä ÌïòÎÇòÌïòÎÇòÏùò Ï†êÏàòÏôÄ Ìä∏Î¶ºÎìú ÌèâÍ∑†¬∑ÏµúÍ≥† Í∏ÄÏùÑ Î∂ÑÏÑùÌïòÎäî ÌôîÎ©¥ÏûÖÎãàÎã§.</div>
</div>
<div class="top-cta">
<div class="lang-toggle">
<button class="lang-btn" data-lang="ko">ÌïúÍµ≠Ïñ¥</button>
<button class="lang-btn" data-lang="en">EN</button>
</div>
<a class="top-link" href="https://analytics.twitter.com/user" target="_blank">
            X Ïï†ÎÑêÎ¶¨Ìã±Ïä§ Ïó¥Í∏∞ ‚Üó
          </a>
</div>
</div><div class="section-note">X Ïï†ÎÑêÎ¶¨Ìã±Ïä§ CSVÎ•º ÏóÖÎ°úÎìúÌï¥ÏÑú Í∏ÄÎ≥Ñ Ï†êÏàò¬∑Îì±Í∏â¬∑Ìä∏Î¶ºÎìú ÌèâÍ∑†ÏùÑ Í≥ÑÏÇ∞ÌïòÎäî Î∂ÑÏÑù ÌÉ≠ÏûÖÎãàÎã§.</div>
<!-- HERO -->
<section class="hero-card">
<div class="hero-top-row">
<div>
<div class="hero-main-title">ÎßàÏù∏ÎìúÏâêÏñ¥ Ïä§ÏΩîÏñ¥ ¬∑ S~D Îì±Í∏â ¬∑ Î¶¨ÎçîÎ≥¥ÎìúÍπåÏßÄ Ìïú Î≤àÏóê</div>
<div class="hero-desc">
              X Ïï†ÎÑêÎ¶¨Ìã±Ïä§ÏóêÏÑú CSVÎ•º ÎÇ¥Î†§Î∞õÍ≥† Ïù¥Í≥≥Ïóê ÏóÖÎ°úÎìúÌïòÎ©¥,<br/>
              ÏõêÍ∏Ä Í∏∞Ï§ÄÏúºÎ°ú ÎßàÏù∏ÎìúÏâêÏñ¥ Ï†êÏàòÏôÄ ÏÉÅÏúÑ Í∏Ä, Î¶¨ÎçîÎ≥¥ÎìúÍπåÏßÄ Ìïú Î≤àÏóê Î∂ÑÏÑùÌï† Ïàò ÏûàÏñ¥.
            </div>
<div class="hero-pill"><span class="hero-dot"></span> CSV Ìïú Î≤à ‚Üí Í≥ÑÏ†ï Î∂ÑÏÑù ÎÅù</div>
</div>
</div>
<div class="hero-upload-row">
<div class="file-input-wrap">
<div class="file-input-fake">üìÅ CSV ÌååÏùº ÏÑ†ÌÉùÌïòÍ∏∞</div>
<input accept=".csv" id="csvInput" type="file">
</input></div>
<span class="file-hint">account_analytics_content_YYYY-MM-DD_YYYY-MM-DD.csv Í∑∏ÎåÄÎ°ú ÏóÖÎ°úÎìú</span>
<button class="range-tab" id="btn-last-csv" type="button">ÎßàÏßÄÎßâ CSVÎ°ú Ï°∞ÌöåÌïòÍ∏∞</button>
<div id="last-snapshot-info" style="font-size:11px;color:#9ca3af;margin-top:4px;"></div>
</div>
<div class="badge"><span class="badge-dot"></span>ÌïúÍµ≠Ïñ¥/ÏòÅÏñ¥ CSV ÏûêÎèô Ïù∏Ïãù ¬∑ ÎãµÍ∏Ä Ï†úÏô∏ ÌõÑ ÏõêÍ∏ÄÎßå Î∂ÑÏÑù</div>
<div class="range-tabs" id="range-tabs" style="display:none">
<button class="range-tab active" data-range="ALL">Ï†ÑÏ≤¥ Í∏∞Í∞Ñ</button>
<button class="range-tab" data-range="7">ÏµúÍ∑º 7Ïùº</button>
<button class="range-tab" data-range="30">ÏµúÍ∑º 30Ïùº</button>
</div>
<!-- summary moved to dashboard -->
<div class="error" id="error"></div>
</section>
<!-- Î©îÏù∏ Í∑∏Î¶¨Îìú: ÏôºÏ™Ω(Ìëú), Ïò§Î•∏Ï™Ω(Î¥á/ÏöîÏïΩ) -->
<div class="grid-1">
<div class="column-main">
<!-- üìà Í≥ÑÏ†ï ÏÑ±Ïû• Í∑∏ÎûòÌîÑ Ïπ¥Îìú -->
<!-- growth-card moved to dashboard -->
<section class="card yap-heatmap-card">
<div class="section-header">
<div class="section-title">üì° YAP ÌûàÌä∏Îßµ</div>
<div class="section-sub">ÎÇ†ÏßúÎ≥Ñ Ìä∏Î¶ºÎìú/ÌèâÍ∑† Ïä§ÏΩîÏñ¥ÏôÄ ÏõêÍ∏Ä ÏàòÎ•º Í∏∞Î∞òÏúºÎ°ú Ï∂îÏ†ïÌïú YAP ÏÉÅÏäπ Ïã†Ìò∏ Í∞ïÎèÑÏûÖÎãàÎã§.</div>
</div>
<div class="yap-heatmap-legend">
<span>ÎÇÆÏùå</span>
<div class="yap-heatmap-legend-bar">
<span class="lvl-1"></span>
<span class="lvl-2"></span>
<span class="lvl-3"></span>
<span class="lvl-4"></span>
<span class="lvl-5"></span>
</div>
<span>ÎÜíÏùå</span>
</div>
<div class="yap-heatmap" id="yap-heatmap">
<div class="empty">CSVÎ•º ÏóÖÎ°úÎìúÌïòÍ≥† Í∏∞Í∞ÑÏùÑ ÏÑ†ÌÉùÌïòÎ©¥ ÎÇ†ÏßúÎ≥Ñ YAP Ïã†Ìò∏Î•º ÏÉâÏúºÎ°ú Î≥¥Ïó¨Ï§ÑÍ≤å.</div>
</div>
</section>
<section class="card">
<div class="section-header">
<div class="section-title" id="top10-title">
                üí• ÎßàÏù∏ÎìúÏâêÏñ¥ Ìè≠Î∞ú Top 10 <span id="top10-count"></span>
</div>
<div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
<div class="grade-chip">Ï†êÏàò Í∏∞Ï§Ä ¬∑ <strong>ÎßàÏù∏ÎìúÏâêÏñ¥ Ïä§ÏΩîÏñ¥</strong></div>
<select class="sort-select" id="sort-key">
<option value="score">Ï†ïÎ†¨: Ïä§ÏΩîÏñ¥</option>
<option value="impressions">Ï†ïÎ†¨: ÎÖ∏Ï∂úÏàò</option>
<option value="engagements">Ï†ïÎ†¨: Ï∞∏Ïó¨Ïàò</option>
<option value="bookmarks">Ï†ïÎ†¨: Î∂ÅÎßàÌÅ¨</option>
<option value="newFollows">Ï†ïÎ†¨: Ïã†Í∑ú ÌåîÎ°úÏö∞</option>
</select>
</div>
</div>
<div class="table-wrap" id="top10-table-wrap"></div>
</section>
<section class="card">
<div class="section-header">
<div class="section-title" id="grade-section-title">üéö Îì±Í∏âÎ≥Ñ ÏÉÅÏúÑ Í≤åÏãúÍ∏Ä <span>(S~D)</span></div>
<div class="grade-legend">
<span><span class="grade-dot s"></span>S ÏÉÅÏúÑ 5%</span>
<span><span class="grade-dot a"></span>A ÏÉÅÏúÑ 20%</span>
<span><span class="grade-dot b"></span>B ÏÉÅÏúÑ 40%</span>
<span><span class="grade-dot c"></span>C ÏÉÅÏúÑ 60%</span>
<span><span class="grade-dot d"></span>D Í∑∏ Ïô∏</span>
</div>
</div>
<div class="grade-tabs">
<button class="grade-tab active" data-grade="ALL"><span class="grade-tab-dot" style="background:linear-gradient(90deg,var(--grade-s),var(--grade-a),var(--grade-b))"></span>Ï†ÑÏ≤¥</button>
<button class="grade-tab" data-grade="S"><span class="grade-tab-dot" style="background:var(--grade-s)"></span>S Îì±Í∏â</button>
<button class="grade-tab" data-grade="A"><span class="grade-tab-dot" style="background:var(--grade-a)"></span>A Îì±Í∏â</button>
<button class="grade-tab" data-grade="B"><span class="grade-tab-dot" style="background:var(--grade-b)"></span>B Îì±Í∏â</button>
<button class="grade-tab" data-grade="C"><span class="grade-tab-dot" style="background:var(--grade-c)"></span>C Îì±Í∏â</button>
<button class="grade-tab" data-grade="D"><span class="grade-tab-dot" style="background:var(--grade-d)"></span>D Îì±Í∏â</button>
</div>
<div class="table-wrap" id="grade-table-wrap"></div>
</section>
</div>
<!-- Ïò§Î•∏Ï™Ω: ÏΩîÏπò Î¥á -->
<div class="column-side">
<section class="card bot-card">
<div class="section-header">
<div class="section-title" id="coach-title">ü§ñ ÎßàÏù∏ÎìúÏâêÏñ¥ ÏΩîÏπò Î¥á <span style="font-size:11px;color:var(--text-muted);">(Beta)</span></div>
</div>
<div class="bot-chip">
<span>üìå</span><span id="coach-chip-text">ÌòÑÏû¨ ÏÑ†ÌÉùÌïú Í∏∞Í∞Ñ Í∏∞Ï§Ä ¬∑ YAP Ïã†Ìò∏Îäî ÏµúÍ∑º 7Ïùº Ï†ïÌôïÎèÑ‚Üë Ìïú Ï§Ñ ÏöîÏïΩ + ÌîºÎìúÎ∞±</span>
</div>
<div class="bot-output" id="coach-output">
              ÏïÑÏßÅ CSVÎ•º Ïò¨Î¶¨ÏßÄ ÏïäÏïòÏñ¥.<br/>
              ÏÉÅÎã®ÏóêÏÑú Ïï†ÎÑêÎ¶¨Ìã±Ïä§ CSVÎ•º ÏóÖÎ°úÎìúÌïòÍ≥† Í∏∞Í∞Ñ ÌÉ≠(Ï†ÑÏ≤¥/7/30Ïùº)ÏùÑ Î∞îÍæ∏Î©¥<br/>
              Ïù¥ Íµ¨Í∞ÑÏùò ÎßàÏù∏ÎìúÏâêÏñ¥ ÏÉÅÌÉúÎ•º ÏΩîÏπò Î¥áÏù¥ ÏûêÎèôÏúºÎ°ú ÏöîÏïΩÌï¥ Ï§Ñ Í±∞Ïïº.
            </div>
<div class="bot-hint">
              * ÏÑúÎ≤Ñ/LLM Ìò∏Ï∂ú ÏóÜÏù¥, ÎÇ¥ Ïï†ÎÑêÎ¶¨Ìã±Ïä§Î•º Í∏∞Î∞òÏúºÎ°ú Í∑úÏπôÏ†ÅÏúºÎ°ú ÏöîÏïΩÌï¥ Ï£ºÎäî Ïò§ÌîÑÎùºÏù∏ ÏΩîÏπòÏïº.
            </div>
</section>
<section class="card yap-card" id="yap-card">
<div class="section-header">
<div class="section-title">üì° YAP Ïã†Ìò∏ <span style="font-size:11px;color:var(--text-muted);">(Beta)</span></div>
</div>
<div class="yap-main">
<div>
<div class="yap-label" style="font-size:11px;color:var(--text-muted);">ÌòÑÏû¨ ÏÑ†ÌÉùÌïú Í∏∞Í∞Ñ Í∏∞Ï§Ä ¬∑ YAP Ïã†Ìò∏Îäî ÏµúÍ∑º 7Ïùº Ï†ïÌôïÎèÑ‚Üë</div>
<div class="yap-level" id="yap-level-text">-</div>
<div class="yap-sub" id="yap-level-sub">
                  CSVÎ•º ÏóÖÎ°úÎìúÌïòÎ©¥ ÏµúÍ∑º Ìå®ÌÑ¥ÏùÑ Í∏∞Î∞òÏúºÎ°ú YAP ÏÉÅÏäπ Ïã†Ìò∏Î•º Í∞ÑÎã®Ìûà Î≥¥Ïó¨Ï§ÑÍ≤å.
                </div>
<div class="yap-boost-toggles">
<label class="yap-toggle">
<input id="yap-inner-toggle" type="checkbox"/>
<span>Ïù¥ÎÑàÏÑúÌÅ¥ Í≥ÑÏ†ï (+30% Í∞ÄÏ§ëÏπò)</span>
</label>
<label class="yap-toggle">
<input id="yap-100-toggle" type="checkbox"/>
<span>ÏµúÍ∑º YAP 100Ï†ê‚Üë Í≤ΩÌóò ÏûàÏùå (+15% Í∞ÄÏ§ëÏπò)</span>
</label>
</div>
</div>
<div class="yap-metrics">
<div class="yap-metric">
<div class="yap-metric-label">Ìä∏Î¶ºÎìú Ï†êÏàò</div>
<div class="yap-metric-value" id="yap-trimmed">-</div>
</div>
<div class="yap-metric">
<div class="yap-metric-label">ÌèâÍ∑† Ï†êÏàò</div>
<div class="yap-metric-value" id="yap-avg">-</div>
</div>
<div class="yap-metric">
<div class="yap-metric-label">ÏõêÍ∏Ä Ïàò</div>
<div class="yap-metric-value" id="yap-posts">-</div>
</div>
<div class="yap-metric">
<div class="yap-metric-label">YAP ÏÉÅÏäπ ÌôïÎ•†</div>
<div class="yap-metric-value" id="yap-prob">-</div>
</div>
</div>
</div>
</section>
</div>
</div>
</div>
<!-- ‚ñ≤‚ñ≤ CSV Î∂ÑÏÑù ÌôîÎ©¥ ÎÅù ‚ñ≤‚ñ≤ -->
<!-- ‚ñº‚ñº YAP Í≤åÏù¥ÏßÄ ÌôîÎ©¥ ‚ñº‚ñº -->
<div id="view-yap-gauge" style="display:none;">
<div class="top-nav">
<div>
<div class="top-title">YAP Î≤ÑÌçº Í≤åÏù¥ÏßÄ</div>
<div class="top-sub">
            ÏµúÍ∑º ÏÑ†ÌÉùÌïú Í∏∞Í∞ÑÏùò YAP Î≤ÑÌçºÏö© ÎÇ¥Î∂Ä ÏßÄÌëúÏôÄ ÏõêÍ∏Ä ÏàòÎ•º Í∏∞Î∞òÏúºÎ°ú<br/>
            Ïπ¥Ïù¥ÌÜ†Ïóê ÏåìÏù∏ YAP ÏóêÎÑàÏßÄÎ•º % Îã®ÏúÑÎ°ú Í∞ÄÎä†Ìï¥Ï£ºÎäî ÌôîÎ©¥Ïù¥Ïïº.
          </div>
</div>
</div>
<section class="card yap-gauge-card" style="margin-top:8px;max-width:880px;">
<div class="section-header">
<div class="section-title">üîã YAP Î≤ÑÌçº Í≤åÏù¥ÏßÄ <span style="font-size:11px;color:var(--text-muted);">(Beta)</span></div>
<div class="section-sub">
            CSVÎ•º ÏóÖÎ°úÎìúÌïòÍ≥† Í∏∞Í∞ÑÏùÑ ÏÑ†ÌÉùÌïòÎ©¥, Í∞ôÏùÄ Î∂ÑÏÑù Í≤∞Í≥ºÎ•º Í∏∞Î∞òÏúºÎ°ú<br/>
            ÏßÄÍ∏à Í≥ÑÏ†ïÏóê ÏñºÎßàÎÇò YAP Î≤ÑÌçºÍ∞Ä ÏåìÏó¨ÏûàÎäîÏßÄ %Î°ú Î≥¥Ïó¨Ï§ÑÍ≤å.
          </div>
</div>
<div class="yap-gauge-main">
<div class="yap-gauge-percent-row">
<div class="yap-gauge-percent" id="yap-gauge-percent">-</div>
<div class="yap-gauge-level" id="yap-gauge-level">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</div>
</div>
<div class="yap-gauge-bar">
<div class="yap-gauge-fill" id="yap-gauge-fill"></div>
</div>
<div class="yap-gauge-sub" id="yap-gauge-desc">
            CSVÎ•º ÏóÖÎ°úÎìúÌïòÍ≥† Í∏∞Í∞ÑÏùÑ ÏÑ†ÌÉùÌïòÎ©¥ YAP Î≤ÑÌçº(ÏûîÏó¨ Ï†êÏàò)Î•º %Î°ú Î≥¥Ïó¨Ï§ÑÍ≤å.
          </div>
<ul class="yap-gauge-legend">
<li><b>0 ~ 30%</b> : üßä Low ‚Äî ÏµúÍ∑º Ìå®ÌÑ¥ Í∏∞Ï§ÄÏúºÎ°ú, ÏïÑÏßÅ ÌÅ¨Í≤å ÏåìÏù∏ YAP Î≤ÑÌçºÎäî ÎßéÏßÄ ÏïäÏùÄ Íµ¨Í∞Ñ.</li>
<li><b>30 ~ 60%</b> : üåä Mid ‚Äî ÏûëÏùÄ YAP(+1 ~ 2Ï†ê) Ï†ïÎèÑÍ∞Ä ÎÇòÏò¨ Ïàò ÏûàÎäî Ï§ëÍ∞Ñ ÏàòÏ§Ä Î≤ÑÌçº.</li>
<li><b>60 ~ 100%</b> : üî• High ‚Äî Ìïú Î≤à ÌÅ¨Í≤å ÌÑ∞Ïßà Ïàò ÏûàÎäî YAP Î≤ÑÌçºÍ∞Ä Ï†úÎ≤ï ÏåìÏó¨ ÏûàÎäî ÏÉÅÌÉú.</li>
</ul>
<div class="yap-gauge-metrics">
<div class="metric-chip">
<div class="metric-label">ÏÑ†ÌÉù Íµ¨Í∞Ñ ÏõêÍ∏Ä Ïàò</div>
<div class="metric-value" id="yap-gauge-posts">-</div>
</div>
<div class="metric-chip">
<div class="metric-label">Î≤ÑÌçº Í∏∞Ï§Ä Ï†êÏàò</div>
<div class="metric-value" id="yap-gauge-trimmed">-</div>
</div>
<div class="metric-chip">
<div class="metric-label">Î≤ÑÌçº Í∏∞Ï§Ä Í≥ÑÏ†ïÏßÄÏàò</div>
<div class="metric-value" id="yap-gauge-avg">-</div>
</div>
</div>
<div class="yap-gauge-forecast">
<div class="forecast-title">ÏòàÏÉÅ YAP Î≤îÏúÑ</div>
<div class="forecast-value" id="yap-gauge-forecast">-</div>
<div class="forecast-sub" id="yap-gauge-forecast-desc">
              ÏÑ†ÌÉùÌïú Íµ¨Í∞ÑÏùò Ìå®ÌÑ¥ÏùÑ Í∏∞Î∞òÏúºÎ°ú, ÏïûÏúºÎ°ú Î∞õÏùÑ Í∞ÄÎä•ÏÑ±Ïù¥ ÏûàÎäî YAP Íµ¨Í∞ÑÏùÑ ÎåÄÎûµÏ†ÅÏúºÎ°ú Î≥¥Ïó¨Ï§ÑÍ≤å.
            </div>
</div>
<div class="yap-gauge-highlight">
<div class="highlight-title">ÏµúÍ∑º ÏµúÍ≥† ÏûÑÌå©Ìä∏ Í≤åÏãúÍ∏Ä</div>
<div class="highlight-body">
<div class="highlight-row">
<span class="highlight-label">ÎÇ†Ïßú</span>
<span class="highlight-value" id="yap-gauge-best-date">-</span>
</div>
<div class="highlight-row">
<span class="highlight-label">Ïä§ÏΩîÏñ¥</span>
<span class="highlight-value" id="yap-gauge-best-score">-</span>
</div>
<div class="highlight-row">
<span class="highlight-label">ÎßÅÌÅ¨</span>
<span class="highlight-value">
<a href="javascript:void(0)" id="yap-gauge-best-link" target="_blank">-</a>
</span>
</div>
</div>
</div>
<div class="yap-gauge-note">
<div class="note-title">Ïù¥ ÌôîÎ©¥ÏóêÏÑú Ïì∞Îäî ÏßÄÌëúÎì§</div>
<ul class="note-list">
<li><b>Î≤ÑÌçº Í∏∞Ï§Ä Ï†êÏàò</b> : ÏµúÍ∑º ÏÑ†ÌÉùÌïú Í∏∞Í∞ÑÏùò ÏÉÅÏúÑ Ìä∏Ïúó ÏúÑÏ£ºÎ°ú Îã§Ïãú Í≥ÑÏÇ∞Ìïú Ï†êÏàòÏïº. CSV Î∂ÑÏÑù ÌÉ≠Ïùò Ìä∏Î¶ºÎìú Ï†êÏàòÏôÄÎäî ÏÇ¥Ïßù Îã§Î•¥Í≤å ÌäúÎãùÌñàÏñ¥.</li>
<li><b>Î≤ÑÌçº Í∏∞Ï§Ä Í≥ÑÏ†ïÏßÄÏàò</b> : Í≥ÑÏ†ï Ï†ÑÏ≤¥ ÌèâÍ∑† ÎåÄÏã†, YAP ÏòàÏ∏°Ïóê ÎßûÍ≤å Ï°∞Ï†ïÌïú ÎÇ¥Î∂Ä ÏßÄÏàòÏïº.</li>
<li><b>YAP Î≤ÑÌçº %</b> : ÏúÑ Îëê ÏßÄÌëú + ÏõêÍ∏Ä ÏàòÎ•º 0~100 Ïä§ÏºÄÏùºÎ°ú ÌôòÏÇ∞Ìïú Í∞íÏù¥Ïïº. ÎÜíÏùÑÏàòÎ°ù ‚ÄúÏñ∏Ï††Í∞Ä Ìïú Î≤à ÌÑ∞Ïßà Í∞ÄÎä•ÏÑ±‚ÄùÏù¥ Ïª§ÏßÑÎã§Í≥† Î≥¥Î©¥ Îèº.</li>
</ul>
</div>
</div>
</section>
</div>
<!-- ‚ñ≤‚ñ≤ YAP Í≤åÏù¥ÏßÄ ÌôîÎ©¥ ÎÅù ‚ñ≤‚ñ≤ -->
<!-- ‚ñº‚ñº Î¶¨ÎçîÎ≥¥Îìú ÌôîÎ©¥ ‚ñº‚ñº -->
<div id="view-leaderboard" style="display:none;">
<div class="top-nav">
<div>
<div class="top-title">ÌÅ¨Î¶¨ÏóêÏù¥ÌÑ∞ ÎßàÏù∏ÎìúÏâêÏñ¥ Î¶¨ÎçîÎ≥¥Îìú</div>
<div class="top-sub">CSV Í∏∞Î∞ò MUDDHA Ï¢ÖÌï© Ï†êÏàòÎ°ú ÎßåÎì† Ï†ÑÏö© Î¶¨ÎçîÎ≥¥ÎìúÏûÖÎãàÎã§. (YAP ÏßÄÏàòÏôÄÎäî Î≥ÑÍ∞ú)</div>
</div>
</div><div class="section-note">CSV Î∂ÑÏÑù Í≤∞Í≥ºÎ°ú Í≥ÑÏÇ∞Ìïú MUDDHA Ï†ÑÏö© Ï¢ÖÌï© Ï†êÏàò Í∏∞Î∞ò Î¶¨ÎçîÎ≥¥ÎìúÏûÖÎãàÎã§. (YAPÍ≥ºÎäî Î≥ÑÎèÑ Ï†êÏàò)</div>
<section class="card" id="leaderboard-section" style="margin-top:8px;">
<div class="section-header">
<div class="section-title">üèÜ ÌÅ¨Î¶¨ÏóêÏù¥ÌÑ∞ ÎßàÏù∏ÎìúÏâêÏñ¥ Î¶¨ÎçîÎ≥¥Îìú (Beta)</div>
</div>
<div class="leader-input-row">
<input class="leader-input" id="leader-handle" placeholder="X Ìï∏Îì§ ÏûÖÎ†• (Ïòà: @bud_dha__)">
<button class="leader-btn" id="leader-save-btn">ÌòÑÏû¨ Î∂ÑÏÑù Í≤∞Í≥º Ï†ÄÏû•</button>
</input></div>
<div class="leader-note" id="leader-note">‚Äª ÏµúÏÜå ÏõêÍ∏Ä Ïàò 20Í∞ú Ïù¥ÏÉÅÏùº Îïå Î¶¨ÎçîÎ≥¥Îìú Ï†êÏàòÍ∞Ä Îçî Ï†ïÌôïÌï©ÎãàÎã§.</div>
<div id="my-rank-wrap" style="margin-top:10px"></div>
<div class="table-wrap" id="leaderboard-wrap" style="margin-top:10px"></div>
</section>
</div>
<!-- ‚ñ≤‚ñ≤ Î¶¨ÎçîÎ≥¥Îìú ÌôîÎ©¥ ÎÅù ‚ñ≤‚ñ≤ -->
<!-- ‚ñº‚ñº ÎÇ¥ ÌûàÏä§ÌÜ†Î¶¨ ÌôîÎ©¥ ‚ñº‚ñº -->
<div id="view-history" style="display:none;">
<div class="top-nav">
<div>
<div class="top-title">ÎÇ¥ Î∂ÑÏÑù ÌûàÏä§ÌÜ†Î¶¨</div>
<div class="top-sub">CSVÎ•º ÏóÖÎ°úÎìúÌï† ÎïåÎßàÎã§ Ïù¥Í≥≥Ïóê ÏöîÏïΩ Í∏∞Î°ùÏù¥ ÏûêÎèôÏúºÎ°ú ÏåìÏûÖÎãàÎã§.</div>
</div>
</div>
<section class="card" style="margin-top:8px;">
<div class="section-header">
<div class="section-title">üìÜ ÏóÖÎ°úÎìú Í∏∞Î°ù</div>
<div class="section-sub">ÏµúÍ∑º ÏóÖÎ°úÎìú Í∏∞Ï§ÄÏúºÎ°ú Ï†ïÎ†¨Îê©ÎãàÎã§. (Î∏åÎùºÏö∞Ï†ÄÏóêÎßå Ï†ÄÏû•)</div>
</div>
<div class="table-wrap" id="history-wrap">
<div class="empty">ÏïÑÏßÅ Ï†ÄÏû•Îêú Î∂ÑÏÑù ÌûàÏä§ÌÜ†Î¶¨Í∞Ä ÏóÜÏäµÎãàÎã§. CSVÎ•º ÏóÖÎ°úÎìúÌïòÎ©¥ Ïó¨Í∏∞ Í∏∞Î°ùÏù¥ ÏåìÏûÖÎãàÎã§.</div>
</div>
</section>
</div>
<!-- ‚ñ≤‚ñ≤ ÌûàÏä§ÌÜ†Î¶¨ ÌôîÎ©¥ ÎÅù ‚ñ≤‚ñ≤ -->
<!-- ‚ñº‚ñº ÌîÑÎ°úÏ†ùÌä∏Î≥Ñ ÎßàÏù∏ÎìúÏâêÏñ¥ ÌôîÎ©¥ ‚ñº‚ñº -->
<div id="view-projects" style="display:none;">
<div class="top-nav">
<div>
<div class="top-title">ÌîÑÎ°úÏ†ùÌä∏Î≥Ñ ÎßàÏù∏ÎìúÏâêÏñ¥</div>
<div class="top-sub">Ìä∏Ïúó Î≥∏Î¨∏ ÌÇ§ÏõåÎìú Í∏∞Ï§ÄÏúºÎ°ú ÌîÑÎ°úÏ†ùÌä∏Î≥Ñ ÏûÑÌå©Ìä∏ÏôÄ Í≤åÏãúÍ∏Ä/Îì±Í∏âÏùÑ Î∂ÑÏÑùÌï©ÎãàÎã§.</div>
</div>
</div><div class="section-note">Í¥ÄÏã¨ ÌîÑÎ°úÏ†ùÌä∏Îì§Ïùò ÎßàÏù∏ÎìúÏâêÏñ¥ÏôÄ Í¥ÄÎ†® Îç∞Ïù¥ÌÑ∞Î•º Î™®ÏïÑÏÑú Î≥¥Îäî ÌÉ≠ÏûÖÎãàÎã§.</div>
<section class="card card-soft">
<div class="section-header">
<div class="section-title" id="project-summary-title">üìö ÌîÑÎ°úÏ†ùÌä∏ ÏöîÏïΩ + ÏõêÌòï Í∑∏ÎûòÌîÑ</div>
<div class="section-sub" id="project-summary-sub">ÏΩîÎìú ÏÉÅÎã® <code>PROJECTS</code> Î∞∞Ïó¥Ïùò ÌÇ§ÏõåÎìúÎ•º ÎÑ§Í∞Ä Ìä∏Îäî ÌîÑÎ°úÏ†ùÌä∏Ïóê ÎßûÍ≤å Î∞îÍøîÏ§ò.</div>
</div>
<div class="project-charts-row">
<div class="project-chart-single">
<div class="project-chart-title" id="proj-chart-title-1">ÌîÑÎ°úÏ†ùÌä∏Î≥Ñ Í≤åÏãúÍ∏Ä ÎπÑÏú®</div>
<canvas id="project-pie"></canvas>
</div>
<div class="project-chart-single">
<div class="project-chart-title" id="proj-chart-title-2">ÏÑ†ÌÉù Í∏∞Í∞Ñ Ï†ÑÏ≤¥ S~D Îì±Í∏â Î∂ÑÌè¨</div>
<canvas id="grade-distribution-pie"></canvas>
</div>
<div class="project-chart-single">
<div class="project-chart-title" id="proj-chart-title-3">ÏÑ†ÌÉù ÌîÑÎ°úÏ†ùÌä∏ S~D Îì±Í∏â Î∂ÑÌè¨</div>
<canvas id="project-grade-pie"></canvas>
</div>
</div>
<div class="table-wrap" id="project-summary-wrap">
<div class="empty">Î®ºÏ†Ä DashboardÏóêÏÑú CSVÎ•º ÏóÖÎ°úÎìúÌïòÍ≥† Î∂ÑÏÑùÏùÑ Ìïú Î≤à ÎèåÎ†§Ï§ò.</div>
</div>
<div class="project-detail-controls">
<span>üîç ÌîÑÎ°úÏ†ùÌä∏Î≥Ñ Í≤åÏãúÍ∏Ä Î≥¥Í∏∞</span>
<select class="project-select" id="project-select">
<option value="">CSV ÏóÖÎ°úÎìú ÌõÑ ÏûêÎèô ÌôúÏÑ±ÌôîÎê©ÎãàÎã§.</option>
</select>
</div>
<div class="table-wrap" id="project-detail-wrap">
<div class="empty">ÌîÑÎ°úÏ†ùÌä∏Î•º ÏÑ†ÌÉùÌïòÎ©¥ Ìï¥Îãπ ÌîÑÎ°úÏ†ùÌä∏Ïùò Í≤åÏãúÍ∏ÄÍ≥º Îì±Í∏âÏù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§.</div>
</div>
</section>
</div>
<!-- ‚ñº‚ñº ÏïºÌïë ÌîåÎûòÎÑà ÌôîÎ©¥ ‚ñº‚ñº -->
<div id="view-yapping" style="display:none;">
<div class="top-nav">
<div>
<div class="top-title">ÏïºÌïë &amp; Î≥¥ÏÉÅ ÌîåÎûòÎÑà</div>
<div class="top-sub">
            Ïä§ÌîÑÎ†àÎìúÏãúÌä∏ÏóêÏÑú Í¥ÄÎ¶¨ÌïòÎçò <b>ÌïÑÏàò/Î≥¥Ï°∞ ÏïºÌïë ¬∑ Ï£ºÍ∏∞ ¬∑ Í∏∞Í∞Ñ ¬∑ Î≥¥ÏÉÅ</b>ÏùÑ Ïù¥ ÌôîÎ©¥ÏóêÏÑú ÏßÅÏ†ë Í¥ÄÎ¶¨Ìï† Ïàò ÏûàÏäµÎãàÎã§.
            (Î∏åÎùºÏö∞Ï†Ä <code>localStorage</code>Ïóê Ï†ÄÏû•)
          </div>
</div>
</div><div class="section-note">ÏïºÌïë/ÏóêÎìúÏûë Í≥ÑÌöçÍ≥º Ï£ºÍ∏∞Î•º Í¥ÄÎ¶¨ÌïòÎ©¥ÏÑú Î≥¥ÏÉÅ ÎåÄÎπÑ Ìö®Ïú®ÏùÑ Ï≤¥ÌÅ¨ÌïòÎäî ÌÉ≠ÏûÖÎãàÎã§.</div>
<div class="yap-layout">
<section class="card card-soft">
<div class="section-header">
<div class="section-title">ÏÉà ÏïºÌïë Í≥ÑÌöç Ï∂îÍ∞Ä</div>
<div class="section-sub">ÏóëÏÖÄ Ìïú Ï§Ñ = ÏïÑÎûò Ìèº Ìïú Ï§ÑÏù¥ÎùºÍ≥† ÏÉùÍ∞ÅÌïòÎ©¥ Ìé∏Ìï¥.</div>
</div>
<form id="yap-form">
<div class="yap-form-grid">
<div>
<div class="yap-label">ÌïúÍµ≠Î™Ö</div>
<input class="yap-input" id="yap-kor" placeholder="Ïπ¥Ïù¥ÌÜ†, Î¶¨Î≤Ñ, Î±ÖÏª§ ...">
</input></div>
<div>
<div class="yap-label">ÌîÑÎ°úÏ†ùÌä∏</div>
<input class="yap-input" id="yap-project" placeholder="Kaito, River, Bankr ...">
</input></div>
<div>
<div class="yap-label">Í≥ÑÏó¥</div>
<input class="yap-input" id="yap-segment" placeholder="Ïû•Í∏∞ / Îã®Í∏∞ Îì±">
</input></div>
<div>
<div class="yap-label">ÏïºÌïë ÌÉÄÏûÖ</div>
<select class="yap-select" id="yap-type">
<option value="ÌïÑÏàò">ÌïÑÏàò</option>
<option value="Î≥¥Ï°∞">Î≥¥Ï°∞</option>
</select>
</div>
</div>
<div class="yap-form-grid">
<div>
<div class="yap-label">ÏïºÌïë Ï£ºÍ∏∞</div>
<input class="yap-input" id="yap-frequency" placeholder="Ïùº2Ìöå / Ïùº1Ìöå / Ï£º1Ìöå ..."/>
</div>
<div>
<div class="yap-label">Î≥¥ÏÉÅ</div>
<input class="yap-input" id="yap-reward" placeholder="$200, Ìè¨Ïù∏Ìä∏, WL Îì±"/>
</div>
<div>
<div class="yap-label">ÏãúÏûëÏùº</div>
<input class="yap-input" id="yap-start" type="date"/>
</div>
<div>
<div class="yap-label">Ï¢ÖÎ£åÏùº</div>
<input class="yap-input" id="yap-end" type="date"/>
</div>
</div>
<div class="yap-form-grid-1">
<div>
<div class="yap-label">Î©îÎ™®</div>
<input class="yap-input" id="yap-memo" placeholder="Ïòà: Ïùº2Ìöå Ïä§Î†àÎìú + ÎîîÏä§ÏΩîÎìú ÌõÑÍ∏∞, ÏµúÏÜå 2Í∞úÏõî Ïú†ÏßÄ"/>
</div>
</div>
<button class="yap-add-btn" type="submit">+ ÏïºÌïë Í≥ÑÌöç Ï∂îÍ∞Ä</button>
</form>
</section>
<section class="card card-soft">
<div class="section-header">
<div class="section-title">ÎÇòÏùò ÏïºÌïë Î¶¨Ïä§Ìä∏</div>
<div class="section-sub">ÏôºÏ™Ω Ï≤¥ÌÅ¨Î∞ïÏä§Îäî Ï†ÑÏ≤¥ ÏôÑÎ£å Ïó¨Î∂Ä Ï≤¥ÌÅ¨ Ïö©ÎèÑ, Î©îÎ™®ÍπåÏßÄ Ìïú ÎààÏóê Ï†ïÎ¶¨.</div>
</div>
<div id="yap-list">
<div class="yap-list-empty">Îì±Î°ùÎêú ÏïºÌïë Í≥ÑÌöçÏù¥ ÏóÜÏäµÎãàÎã§. ÏôºÏ™ΩÏóêÏÑú ÏÉà Í≥ÑÌöçÏùÑ Ï∂îÍ∞ÄÌï¥Ï§ò.</div>
</div>
</section>
</div>
</div>
<!-- ‚ñ≤‚ñ≤ ÏïºÌïë ÌîåÎûòÎÑà ÌôîÎ©¥ ÎÅù ‚ñ≤‚ñ≤ -->
<!-- ‚ñº‚ñº InfoFi Î¶¨ÎçîÎ≥¥Îìú ÌôîÎ©¥ ‚ñº‚ñº -->
<!-- ‚ñº‚ñº Ïª§ÎÆ§ÎãàÌã∞ ÌôîÎ©¥ ‚ñº‚ñº -->
<div id="view-community" style="display:none;">
<div class="top-nav">
<div>
<div class="top-title">Ïª§ÎÆ§ÎãàÌã∞ (Î°úÏª¨ Ï†ÑÏö© Î≤†ÌÉÄ)</div>
<div class="top-sub">
            Î∏åÎùºÏö∞Ï†ÄÏóêÎßå Ï†ÄÏû•ÎêòÎäî ÏûëÏùÄ Ïª§ÎÆ§ÎãàÌã∞Ïïº. ÎãâÎÑ§ÏûÑ + Í∏Ä + Ìä∏ÏúÑÌÑ∞ ÎßÅÌÅ¨Î•º ÎÇ®Í∏∞Í≥†, ÏÑúÎ°ú ÎåìÍ∏ÄÍ≥º Ï¢ãÏïÑÏöîÎ•º ÎÇ®Í≤®Î≥º Ïàò ÏûàÏñ¥.
          </div>
</div>
</div><div class="section-note">MUDDHA ÏÇ¨Ïö©ÏûêÎì§Ïù¥ ÏÑúÎ°ú Í∏ÄÍ≥º Ìä∏Ïúó ÎßÅÌÅ¨Î•º Í≥µÏú†ÌïòÍ≥† ÌîºÎìúÎ∞±ÏùÑ Ï£ºÍ≥†Î∞õÎäî Ïª§ÎÆ§ÎãàÌã∞ ÌÉ≠ÏûÖÎãàÎã§.</div>
<div class="community-layout">
<section class="card card-soft">
<div class="section-header">
<div class="section-title">üí¨ ÏµúÍ∑º Í∏Ä &amp; Í∏Ä Ïì∞Í∏∞</div>
<div class="section-sub">
              Í∞ÄÏö¥Îç∞ÏóêÏÑú Î∞îÎ°ú Í∏ÄÏùÑ ÏùΩÍ≥†, ÌïÑÏöîÌï† ÎïåÎßå Í∏Ä Ïì∞Í∏∞ ÏòÅÏó≠ÏùÑ ÌéºÏπ† Ïàò ÏûàÏñ¥.
            </div>
</div>
<div class="community-toggle">
<button class="community-toggle-btn" id="community-toggle-btn" type="button">
              ‚úèÔ∏è ÏÉà Í∏Ä Ïì∞Í∏∞ Ïó¥Í∏∞
            </button>
<div class="community-hint">
              ¬∑ ÏÇ¨Ïù¥ÎìúÎ∞î ÎãâÎÑ§ÏûÑ Î≤ÑÌäºÏúºÎ°ú Ïù¥Î¶ÑÏùÑ Î®ºÏ†Ä Ï†ïÌï¥ÎèÑ Ï¢ãÏïÑ.<br/>
              ¬∑ Ïù¥ Ïª§ÎÆ§ÎãàÌã∞Ïùò Î™®Îì† Îç∞Ïù¥ÌÑ∞Îäî Ïù¥ Î∏åÎùºÏö∞Ï†ÄÏùò localStorageÏóêÎßå Ï†ÄÏû•Îèº.
            </div>
</div>
<form class="community-form" id="community-form" style="display:none;">
<div>
<div class="community-form-label">ÎÇ¥Ïö©</div>
<textarea class="community-textarea" id="community-content" placeholder="Ïò§ÎäòÏùò ÎßàÏâê / Ïù∏ÏÇ¨Ïù¥Ìä∏ / Ïû°Îã¥ Îì±ÏùÑ ÏûêÏú†Î°≠Í≤å ÎÇ®Í≤®Ï§ò."></textarea>
</div>
<div>
<div class="community-form-label">Ìä∏ÏúÑÌÑ∞ ÎßÅÌÅ¨ (ÏÑ†ÌÉù)</div>
<input class="community-input" id="community-twitter" placeholder="https://x.com/.... ÌòïÌÉúÏùò ÎßÅÌÅ¨Î•º Î∂ôÏó¨ÎÑ£Ïñ¥Ï§ò."/>
</div>
<button class="community-submit" type="submit">Í∏Ä Ïò¨Î¶¨Í∏∞</button>
</form>
<div class="community-list" id="community-list">
<div class="community-empty">ÏïÑÏßÅ Îì±Î°ùÎêú Í∏ÄÏù¥ ÏóÜÏñ¥. Ï≤´ Í∏ÄÏùÑ ÎÇ®Í≤®Î≥ºÎûò?</div>
</div>
</section>
</div>
</div>
<!-- ‚ñ≤‚ñ≤ Ïª§ÎÆ§ÎãàÌã∞ ÌôîÎ©¥ ÎÅù ‚ñ≤‚ñ≤ -->
<!-- ‚ñº‚ñº Cookie Î¶¨ÎçîÎ≥¥Îìú ÌôîÎ©¥ ‚ñº‚ñº -->
<div id="view-cookie" style="display:none;">
<div class="top-nav">
<div>
<div class="top-title">üç™ Cookie ÌîÑÎ°úÏ†ùÌä∏ Î¶¨ÎçîÎ≥¥Îìú</div>
<div class="top-sub">Cookie InfoFi Î¶¨ÎçîÎ≥¥ÎìúÎ•º ÏïàÏ†ÑÌïòÍ≤å ÌîÑÎ°ùÏãúÎ•º Í±∞Ï≥ê Ï°∞ÌöåÌïòÎäî ÌôîÎ©¥ÏûÖÎãàÎã§.</div>
</div>
</div><div class="section-note">Cookie InfoFi Î¶¨ÎçîÎ≥¥ÎìúÎ•º ÌîÑÎ°úÏ†ùÌä∏¬∑Ìï∏Îì§ Îã®ÏúÑÎ°ú Ï°∞ÌöåÌïòÎäî ÌÉ≠ÏûÖÎãàÎã§.</div>
<section class="card card-soft infofi-hero">
<div class="infofi-hero-title">üîç Ìï∏Îì§Î°ú ÎÇ¥ Cookie ÏàúÏúÑ Ï∞æÍ∏∞</div>
<div class="infofi-hero-sub">
      Ïòà: <code>@bud_dha__</code> Ï≤òÎüº ÏûÖÎ†•ÌïòÎ©¥Îê®
    </div>
<div class="infofi-search-row">
<input class="infofi-search-input" id="cookie-handle-input" placeholder="@Ìï∏Îì§ ÏûÖÎ†• (Ïòà: @bud_dha__)"/>
<button class="infofi-search-btn" onclick="handleCookieSearch()" type="button">Í≤ÄÏÉâ</button>
</div>
<div class="infofi-handle-label" id="cookie-handle-label"></div>
<div class="infofi-hint">
      ‚Äª <code>COOKIE_API_URL</code>
    </div>
<div class="infofi-source-note">
      11-28: <code>22:09Í∏∞Ï§Ä</code> (Cookie Í≥µÍ∞ú JSON)
    </div>
</section>
<section class="infofi-results card">
<div class="section-header">
<div class="section-title">üç™ Cookie ÌîÑÎ°úÏ†ùÌä∏ Î¶¨ÎçîÎ≥¥Îìú</div>
<div class="section-sub">
        Ï†ÑÏ≤¥ ÌîÑÎ°úÏ†ùÌä∏ Í∏∞Ï§Ä ÏàúÏúÑ ÎòêÎäî ÌäπÏ†ï Ìï∏Îì§Ïù¥ Ï∞∏Ïó¨Ìïú ÌîÑÎ°úÏ†ùÌä∏Îßå ÌïÑÌÑ∞ÎßÅÌï¥ÏÑú Î≥¥Ïó¨Ï§Ñ Ïàò ÏûàÏñ¥.
      </div>
</div>

<div class="cookie-project-cards" id="cookie-project-cards">
  <div class="infofi-empty">Î®ºÏ†Ä ÏúÑÏóêÏÑú Ï°∞ÌöåÌï† @Ìï∏Îì§ÏùÑ ÏûÖÎ†•Ìï¥Ï§ò.</div>
</div>

<div class="table-wrap">
<table class="infofi-table">
<thead>
<tr>
<th style="width:56px;">Rank</th>
<th>Project</th>
<th>Handle</th>
<th>Segment</th>
<th>Window</th>
<th style="width:100px;">MS%</th>
</tr>
</thead>
<tbody id="cookie-leaderboard-body">
<tr>
<td class="infofi-empty" colspan="6">
              ÏïÑÏßÅ Cookie JSONÏùÑ Î∂àÎü¨Ïò§ÏßÄ ÏïäÏïòÏñ¥. ÏúÑÏóêÏÑú Ìï∏Îì§ÏùÑ Í≤ÄÏÉâÌïòÍ±∞ÎÇò, ÌÉ≠ÏùÑ Îã§Ïãú Ïó¥Ïñ¥Î¥ê.
            </td>
</tr>
</tbody>
</table>
</div>
</section>
</div>
<div id="view-infofi" style="display:none;">
<div class="top-nav">
<div>
<div class="top-title">InfoFi Î¶¨ÎçîÎ≥¥Îìú(ÌòÑÏû¨ ÎÇòÎßå Í∞ÄÎä•Ìï®...)</div>
<div class="top-sub">Ïó¨Îü¨ InfoFi ÌîÑÎ°úÏ†ùÌä∏Î•º Ìïú ÎààÏóê Ï†ïÎ¶¨Ìï¥ÏÑú ÎπÑÍµê¬∑Î∂ÑÏÑùÌïòÎäî ÌôîÎ©¥ÏûÖÎãàÎã§.</div>
</div>
</div><div class="section-note">Ïó¨Îü¨ InfoFi ÌîÑÎ°úÏ†ùÌä∏Îì§Ïùò Î¶¨ÎçîÎ≥¥Îìú¬∑Ï†êÏàòÎ•º Ìïú ÎààÏóê Ï†ïÎ¶¨Ìï¥ÏÑú Î≥¥Îäî ÌÉ≠ÏûÖÎãàÎã§.</div>
<section class="card card-soft infofi-hero">
<div class="infofi-hero-title">üîç Ìï∏Îì§Î°ú ÎÇ¥ InfoFi ÏàúÏúÑ Ï∞æÍ∏∞</div>
<div class="infofi-hero-sub">
          Ïòà: <code>@bud_dha__</code> Ï≤òÎüº ÏûÖÎ†•ÌïòÎ©¥Îê®
        </div>
<div class="infofi-search-row">
<input class="infofi-search-input" id="infofi-handle-input" placeholder="@Ìï∏Îì§ ÏûÖÎ†• (Ïòà: @bud_dha__)"/>
<button class="infofi-search-btn" onclick="handleInfofiSearch()" type="button">Í≤ÄÏÉâ</button>
</div>
<div class="infofi-handle-label" id="infofi-handle-label"></div>
<div class="infofi-hint">
          ‚Äª  <code></code> ÎîúÎ†àÏù¥ ÏûàÏùå
        </div>
<div class="infofi-source-note">
          Îç∞Ïù¥ÌÑ∞ Ï∂úÏ≤ò: <a href="https://gomtu.xyz/kaito-leaderboard" rel="noopener" target="_blank">Gomtu Kaito Leaderboard</a>
</div>
</section>
<section class="infofi-results card">
<div class="infofi-projects-grid" id="infofi-result-wrap">
<div class="empty">Î®ºÏ†Ä ÏúÑÏóêÏÑú @Ìï∏Îì§ÏùÑ ÏûÖÎ†•ÌïòÍ≥† Í≤ÄÏÉâÏùÑ ÎàåÎü¨Ï§ò.</div>
</div>
<!-- ‚úÖ Kaito Leaderboard Í≤∞Í≥º ÏòÅÏó≠ (InfoFi Í≤ÄÏÉâÍ≥º ÌÜµÌï©) -->
<!-- ‚úÖ Kaito Leaderboard Í≤∞Í≥º (ÌÖçÏä§Ìä∏Îßå ÌëúÏãú) -->
<div id="kaito-result" style="margin-top:8px;font-size:13px;line-height:1.6;color:#e5e7eb;"></div>
</section></div>

</main></div>
<!-- ‚ñ≤‚ñ≤ InfoFi Î¶¨ÎçîÎ≥¥Îìú ÌôîÎ©¥ ÎÅù ‚ñ≤‚ñ≤ -->
<!-- ‚ñ≤‚ñ≤ ÌîÑÎ°úÏ†ùÌä∏ ÌôîÎ©¥ ÎÅù ‚ñ≤‚ñ≤ -->


<script>
/* ========= ÏÑ§Ï†ï ========= */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw0yJIOdUoeRNwMn9fys-5ePI6UX6wkqBVhWNLrZ-gomO1sGNgTUJbhO0Kfj0n2QgdC/exec";
const COOKIE_API_URL = "https://www.cookie.fun/api/trpc/cookieFun.leaderboard?input=%7B%22json%22%3A%7B%22projectsFilter%22%3A%7B%22searchFilter%22%3A%22%22%7D%2C%22orderColumn%22%3A%22TwitterMindshare%22%2C%22orderDataPoint%22%3A%22_24HoursAgo%22%2C%22orderByAscending%22%3Afalse%2C%22limit%22%3A10%2C%22dataPoint%22%3A%22_24HoursAgo%22%7D%7D"; // Cookie leaderboard API
const MIN_POSTS_FOR_LEADERBOARD = 20;
const TRIM_RATIO = 0.1;
let CURRENT_LANG = "ko";


const THEME_KEY = "mindshare_theme_v1";
function applyThemeFromStorage(){
  try{
    const saved = localStorage.getItem(THEME_KEY) || "light";
    const root = document.documentElement;
    const toggle = document.getElementById("theme-toggle");
    if(saved === "dark"){
      root.classList.add("dark-theme");
      if(toggle) toggle.checked = true;
    }else{
      root.classList.remove("dark-theme");
      if(toggle) toggle.checked = false;
    }
  }catch(e){}
}
function initThemeToggle(){
  const toggle = document.getElementById("theme-toggle");
  if(!toggle) return;
  toggle.addEventListener("change", ()=>{
    const root = document.documentElement;
    try{
      if(toggle.checked){
        root.classList.add("dark-theme");
        localStorage.setItem(THEME_KEY,"dark");
      }else{
        root.classList.remove("dark-theme");
        localStorage.setItem(THEME_KEY,"light");
      }
    }catch(e){}
  });
}

const NICKNAME_KEY = "mindshare_nickname_v1";

function applyNicknameSidebar(){
  const nameSpan   = document.getElementById("side-username");
  const handleLink = document.getElementById("side-handle-link");
  const avatarImg  = document.getElementById("side-avatar-img");
  if (!nameSpan || !handleLink) return;

  const stored = (typeof localStorage !== "undefined")
    ? localStorage.getItem(NICKNAME_KEY)
    : null;

  if (!stored) {
    // Í∏∞Î≥∏Í∞í: Í≤åÏä§Ìä∏ Î™®Îìú
    nameSpan.textContent = "Í≤åÏä§Ìä∏";
    handleLink.textContent = "@ÏùµÎ™Ö";
    handleLink.href = "javascript:void(0)";
    if (avatarImg) {
      avatarImg.src = "https://unavatar.io/twitter/guest";
    }
    return;
  }

  const nick = stored.trim().slice(0, 30) || "Í≤åÏä§Ìä∏";
  nameSpan.textContent = nick;
  handleLink.textContent = "@" + nick;
  handleLink.href = "javascript:void(0)";
  if (avatarImg) {
    // ÏôÑÏ†Ñ ÏùµÎ™Ö ÎäêÎÇåÏúºÎ°ú, ÎãâÎÑ§ÏûÑ Í∏∞Î∞ò ÏïÑÎ∞îÌÉÄ
    avatarImg.src = "https://unavatar.io/twitter/" + encodeURIComponent(nick);
  }
}

function openNicknamePrompt(){
  let current = "";
  if (typeof localStorage !== "undefined") {
    current = localStorage.getItem(NICKNAME_KEY) || "";
  }
  const input = prompt("Ïù¥ Î∏åÎùºÏö∞Ï†ÄÏóêÏÑú ÏÇ¨Ïö©Ìï† ÏùµÎ™Ö ÎãâÎÑ§ÏûÑÏùÑ Ï†ïÌï¥Ï§ò (Ïòà: Î∂ìÎã§-ÏïºÌïëÏû•Ïù∏)", current);
  if (!input) return;
  const nick = input.trim().slice(0, 30);
  if (!nick) return;
  if (typeof localStorage !== "undefined") {
    localStorage.setItem(NICKNAME_KEY, nick);
  }
  applyNicknameSidebar();
}

document.addEventListener("DOMContentLoaded", () => {
  applyNicknameSidebar();
  applyThemeFromStorage();
  initThemeToggle();
  const btn = document.getElementById("nickname-btn");
  if (btn) {
    btn.addEventListener("click", openNicknamePrompt);
  }

  // YAP Í∞ÄÏ§ëÏπò ÌÜ†Í∏ÄÏù¥ Î∞îÎÄî ÎïåÎßàÎã§ Ïπ¥Îìú/ÌûàÌä∏Îßµ/ÏÑ±Ïû• Í∑∏ÎûòÌîÑ Îã§Ïãú Í∑∏Î¶¨Í∏∞
  const inner = document.getElementById("yap-inner-toggle");
  const top100 = document.getElementById("yap-100-toggle");
  const handleToggleChange = () => {
    if (!ANALYSIS || !CURRENT_LIST || !CURRENT_LIST.length) return;
    updateYapCard(ANALYSIS);
    updateYapGauge(ANALYSIS);
    renderYapHeatmap(CURRENT_LIST);
    renderGrowthChart(CURRENT_LIST);
  };
  [inner, top100].forEach(el => {
    if (el) el.addEventListener("change", handleToggleChange);
  });
});


/* ===== Ïª§ÎÆ§ÎãàÌã∞ Î°úÏª¨ Í≤åÏãúÌåê ===== */
const COMMUNITY_KEY = "mindshare_community_v1";

function getCurrentNicknameForCommunity(){
  try{
    const stored = (typeof localStorage !== "undefined")
      ? localStorage.getItem(NICKNAME_KEY)
      : null;
    const nick = stored && stored.trim() ? stored.trim().slice(0,30) : "Í≤åÏä§Ìä∏";
    return nick;
  }catch(e){
    return "Í≤åÏä§Ìä∏";
  }
}

function loadCommunityPosts(){
  try{
    const raw = localStorage.getItem(COMMUNITY_KEY);
    if (!raw) return [];
    const arr = JSON.parse(raw);
    if (!Array.isArray(arr)) return [];
    return arr;
  }catch(e){
    return [];
  }
}

function saveCommunityPosts(list){
  try{
    localStorage.setItem(COMMUNITY_KEY, JSON.stringify(list || []));
  }catch(e){}
}

function createCommunityPost({content, twitterUrl, parentId=null}){
  const now = Date.now();
  return {
    id: "c_" + now + "_" + Math.random().toString(36).slice(2,8),
    author: getCurrentNicknameForCommunity(),
    content: (content || "").trim(),
    twitterUrl: (twitterUrl || "").trim(),
    parentId: parentId,
    likes: 0,
    createdAt: now
  };
}

function renderCommunity(){
  const container = document.getElementById("community-list");
  if (!container) return;

  const posts = loadCommunityPosts();
  container.innerHTML = "";

  if (!posts.length){
    const empty = document.createElement("div");
    empty.className = "community-empty";
    empty.textContent = "ÏïÑÏßÅ Îì±Î°ùÎêú Í∏ÄÏù¥ ÏóÜÏñ¥. Ï≤´ Í∏ÄÏùÑ ÎÇ®Í≤®Î≥ºÎûò?";
    container.appendChild(empty);
    return;
  }

  // ÏµúÏã† Ïàú Ï†ïÎ†¨
  posts.sort((a,b) => (b.createdAt||0) - (a.createdAt||0));

  const topLevel = posts.filter(p => !p.parentId);
  const replies = posts.filter(p => p.parentId);

  topLevel.forEach(post => {
    const postEl = document.createElement("div");
    postEl.className = "community-post";

    const meta = document.createElement("div");
    meta.className = "community-meta";
    const authorSpan = document.createElement("span");
    authorSpan.textContent = post.author || "Í≤åÏä§Ìä∏";
    const dateSpan = document.createElement("span");
    const d = new Date(post.createdAt || Date.now());
    const pad = n => (n<10?"0"+n:n);
    dateSpan.textContent = `${d.getFullYear()}.${pad(d.getMonth()+1)}.${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
    meta.appendChild(authorSpan);
    meta.appendChild(dateSpan);

    const body = document.createElement("div");
    body.className = "community-body";
    body.textContent = post.content || "";

    postEl.appendChild(meta);
    postEl.appendChild(body);

    if (post.twitterUrl){
      const link = document.createElement("a");
      link.className = "community-link";
      link.href = post.twitterUrl;
      link.target = "_blank";
      link.rel = "noopener";
      link.innerHTML = "Ìä∏ÏúÑÌÑ∞ Ïó¥Í∏∞ ‚Üó";
      postEl.appendChild(link);
    }

    const actions = document.createElement("div");
    actions.className = "community-actions";

    const likeBtn = document.createElement("button");
    likeBtn.type = "button";
    likeBtn.className = "community-action-btn";
    const likesLabel = () => (post.likes || 0) ? `Ï¢ãÏïÑÏöî ${post.likes}` : "Ï¢ãÏïÑÏöî";
    likeBtn.textContent = likesLabel();
    likeBtn.addEventListener("click", () => {
      const all = loadCommunityPosts();
      const found = all.find(p => p.id === post.id);
      if (found){
        found.likes = (found.likes || 0) + 1;
        saveCommunityPosts(all);
        renderCommunity();
      }
    });

    const replyBtn = document.createElement("button");
    replyBtn.type = "button";
    replyBtn.className = "community-action-btn";
    replyBtn.textContent = "ÎãµÍ∏Ä Îã¨Í∏∞";
    replyBtn.addEventListener("click", () => {
      const text = prompt("ÎãµÍ∏Ä ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï§ò:");
      if (!text || !text.trim()) return;
      const all = loadCommunityPosts();
      const reply = createCommunityPost({content:text, twitterUrl:"", parentId:post.id});
      all.push(reply);
      saveCommunityPosts(all);
      renderCommunity();
    });

    actions.appendChild(likeBtn);
    actions.appendChild(replyBtn);
    postEl.appendChild(actions);

    // ÌïòÏúÑ ÎãµÍ∏Ä Î†åÎçîÎßÅ
    const children = replies.filter(r => r.parentId === post.id);
    if (children.length){
      const repliesWrap = document.createElement("div");
      repliesWrap.className = "community-replies";
      children
        .sort((a,b)=> (a.createdAt||0) - (b.createdAt||0))
        .forEach(rep => {
          const repEl = document.createElement("div");
          repEl.className = "community-reply";
          const repMeta = document.createElement("div");
          repMeta.className = "community-reply-meta";
          const d2 = new Date(rep.createdAt || Date.now());
          const pad2 = n => (n<10?"0"+n:n);
          repMeta.textContent = `${rep.author || "Í≤åÏä§Ìä∏"} ¬∑ ${d2.getFullYear()}.${pad2(d2.getMonth()+1)}.${pad2(d2.getDate())} ${pad2(d2.getHours())}:${pad2(d2.getMinutes())}`;
          const repBody = document.createElement("div");
          repBody.textContent = rep.content || "";
          repEl.appendChild(repMeta);
          repEl.appendChild(repBody);
          repliesWrap.appendChild(repEl);
        });
      postEl.appendChild(repliesWrap);
    }

    container.appendChild(postEl);
  });
}


function initCommunity(){
  const form = document.getElementById("community-form");
  const contentEl = document.getElementById("community-content");
  const twitterEl = document.getElementById("community-twitter");
  const toggleBtn = document.getElementById("community-toggle-btn");
  if (!form || !contentEl) return;

  // ÌÜ†Í∏Ä Î≤ÑÌäº: Í∏ÄÏì∞Í∏∞ ÏòÅÏó≠ Ïó¥Í≥†/Îã´Í∏∞
  if (toggleBtn){
    toggleBtn.addEventListener("click", () => {
      const isHidden = form.style.display === "none" || !form.style.display;
      if (isHidden){
        form.style.display = "flex";
        toggleBtn.textContent = "‚¨á Í∏ÄÏì∞Í∏∞ Ï†ëÍ∏∞";
      }else{
        form.style.display = "none";
        toggleBtn.textContent = "‚úèÔ∏è ÏÉà Í∏Ä Ïì∞Í∏∞ Ïó¥Í∏∞";
      }
    });
  }

  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const content = contentEl.value || "";
    const twitterUrl = twitterEl ? twitterEl.value || "" : "";
    if (!content.trim()){
      alert("ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï§ò!");
      return;
    }
    const posts = loadCommunityPosts();
    const newPost = createCommunityPost({content, twitterUrl});
    posts.push(newPost);
    saveCommunityPosts(posts);
    contentEl.value = "";
    if (twitterEl) twitterEl.value = "";

    // Í∏Ä ÏûëÏÑ± ÌõÑ ÏûêÎèô Ï†ëÍ∏∞
    if (toggleBtn){
      form.style.display = "none";
      toggleBtn.textContent = "‚úèÔ∏è ÏÉà Í∏Ä Ïì∞Í∏∞ Ïó¥Í∏∞";
    }

    renderCommunity();
  });

  // ÏµúÏ¥à Î°úÎî© Ïãú Ìïú Î≤à Î†åÎçî
  renderCommunity();
}
/* ÌîÑÎ°úÏ†ùÌä∏ ÌÇ§ÏõåÎìú (ÏõêÌïòÎ©¥ Ïó¨Í∏∞ ÏàòÏ†ï) */
/* ÌîÑÎ°úÏ†ùÌä∏ ÌÇ§ÏõåÎìú (Ïù¥ÎØ∏ÏßÄÏóê ÎÇòÏò® ÌîÑÎ°úÏ†ùÌä∏ + Ï£ºÏöî ÏïºÌïë ÌîÑÎ°úÏ†ùÌä∏) */
const PROJECTS = [
  // --- L0 / L1 ---
  { id: "aptos",       label: "Aptos",                  category: "L0/L1", keywords: ["aptos"] },
  { id: "beldex",      label: "Beldex",                 category: "L0/L1", keywords: ["beldex"] },
  { id: "berachain",   label: "Berachain",              category: "L0/L1", keywords: ["berachain"] },
  { id: "camp",        label: "Camp Network",           category: "L0/L1", keywords: ["camp network","campnet"] },
  { id: "ethereum",    label: "Ethereum",               category: "L0/L1", keywords: ["ethereum","eth "] },
  { id: "fogo",        label: "Fogo",                   category: "L0/L1", keywords: ["fogo"] },
  { id: "injective",   label: "Injective",              category: "L0/L1", keywords: ["injective","inj "] },
  { id: "irys",        label: "Irys",                   category: "L0/L1", keywords: ["irys"] },
  { id: "kaia",        label: "Kaia",                   category: "L0/L1", keywords: ["kaia"] },
  { id: "mantra",      label: "MANTRA",                 category: "L0/L1", keywords: ["mantra"] },
  { id: "mavryk",      label: "Mavryk",                 category: "L0/L1", keywords: ["mavryk"] },
  { id: "mitosis",     label: "Mitosis",                category: "L0/L1", keywords: ["mitosis"] },
  { id: "monad",       label: "Monad",                  category: "L0/L1", keywords: ["monad"] },
  { id: "movement",    label: "Movement",               category: "L0/L1", keywords: ["movement"] },
  { id: "near",        label: "Near",                   category: "L0/L1", keywords: ["near"] },
  { id: "peaq",        label: "PEAQ",                   category: "L0/L1", keywords: ["peaq"] },
  { id: "polkadot",    label: "Polkadot",               category: "L0/L1", keywords: ["polkadot","dot "] },
  { id: "sei",         label: "Sei",                    category: "L0/L1", keywords: ["sei "] },
  { id: "somnia",      label: "Somnia",                 category: "L0/L1", keywords: ["somnia"] },
  { id: "sonic",       label: "Sonic (L1)",             category: "L0/L1", keywords: ["sonic chain","sonic l1","sonic mainnet"] },
  { id: "story",       label: "Story",                  category: "L0/L1", keywords: ["story protocol","story chain"] },
  { id: "xion",        label: "XION",                   category: "L0/L1", keywords: ["xion"] },

  // --- L2 ---
  { id: "arbitrum",    label: "Arbitrum",               category: "L2",    keywords: ["arbitrum","arb "] },
  { id: "katana",      label: "Katana",                 category: "L2",    keywords: ["katana"] },
  { id: "mantle",      label: "Mantle",                 category: "L2",    keywords: ["mantle"] },
  { id: "megaeth",     label: "MegaETH",                category: "L2",    keywords: ["megaeth"] },
  { id: "polygon",     label: "Polygon",                category: "L2",    keywords: ["polygon","matic"] },
  { id: "soon",        label: "SOON",                   category: "L2",    keywords: ["soon network","soon chain"] },

  // --- DeFi / Infra ---
  { id: "falcon",      label: "Falcon Finance",         category: "DeFi",  keywords: ["falcon finance","falconfi"] },
  { id: "frax",        label: "Frax",                   category: "DeFi",  keywords: ["frax"] },
  { id: "huma",        label: "Huma",                   category: "DeFi",  keywords: ["huma"] },
  { id: "moremarkets", label: "MoreMarkets",            category: "DeFi",  keywords: ["moremarkets","more markets"] },
  { id: "multipli",    label: "Multipli",               category: "DeFi",  keywords: ["multipli"] },
  { id: "noble",       label: "Noble",                  category: "DeFi",  keywords: ["noble chain","noble network"] },
  { id: "orderly",     label: "Orderly",                category: "DeFi",  keywords: ["orderly","orderly network","orderly omni"] },
  { id: "pyth",        label: "Pyth",                   category: "DeFi",  keywords: ["pyth oracle","pyth network"] },
  { id: "soul",        label: "Soul Protocol",          category: "DeFi",  keywords: ["soul protocol"] },
  { id: "stbl",        label: "STBL",                   category: "DeFi",  keywords: ["stbl","usst","yld","stablecoin 2.0"] },
  { id: "turtle",      label: "Turtle Club",            category: "DeFi",  keywords: ["turtle club"] },
  { id: "walrus",      label: "Walrus",                 category: "DeFi",  keywords: ["walrus"] },

  // --- AI Agents / Agent Infra ---
  { id: "creatorbid",  label: "CreatorBid",             category: "AI Agents", keywords: ["creatorbid"] },
  { id: "infinit",     label: "INFINIT",                category: "AI Agents", keywords: ["infinit"] },
  { id: "newton",      label: "Newton",                 category: "AI Agents", keywords: ["newton ai"] },
  { id: "surf",        label: "Surf",                   category: "AI Agents", keywords: ["surf ai","surf agent"] },
  { id: "symphony",    label: "Symphony",               category: "AI Agents", keywords: ["symphony","symphony finance","symphony router"] },
  { id: "talus",       label: "Talus",                  category: "AI Agents", keywords: ["talus"] },
  { id: "theoriq",     label: "Theoriq",                category: "AI Agents", keywords: ["theoriq"] },
  { id: "virtuals",    label: "Virtuals Protocol",      category: "AI Agents", keywords: ["virtuals","virtuals protocol"] },
  { id: "warden",      label: "Warden Protocol",        category: "AI Agents", keywords: ["warden protocol"] },
  { id: "wayfinder",   label: "Wayfinder",              category: "AI Agents", keywords: ["wayfinder"] },

  // --- Culture / NFT ---
  { id: "anime",       label: "ANIME",                  category: "Culture", keywords: ["anime token","anime protocol"] },
  { id: "boop",        label: "Boop",                   category: "Culture", keywords: ["boop"] },
  { id: "doodles",     label: "Doodles",                category: "Culture", keywords: ["doodles"] },
  { id: "memex",       label: "MemeX",                  category: "Culture", keywords: ["memex"] },
  { id: "moonbirds",   label: "Moonbirds",              category: "Culture", keywords: ["moonbirds"] },
  { id: "pengu",       label: "PENGU",                  category: "Culture", keywords: ["pengu"] },

  // --- BTCFi ---
  { id: "corn",        label: "Corn",                   category: "BTCFi",  keywords: ["corn"] },
  { id: "goat",        label: "GOAT Network",           category: "BTCFi",  keywords: ["goat network"] },
  { id: "lombard",     label: "Lombard",                category: "BTCFi",  keywords: ["lombard"] },
  { id: "portalbtc",   label: "Portal to BTC",          category: "BTCFi",  keywords: ["portal to btc","portal btc"] },
  { id: "satlayer",    label: "SatLayer",               category: "BTCFi",  keywords: ["satlayer"] },

  // --- Robotics ---
  { id: "openmind",    label: "Openmind",               category: "Robotics", keywords: ["openmind"] },

  // --- ZK ---
  { id: "boundless",   label: "Boundless",              category: "ZK", keywords: ["boundless"] },
  { id: "brevis",      label: "Brevis",                 category: "ZK", keywords: ["brevis"] },
  { id: "cysic",       label: "Cysic",                  category: "ZK", keywords: ["cysic"] },
  { id: "miden",       label: "Miden",                  category: "ZK", keywords: ["miden"] },
  { id: "starknet",    label: "Starknet",               category: "ZK", keywords: ["starknet"] },
  { id: "succinct",    label: "Succinct",               category: "ZK", keywords: ["succinct"] },
  { id: "zcash",       label: "Zcash",                  category: "ZK", keywords: ["zcash"] },
  { id: "zkpass",      label: "zkPass",                 category: "ZK", keywords: ["zkpass"] },

  // --- Others ---
  { id: "anoma",       label: "Anoma",                  category: "Others", keywords: ["anoma"] },
  { id: "bless",       label: "Bless",                  category: "Others", keywords: ["bless protocol"] },
  { id: "bybittradfi", label: "Bybit TradFi",           category: "Others", keywords: ["bybit tradfi"] },
  { id: "humanity",    label: "Humanity Protocol",      category: "Others", keywords: ["humanity protocol"] },
  { id: "integra",     label: "Integra",                category: "Others", keywords: ["integra"] },
  { id: "multibank",   label: "Multibank",              category: "Others", keywords: ["multibank"] },
  { id: "thrive",      label: "Thrive Protocol",        category: "Others", keywords: ["thrive protocol"] },

  // --- Exchange / Perp ---
  { id: "apex",        label: "ApeX",                   category: "Exchange", keywords: ["apex pro","apex dex"] },
  { id: "bluefin",     label: "Bluefin",                category: "Exchange", keywords: ["bluefin"] },
  { id: "dydx",        label: "dYdX",                   category: "Exchange", keywords: ["dydx"] },
  { id: "flipster",    label: "Flipster",               category: "Exchange", keywords: ["flipster"] },
  { id: "mememax",     label: "MemeMax",                category: "Exchange", keywords: ["mememax","mememax_fi","@mememax_fi","memax"] },
  { id: "momentum",    label: "Momentum",               category: "Exchange", keywords: ["momentum"] },
  { id: "paradex",     label: "PARADEX",                category: "Exchange", keywords: ["paradex"] },

  // --- AI / InfoFi ---
  { id: "kaito",       label: "Kaito / Yapper",         category: "AI", keywords: ["kaito","kaito ai","yapper","yap points","infofi"] },
  { id: "og",          label: "OG",                     category: "AI", keywords: ["og protocol"] },
  { id: "allora",      label: "Allora",                 category: "AI", keywords: ["allora"] },
  { id: "billions",    label: "Billions Network",       category: "AI", keywords: ["billions network"] },
  { id: "edgen",       label: "Edgen",                  category: "AI", keywords: ["edgen"] },
  { id: "everlynai",   label: "EverlynAI",              category: "AI", keywords: ["everlynai"] },
  { id: "iq",          label: "IQ",                     category: "AI", keywords: ["iq ai","iq token"] },
  { id: "kindred",     label: "Kindred",                category: "AI", keywords: ["kindred"] },
  { id: "mira",        label: "Mira Network",           category: "AI", keywords: ["mira network"] },
  { id: "novastro",    label: "Novastro",               category: "AI", keywords: ["novastro"] },
  { id: "noya",        label: "Noya.ai",                category: "AI", keywords: ["noya.ai","noya ai"] },
  { id: "openledger",  label: "OpenLedger",             category: "AI", keywords: ["openledger"] },
  { id: "pipworld",    label: "PiP World",              category: "AI", keywords: ["pip world","pipworld"] },
  { id: "playai",      label: "PlayAI",                 category: "AI", keywords: ["playai","play ai"] },
  { id: "sapien",      label: "Sapien",                 category: "AI", keywords: ["sapien"] },
  { id: "sentient",    label: "Sentient",               category: "AI", keywords: ["sentient"] },
  { id: "uxlink",      label: "UXLINK",                 category: "AI", keywords: ["uxlink"] },

  // --- Consumer / Apps ---
  { id: "tria",        label: "Tria",                   category: "Consumer", keywords: ["tria","use tria","@useTria"] },
  { id: "anichess",    label: "Anichess",               category: "Consumer", keywords: ["anichess"] },
  { id: "bitdealer",   label: "Bitdealer",              category: "Consumer", keywords: ["bitdealer"] },
  { id: "defiapp",     label: "Defi App",               category: "Consumer", keywords: ["defi app"] },
  { id: "hana",        label: "Hana",                   category: "Consumer", keywords: ["hana app"] },
  { id: "infinex",     label: "Infinex",                category: "Consumer", keywords: ["infinex"] },
  { id: "lumiterra",   label: "Lumiterra",              category: "Consumer", keywords: ["lumiterra"] },
  { id: "maplestory",  label: "MapleStory Universe",    category: "Consumer", keywords: ["maplestory universe","msu"] },
  { id: "metawin",     label: "Metawin",                category: "Consumer", keywords: ["metawin"] },
  { id: "parti",       label: "Parti",                  category: "Consumer", keywords: ["parti"] },
  { id: "puffpaw",     label: "Puffpaw",                category: "Consumer", keywords: ["puffpaw"] },
  { id: "rainbow",     label: "Rainbow",                category: "Consumer", keywords: ["rainbow wallet","rainbow app"] },
  { id: "sidekick",    label: "Sidekick",               category: "Consumer", keywords: ["sidekick"] },
  { id: "sixr",        label: "SIXR Cricket",           category: "Consumer", keywords: ["sixr cricket","sixr"] },
  { id: "sophon",      label: "Sophon",                 category: "Consumer", keywords: ["sophon"] },
  { id: "vultisig",    label: "Vultisig",               category: "Consumer", keywords: ["vultisig"] },
  { id: "yeet",        label: "YEET",                   category: "Consumer", keywords: ["yeet"] },

  // --- Interop ---
  { id: "caldera",     label: "Caldera",                category: "Interop", keywords: ["caldera"] },
  { id: "initia",      label: "Initia",                 category: "Interop", keywords: ["initia"] },
  { id: "skate",       label: "Skate",                  category: "Interop", keywords: ["skate"] },
  { id: "union",       label: "Union",                  category: "Interop", keywords: ["union"] },

  // --- RWA ---
  { id: "kaio",        label: "KAIO",                   category: "RWA", keywords: ["kaio","kaio network"] },
  { id: "theo",        label: "Theo Network",           category: "RWA", keywords: ["theo","theo network","thbill","tultra"] },

  // --- Snapper / Campaign style(ÎßàÏù∏ÎìúÏâêÏñ¥Ïö©) ---
  { id: "superform",   label: "Superform",              category: "Campaign", keywords: ["superform","superformxyz","@superformxyz"] },
  { id: "glint",       label: "Glint Analytics",        category: "Campaign", keywords: ["glint analytics","@glintanalytics"] },
  { id: "solv",        label: "Solv Protocol",          category: "Campaign", keywords: ["solv protocol","@solvprotocol"] },
  { id: "pacifica",    label: "Pacifica",               category: "Campaign", keywords: ["pacifica_fi","@pacifica_fi","pacifica fi"] },
  { id: "layerbank",   label: "LayerBank",              category: "Campaign", keywords: ["layerbank","layerbankfi","@layerbankfi"] },
  { id: "rayls",       label: "Rayls",                  category: "Campaign", keywords: ["rayls","@RaylsLabs","raylslabs"] },
  { id: "velora",      label: "Velora",                 category: "Campaign", keywords: ["velora","veloradex","@veloradex"] },
  { id: "antix",       label: "Antix",                  category: "Campaign", keywords: ["antix","@antix_in"] },
  { id: "almanak",     label: "Almanak",                category: "Campaign", keywords: ["almanak","@Almanak"] },
  { id: "bob",         label: "BOB",                    category: "Campaign", keywords: ["bob","build on bitcoin","@build_on_bob"] },
  { id: "ten",         label: "TEN Protocol",           category: "Campaign", keywords: ["ten protocol","@tenprotocol","ten app"] },
  { id: "vooi",        label: "Vooi",                   category: "Campaign", keywords: ["vooi","@vooi_io","vooi io"] },

  // --- ÎÑà Ï†ÑÏö©(Ïù¥ÎØ∏ CSVÏóêÏÑú ÏûêÏ£º Ïì∞Îäî Í≤ÉÎì§) ---
  { id: "river",       label: "River / satUSD",         category: "Stable", keywords: ["river","satusd","sat usd","river4fun","river4 fun","@riverhq"] },
  { id: "cookie",      label: "Cookie.fun",             category: "InfoFi", keywords: ["cookie.fun","cookie fun","cookie leaderboard","@cookie_fun"] },
  { id: "bnkr",        label: "BNKR / BANKR",           category: "Social", keywords: ["bnkr","bankr","bankr leaderboard","@bnkr_network"] }
];


let ANALYSIS = null;
let ALL_BASE = [];
let CURRENT_LIST = [];
let buckets = { S:[], A:[], B:[], C:[], D:[] };
let CURRENT_RANGE = "ALL";
let CURRENT_GRADE = "ALL";
let SORT_KEY = "score";

/* ÌîÑÎ°úÏ†ùÌä∏ ÌÜµÍ≥Ñ/Ï∞®Ìä∏Ïö© */
let PROJECT_STATS = [];
let projectChart = null;
let globalGradeChart = null;
let projectGradeChart = null;

/* ========== CSV Ìó§Îçî Îß§Ìïë/Ïà´Ïûê ========== */
function autoMap(row) {
  const map = {
    "Í≤åÏãúÎ¨º Î≥∏Î¨∏": "text", "Post text": "text", "Tweet text": "text",
    "„ÉÑ„Ç§„Éº„Éà„ÉÜ„Ç≠„Çπ„Éà": "text", "„ÉÑ„Ç§„Éº„ÉàÊú¨Êñá": "text", "Êé®ÊñáÊñáÊú¨": "text", "Â∏ñÂ≠êÊñáÊú¨": "text",
    "ÎÇ†Ïßú": "date", "Date": "date", "Êó•‰ªò": "date", "Êó•Êúü": "date",
    "Í≤åÏãúÎ¨º ÎßÅÌÅ¨": "link", "Tweet permalink": "link","URL":"link","Link":"link",
    "„ÉÑ„Ç§„Éº„Éà„É™„É≥„ÇØ": "link", "Êé®ÊñáÈìæÊé•": "link",
    "Í≤åÏãúÎ¨º ID":"id","Tweet ID":"id",
    "ÎÖ∏Ï∂úÏàò":"impressions","Impressions":"impressions","„Ç§„É≥„Éó„É¨„ÉÉ„Ç∑„Éß„É≥Êï∞":"impressions","Â±ïÁ§∫Ê¨°Êï∞":"impressions","ÊõùÂÖâÊ¨°Êï∞":"impressions",
    "Ï∞∏Ïó¨Ïàò":"engagements","Engagements":"engagements","„Ç®„É≥„Ç≤„Éº„Ç∏„É°„É≥„ÉàÊï∞":"engagements","‰∫íÂä®Ê¨°Êï∞":"engagements",
    "ÎßàÏùåÏóê Îì§Ïñ¥Ïöî":"likes","Likes":"likes","„ÅÑ„ÅÑ„Å≠":"likes","ÁÇπËµûÊï∞":"likes",
    "Î∂ÅÎßàÌÅ¨":"bookmarks","Bookmarks":"bookmarks","„Éñ„ÉÉ„ÇØ„Éû„Éº„ÇØ":"bookmarks","‰π¶Á≠æ":"bookmarks",
    "Ïû¨Í≤åÏãú":"retweets","Retweets":"retweets","Reposts":"retweets","„É™„ÉÑ„Ç§„Éº„Éà":"retweets","ËΩ¨Êé®":"retweets","ËΩâÊé®":"retweets","ËΩ¨Âèë":"retweets",
    "ÎãµÍ∏Ä":"replies","Replies":"replies","Ëøî‰ø°":"replies","ÂõûÂ§ç":"replies",
    "Í≥µÏú† Ïàò":"shares","Shares":"shares","„Ç∑„Çß„Ç¢":"shares","ÂàÜ‰∫´":"shares",
    "ÏÉàÎ°úÏö¥ ÌåîÎ°úÏö∞":"newFollows","New follows":"newFollows","Êñ∞„Åó„ÅÑ„Éï„Ç©„É≠„ÉØ„Éº":"newFollows","Êñ∞ÂÖ≥Ê≥®ËÄÖ":"newFollows",
    "ÌîÑÎ°úÌïÑ Ï°∞ÌöåÏàò":"profileClicks","Profile clicks":"profileClicks","„Éó„É≠„Éï„Ç£„Éº„É´„ÇØ„É™„ÉÉ„ÇØÊï∞":"profileClicks","‰∏™‰∫∫ËµÑÊñôÁÇπÂáªÊ¨°Êï∞":"profileClicks",
    "URL ÌÅ¥Î¶≠Ïàò":"urlClicks","URL clicks":"urlClicks","URL „ÇØ„É™„ÉÉ„ÇØÊï∞":"urlClicks","URL ÁÇπÂáªÊ¨°Êï∞":"urlClicks",
    "Í≥†Ïú† ÎßÅÌÅ¨ ÌÅ¥Î¶≠Ïàò":"uniqueClicks","Unique link clicks":"uniqueClicks","„É¶„Éã„Éº„ÇØ„É™„É≥„ÇØ„ÇØ„É™„ÉÉ„ÇØÊï∞":"uniqueClicks","ÂîØ‰∏ÄÈìæÊé•ÁÇπÂáªÊ¨°Êï∞":"uniqueClicks",
  };
  const result = {};
  for (const key in row) {
    const clean = key.trim();
    if (map[clean]) result[map[clean]] = row[key];
  }

  // ÎÇ†Ïßú & ÎßÅÌÅ¨ & Î≥∏Î¨∏ÏùÑ Ï¢Ä Îçî Ïú†Ïó∞ÌïòÍ≤å Ï∞æÍ∏∞
  if (!result.date) {
    for (const key in row) {
      const l = key.trim().toLowerCase();
      if (l.includes("ÎÇ†Ïßú") || l === "date" || l.startsWith("date ")) {
        result.date = row[key];
        break;
      }
    }
  }
  if (!result.link) {
    for (const key in row) {
      const l = key.trim().toLowerCase();
      if (l.includes("ÎßÅÌÅ¨") || l.includes("permalink") || l === "url" || l.includes("url")) {
        result.link = row[key];
        break;
      }
    }
  }
  if (!result.text) {
    for (const key in row) {
      const l = key.trim().toLowerCase();
      if (l.includes("text") || l.includes("Î≥∏Î¨∏")) {
        result.text = row[key];
        break;
      }
    }
  }
  return result;
}
function num(v){
  if(!v) return 0;
  v = String(v).replace(/,/g,"").trim();
  const n = parseFloat(v);
  return isNaN(n)?0:n;
}

/* ========== ÎÇ†Ïßú/Í∏∞Í∞Ñ Ï≤òÎ¶¨ (ÌïúÍµ≠Ïãù ÎÇ†Ïßú Ìè¨Ìï®) ========== */
function parseDateValue(v){
  if(!v) return null;
  let s = String(v).trim();

  // 1) YYYY-MM-DD, YYYY/MM/DD, etc.
  let m = s.match(/(\d{4})[^\d]?(\d{1,2})[^\d]?(\d{1,2})/);
  if(m){
    const year = parseInt(m[1],10);
    const month = parseInt(m[2],10)-1;
    const day = parseInt(m[3],10);
    const d = new Date(year, month, day);
    if(!isNaN(d.getTime())) return d;
  }

  // 2) MM-DD-YYYY or DD-MM-YYYY ÌòïÌÉú Î≥¥ÏôÑ
  m = s.match(/(\d{1,2})[^\d]?(\d{1,2})[^\d]?(\d{4})/);
  if(m){
    const a = parseInt(m[1],10);
    const b = parseInt(m[2],10);
    const year = parseInt(m[3],10);
    // Ïõî/Ïùº Ï∂îÏ†ï (a>12Î©¥ a=day, b=month Î°ú Í∞ÄÏ†ï)
    let month, day;
    if(a > 12){
      day = a;
      month = b - 1;
    }else{
      month = a - 1;
      day = b;
    }
    const d = new Date(year, month, day);
    if(!isNaN(d.getTime())) return d;
  }

  // 3) Date.parseÍ∞Ä Í∞ÄÎä•Ìïú Î¨∏ÏûêÏó¥Ïù¥Î©¥ Í∑∏ÎåÄÎ°ú ÏÇ¨Ïö©
  const parsed = Date.parse(s);
  if(!isNaN(parsed)){
    const d = new Date(parsed);
    if(!isNaN(d.getTime())) return d;
  }
  return null;
}

function applyDateFilter(list, range){
  if(range === "ALL") return list.slice();
  const days = Number(range);
  if(!days || !list.length) return list.slice();

  // ÎÇ†ÏßúÍ∞Ä ÏûàÎäî Îç∞Ïù¥ÌÑ∞Îßå Ïö∞ÏÑ† ÏÇ¨Ïö©
  const withDates = list.filter(p => p.dateObj);
  if(!withDates.length){
    // ÎÇ†Ïßú ÌååÏã±Ïù¥ Ïïà Îêú Í≤ΩÏö∞: Îã®ÏàúÌûà Îí§ÏóêÏÑú NÍ∞úÎßå Î≥¥Ïó¨Ï£ºÎäî fallback
    const count = Math.min(list.length, days);
    return list.slice(list.length - count);
  }

  const dates = withDates.map(p=>p.dateObj);
  const latestTime = Math.max.apply(null, dates.map(d=>d.getTime()));
  const latest = new Date(latestTime);
  const ms = 24*60*60*1000;
  const threshold = new Date(latest.getTime() - (days-1)*ms);

  // Í∏∞Í∞Ñ ÌïÑÌÑ∞ÏóêÏÑúÎäî ÎÇ†Ïßú ÏóÜÎäî Í∏ÄÏùÄ Ï†úÏô∏ (ALLÏóêÏÑúÎßå Ìè¨Ìï®)
  return list.filter(p => p.dateObj && p.dateObj >= threshold);
}

/* ========== Ïä§ÏΩîÏñ¥/Îì±Í∏â ========== */
function computeScore(p){
  const impres = p.impressions || 0;
  const raw =
      p.engagements +
      p.bookmarks * 3 +
      p.newFollows * 10 +
      p.profileClicks * 0.7 +
      p.urlClicks * 0.8 +
      p.uniqueClicks * 1.2 +
      p.likes * 1.2 +
      p.retweets * 2 +
      p.replies * 1.5 +
      p.shares * 1.8;
  return raw / Math.log10(impres + 10);
}
function assignGrades(list){
  list.sort((a,b)=>b.score-a.score);
  const N = list.length || 1;
  list.forEach((p,i)=>{
    const pct = N>1 ? 1 - i/(N-1) : 1;
    p.percentile = Math.round(pct*100);
    p.grade =
      pct>=0.95?"S":
      pct>=0.80?"A":
      pct>=0.60?"B":
      pct>=0.40?"C":"D";
  });
}
function computeTrimmedAverage(list, ratio){
  if(!list.length) return 0;
  const scores = list.map(p=>p.score).sort((a,b)=>a-b);
  const n = scores.length;
  let k = Math.floor(n*ratio);
  if(k*2>=n) k = 0;
  const trimmed = scores.slice(k, n-k);
  const sum = trimmed.reduce((s,v)=>s+v,0);
  return sum / trimmed.length;
}
function sortForView(list){
  const key = SORT_KEY || "score";
  list.sort((a,b)=>{
    let va, vb;
    switch(key){
      case "impressions": va = a.impressions; vb = b.impressions; break;
      case "engagements": va = a.engagements; vb = b.engagements; break;
      case "bookmarks":  va = a.bookmarks;  vb = b.bookmarks;  break;
      case "newFollows": va = a.newFollows; vb = b.newFollows; break;
      case "score":
      default:
        va = a.score; vb = b.score; break;
    }
    if(va < vb) return 1;
    if(va > vb) return -1;
    return 0;
  });
  return list;
}

/* ========== ÌîÑÎ°úÏ†ùÌä∏ ÌÉúÍπÖ/ÏßëÍ≥Ñ ========== */
function tagProjectsForPost(p){
  const text = (p.text || "").toLowerCase();
  const tags = [];
  PROJECTS.forEach(proj=>{
    const hit = proj.keywords.some(kw => text.includes(kw.toLowerCase()));
    if(hit) tags.push(proj.id);
  });
  p.projects = tags;
}

function computeProjectStats(list){
  const stats = {};
  PROJECTS.forEach(proj=>{
    stats[proj.id] = {
      id: proj.id,
      label: proj.label,
      count: 0,
      avgScore: 0,
      trimmedAvg: 0,
      bestScore: 0,
      bestDate: "",
      bestLink: "",
      posts: []
    };
  });

  list.forEach(post=>{
    (post.projects || []).forEach(pid=>{
      const s = stats[pid];
      if(!s) return;
      s.count++;
      s.posts.push(post);
      if(!s.bestScore || post.score > s.bestScore){
        s.bestScore = post.score;
        s.bestDate = post.date;
        s.bestLink = post.link;
      }
    });
  });

  const result = [];
  Object.values(stats).forEach(s=>{
    if(!s.posts.length) return;
    const total = s.posts.length;
    s.avgScore = s.posts.reduce((sum,p)=>sum+p.score,0)/total;
    s.trimmedAvg = computeTrimmedAverage(s.posts, TRIM_RATIO);
    result.push(s);
  });
  return result;
}

/* ÌîÑÎ°úÏ†ùÌä∏ ÏöîÏïΩ ÌÖåÏù¥Î∏î */
function renderProjectSummary(list){
  const wrap = document.getElementById("project-summary-wrap");
  if(!wrap) return;
  if(!list.length){
    wrap.innerHTML = "<div class='empty'>ÌîÑÎ°úÏ†ùÌä∏ ÌÇ§ÏõåÎìúÏóê Îß§Ïπ≠Îêú Í∏ÄÏù¥ ÏïÑÏßÅ ÏóÜÏäµÎãàÎã§.</div>";
    return;
  }
  list.sort((a,b)=>(b.trimmedAvg||0)-(a.trimmedAvg||0));
  const rows = list.map((s,idx)=>`
    <tr>
      <td>#${idx+1}</td>
      <td>${s.label}</td>
      <td>${s.count}</td>
      <td>${s.avgScore ? s.avgScore.toFixed(1) : "-"}</td>
      <td>${s.trimmedAvg ? s.trimmedAvg.toFixed(1) : "-"}</td>
      <td>${s.bestLink ? `<a href="${s.bestLink}" class="link-pill" target="_blank">ÎåÄÌëú Ìä∏Ïúó ‚Üó</a>` : ""}</td>
    </tr>
  `).join("");
  wrap.innerHTML = `
    <table>
      <thead>
        <tr>
          <th>ÏàúÏúÑ</th>
          <th>ÌîÑÎ°úÏ†ùÌä∏</th>
          <th>Í≤åÏãúÍ∏Ä Ïàò</th>
          <th>ÌèâÍ∑† Ïä§ÏΩîÏñ¥</th>
          <th>Ìä∏Î¶ºÎìú ÌèâÍ∑†</th>
          <th>ÎåÄÌëú Ìä∏Ïúó</th>
        </tr>
      </thead>
      <tbody>${rows}</tbody>
    </table>
  `;
}

/* ÌîÑÎ°úÏ†ùÌä∏Î≥Ñ ÏÉÅÏÑ∏ ÏÖÄÎ†âÌä∏ & ÌÖåÏù¥Î∏î */
function buildProjectSelect(list){
  const select = document.getElementById("project-select");
  const detailWrap = document.getElementById("project-detail-wrap");
  if(!select || !detailWrap) return;

  if(!list.length){
    select.innerHTML = `<option value="">Îß§Ïπ≠Îêú ÌîÑÎ°úÏ†ùÌä∏Í∞Ä ÏóÜÏäµÎãàÎã§.</option>`;
    detailWrap.innerHTML = `<div class="empty">ÌîÑÎ°úÏ†ùÌä∏ ÌÇ§ÏõåÎìúÏóê Îß§Ïπ≠Îêú Í∏ÄÏù¥ ÏïÑÏßÅ ÏóÜÏäµÎãàÎã§.</div>`;
    renderProjectGradePie(null);
    return;
  }

  select.innerHTML = list.map(p=>`<option value="${p.id}">${p.label} (${p.count})</option>`).join("");
  select.onchange = () => {
    const stat = PROJECT_STATS.find(p=>p.id===select.value);
    if(stat) renderProjectGradePie(stat);
    renderProjectDetail(select.value);
  };
  const first = list[0];
  select.value = first.id;
  renderProjectDetail(first.id);
  renderProjectGradePie(first);
}

function renderProjectDetail(projectId){
  const wrap = document.getElementById("project-detail-wrap");
  if(!wrap) return;
  const proj = PROJECT_STATS.find(p=>p.id===projectId);
  if(!proj || !proj.posts.length){
    wrap.innerHTML = `<div class="empty">ÏÑ†ÌÉùÌïú ÌîÑÎ°úÏ†ùÌä∏Ïóê Ìï¥ÎãπÌïòÎäî Í≤åÏãúÍ∏ÄÏù¥ ÏóÜÏäµÎãàÎã§.</div>`;
    return;
  }
  const posts = proj.posts.slice().sort((a,b)=>b.score-a.score);
  const rows = posts.map((p,idx)=>`
    <tr>
      <td>#${idx+1}</td>
      <td><div class="grade-badge ${p.grade.toLowerCase()}">${p.grade}</div></td>
      <td>
        <div class="text-main">${p.text}</div>
        <div class="text-meta">${p.date} ¬∑ Ïä§ÏΩîÏñ¥ <strong>${p.score.toFixed(1)}</strong></div>
      </td>
      <td>
        <div class="stat-chip">Ï∞∏Ïó¨ <strong>${p.engagements}</strong></div>
        <div class="stat-chip">ÎÖ∏Ï∂ú <strong>${p.impressions}</strong></div>
      </td>
      <td>
        <div class="stat-chip">ÌåîÎ°úÏö∞ <strong>${p.newFollows}</strong></div>
        <div class="stat-chip">Î∂ÅÎßàÌÅ¨ <strong>${p.bookmarks}</strong></div>
      </td>
      <td>${p.link ? `<a href="${p.link}" class="link-pill" target="_blank">Ìä∏Ïúó Î≥¥Í∏∞ ‚Üó</a>` : ""}</td>
    </tr>
  `).join("");

  wrap.innerHTML = `
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Îì±Í∏â</th>
          <th>Î≥∏Î¨∏</th>
          <th>Ï∞∏Ïó¨/ÎÖ∏Ï∂ú</th>
          <th>ÌåîÎ°úÏö∞/Î∂ÅÎßàÌÅ¨</th>
          <th>ÎßÅÌÅ¨</th>
        </tr>
      </thead>
      <tbody>${rows}</tbody>
    </table>
  `;
}

/* ÌîÑÎ°úÏ†ùÌä∏ ÎèÑÎÑõ Ï∞®Ìä∏ */
function renderProjectPieChart(list){
  const canvas = document.getElementById("project-pie");
  if(!canvas) return;
  const ctx = canvas.getContext("2d");

  if(projectChart){
    projectChart.destroy();
    projectChart = null;
  }
  if(!list.length) return;

  const labels = list.map(p=>p.label);
  const data = list.map(p=>p.count);

  projectChart = new Chart(ctx, {
    type: "doughnut",
    data: {
      labels,
      datasets: [{
        data,
        backgroundColor: [
          "rgba(59,130,246,0.9)",
          "rgba(45,212,191,0.9)",
          "rgba(251,191,36,0.9)",
          "rgba(244,114,182,0.9)",
          "rgba(129,140,248,0.9)",
          "rgba(16,185,129,0.9)",
          "rgba(249,115,22,0.9)",
          "rgba(236,72,153,0.9)"
        ]
      }]
    },
    options: {
      responsive:false,
      maintainAspectRatio:false,
      plugins: {
        legend: { position: "bottom" }
      },
      cutout:"55%",
      onClick(evt, elements){
        if(!elements.length) return;
        const idx = elements[0].index;
        const proj = list[idx];
        if(!proj) return;
        const select = document.getElementById("project-select");
        if(select){
          select.value = proj.id;
        }
        renderProjectDetail(proj.id);
        const stat = PROJECT_STATS.find(p=>p.id===proj.id);
        if(stat){
          renderProjectGradePie(stat);
        }
      }
    }
  });
}

function renderGlobalGradePie(stats){
  const canvas = document.getElementById("grade-distribution-pie");
  if(!canvas) return;
  const ctx = canvas.getContext("2d");

  if(globalGradeChart){
    globalGradeChart.destroy();
    globalGradeChart = null;
  }

  if(!stats || !stats.length){
    canvas.style.display = "none";
    return;
  }
  canvas.style.display = "block";

  const labels = stats.map(p=>p.label);
  const data = stats.map(p=> (p.trimmedAvg || p.avgScore || 0));

  globalGradeChart = new Chart(ctx, {
    type: "doughnut",
    data: {
      labels,
      datasets: [{
        data,
        backgroundColor: [
          "rgba(59,130,246,0.9)",
          "rgba(45,212,191,0.9)",
          "rgba(251,191,36,0.9)",
          "rgba(244,114,182,0.9)",
          "rgba(129,140,248,0.9)",
          "rgba(16,185,129,0.9)",
          "rgba(249,115,22,0.9)",
          "rgba(236,72,153,0.9)"
        ]
      }]
    },
    options: {
      responsive:false,
      maintainAspectRatio:false,
      plugins: {
        legend: { position: "bottom" }
      },
      cutout:"55%"
    }
  });
}

function renderProjectGradePie(stat){
  const canvas = document.getElementById("project-grade-pie");
  if(!canvas) return;
  const ctx = canvas.getContext("2d");

  if(projectGradeChart){
    projectGradeChart.destroy();
    projectGradeChart = null;
  }

  if(!stat || !stat.posts || !stat.posts.length){
    canvas.style.display = "none";
    return;
  }
  canvas.style.display = "block";

  const counts = { S:0, A:0, B:0, C:0, D:0 };
  stat.posts.forEach(p=>{
    if(counts[p.grade] !== undefined){
      counts[p.grade]++;
    }
  });

  const labels = ["S","A","B","C","D"];
  const data = labels.map(g=>counts[g]);

  projectGradeChart = new Chart(ctx, {
    type: "doughnut",
    data: {
      labels,
      datasets: [{
        data,
        backgroundColor: [
          "rgba(245,158,11,0.9)",  // S
          "rgba(56,189,248,0.9)",  // A
          "rgba(34,197,94,0.9)",   // B
          "rgba(168,85,247,0.9)",  // C
          "rgba(148,163,184,0.9)"  // D
        ]
      }]
    },
    options: {
      responsive:false,
      maintainAspectRatio:false,
      plugins: {
        legend: { position: "bottom" }
      },
      cutout:"55%"
    }
  });
}

/* ========== Top10 / Îì±Í∏âÎ≥Ñ Î†åÎçîÎßÅ ========== */
function renderTop10(posts){
  const wrap=document.getElementById("top10-table-wrap");
  const countSpan = document.getElementById("top10-count");
  if(!posts.length){
    wrap.innerHTML="<div class='empty'>Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</div>";
    if(countSpan) countSpan.textContent = "";
    return;
  }
  const base = sortForView(posts.slice());
  const top = base.slice(0,10);
  if(countSpan) countSpan.textContent = `(${top.length} / ${posts.length})`;
  const rows=top.map((p,i)=>`
    <tr>
      <td>#${i+1}</td>
      <td><div class="grade-badge ${p.grade.toLowerCase()}">${p.grade}</div></td>
      <td>
        <div class="text-main">${p.text}</div>
        <div class="text-meta">${p.date} ¬∑ Ïä§ÏΩîÏñ¥ <strong>${p.score.toFixed(1)}</strong></div>
      </td>
      <td>
        <div class="stat-chip">Ï∞∏Ïó¨ <strong>${p.engagements}</strong></div>
        <div class="stat-chip">ÎÖ∏Ï∂ú <strong>${p.impressions}</strong></div>
      </td>
      <td>
        <div class="stat-chip">ÌåîÎ°úÏö∞ <strong>${p.newFollows}</strong></div>
        <div class="stat-chip">Î∂ÅÎßàÌÅ¨ <strong>${p.bookmarks}</strong></div>
      </td>
      <td>${p.link ? `<a href="${p.link}" class="link-pill" target="_blank">Ìä∏Ïúó Î≥¥Í∏∞ ‚Üó</a>` : ""}</td>
    </tr>`).join("");
  wrap.innerHTML=`
    <table>
      <thead><tr>
        <th>#</th><th>Îì±Í∏â</th><th>Î≥∏Î¨∏</th><th>Ï∞∏Ïó¨/ÎÖ∏Ï∂ú</th><th>ÌåîÎ°úÏö∞/Î∂ÅÎßàÌÅ¨</th><th>ÎßÅÌÅ¨</th>
      </tr></thead>
      <tbody>${rows}</tbody>
    </table>`;
}
function renderGrade(list){
  const wrap=document.getElementById("grade-table-wrap");
  if(!list.length){
    wrap.innerHTML="<div class='empty'>Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</div>";
    return;
  }
  const base = sortForView(list.slice());
  const rows=base.map((p,i)=>`
    <tr>
      <td>#${i+1}</td>
      <td><div class="grade-badge ${p.grade.toLowerCase()}">${p.grade}</div></td>
      <td>
        <div class="text-main">${p.text}</div>
        <div class="text-meta">${p.date} ¬∑ Ïä§ÏΩîÏñ¥ <strong>${p.score.toFixed(1)}</strong></div>
      </td>
      <td>
        <div class="stat-chip">Ï∞∏Ïó¨ <strong>${p.engagements}</strong></div>
        <div class="stat-chip">ÎÖ∏Ï∂ú <strong>${p.impressions}</strong></div>
      </td>
      <td>
        <div class="stat-chip">ÌåîÎ°úÏö∞ <strong>${p.newFollows}</strong></div>
        <div class="stat-chip">Î∂ÅÎßàÌÅ¨ <strong>${p.bookmarks}</strong></div>
      </td>
      <td>${p.link ? `<a href="${p.link}" class="link-pill" target="_blank">Ìä∏Ïúó Î≥¥Í∏∞ ‚Üó</a>` : ""}</td>
    </tr>`).join("");
  wrap.innerHTML=`
    <table>
      <thead><tr>
        <th>#</th><th>Îì±Í∏â</th><th>Î≥∏Î¨∏</th><th>Ï∞∏Ïó¨/ÎÖ∏Ï∂ú</th><th>ÌåîÎ°úÏö∞/Î∂ÅÎßàÌÅ¨</th><th>ÎßÅÌÅ¨</th>
      </tr></thead>
      <tbody>${rows}</tbody>
    </table>`;
}

/* ========== ÏΩîÏπò Î¥á Ï∂úÎ†• ========== */
function updateCoach(){
  const el = document.getElementById("coach-output");
  if(!el) return;

  if(!ALL_BASE.length){
    if(CURRENT_LANG === "en"){
      el.textContent =
        "No CSV has been uploaded yet.\n" +
        "Download your X Analytics CSV and upload it above,\n" +
        "then the coach bot will summarize your mindshare status for this period.";
    }else{
      el.textContent =
        "ÏïÑÏßÅ CSVÎ•º Ïò¨Î¶¨ÏßÄ ÏïäÏïòÏñ¥.\n" +
        "ÏÉÅÎã®ÏóêÏÑú Ïï†ÎÑêÎ¶¨Ìã±Ïä§ CSVÎ•º ÏóÖÎ°úÎìúÌïòÎ©¥\n" +
        "Ïù¥ Íµ¨Í∞ÑÏùò ÎßàÏù∏ÎìúÏâêÏñ¥ ÏÉÅÌÉúÎ•º ÏΩîÏπò Î¥áÏù¥ ÏöîÏïΩÌï¥ Ï§Ñ Í±∞Ïïº.";
    }
    return;
  }
  if(!CURRENT_LIST.length || !ANALYSIS){
    el.textContent = (CURRENT_LANG === "en")
      ? "There is no data for the selected period, so I can't analyze it."
      : "ÏÑ†ÌÉùÌïú Í∏∞Í∞ÑÏóê Ìï¥ÎãπÌïòÎäî Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏñ¥ÏÑú Î∂ÑÏÑùÌï† Ïàò ÏóÜÏñ¥.";
    return;
  }

  const gradeCounts = { S:0, A:0, B:0, C:0, D:0 };
  CURRENT_LIST.forEach(p=>{
    if(gradeCounts[p.grade] !== undefined){
      gradeCounts[p.grade]++;
    }
  });

  const tAvg = ANALYSIS.trimmedAvg || 0;
  let overallGrade, moodKo, moodEn;
  if(tAvg >= 80){
    overallGrade = "S";
    moodKo = "Ïù¥Î≤à Íµ¨Í∞ÑÏùÄ ÏÇ¨Ïã§ÏÉÅ Ìè≠Î∞ú Íµ¨Í∞ÑÏù¥Ïïº. ÏßÄÍ∏à ÌéòÏù¥Ïä§ Í∑∏ÎåÄÎ°ú Ïú†ÏßÄÌïòÎ©¥ÏÑú, ÌÑ∞Ï°åÎçò Ìå®ÌÑ¥ÏùÑ Î∞òÎ≥µÌïòÎ©¥ Îèº.";
    moodEn = "This period is basically an explosion zone. Keep this pace and repeat the patterns that already worked.";
  }else if(tAvg >= 60){
    overallGrade = "A";
    moodKo = "ÏÉÅÏúÑÍ∂åÏóêÏÑú Ïûò Î≤ÑÌã∞Í≥† ÏûàÏñ¥. Ï°∞Í∏àÎßå Îçî Ï†ïÍµêÌïòÍ≤å Ïã§ÌóòÌïòÎ©¥ Ïñ∏Ï†úÎì† SÎ°ú Ïò¨ÎùºÍ∞à Ïàò ÏûàÎäî ÏúÑÏπòÏïº.";
    moodEn = "You are holding solid in the upper tier. With a bit more fine‚Äëtuned experimentation, you can jump into S range.";
  }else if(tAvg >= 45){
    overallGrade = "B";
    moodKo = "Î¨¥ÎÇúÌïòÍ≤å Ïö∞ÏÉÅÌñ• Ï§ÄÎπÑ Ï§ëÏù∏ Íµ¨Í∞ÑÏù¥Ïïº. Î™á Í∞ú Í∞ïÌïú ÏãúÍ∑∏ÎÑêÏùÑ Îçî ÎßåÎì§Î©¥ Ìïú Îã®Í≥Ñ ÏúÑÎ°ú Ïò¨ÎùºÍ∞à Ïàò ÏûàÏñ¥.";
    moodEn = "This is a steady preparation phase for an uptrend. A few stronger signals could push you to the next tier.";
  }else if(tAvg >= 30){
    overallGrade = "C";
    moodKo = "Ïã§ÌóòÏùÄ ÎßéÏù¥ ÌñàÏßÄÎßå ÏïÑÏßÅ Îπµ ÌÑ∞ÏπòÎäî Ìå®ÌÑ¥Ïù¥ Î∂ÄÏ°±Ìïú Íµ¨Í∞ÑÏù¥Ïïº. Ïûò ÌÑ∞ÏßÑ Í∏Ä Í∏∞Ï§ÄÏúºÎ°ú Í≥µÌÜµ Ìå®ÌÑ¥ÏùÑ ÎΩëÏïÑÎ≥¥Ïûê.";
    moodEn = "You‚Äôre experimenting a lot, but lack a consistently explosive pattern. Try extracting common traits from your best‚Äëperforming posts.";
  }else{
    overallGrade = "D";
    moodKo = "Îç∞Ïù¥ÌÑ∞Í∞Ä ÏåìÏù¥Îäî Îã®Í≥ÑÎùºÏÑú, ÏßÄÍ∏àÏùÄ ‚ÄòÌÖåÏä§Ìä∏ Í∏∞Í∞Ñ‚ÄôÏù¥Îùº Î≥¥Î©¥ Îèº. Îã§ÏñëÌïú ÌòïÏãùÏùÑ Î∂ÄÎã¥ ÏóÜÏù¥ ÎçòÏßÄÎäî Í≤å Ï¢ãÏïÑ.";
    moodEn = "This is still a data‚Äëgathering phase. Treat it as a test period and throw out various formats without overthinking.";
  }

  const bestPost = CURRENT_LIST.slice().sort((a,b)=>b.score-a.score)[0];

  let accountStyleKo = "";
  let accountStyleEn = "";
  const totalPosts = ANALYSIS.totalPosts || CURRENT_LIST.length || 0;
  const highPosts = gradeCounts.S + gradeCounts.A;
  const highRate = totalPosts > 0 ? highPosts / totalPosts : 0;

  if (totalPosts <= 40 && highRate >= 0.3) {
    // ÏßàÎ°ú ÏäπÎ∂ÄÌòï
    accountStyleKo = "Ïù¥ Í≥ÑÏ†ïÏùÄ Ï†ÑÌòïÏ†ÅÏù∏ ‚ÄòÏßàÎ°ú ÏäπÎ∂Ä‚Äô ÌÉÄÏûÖÏù¥Ïïº. Í∏Ä ÏàòÎäî ÏÉÅÎåÄÏ†ÅÏúºÎ°ú ÎßéÏßÄ ÏïäÏùÄÎç∞ S/AÍ∏â ÎπÑÏú®Ïù¥ ÎÜíÏïÑÏÑú, Ìïú Ìé∏ Ìïú Ìé∏ÏùÑ ÍΩ§ Í≥µÎì§Ïó¨ Ïì∞Îäî Ìå®ÌÑ¥Ïù¥ Î≥¥Ïó¨.";
    accountStyleEn = "This account is a classic ‚Äúquality‚Äëfirst‚Äù type. You don‚Äôt post huge volume, but the S/A‚Äëtier ratio is high, so each post seems carefully crafted.";
  } else if (totalPosts >= 80 && highRate < 0.2) {
    // ÏñëÏúºÎ°ú ÏïïÎ∞ïÌòï
    accountStyleKo = "Ïù¥ Í≥ÑÏ†ïÏùÄ ‚ÄòÏñëÏúºÎ°ú ÏïïÎ∞ï‚ÄôÌïòÎäî ÌÉÄÏûÖÏóê Í∞ÄÍπåÏõå. Ï†ÑÏ≤¥ Í∏Ä ÏàòÍ∞Ä ÎßéÍ≥† S/A ÎπÑÏú®ÏùÄ ÎÇÆÏùÄ Ìé∏Ïù¥Îùº, Îã§ÏñëÌïú ÏãúÎèÑÎ•º ÎßéÏù¥ ÎçòÏßÄÎ©¥ÏÑú ÏÑ±Í≥µ Ìå®ÌÑ¥ÏùÑ Ï∞æÎäî Ïä§ÌÉÄÏùºÏù¥Ïïº.";
    accountStyleEn = "This account leans toward a ‚Äúvolume‚Äëdriven‚Äù style. You post a lot, with a relatively lower S/A ratio, using sheer volume and experimentation to find what works.";
  } else {
    // Î∞∏Îü∞Ïä§Ìòï
    accountStyleKo = "Ïù¥ Í≥ÑÏ†ïÏùÄ ÏßàÍ≥º ÏñëÏù¥ Ï†ÅÎãπÌûà ÏÑûÏù∏ Î∞∏Îü∞Ïä§ÌòïÏù¥Ïïº. Í∏Ä ÏàòÎèÑ, S/A ÎπÑÏú®ÎèÑ Î™®Îëê Ï§ëÍ∞Ñ Ïù¥ÏÉÅÏù¥Îùº, Íæ∏Ï§ÄÌïú Î≥ºÎ•®ÏùÑ Ïú†ÏßÄÌïòÎ©¥ÏÑú Ïã§ÌóòÎèÑ Î≥ëÌñâÌïòÎäî Ìå®ÌÑ¥Ïù¥ Î≥¥Ïó¨.";
    accountStyleEn = "This account is a balanced mix of quality and volume. Both your post count and S/A ratio are in a healthy middle range, keeping steady volume while continuing to experiment.";
  }

  let text;
  if(CURRENT_LANG === "en"){
    text =
`‚óè One‚Äëline summary for this period
- Trimmed average score: about ${tAvg.toFixed(1)} ‚Üí roughly in the ${overallGrade} band
- Grade distribution: S ${gradeCounts.S} / A ${gradeCounts.A} / B ${gradeCounts.B} / C ${gradeCounts.C} / D ${gradeCounts.D}

‚óè Coach comment
- ${moodEn}

‚óè Best‚Äëperforming post
- Date: ${bestPost.date || "-"}
- Score: ${bestPost.score.toFixed(1)}
${bestPost.link ? "- Link: " + bestPost.link : ""}

‚óè Account style (quality vs volume)
- ${accountStyleEn}

‚Äª Tip: Collect your S/A‚Äëtier posts and compare length, tone, meme usage, time of posting, hashtags, and inner‚Äëcircle tags.
That‚Äôs the fastest way to reverse‚Äëengineer your own ‚Äúmindshare pattern‚Äù.`;
  }else{
    text =
`‚óè Ïù¥Î≤à Í∏∞Í∞Ñ Ìïú Ï§Ñ ÏöîÏïΩ
- Ï†ÑÏ≤¥ Ìä∏Î¶ºÎìú ÌèâÍ∑†: ÏïΩ ${tAvg.toFixed(1)}Ï†ê ‚Üí Ï≤¥Í∞ê Îì±Í∏âÏúºÎ°úÎäî ${overallGrade} Íµ¨Í∞ÑÏù¥Ïïº.
- Îì±Í∏â Î∂ÑÌè¨: S ${gradeCounts.S} / A ${gradeCounts.A} / B ${gradeCounts.B} / C ${gradeCounts.C} / D ${gradeCounts.D}

‚óè ÏΩîÏπò ÏΩîÎ©òÌä∏
- ${moodKo}

‚óè Í∞ÄÏû• Ïûò ÌÑ∞ÏßÑ Í∏Ä
- ÎÇ†Ïßú: ${bestPost.date || "-"}
- Ïä§ÏΩîÏñ¥: ${bestPost.score.toFixed(1)}
${bestPost.link ? "- ÎßÅÌÅ¨: " + bestPost.link : ""}

‚óè Í≥ÑÏ†ï Ïä§ÌÉÄÏùº (Ïßà vs Ïñë)
- ${accountStyleKo}

‚Äª ÌåÅ: ÏÉÅÏúÑ S/A Í∏ÄÎì§Îßå Î™®ÏïÑÏÑú ‚ÄúÍ∏∏Ïù¥, ÌÜ§, Î∞à ÏÇ¨Ïö© Ïó¨Î∂Ä, ÏãúÍ∞ÑÎåÄ, Ìï¥ÏãúÌÉúÍ∑∏, Ïù¥ÎÑàÏÑúÌÅ¥ ÌÉúÍ∑∏ Ïó¨Î∂Ä‚ÄùÎ•º ÎπÑÍµêÌï¥ Î≥¥Î©¥,
ÏßÄÍ∏à Í≥ÑÏ†ïÎßåÏùò ÎßàÏâê Ìå®ÌÑ¥ÏùÑ Îçî Îπ®Î¶¨ Ï∞æÏùÑ Ïàò ÏûàÏñ¥.`;
  }

  el.textContent = text;
}

function setupRangeTabs(){
  const rangeTabs = document.getElementById("range-tabs");
  if(!rangeTabs) return;
  if(rangeTabs.dataset.bound === "1") return;
  rangeTabs.dataset.bound = "1";

  const buttons = rangeTabs.querySelectorAll(".range-tab");
  buttons.forEach(btn=>{
    btn.addEventListener("click", ()=>{
      buttons.forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      const range = btn.dataset.range || "ALL";
      CURRENT_RANGE = range;
      updateView();
    });
  });
}

/* ========== Ï†ÑÏ≤¥ Î∑∞ ÏóÖÎç∞Ïù¥Ìä∏ (Í∏∞Í∞Ñ ÌïÑÌÑ∞ Ï†ÅÏö©) ========== */
function updateView(){
  if(!ALL_BASE.length) return;
  const summaryEl = document.getElementById("summary");
  const errorEl = document.getElementById("error");
  const filtered = applyDateFilter(ALL_BASE, CURRENT_RANGE);
  CURRENT_LIST = filtered;

  if(!filtered.length){
    ANALYSIS = null;
    updateYapGauge(null);
    summaryEl.innerHTML = "";
    summaryEl.style.display = "none";
    errorEl.textContent = "ÏÑ†ÌÉùÌïú Í∏∞Í∞ÑÏóê Ìï¥ÎãπÌïòÎäî Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.";
    document.getElementById("top10-table-wrap").innerHTML = "<div class='empty'>Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</div>";
    document.getElementById("grade-table-wrap").innerHTML = "<div class='empty'>Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</div>";
    PROJECT_STATS = [];
    renderProjectSummary([]);
    buildProjectSelect([]);
    renderProjectPieChart([]);
    const countSpan = document.getElementById("top10-count");
    if(countSpan) countSpan.textContent = "";
    updateCoach();
    return;
  }

  errorEl.textContent = "";
  assignGrades(filtered);

  buckets = { S:[], A:[], B:[], C:[], D:[] };
  filtered.forEach(p=>{
    const g = p.grade;
    if(buckets[g] && buckets[g].length < 10){
      buckets[g].push(p);
    }
  });

  const total = filtered.length;
  const avgScore = filtered.reduce((s,p)=>s+p.score,0)/total;
  const trimmedAvg = computeTrimmedAverage(filtered, TRIM_RATIO);
  const best = filtered[0];

  ANALYSIS = {
    trimmedAvg,
    avgScore,
    bestScore: best.score,
    bestDate: best.date,
    bestLink: best.link,
    totalPosts: total
  };

    
  updateYapCard(ANALYSIS);
  updateYapGauge(ANALYSIS);

summaryEl.innerHTML = `
    <div class="summary-card summary-card--posts">
      <div class="summary-ring"><span>üìù</span></div>
      <div class="summary-text">
        <div class="summary-label">ÏõêÍ∏Ä Í∞úÏàò</div>
        <div class="summary-value">${total}</div>
        <div class="summary-sub">ÎãµÍ∏Ä Ï†úÏô∏ ¬∑ Í∏∞Í∞Ñ ÌïÑÌÑ∞ Ï†ÅÏö©</div>
      </div>
    </div>

    <div class="summary-card summary-card--avg">
      <div class="summary-ring"><span>üìà</span></div>
      <div class="summary-text">
        <div class="summary-label">ÌèâÍ∑† Ïä§ÏΩîÏñ¥</div>
        <div class="summary-value">${avgScore.toFixed(1)}</div>
        <div class="summary-sub">ÌòÑÏû¨ ÏÑ†ÌÉùÎêú Í∏∞Í∞ÑÏùò Ï†ÑÏ≤¥ ÏõêÍ∏Ä Í∏∞Ï§Ä</div>
      </div>
    </div>

    <div class="summary-card summary-card--trimmed">
      <div class="summary-ring"><span‚öñÔ∏è</span></div>
      <div class="summary-text">
        <div class="summary-label">Ìä∏Î¶ºÎìú ÌèâÍ∑†</div>
        <div class="summary-value">${trimmedAvg.toFixed(1)}</div>
        <div class="summary-sub">ÏÉÅ¬∑ÌïòÏúÑ 10% Ï†úÍ±∞ ÌõÑ ÌèâÍ∑†</div>
      </div>
    </div>

    <div class="summary-card summary-card--best">
      <div class="summary-ring"><span>üí•</span></div>
      <div class="summary-text">
        <div class="summary-label">Í∞ÄÏû• ÌÑ∞ÏßÑ Í∏Ä</div>
        <div class="summary-value">${best.score.toFixed(1)}</div>
        <div class="summary-sub">${best.date || ""}</div>
      </div>
    </div>
  `;

  summaryEl.style.display="grid";

  renderGrowthChart(filtered);
  renderYapHeatmap(filtered);
  renderTop10(filtered);
  if(CURRENT_GRADE === "ALL"){
    renderGrade(filtered.slice(0,30));
  }else{
    renderGrade(buckets[CURRENT_GRADE] || []);
  }

  PROJECT_STATS = computeProjectStats(filtered);
  renderProjectSummary(PROJECT_STATS);
  buildProjectSelect(PROJECT_STATS);
  renderProjectPieChart(PROJECT_STATS);
  renderGlobalGradePie(PROJECT_STATS);

  updateCoach();
}
/* ========== Î°úÏª¨ Î∂ÑÏÑù ÌûàÏä§ÌÜ†Î¶¨ Ï†ÄÏû• ========== */
function getHistoryList(){
  try{
    const raw = localStorage.getItem("ms_history");
    if(!raw) return [];
    const parsed = JSON.parse(raw);
    return Array.isArray(parsed) ? parsed : [];
  }catch(e){
    console.warn("ÌûàÏä§ÌÜ†Î¶¨ Î∂àÎü¨Ïò§Í∏∞ Ï§ë Ïò§Î•ò", e);
    return [];
  }
}

function saveHistoryEntry(){
  try{
    if(!ANALYSIS || !ALL_BASE.length) return;
    const entry = {
      timestamp: new Date().toISOString(),
      range: CURRENT_RANGE || "ALL",
      trimmedAvg: ANALYSIS.trimmedAvg,
      avgScore: ANALYSIS.avgScore,
      bestScore: ANALYSIS.bestScore,
      bestDate: ANALYSIS.bestDate,
      totalPosts: ANALYSIS.totalPosts
    };
    const list = getHistoryList();
    list.push(entry);
    const trimmed = list.slice(-50); // ÏµúÍ∑º 50Í∞úÎßå Ïú†ÏßÄ
    localStorage.setItem("ms_history", JSON.stringify(trimmed));
  }catch(e){
    console.warn("ÌûàÏä§ÌÜ†Î¶¨ Ï†ÄÏû• Ïã§Ìå®", e);
  }
}



/* ========== ÎßàÏßÄÎßâ CSV Î∂ÑÏÑù Ïä§ÎÉÖÏÉ∑ (ÎãâÎÑ§ÏûÑÎ≥Ñ) ========== */
const LAST_SNAPSHOT_PREFIX = "ms_last_analysis_v1_";

function getCurrentProfileKey(){

function updateLastSnapshotUI(){
  try{
    const infoEl = document.getElementById("last-snapshot-info");
    if (!infoEl) return;
    if (typeof localStorage === "undefined") {
      infoEl.textContent = "Ïù¥ Î∏åÎùºÏö∞Ï†ÄÏóêÏÑúÎäî ÎßàÏßÄÎßâ CSV Ï†ÄÏû• Í∏∞Îä•ÏùÑ ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÏäµÎãàÎã§.";
      return;
    }
    const raw = localStorage.getItem(getCurrentProfileKey());
    if (!raw) {
      infoEl.textContent = "Ï†ÄÏû•Îêú ÎßàÏßÄÎßâ CSV Î∂ÑÏÑùÏù¥ ÏóÜÏäµÎãàÎã§.";
      return;
    }
    const parsed = JSON.parse(raw);
    if (!parsed || !parsed.timestamp) {
      infoEl.textContent = "Ï†ÄÏû•Îêú ÎßàÏßÄÎßâ CSV Î∂ÑÏÑùÏù¥ ÏóÜÏäµÎãàÎã§.";
      return;
    }
    const d = new Date(parsed.timestamp);
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,"0");
    const day = String(d.getDate()).padStart(2,"0");
    const hh = String(d.getHours()).padStart(2,"0");
    const mm = String(d.getMinutes()).padStart(2,"0");
    infoEl.textContent = `ÎßàÏßÄÎßâ Î∂ÑÏÑù: ${y}-${m}-${day} ${hh}:${mm} Í∏∞Ï§Ä`;
  }catch(e){
    console.warn("ÎßàÏßÄÎßâ Î∂ÑÏÑù UI ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®", e);
  }
}

  let nick = "";
  try{
    if (typeof localStorage !== "undefined") {
      nick = localStorage.getItem(NICKNAME_KEY) || "";
    }
  }catch(e){}
  if(!nick) nick = "guest";
  return LAST_SNAPSHOT_PREFIX + encodeURIComponent(nick);
}

function saveLastSnapshot(){
  try{
    if (typeof localStorage === "undefined") return;
    if (!ANALYSIS || !ALL_BASE.length) return;
    const payload = {
      timestamp: new Date().toISOString(),
      range: CURRENT_RANGE || "ALL",
      posts: ALL_BASE
    };
    localStorage.setItem(getCurrentProfileKey(), JSON.stringify(payload));
    updateLastSnapshotUI();
  }catch(e){
    console.warn("ÎßàÏßÄÎßâ Î∂ÑÏÑù Ï†ÄÏû• Ïã§Ìå®", e);
  }
}

function loadLastSnapshot(){
  try{
    if (typeof localStorage === "undefined") return null;
    const raw = localStorage.getItem(getCurrentProfileKey());
    if (!raw) return null;
    const parsed = JSON.parse(raw);
    if (!parsed || !Array.isArray(parsed.posts)) return null;
    return parsed;
  }catch(e){
    console.warn("ÎßàÏßÄÎßâ Î∂ÑÏÑù Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®", e);
    return null;
  }
}

function restoreLastAnalysis(){
  const snap = loadLastSnapshot();
  updateLastSnapshotUI();
  if (!snap || !Array.isArray(snap.posts) || !snap.posts.length){
    alert("Ïù¥ Î∏åÎùºÏö∞Ï†ÄÏóê Ï†ÄÏû•Îêú ÎßàÏßÄÎßâ CSV Î∂ÑÏÑùÏù¥ ÏóÜÏäµÎãàÎã§.\nÎ®ºÏ†Ä CSVÎ•º ÏóÖÎ°úÎìúÌï¥ÏÑú Ìïú Î≤à Î∂ÑÏÑùÌï¥Ï§ò.");
    return;
  }

  ALL_BASE = snap.posts;
  CURRENT_RANGE = snap.range || "ALL";
  CURRENT_GRADE = "ALL";

  const errorEl = document.getElementById("error");
  if (errorEl) errorEl.textContent = "";

  const rangeTabs = document.getElementById("range-tabs");
  if (rangeTabs) rangeTabs.style.display = "flex";

  setupRangeTabs();
  updateView();
}
function renderHistoryList(){
  const wrap = document.getElementById("history-wrap");
  if(!wrap) return;
  const list = getHistoryList();
  if(!list.length){
    wrap.innerHTML = "<div class='empty'>ÏïÑÏßÅ Ï†ÄÏû•Îêú Î∂ÑÏÑù ÌûàÏä§ÌÜ†Î¶¨Í∞Ä ÏóÜÏäµÎãàÎã§. CSVÎ•º ÏóÖÎ°úÎìúÌïòÎ©¥ Ïó¨Í∏∞ Í∏∞Î°ùÏù¥ ÏåìÏûÖÎãàÎã§.</div>";
    return;
  }

  const rows = list
    .slice()
    .sort((a,b)=> new Date(b.timestamp) - new Date(a.timestamp))
    .map((item, idx)=>{
      const d = new Date(item.timestamp);
      const dateStr = isNaN(d.getTime())
        ? (item.timestamp || "")
        : [
            d.getFullYear(),
            String(d.getMonth()+1).padStart(2,"0"),
            String(d.getDate()).padStart(2,"0")
          ].join("-") + " " +
          String(d.getHours()).padStart(2,"0") + ":" +
          String(d.getMinutes()).padStart(2,"0");

      const avg = Number(item.avgScore || 0);
      const trimmed = Number(item.trimmedAvg || 0);
      const best = Number(item.bestScore || 0);

      return `
        <tr>
          <td>${idx+1}</td>
          <td>${dateStr}</td>
          <td>${item.range || "ALL"}</td>
          <td>${item.totalPosts || 0}</td>
          <td>${avg.toFixed(1)}</td>
          <td>${trimmed.toFixed(1)}</td>
          <td>${best.toFixed(1)}</td>
          <td>${item.bestDate || ""}</td>
        </tr>
      `;
    }).join("");

  wrap.innerHTML = `
    <table class="data-table">
      <thead>
        <tr>
          <th>#</th>
          <th>ÏóÖÎ°úÎìú ÏãúÍ∞Å</th>
          <th>Í∏∞Í∞Ñ ÌïÑÌÑ∞</th>
          <th>ÏõêÍ∏Ä Ïàò</th>
          <th>ÌèâÍ∑† Ïä§ÏΩîÏñ¥</th>
          <th>Ìä∏Î¶ºÎìú ÌèâÍ∑†</th>
          <th>Í∞ÄÏû• ÌÑ∞ÏßÑ Í∏Ä</th>
          <th>Î≤†Ïä§Ìä∏ ÎÇ†Ïßú</th>
        </tr>
      </thead>
      <tbody>
        ${rows}
      </tbody>
    </table>
  `;
}


/* ========= Dashboard Ïã§ÏãúÍ∞Ñ ÏúÑÏ†Ø (BTC/ETH/FX/Îâ¥Ïä§/ÌîÑÎ°úÏ†ùÌä∏/Î¶¨ÎçîÎ≥¥Îìú) ========== */

let DASHBOARD_STARTED = false;
const DASH_CHARTS = {};
const DASH_WORKER_BASE = "https://btceth.wnehdrla8382.workers.dev"; // ‚Üê ÎÑàÏùò Cloudflare Worker Ï£ºÏÜå

const DASH_CACHE_KEY_BTC = "mudDHA_dash_cache_btc_v1";
const DASH_CACHE_KEY_ETH = "mudDHA_dash_cache_eth_v1";


// candlestick ÌîåÎü¨Í∑∏Ïù∏Ïù¥ ÏûàÏúºÎ©¥ candlestick, ÏóÜÏúºÎ©¥ line Ï∞®Ìä∏Î°ú Ìè¥Î∞±
function getDashChartType(){
  try{
    if (Chart && Chart.registry && Chart.registry.getController("candlestick")) {
      return "candlestick";
    }
  }catch(e){}
  return "line";
}

// close Í∞íÎßå ÏûàÎäî ÏãúÍ≥ÑÏó¥ÏùÑ OHLC ÎπÑÏä∑Ìïú ÌòïÌÉúÎ°ú Î≥ÄÌôò
function closeSeriesToOhlc(series){
  const out = [];
  if (!Array.isArray(series) || !series.length) return out;
  let prevClose = series[0].c;
  for (let i = 0; i < series.length; i++){
    const item = series[i];
    const c = Number(item.c);
    const ts = item.t;
    const open = prevClose != null ? prevClose : c;
    const close = c;
    const highBase = Math.max(open, close);
    const lowBase  = Math.min(open, close);
    const high = highBase * 1.001;
    const low  = lowBase  * 0.999;
    out.push({ x: i, o: open, h: high, l: low, c: close, t: ts });
    prevClose = close;
  }
  return out;
}

function createDashCandleChart(ctx){
  const t = getDashChartType();

  const commonOpts = {
    responsive: true,
    maintainAspectRatio: false,
    animation: false,
    plugins: {
      legend: { display: false },
      tooltip: {
        enabled: true,
        intersect: false,
        mode: "index",
        displayColors: false,
        callbacks: {
          label: (context) => {
            const v = context.parsed.y;
            if (v == null) return "";
            const prefix = ctx.canvas.id === "btc-chart" || ctx.canvas.id === "eth-chart" ? "$ " : "";
            return prefix + v.toLocaleString();
          }
        }
      }
    },
    scales: {
      x: { display: false },
      y: { display: false }
    }
  };

  if (t === "candlestick"){
    return new Chart(ctx, {
      type: "candlestick",
      data: {
        datasets: [{
          data: [],
          borderWidth: 1
        }]
      },
      options: commonOpts
    });
  } else {
    return new Chart(ctx, {
      type: "line",
      data: {
        labels: [],
        datasets: [{
          data: [],
          tension: 0.25,
          borderWidth: 2,
          pointRadius: 0,
          fill: true,
          borderColor: "#22c55e",
          backgroundColor: (context) => {
            const chart = context.chart;
            const {ctx} = chart;
            const gradient = ctx.createLinearGradient(0, 0, 0, chart.height);
            gradient.addColorStop(0, "rgba(34, 197, 94, 0.35)");
            gradient.addColorStop(1, "rgba(34, 197, 94, 0)");
            return gradient;
          }
        }]
      },
      options: commonOpts
    });
  }
}

function updateDashChartFromSeries(chart, series){
  if (!chart || !Array.isArray(series) || !series.length) return;
  const t = chart.config.type;
  if (t === "candlestick"){
    const ohlc = closeSeriesToOhlc(series);
    chart.data.datasets[0].data = ohlc;
  } else {
    const labels = series.map(c => {
      if (!c || !c.t) return "";
      const d = new Date(c.t);
      const m = d.getMonth() + 1;
      const day = d.getDate();
      return `${m}/${day}`;
    });
    const values = series.map(c => Number(c.c));
    chart.data.labels = labels;
    chart.data.datasets[0].data = values;
  }
  chart.update("none");
}

function updateDashChartFromSeries(chart, series){
  if (!chart || !Array.isArray(series) || !series.length) return;
  const t = chart.config.type;
  if (t === "candlestick"){
    const ohlc = closeSeriesToOhlc(series);
    chart.data.datasets[0].data = ohlc;
  } else {
    const labels = series.map((_, idx) => idx.toString());
    const values = series.map(c => Number(c.c));
    chart.data.labels = labels;
    chart.data.datasets[0].data = values;
  }
  chart.update("none");
}

// WorkerÏóêÏÑú ÏΩîÏù∏ ÏãúÍ≥ÑÏó¥ Í∞ÄÏ†∏Ïò§Í∏∞ (CoinGecko ÌîÑÎ°ùÏãú)
async function fetchDashCoinSeries(asset, days){
  const url = `${DASH_WORKER_BASE}/api/candle?asset=${encodeURIComponent(asset)}&days=${encodeURIComponent(days)}`;
  const res = await fetch(url);
  const json = await res.json();
  return Array.isArray(json.candles) ? json.candles : [];
}

// ÎåÄÏãúÎ≥¥Îìú 2Í∞ú ÏûêÏÇ∞ ÏóÖÎç∞Ïù¥Ìä∏ (BTC / ETH Ï†ÑÏö©)
async function refreshDashboardRealtime(){
  try {
    const [btc, eth] = await Promise.all([
      fetchDashCoinSeries("bitcoin", 1),
      fetchDashCoinSeries("ethereum", 1),
    ]);

    // BTC Í∞±Ïã† + Ï∫êÏãú Ï†ÄÏû•
    if (btc && btc.length && DASH_CHARTS.btc){
      updateDashChartFromSeries(DASH_CHARTS.btc, btc);
      const last = btc[btc.length - 1].c;
      const el = document.getElementById("btc-price-text");
      if (el) el.textContent = `$ ${Number(last).toLocaleString()}`;
      try {
        localStorage.setItem(DASH_CACHE_KEY_BTC, JSON.stringify(btc));
      } catch(e){}
    }

    // ETH Í∞±Ïã† + Ï∫êÏãú Ï†ÄÏû•
    if (eth && eth.length && DASH_CHARTS.eth){
      updateDashChartFromSeries(DASH_CHARTS.eth, eth);
      const last = eth[eth.length - 1].c;
      const el = document.getElementById("eth-price-text");
      if (el) el.textContent = `$ ${Number(last).toLocaleString()}`;
      try {
        localStorage.setItem(DASH_CACHE_KEY_ETH, JSON.stringify(eth));
      } catch(e){}
    }
  } catch (e) {
    console.error("refreshDashboardRealtime error:", e);
  }
}

function startDashboardRealtime(){
  if (DASHBOARD_STARTED) return;
  DASHBOARD_STARTED = true;

  const btcCanvas = document.getElementById("btc-chart");
  const ethCanvas = document.getElementById("eth-chart");

  if (btcCanvas) DASH_CHARTS.btc = createDashCandleChart(btcCanvas.getContext("2d"));
  if (ethCanvas) DASH_CHARTS.eth = createDashCandleChart(ethCanvas.getContext("2d"));

  // üîÅ Ï∫êÏãúÎêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÏúºÎ©¥ Î®ºÏ†Ä Í∑∏Î†§Ï£ºÍ∏∞ (Îπ†Î•∏ Ï≤´ ÌôîÎ©¥Ïö©)
  try {
    if (DASH_CHARTS.btc) {
      const rawBtc = localStorage.getItem(DASH_CACHE_KEY_BTC);
      if (rawBtc) {
        const cachedBtc = JSON.parse(rawBtc);
        if (Array.isArray(cachedBtc) && cachedBtc.length){
          updateDashChartFromSeries(DASH_CHARTS.btc, cachedBtc);
          const last = cachedBtc[cachedBtc.length - 1].c;
          const el = document.getElementById("btc-price-text");
          if (el) el.textContent = `$ ${Number(last).toLocaleString()}`;
        }
      }
    }
    if (DASH_CHARTS.eth) {
      const rawEth = localStorage.getItem(DASH_CACHE_KEY_ETH);
      if (rawEth) {
        const cachedEth = JSON.parse(rawEth);
        if (Array.isArray(cachedEth) && cachedEth.length){
          updateDashChartFromSeries(DASH_CHARTS.eth, cachedEth);
          const el = document.getElementById("eth-price-text");
          const last = cachedEth[cachedEth.length - 1].c;
          if (el) el.textContent = `$ ${Number(last).toLocaleString()}`;
        }
      }
    }
  } catch(e){}

  // Ï≤´ Î°úÎìú: ÏµúÏã† Îç∞Ïù¥ÌÑ∞Î°ú Í∞±Ïã†
  refreshDashboardRealtime();
  // 60Ï¥àÎßàÎã§ Í∞±Ïã† (Ïã§ÏãúÍ∞Ñ ÎäêÎÇå)
  setInterval(refreshDashboardRealtime, 60000);
}

/* Ïò§ÎäòÏùò Ïù¥Ïäà: Worker ÌîÑÎ°ùÏãúÎ•º ÌÜµÌïú Îâ¥Ïä§ 3Í∞ú */
async function loadDashboardNews(){
  const listEl = document.getElementById("dash-news-list");
  if (!listEl) return;
  try {
    listEl.innerHTML = "<li class='dash-news-placeholder'>Îâ¥Ïä§Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</li>";
    const res = await fetch(`${DASH_WORKER_BASE}/api/news`);
    const json = await res.json();
    const items = Array.isArray(json.articles) ? json.articles : (json.Data || json.data || []);
    if (!items || !items.length){
      listEl.innerHTML = "<li class='dash-news-placeholder'>ÌëúÏãúÌï† Îâ¥Ïä§Í∞Ä ÏóÜÏäµÎãàÎã§.</li>";
      return;
    }
    const top = items.slice(0,3);
    listEl.innerHTML = top.map(n => {
      const title = n.title || "";
      const url = n.url || "#";
      return `<li><a href="${url}" target="_blank" rel="noopener noreferrer">${title}</a></li>`;
    }).join("");
  } catch(e) {
    console.error(e);
    listEl.innerHTML = "<li class='dash-news-placeholder'>Îâ¥Ïä§Î•º Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.</li>";
  }
}

/* ÌîÑÎ°úÏ†ùÌä∏ Ïπ¥Îìú: INFOFI_SNAPSHOTS Í∏∞Ï§Ä ÏÉÅÏúÑ ÌîÑÎ°úÏ†ùÌä∏ */
function renderDashboardProjects(){
  const wrap = document.getElementById("dash-projects-wrap");
  if(!wrap || !Array.isArray(INFOFI_SNAPSHOTS)) return;

  const byProject = {};
  INFOFI_SNAPSHOTS.forEach(row=>{
    const p = row.project || "Í∏∞ÌÉÄ";
    if(!byProject[p] || (row.mindshare || 0) > (byProject[p].mindshare || 0)){
      byProject[p] = row;
    }
  });

  const arr = Object.values(byProject).sort((a,b)=>(b.mindshare||0)-(a.mindshare||0)).slice(0,6);
  if(!arr.length){
    wrap.innerHTML = "<div class='empty'>ÏïÑÏßÅ InfoFi ÌîÑÎ°úÏ†ùÌä∏ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</div>";
    return;
  }
  wrap.innerHTML = arr.map((r)=>`
    <div class="dash-project-item">
      <div>
        <div class="dash-project-name">${r.project}</div>
        <div class="dash-project-rank">${r.window} ¬∑ rank #${r.rank}</div>
      </div>
      <div style="font-size:11px;">MS ${Number(r.mindshare || 0).toFixed(2)}</div>
    </div>
  `).join("");
}

/* ÎåÄÏãúÎ≥¥ÎìúÏö© Î¶¨ÎçîÎ≥¥Îìú TOP10 */

async function loadDashboardLeaderboardTop10(){
  const wrap = document.getElementById("dashboard-leaderboard-wrap");
  if(!wrap) return;
  try{
    wrap.innerHTML = "<div class='empty'>Î¶¨ÎçîÎ≥¥ÎìúÎ•º Î∂àÎü¨Ïò§Îäî Ï§ë...</div>";
    const res = await fetch(SCRIPT_URL);
    const data = await res.json();
    const list = Array.isArray(data) ? data : (data.top || []);
    if(!list || !list.length){
      wrap.innerHTML = "<div class='empty'>ÏïÑÏßÅ Î¶¨ÎçîÎ≥¥Îìú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</div>";
      return;
    }

    // üîπ ÏõêÍ∏Ä ÏàòÎ•º Î∞òÏòÅÌïú Í∞ÄÏ§ëÏπò Ï†êÏàò Í≥ÑÏÇ∞ (ÎåÄÏãúÎ≥¥ÎìúÏö© TOP10)
    const scoredList = list.slice().map(item => {
      const totalPosts = item.totalPosts || 0;
      const trimmed    = Number(item.trimmedAvg || 0);
      const reliability = Math.min(totalPosts, 60) / 60;       // 0 ~ 1
      const factor      = 0.4 + 0.6 * reliability;            // 0.4 ~ 1.0
      const score       = trimmed * factor;                   // Í∞ÄÏ§ëÏπò Ï†êÏàò
      return { ...item, _score: score, _factor: factor };
    }).sort((a,b) => (b._score || 0) - (a._score || 0));

    const top = scoredList.slice(0,10);

    const rows = top.map((item,idx)=>{
      const handle = item.handle || "";
      const handleClean = handle.replace("@","").trim();
      const trimmedAvg = Number(item.trimmedAvg || 0).toFixed(1);
      const avgScore  = Number(item.avgScore   || 0).toFixed(1);
      const totalPosts = item.totalPosts || 0;
      const bestLink  = item.bestLink || (handleClean ? `https://twitter.com/${handleClean}` : "#");
      return `
        <tr>
          <td>#${idx+1}</td>
          <td>
            <a href="${bestLink}" target="_blank" style="display:inline-flex;align-items:center;gap:6px;text-decoration:none;color:inherit;">
              <img src="https://unavatar.io/twitter/${handleClean}" style="width:20px;height:20px;border-radius:999px;border:1px solid rgba(209,213,219,1);" />
              <span>${handle}</span>
            </a>
          </td>
          <td>${trimmedAvg}</td>
          <td>${avgScore}</td>
          <td>${totalPosts}</td>
        </tr>`;
    }).join("");
    wrap.innerHTML = `
      <table>
        <thead>
          <tr>
            <th>ÏàúÏúÑ</th>
            <th>Ìï∏Îì§</th>
            <th>Ìä∏Î¶ºÎìú ÌèâÍ∑†</th>
            <th>ÌèâÍ∑† Ïä§ÏΩîÏñ¥</th>
            <th>ÏõêÍ∏Ä Ïàò</th>
          </tr>
        </thead>
        <tbody>${rows}</tbody>
      </table>
    `;
  }catch(e){
    console.error(e);
    wrap.innerHTML = "<div class='empty'>Î¶¨ÎçîÎ≥¥ÎìúÎ•º Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.</div>";
  }
}



function ensureDashboardInitialized(){
  startDashboardRealtime();
  loadDashboardNews();
  renderDashboardProjects();
  loadDashboardLeaderboardTop10();
}

/* ========= YAP ÌôïÎ•† Í≥ÑÏÇ∞ Í≥µÏö© Ìï®Ïàò ========= */
function calcYapProbability(trimmed, avg, posts){
  const t = Math.max(0, Number(trimmed||0));
  const a = Math.max(0, Number(avg||0));
  const p = Math.max(0, Number(posts||0));
  const qualNorm = Math.min(t / 100, 1);
  const avgNorm  = Math.min(a / 100, 1);
  const volNorm  = Math.min(p / 200, 1);
  const yapBase = 0.6 * qualNorm + 0.3 * avgNorm + 0.1 * volNorm;
  const prob = Math.max(5,
    Math.min(95, Math.round(5 + 60 * Math.pow(yapBase, 2)))
  );
  return prob;
}

/* YAP Ïù¥ÎÑàÏÑúÌÅ¥ / Í≥†ÎìùÏ†ê Í∞ÄÏ§ëÏπò ÌÜ†Í∏Ä */
function getYapBoostFactor(){
  let factor = 1;
  const inner = document.getElementById("yap-inner-toggle");
  const top100 = document.getElementById("yap-100-toggle");
  if(inner && inner.checked) factor *= 1.30;   // Ïù¥ÎÑàÏÑúÌÅ¥ +30%
  if(top100 && top100.checked) factor *= 1.15; // YAP 100Ï†ê Í≤ΩÌóò +15%
  return factor;
}

/* ========= Í≥ÑÏ†ï ÏÑ±Ïû• Í∑∏ÎûòÌîÑ ========== */

let growthChart = null;



function updateYapCard(analysis){
  const levelEl = document.getElementById("yap-level-text");
  const subEl   = document.getElementById("yap-level-sub");
  const tEl     = document.getElementById("yap-trimmed");
  const aEl     = document.getElementById("yap-avg");
  const pEl     = document.getElementById("yap-posts");
  const probEl  = document.getElementById("yap-prob");
  if(!levelEl || !subEl || !tEl || !aEl || !pEl || !probEl) return;

  // CSVÍ∞Ä ÏïÑÏßÅ ÏóÜÍ±∞ÎÇò Î∂ÑÏÑù Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏùÑ Îïå
  if(!analysis){
    levelEl.textContent = "-";
    subEl.textContent   = "CSVÎ•º ÏóÖÎ°úÎìúÌïòÎ©¥ ÏµúÍ∑º Ìå®ÌÑ¥ÏùÑ Í∏∞Î∞òÏúºÎ°ú YAP ÏÉÅÏäπ Ïã†Ìò∏Î•º Í∞ÑÎã®Ìûà Î≥¥Ïó¨Ï§ÑÍ≤å.";
    tEl.textContent = "-";
    aEl.textContent = "-";
    pEl.textContent = "-";
    probEl.textContent = "-";
    return;
  }

  const trimmed = Number(analysis.trimmedAvg || 0);
  const avg     = Number(analysis.avgScore   || 0);
  const posts   = Number(analysis.totalPosts || 0);

  let prob = calcYapProbability(trimmed, avg, posts);
  // Ïù¥ÎÑàÏÑúÌÅ¥ / YAP 100Ï†ê Í≤ΩÌóò Í∞ÄÏ§ëÏπò Ï†ÅÏö©
  prob = Math.round(prob * getYapBoostFactor());
  if (prob > 100) prob = 100;
  if (prob < 0)   prob = 0;

  let level = "";
  let desc  = "";
  if(prob < 30){
    level = "üßä Low";
    desc = "ÏµúÍ∑º Ìå®ÌÑ¥ Í∏∞Ï§ÄÏúºÎ°ú YAPÏù¥ Ïò§Î•º Í∞ÄÎä•ÏÑ±Ïù¥ ÎÇÆÏùÄ Íµ¨Í∞ÑÏù¥Ïïº.";
  }else if(prob < 60){
    level = "üåä Mid";
    desc = "Ïßà/Ïñë Ï§ë ÏùºÎ∂ÄÎäî Ïò¨ÎùºÏôÄ ÏûàÏñ¥ÏÑú, Ï°∞Í∏àÎßå Îçî Î∞ÄÎ©¥ YAPÏù¥ Î∞òÏùëÌï† Ïàò ÏûàÎäî Ï§ëÍ∞Ñ Íµ¨Í∞ÑÏù¥Ïïº.";
  }else{
    level = "üî• High";
    desc = "Ìä∏Î¶ºÎìú/ÌèâÍ∑†/ÌôúÎèôÎüâÏù¥ Î™®Îëê ÎÜíÏùÄ Ìé∏Ïù¥Îùº YAPÏù¥ Ïò§Î•º ÌôïÎ•†Ïù¥ ÍΩ§ ÎÜíÏùÄ ÏÉÅÌÉúÏïº.";
  }

  levelEl.textContent = level;
  subEl.textContent   = desc;
  tEl.textContent     = trimmed ? trimmed.toFixed(1) : "-";
  aEl.textContent     = avg ? avg.toFixed(1) : "-";
  pEl.textContent     = posts ? posts.toString() : "-";
  probEl.textContent  = prob + "%";
}


function updateYapGauge(analysis){
  const pctEl  = document.getElementById("yap-gauge-percent");
  const lvlEl  = document.getElementById("yap-gauge-level");
  const descEl = document.getElementById("yap-gauge-desc");
  const fillEl = document.getElementById("yap-gauge-fill");
  const postsEl = document.getElementById("yap-gauge-posts");
  const trimmedEl = document.getElementById("yap-gauge-trimmed");
  const avgEl = document.getElementById("yap-gauge-avg");
  const forecastEl = document.getElementById("yap-gauge-forecast");
  const forecastDescEl = document.getElementById("yap-gauge-forecast-desc");
  const bestDateEl = document.getElementById("yap-gauge-best-date");
  const bestScoreEl = document.getElementById("yap-gauge-best-score");
  const bestLinkEl = document.getElementById("yap-gauge-best-link");

  if(!pctEl || !lvlEl || !descEl || !fillEl) return;

  if(!analysis){
    pctEl.textContent  = "-";
    lvlEl.textContent  = "Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå";
    descEl.textContent = "CSVÎ•º ÏóÖÎ°úÎìúÌïòÍ≥† Í∏∞Í∞ÑÏùÑ ÏÑ†ÌÉùÌïòÎ©¥ YAP Î≤ÑÌçº(ÏûîÏó¨ Ï†êÏàò)Î•º %Î°ú Î≥¥Ïó¨Ï§ÑÍ≤å.";
    fillEl.style.width = "0%";

    if(postsEl) postsEl.textContent = "-";
    if(trimmedEl) trimmedEl.textContent = "-";
    if(avgEl) avgEl.textContent = "-";
    if(forecastEl) forecastEl.textContent = "-";
    if(forecastDescEl) forecastDescEl.textContent = "ÏÑ†ÌÉùÌïú Íµ¨Í∞ÑÏùò Ìå®ÌÑ¥ÏùÑ Í∏∞Î∞òÏúºÎ°ú, ÏïûÏúºÎ°ú Î∞õÏùÑ Í∞ÄÎä•ÏÑ±Ïù¥ ÏûàÎäî YAP Íµ¨Í∞ÑÏùÑ ÎåÄÎûµÏ†ÅÏúºÎ°ú Î≥¥Ïó¨Ï§ÑÍ≤å.";
    if(bestDateEl) bestDateEl.textContent = "-";
    if(bestScoreEl) bestScoreEl.textContent = "-";
    if(bestLinkEl){ bestLinkEl.textContent = "-"; bestLinkEl.removeAttribute("href"); }

    return;
  }

  const trimmed = Number(analysis.trimmedAvg || 0);
  const avg     = Number(analysis.avgScore   || 0);
  const posts   = Number(analysis.totalPosts || 0);

  let prob = calcYapProbability(trimmed, avg, posts);
  prob = Math.round(prob * getYapBoostFactor());
  if (prob > 100) prob = 100;
  if (prob < 0)   prob = 0;

  let levelText = "";
  let desc = "";
  if(prob < 30){
    levelText = "üßä Low Buffer";
    desc = "ÏµúÍ∑º Ìå®ÌÑ¥ Í∏∞Ï§ÄÏúºÎ°ú ÏïÑÏßÅ ÌÅ¨Í≤å ÏåìÏù∏ YAP Î≤ÑÌçºÎäî ÎßéÏßÄ ÏïäÏùÄ Íµ¨Í∞ÑÏù¥Ïïº.";
  }else if(prob < 60){
    levelText = "üåä Mid Buffer";
    desc = "ÏûëÏùÄ YAP(+1~2Ï†ê) Ï†ïÎèÑÍ∞Ä ÎÇòÏò¨ Ïàò ÏûàÎäî Ï§ëÍ∞Ñ ÏàòÏ§ÄÏùò Î≤ÑÌçº ÏÉÅÌÉúÏïº.";
  }else{
    levelText = "üî• High Buffer";
    desc = "Ìïú Î≤à ÌÅ¨Í≤å ÌÑ∞Ïßà Ïàò ÏûàÎäî YAP Î≤ÑÌçºÍ∞Ä Ï†úÎ≤ï ÏåìÏó¨ ÏûàÎäî ÏÉÅÌÉúÏïº.";
  }

  pctEl.textContent  = prob + "%";
  lvlEl.textContent  = levelText;
  descEl.textContent = desc;
  fillEl.style.width = prob + "%";

  if(postsEl) postsEl.textContent = posts ? posts.toLocaleString() + "Í∞ú" : "0Í∞ú";
  if(trimmedEl) trimmedEl.textContent = trimmed ? trimmed.toFixed(2) : "0.00";
  if(avgEl) avgEl.textContent = avg ? avg.toFixed(2) : "0.00";

  if(forecastEl && forecastDescEl){
    let rangeText = "";
    let subText = "";
    if(prob < 20){
      rangeText = "0 ~ 0.5Ï†ê Ï†ïÎèÑ";
      subText = "ÌòÑÏû¨ CSV Í∏∞Ï§ÄÏúºÎ°úÎäî Ï∂îÍ∞Ä YAPÏù¥ Î∞îÎ°ú ÎÇòÏò§Í∏∞Î≥¥Îã®, Ìå®ÌÑ¥ÏùÑ Ï°∞Í∏à Îçî ÏåìÏïÑÏïº ÌïòÎäî Íµ¨Í∞ÑÏù¥Ïïº.";
    }else if(prob < 40){
      rangeText = "0 ~ 1Ï†ê Ï†ïÎèÑ";
      subText = "ÏûëÏùÄ ÏûîÏó¨ YAPÏù¥ ÎÇòÏò¨ Ïàò ÏûàÎäî Ï¥àÏûÖ Íµ¨Í∞ÑÏù¥Ïïº. Î∞òÏùëÏù¥ Ï°∞Í∏à Îçî ÏåìÏù¥Î©¥ ÏùòÎØ∏ ÏûàÎäî ÏÉÅÏäπÏù¥ ÎÇòÏò¨ Ïàò ÏûàÏñ¥.";
    }else if(prob < 60){
      rangeText = "0.5 ~ 2Ï†ê Ï†ïÎèÑ";
      subText = "ÏµúÍ∑º Ìå®ÌÑ¥ Í∏∞Ï§ÄÏúºÎ°ú, 1Ï†ê ÏïàÌåéÏùò ÏÜåÍ∑úÎ™® YAPÍ∞Ä ÎÇòÏò¨ Ïàò ÏûàÎäî ÏÉÅÌÉúÏïº.";
    }else if(prob < 80){
      rangeText = "2 ~ 4Ï†ê Ï†ïÎèÑ";
      subText = "YAPÍ∞Ä Ìïú Î≤à ÌäÄÏñ¥Ïò§Î•ºÎßåÌïú ÏóêÎÑàÏßÄÍ∞Ä Ï†úÎ≤ï ÏåìÏù∏ ÏÉÅÌÉúÏïº. 1~3Ïùº ÎÇ¥Ïóê Î≥ÄÌôîÎ•º Í∏∞ÎåÄÌï¥Î≥º Ïàò ÏûàÏñ¥.";
    }else{
      rangeText = "4Ï†ê Ïù¥ÏÉÅÎèÑ Í∞ÄÎä•";
      subText = "Í∞ïÌïú Ïä§ÌååÏù¥ÌÅ¨ + ÎàÑÏ†Å Ìå®ÌÑ¥Ïù¥ Ìï®Íªò ÎÇòÏò§Îäî Íµ¨Í∞ÑÏù¥Ïïº. Í∞ÄÍπåÏö¥ ÏãúÏùº ÎÇ¥Ïóê ÍΩ§ ÏùòÎØ∏ ÏûàÎäî YAP ÏÉÅÏäπÏù¥ ÎÇòÏò¨ Ïàò ÏûàÏñ¥.";
    }
    forecastEl.textContent = rangeText;
    forecastDescEl.textContent = subText;
  }

  if(bestDateEl) bestDateEl.textContent = analysis.bestDate || "-";
  if(bestScoreEl) bestScoreEl.textContent = analysis.bestScore ? analysis.bestScore.toFixed(2) : "-";
  if(bestLinkEl){
    if(analysis.bestLink){
      bestLinkEl.textContent = "Ìä∏Ïúó Î≥¥Îü¨Í∞ÄÍ∏∞";
      bestLinkEl.href = analysis.bestLink;
    }else{
      bestLinkEl.textContent = "-";
      bestLinkEl.removeAttribute("href");
    }
  }
}
function renderYapHeatmap(list){
  const wrap = document.getElementById("yap-heatmap");
  if(!wrap) return;
  if(!list || !list.length){
    wrap.innerHTML = "<div class='empty'>CSVÎ•º ÏóÖÎ°úÎìúÌïòÍ≥† Í∏∞Í∞ÑÏùÑ ÏÑ†ÌÉùÌïòÎ©¥ ÎÇ†ÏßúÎ≥Ñ YAP Ïã†Ìò∏Î•º ÏÉâÏúºÎ°ú Î≥¥Ïó¨Ï§ÑÍ≤å.</div>";
    return;
  }
  wrap.innerHTML = "";
  const byDate = {};
  list.forEach(p=>{
    if(!p.dateObj) return;
    const d = p.dateObj.toISOString().slice(0,10);
    if(!byDate[d]) byDate[d] = [];
    byDate[d].push(p);
  });
  const dates = Object.keys(byDate).sort();
  dates.forEach(d=>{
    const arr = byDate[d];
    const scores = arr.map(p=>p.score||0).filter(v=>!isNaN(v));
    if(!scores.length) return;
    const posts = scores.length;
    const sum = scores.reduce((s,v)=>s+v,0);
    const avg = sum / posts;
    const trimmed = computeTrimmedAverage(arr, TRIM_RATIO);
    let prob = calcYapProbability(trimmed, avg, posts);
    // YAP Í∞ÄÏ§ëÏπò ÌÜ†Í∏Ä Î∞òÏòÅ
    prob = Math.round(prob * getYapBoostFactor());
    if (prob > 100) prob = 100;
    if (prob < 0)   prob = 0;
    let lvl = 1;
    if(prob >= 80) lvl = 5;
    else if(prob >= 60) lvl = 4;
    else if(prob >= 40) lvl = 3;
    else if(prob >= 20) lvl = 2;
    const box = document.createElement("div");
    box.className = "yap-heatbox level-" + lvl;
    box.title = d + "\nÌä∏Î¶ºÎìú " + trimmed.toFixed(1) +
      " ¬∑ ÌèâÍ∑† " + avg.toFixed(1) +
      " ¬∑ ÏõêÍ∏Ä " + posts +
      " ¬∑ YAP " + prob + "%";
    wrap.appendChild(box);
  });
}


function renderGrowthChart(list) {
  const canvas = document.getElementById("growth-chart");
  if (!canvas) return;
  const ctx = canvas.getContext("2d");

  // Í∏∞Ï°¥ Ï∞®Ìä∏ Ï†úÍ±∞
  if (growthChart) {
    growthChart.destroy();
    growthChart = null;
  }

  // Îç∞Ïù¥ÌÑ∞ ÏóÜÏúºÎ©¥ Ïà®ÍπÄ
  if (!list || list.length < 4) {
    canvas.style.display = "none";
    return;
  }
  canvas.style.display = "block";

  // ÎÇ†Ïßú Í∏∞Ï§Ä Ï†ïÎ†¨
  const arr = list.slice().sort((a, b) => {
    if (a.dateObj && b.dateObj) return a.dateObj - b.dateObj;
    return 0;
  });

  // xÏ∂ï: ÎÇ†Ïßú
  const labels = arr.map(p =>
    p.dateObj
      ? `${p.dateObj.getMonth() + 1}/${p.dateObj.getDate()}`
      : ""
  );

  // yÏ∂ï: Ï†êÏàò(Ïä§ÏΩîÏñ¥)
  const scores = arr.map(p => p.score);

  // ÎÇ†ÏßúÎ≥Ñ ÏµúÍ≥† Ï†êÏàò Í∏∞Ï§ÄÏúºÎ°ú "Ï§ëÏöîÌïú ÎÇ†" ÏÑ†Ï†ï
  // Í∞Å ÎÇ†ÏßúÎßàÎã§ ÏµúÍ≥† Ï†êÏàòÎ•º Í∞ÄÏßÑ Ïù∏Îç±Ïä§Î•º Ï†ÄÏû•
  const byDateMax = {};
  arr.forEach((p, idx) => {
    if (!p.dateObj) return;
    const d = p.dateObj.toISOString().slice(0,10);
    const s = Number(p.score || 0);
    if (!byDateMax[d] || s > byDateMax[d].score) {
      byDateMax[d] = { score: s, index: idx };
    }
  });

  // ÏµúÍ≥† Ï†êÏàò Í∏∞Ï§ÄÏúºÎ°ú ÎÇ¥Î¶ºÏ∞®Ïàú Ï†ïÎ†¨ ÌõÑ ÏÉÅÏúÑ NÍ∞ú ÎÇ†ÏßúÎßå ÏÑ†ÌÉù
  const maxEntries = Object.values(byDateMax)
    .sort((a, b) => b.score - a.score);

  const MAX_DOTS = 7; // Ìïú ÎààÏóê Î≥¥Í∏∞ ÏúÑÌïú ÏµúÎåÄ Ï†ê Í∞úÏàò
  const topEntries = maxEntries.slice(0, MAX_DOTS);

  // ÏÑ†ÌÉùÎêú Ïù∏Îç±Ïä§Îßå Îπ®Í∞Ñ Ï†êÏúºÎ°ú ÌëúÏãú
  const highlightIndexSet = new Set(topEntries.map(e => e.index));
  const yapPoints = arr.map((p, idx) => {
    return highlightIndexSet.has(idx) ? p.score : null;
  });

  // ÎÇ†ÏßúÎ≥Ñ Ï†êÏàò Î∞∞Ïó¥ Î™®ÏúºÍ∏∞
  const byDateScores = {};
  arr.forEach(p => {
    if (!p.dateObj) return;
    const d = p.dateObj.toISOString().slice(0,10);
    if (!byDateScores[d]) byDateScores[d] = [];
    byDateScores[d].push(Number(p.score || 0));
  });

  // ÎÇ†Ïßú Ï†ïÎ†¨ ÌõÑ, Ïπ¥ÎìúÏôÄ Ïú†ÏÇ¨Ìïú Ïä§ÏºÄÏùºÏùò YAP ÌôïÎ•† + Ï†ÑÍ≥†Ï†ê/ÌïòÎùΩ Í∞ÄÏ§ëÏπò Í≥ÑÏÇ∞
  const sortedDates = Object.keys(byDateScores).sort();
  const yapProbByDate = {};
  let prevTrim = -Infinity;
  let prevAvg  = -Infinity;

  sortedDates.forEach(d => {
    const scoresArr = byDateScores[d];
    if (!scoresArr.length) {
      yapProbByDate[d] = 0;
      return;
    }
    const posts = scoresArr.length;
    const sum = scoresArr.reduce((s, v) => s + v, 0);
    const avg = sum / posts;
    const trimmed = computeTrimmedAverage(scoresArr, TRIM_RATIO);

    // 1) Í∏∞Î≥∏ YAP ÌôïÎ•† (Ïπ¥Îìú Ïä§ÏºÄÏùºÏóê ÎßûÏ∂îÍ∏∞ ÏúÑÌï¥ ÏÇ¥Ïßù ÏÉÅÌñ•)
    let baseProb = calcYapProbability(trimmed, avg, posts);
    baseProb = baseProb * 1.2 + 10; // Ï†ÑÎ∞òÏ†ÅÏúºÎ°ú Ïú†Ìï® Ï†úÍ±∞ + Ïπ¥ÎìúÏôÄ ÎπÑÏä∑Ìïú Î∞∏Î•ò
    if (baseProb > 100) baseProb = 100;
    if (baseProb < 0) baseProb = 0;

    // 2) Ï†ÑÍ≥†Ï†ê/ÌïòÎùΩ Í∞ÄÏ§ëÏπò
    let boost = 1.0;
    const isAbovePrevTrim = trimmed > prevTrim;
    const isAbovePrevAvg  = avg > prevAvg;
    const isBelowPrevTrim = trimmed < prevTrim;
    const isBelowPrevAvg  = avg < prevAvg;

    // Í∞ïÌïú Ï†ÑÍ≥†Ï†ê ÎèåÌåå (Ìä∏Î¶ºÎìú & ÌèâÍ∑† Îëò Îã§ Ïù¥Ï†Ñ ÏµúÍ≥† Í∞±Ïã†) ‚Üí ÌôïÌôï Ïò¨ÎùºÍ∞ÄÍ≤å
    if (isAbovePrevTrim && isAbovePrevAvg) {
      boost *= 2.2;
    }
    // ÏïΩÌïú ÎèåÌåå (Îëò Ï§ë ÌïòÎÇòÎßå Í∞±Ïã†)
    else if (isAbovePrevTrim || isAbovePrevAvg) {
      boost *= 1.45;
    }

    // ÌïòÎùΩÏùº Ìå®ÎÑêÌã∞Îäî ÏïΩÌïòÍ≤åÎßå Ï†ÅÏö© (ÎÑàÎ¨¥ ÎàåÎ¶¨ÏßÄ ÏïäÍ≤å)
    if (isBelowPrevTrim && isBelowPrevAvg) {
      boost *= 0.9;
    }
    else if (isBelowPrevTrim || isBelowPrevAvg) {
      boost *= 0.95;
    }

    let adjProb = baseProb * boost * getYapBoostFactor();
    if (adjProb > 100) adjProb = 100;
    if (adjProb < 0) adjProb = 0;

    yapProbByDate[d] = adjProb;

    // Îã§Ïùå ÎÇ† ÎπÑÍµêÎ•º ÏúÑÌïú Í∏∞Ï§Ä ÏóÖÎç∞Ïù¥Ìä∏
    if (trimmed > prevTrim) prevTrim = trimmed;
    if (avg > prevAvg) prevAvg = avg;
  });

  // xÏ∂ï Ïù∏Îç±Ïä§ Í∏∞Ï§ÄÏúºÎ°ú Îß§ÌïëÌïú ÌôïÎ•† (Ìà¥ÌåÅÏóêÏÑú ÏÇ¨Ïö©)
  const yapProbByIndex = arr.map(p => {
    if (!p.dateObj) return 0;
    const d = p.dateObj.toISOString().slice(0,10);
    return yapProbByDate[d] || 0;
  });

  // Í∑∏ÎûòÎîîÏñ∏Ìä∏ ÏÉùÏÑ±
  const gradient = ctx.createLinearGradient(0, 0, 0, 200);
  gradient.addColorStop(0, "rgba(59,130,246,0.4)");
  gradient.addColorStop(1, "rgba(59,130,246,0.05)");

  const pointShadow = {
    id: "pointShadow",
    afterDraw(chart, args, options) {
      const ctx = chart.ctx;
      ctx.save();
      ctx.shadowColor = "rgba(59,130,246,0.6)";
      ctx.shadowBlur = 12;
      ctx.shadowOffsetX = 0;
      ctx.shadowOffsetY = 0;
    }
  };

  growthChart = new Chart(ctx, {
    type: "line",
    data: {
      labels,
      datasets: [
        {
          label: "Í≥ÑÏ†ï ÏÑ±Ïû• Ïä§ÏΩîÏñ¥",
          data: scores,
          fill: true,
          backgroundColor: gradient,
          borderColor: "rgba(59,130,246,1)",
          borderWidth: 3,
          tension: 0.35,
          pointRadius: 0,
          pointBackgroundColor: "rgba(59,130,246,1)",
          pointBorderColor: "rgba(59,130,246,1)",
          pointHoverRadius: 6,
          pointHitRadius: 18
        },
        {
          label: "YAP Ïã†Ìò∏",
          data: yapPoints,
          fill: false,
          borderColor: "rgba(239,68,68,1)",
          borderWidth: 0,
          tension: 0.3,
          pointRadius: 4,
          pointBackgroundColor: "rgba(239,68,68,1)",
          pointBorderColor: "rgba(248,250,252,1)",
          pointHoverRadius: 7,
          pointHitRadius: 18,
          showLine: false
        }
      ]
    },
    options: {
      plugins: {
        legend: { display: false },
        tooltip: {
          callbacks: {
            label: function(context) {
              const value = context.parsed.y;
              if (context.datasetIndex === 0) {
                return "Í≥ÑÏ†ï ÏÑ±Ïû• Ïä§ÏΩîÏñ¥: " + value.toFixed(3);
              } else {
                return "ÏÇêÎΩÄÏÇêÎΩÄ yaps Ïã†Ìò∏ Î∞úÏÉù";
              }
            }
          }
        }
      },
      scales: {
        x: {
          ticks: { color: "#9ca3af" },
          grid: { display: false }
        },
        y: {
          ticks: { color: "#9ca3af" },
          grid: { color: "rgba(148,163,184,0.1)" }
        }
      }
    },
    plugins: [pointShadow]
  });
}
/* ========== CSV ÏóÖÎ°úÎìú ========== */
document.getElementById("csvInput").addEventListener("change", e=>{
  const file=e.target.files[0]; if(!file) return;
  Papa.parse(file,{
    header:true,skipEmptyLines:true,
    complete:res=>{
      ALL_BASE=[];
      res.data.forEach(row=>{
        const r=autoMap(row);
        const t=(r.text||"").trim();
        if(!t || t.startsWith("@")) return;
        const dateObj = parseDateValue(r.date);

        // ÎßÅÌÅ¨Í∞Ä ÏóÜÍ≥† Ìä∏Ïúó IDÎßå ÏûàÎäî Í≤ΩÏö∞ Î≥¥ÏôÑ
        let link = r.link;
        if((!link || !String(link).trim()) && r.id){
          const id = String(r.id).trim();
          if(id){
            link = `https://twitter.com/i/web/status/${id}`;
          }
        }

        const p={
          text:t,
          date:r.date || "",
          dateObj,
          link,
          impressions:num(r.impressions),
          engagements:num(r.engagements),
          likes:num(r.likes),
          bookmarks:num(r.bookmarks),
          newFollows:num(r.newFollows),
          replies:num(r.replies),
          retweets:num(r.retweets),
          shares:num(r.shares),
          profileClicks:num(r.profileClicks),
          urlClicks:num(r.urlClicks),
          uniqueClicks:num(r.uniqueClicks),
        };
        p.score=computeScore(p);
        tagProjectsForPost(p);
        ALL_BASE.push(p);
      });

      if(!ALL_BASE.length){
        document.getElementById("error").textContent="CSVÏóêÏÑú Î∂ÑÏÑù Í∞ÄÎä•Ìïú ÏõêÍ∏ÄÏù¥ ÏóÜÏäµÎãàÎã§.";
      }else{
        document.getElementById("error").textContent="";
        CURRENT_RANGE = "ALL";
        CURRENT_GRADE = "ALL";
        const rangeTabs = document.getElementById("range-tabs");
        if(rangeTabs){
          rangeTabs.style.display = "flex";
        }
        setupRangeTabs();
        updateView();
        saveHistoryEntry();
        saveLastSnapshot();
        if (typeof saveCsvToSupabase === "function") {
          try { saveCsvToSupabase(file); } catch(err) { console.error("Supabase Ï†ÄÏû• Ïò§Î•ò", err); }
        }
      }
    }
  });
      if(ALL_BASE.length){
        // CSV ÏóÖÎ°úÎìú ÌõÑ ÏûêÎèôÏúºÎ°ú Î¶¨ÎçîÎ≥¥ÎìúÏôÄ Ïó∞Í≤∞
        try{
          const handleInput = document.getElementById("leader-handle");
          if(handleInput && !handleInput.value.trim()){
            const sideHandle = document.getElementById("side-handle-link");
            if(sideHandle){
              const txt = (sideHandle.textContent || "").trim();
              if(txt && txt !== "@ÏùµÎ™Ö"){
                handleInput.value = txt;
              }
            }
          }
          const finalHandleInput = document.getElementById("leader-handle");
          if(finalHandleInput){
            const hv = (finalHandleInput.value || "").trim();
            if(hv && hv !== "@ÏùµÎ™Ö" && typeof saveToLeaderboard === "function"){
              saveToLeaderboard();
            }
          }
        }catch(err){
          console.error("ÏûêÎèô Î¶¨ÎçîÎ≥¥Îìú Ïó∞Îèô Ï§ë Ïò§Î•ò:", err);
        }
      }
});

/* ========== Î¶¨ÎçîÎ≥¥Îìú Ï†ÄÏû•/Î∂àÎü¨Ïò§Í∏∞ ========== */
async function saveToLeaderboard(){
  if(!ANALYSIS){
    alert("Î®ºÏ†Ä CSVÎ•º ÏóÖÎ°úÎìúÌï¥ÏÑú Î∂ÑÏÑùÏùÑ ÎèåÎ†§Ï§ò.");
    return;
  }
  const handleInput = document.getElementById("leader-handle");
  const handle = (handleInput.value || "").trim();
  if(!handle){
    alert("X Ìï∏Îì§ÏùÑ ÏûÖÎ†•Ìï¥Ï§ò. (Ïòà: @bud_dha__)");
    handleInput.focus();
    return;
  }
  if(ANALYSIS.totalPosts < MIN_POSTS_FOR_LEADERBOARD){
    if(!confirm(`ÏõêÍ∏ÄÏù¥ ${ANALYSIS.totalPosts}Í∞úÏûÖÎãàÎã§. ÏµúÏÜå ${MIN_POSTS_FOR_LEADERBOARD}Í∞ú Ïù¥ÏÉÅÏùº Îïå Ï∂îÏ≤úÌï¥.\nÍ∑∏ÎûòÎèÑ Ï†ÄÏû•Ìï†Îûò?`)) return;
  }

  const bestPost = CURRENT_LIST.slice().sort((a,b)=>b.score-a.score)[0];

  const payload = {
    handle,
    trimmedAvg: ANALYSIS.trimmedAvg,
    avgScore: ANALYSIS.avgScore,
    bestScore: ANALYSIS.bestScore,
    bestDate: ANALYSIS.bestDate,
    bestLink: ANALYSIS.bestLink,
    bestText: bestPost?.text || "",
    bestGrade: bestPost?.grade || "",
    totalPosts: ANALYSIS.totalPosts
  };

  try{
    await fetch(SCRIPT_URL, {
      method: "POST",
      headers: { "Content-Type": "text/plain;charset=utf-8" },
      body: JSON.stringify(payload)
    });
    alert("Î¶¨ÎçîÎ≥¥ÎìúÏóê Í∏∞Î°ù Ï†ÄÏû• ÏôÑÎ£å! üî•");
    loadLeaderboard(handle);
  }catch(err){
    console.error(err);
    alert("Î¶¨ÎçîÎ≥¥Îìú Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÎã§.");
  }
}

async function loadLeaderboard(handle){
  const tableWrap = document.getElementById("leaderboard-wrap");
  const myRankWrap = document.getElementById("my-rank-wrap");
  if(!tableWrap) return;
  try{
    const url = handle
      ? `${SCRIPT_URL}?handle=${encodeURIComponent(handle)}`
      : SCRIPT_URL;
    const res  = await fetch(url);
    const data = await res.json();
    const list   = Array.isArray(data) ? data : (data.top || []);
    const myRank = !Array.isArray(data) ? data.myRank : null;
    if(myRankWrap) myRankWrap.innerHTML = "";

    if(!list || !list.length){
      tableWrap.innerHTML = "<div class='empty'>ÏïÑÏßÅ Î¶¨ÎçîÎ≥¥Îìú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</div>";
      return;
    }

    // üîπ ÏõêÍ∏Ä ÏàòÎ•º Î∞òÏòÅÌïú Í∞ÄÏ§ëÏπò Ï†êÏàò Í≥ÑÏÇ∞ (Î¶¨ÎçîÎ≥¥Îìú Ï†ÑÏö©)
    const scoredList = list.slice().map(item => {
      const totalPosts = item.totalPosts || 0;
      const trimmed    = Number(item.trimmedAvg || 0);
      // ÏõêÍ∏Ä 60Í∞ú Ïù¥ÏÉÅÏù¥Î©¥ Ïã†Î¢∞ÎèÑ 1, Í∑∏ Ïù¥ÌïòÎäî ÏÑ†Ìòï Í∞êÏÜå
      const reliability = Math.min(totalPosts, 60) / 60;       // 0 ~ 1
      const factor      = 0.4 + 0.6 * reliability;            // 0.4 ~ 1.0
      const score       = trimmed * factor;                   // Í∞ÄÏ§ëÏπò Ï†êÏàò
      return { ...item, _score: score, _factor: factor };
    }).sort((a,b) => (b._score || 0) - (a._score || 0));

    // üîπ ÎÇ¥ ÏàúÏúÑÎèÑ Í∞ÄÏ§ëÏπò Í∏∞Ï§ÄÏúºÎ°ú Ïû¨Í≥ÑÏÇ∞
    if(myRank && myRankWrap){
      const trimmedAvg = Number(myRank.trimmedAvg || 0).toFixed(1);
      const avgScore   = Number(myRank.avgScore   || 0).toFixed(1);
      const totalPosts = myRank.totalPosts || 0;

      let displayRank = myRank.rank;
      try{
        const targetHandle = (myRank.handle || "").trim();
        if(targetHandle){
          const foundIndex = scoredList.findIndex(it => (it.handle || "").trim() === targetHandle);
          if(foundIndex >= 0){
            displayRank = foundIndex + 1;
          }
        }
      }catch(e){}

      myRankWrap.innerHTML = `
        <div style="padding:10px 12px;margin-bottom:8px;border-radius:12px;border:1px solid rgba(209,213,219,1);background:#f9fafb;font-size:12px;">
          <div style="font-size:13px;font-weight:700;margin-bottom:4px;">ÎÇ¥ ÌòÑÏû¨ ÏàúÏúÑ</div>
          <div style="display:flex;flex-wrap:wrap;gap:8px;align-items:center;">
            <span style="font-weight:700;color:#f97316;">#${displayRank}ÏúÑ</span>
            <span>¬∑ Ìä∏Î¶ºÎìú ÌèâÍ∑† <strong>${trimmedAvg}</strong></span>
            <span>¬∑ ÌèâÍ∑† Ïä§ÏΩîÏñ¥ <strong>${avgScore}</strong></span>
            <span>¬∑ ÏõêÍ∏Ä Ïàò <strong>${totalPosts}</strong></span>
          </div>
        </div>
      `;
    }

    const rows = scoredList.map((item, idx) => {
      const handle      = item.handle || "";
      const handleClean = handle.replace("@","").trim();
      const trimmedAvg  = Number(item.trimmedAvg || 0).toFixed(1);
      const avgScore    = Number(item.avgScore   || 0).toFixed(1);
      const totalPosts  = item.totalPosts || 0;
      const bestLink    = item.bestLink || (handleClean ? `https://twitter.com/${handleClean}` : "#");
      return `
        <tr>
          <td>#${idx+1}</td>
          <td>
            <a href="${bestLink}" target="_blank" style="display:inline-flex;align-items:center;gap:6px;text-decoration:none;color:#111827">
              <img src="https://unavatar.io/twitter/${handleClean}" style="width:20px;height:20px;border-radius:999px;border:1px solid rgba(209,213,219,1)"/>
              <span>${handle}</span>
            </a>
          </td>
          <td>${trimmedAvg}</td>
          <td>${avgScore}</td>
          <td>${totalPosts}</td>
          <td>${item.bestLink ? `<a href="${item.bestLink}" class="link-pill" target="_blank">ÎåÄÌëú Ìä∏Ïúó Î≥¥Í∏∞ ‚Üó</a>` : ""}</td>
        </tr>`;
    }).join("");
    tableWrap.innerHTML = `
      <table>
        <thead>
          <tr>
            <th>ÏàúÏúÑ</th>
            <th>Ìï∏Îì§</th>
            <th>Ìä∏Î¶ºÎìú ÌèâÍ∑†</th>
            <th>ÌèâÍ∑† Ïä§ÏΩîÏñ¥</th>
            <th>ÏõêÍ∏Ä Ïàò</th>
            <th>ÎåÄÌëú Ìä∏Ïúó</th>
          </tr>
        </thead>
        <tbody>${rows}</tbody>
      </table>`;
  }catch(err){
    console.error(err);
    tableWrap.innerHTML = "<div class='empty'>Î¶¨ÎçîÎ≥¥ÎìúÎ•º Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÎã§.</div>";
  }
}


/* ========== Îã§Íµ≠Ïñ¥ UI (KO/EN/JA/ZH) ========== */
const MS_I18N = {
  ko: {
    "#view-dashboard .top-title": "X ÌÅ¨Î¶¨ÏóêÏù¥ÌÑ∞ ÎßàÏù∏ÎìúÏâêÏñ¥ Î∂ÑÏÑùÍ∏∞",
    "#view-dashboard .top-sub": "Ïï†ÎÑêÎ¶¨Ìã±Ïä§ CSVÎ°ú ÎÇ¥ Í≥ÑÏ†ïÏùò ÏßÑÏßú ÏûÑÌå©Ìä∏Î•º Î≥¥Îäî ÎåÄÏãúÎ≥¥Îìú",
    ".hero-main-title": "ÎßàÏù∏ÎìúÏâêÏñ¥ Ïä§ÏΩîÏñ¥ ¬∑ S~D Îì±Í∏â ¬∑ Î¶¨ÎçîÎ≥¥ÎìúÍπåÏßÄ Ìïú Î≤àÏóê",
    ".hero-desc": "X Ïï†ÎÑêÎ¶¨Ìã±Ïä§ÏóêÏÑú CSVÎ•º ÎÇ¥Î†§Î∞õÍ≥† Ïù¥Í≥≥Ïóê ÏóÖÎ°úÎìúÌïòÎ©¥,<br>ÏõêÍ∏Ä Í∏∞Ï§ÄÏúºÎ°ú ÎßàÏù∏ÎìúÏâêÏñ¥ Ï†êÏàòÏôÄ ÏÉÅÏúÑ Í∏Ä, Î¶¨ÎçîÎ≥¥ÎìúÍπåÏßÄ Ìïú Î≤àÏóê Î∂ÑÏÑùÌï† Ïàò ÏûàÏñ¥.",
    ".hero-pill": "<span class='hero-dot'></span> CSV Ìïú Î≤à ‚Üí Í≥ÑÏ†ï Î∂ÑÏÑù ÎÅù",
    ".file-input-fake": "üìÅ CSV ÌååÏùº ÏÑ†ÌÉùÌïòÍ∏∞",
    ".file-hint": "account_analytics_content_YYYY-MM-DD_YYYY-MM-DD.csv Í∑∏ÎåÄÎ°ú ÏóÖÎ°úÎìú",
    ".badge": "<span class='badge-dot'></span>ÌïúÍµ≠Ïñ¥¬∑ÏòÅÏñ¥ CSV ÏûêÎèô Ïù∏Ïãù ¬∑ ÎãµÍ∏Ä Ï†úÏô∏ ÌõÑ ÏõêÍ∏ÄÎßå Î∂ÑÏÑù",
    "#range-tabs button[data-range='ALL']": "Ï†ÑÏ≤¥ Í∏∞Í∞Ñ",
    "#range-tabs button[data-range='7']": "ÏµúÍ∑º 7Ïùº",
    "#range-tabs button[data-range='30']": "ÏµúÍ∑º 30Ïùº",
    "#range-tabs button[data-range='90']": "ÏµúÍ∑º 90Ïùº",
    "#view-leaderboard .top-title": "ÌÅ¨Î¶¨ÏóêÏù¥ÌÑ∞ ÎßàÏù∏ÎìúÏâêÏñ¥ Î¶¨ÎçîÎ≥¥Îìú",
    "#view-leaderboard .top-sub": "ÎÇ¥ ÏàúÏúÑ ¬∑ Ìä∏Î¶ºÎìú ÌèâÍ∑† ¬∑ ÎåÄÌëú Ìä∏ÏúóÏùÑ Ìïú ÎààÏóê Î≥¥Îäî Îû≠ÌÇπ Î≥¥Îìú",
    "#view-projects .top-title": "ÌîÑÎ°úÏ†ùÌä∏Î≥Ñ ÎßàÏù∏ÎìúÏâêÏñ¥",
    "#view-projects .top-sub": "Ìä∏Ïúó Î≥∏Î¨∏ ÌÇ§ÏõåÎìú Í∏∞Ï§ÄÏúºÎ°ú ÌîÑÎ°úÏ†ùÌä∏Î≥Ñ ÏûÑÌå©Ìä∏ÏôÄ Í≤åÏãúÍ∏Ä/Îì±Í∏âÏùÑ Î∂ÑÏÑùÌï©ÎãàÎã§.",
    ".side-badge": "Ïò§ÎäòÎèÑ Ìïú Î≤à<br>ÎßàÏâê ÌÑ∞Ìä∏Î†§Î≥ºÍπå? üí•",
    "#leaderboard-section .section-title": "üèÜ ÌÅ¨Î¶¨ÏóêÏù¥ÌÑ∞ ÎßàÏù∏ÎìúÏâêÏñ¥ Î¶¨ÎçîÎ≥¥Îìú (Beta)",
    "#leader-handle::placeholder": "X Ìï∏Îì§ ÏûÖÎ†• (Ïòà: @bud_dha__)",
    "#nav-dashboard-label": "Dashboard",
    "#nav-leaderboard-label": "Î¶¨ÎçîÎ≥¥Îìú",
    "#nav-projects-label": "ÌîÑÎ°úÏ†ùÌä∏Î≥Ñ ÎßàÏù∏ÎìúÏâêÏñ¥",
    "#nav-course-label": "ÌÅ¨Î¶ΩÌÜ† ÌíÄÏΩîÏä§",
    "#growth-title": "üìà Í≥ÑÏ†ï ÏÑ±Ïû• Í∑∏ÎûòÌîÑ",
    "#growth-sub": "ÏµúÍ∑º Í∏∞Í∞Ñ ÎèôÏïà ÏõêÍ∏Ä Í∞úÏàò / ÌèâÍ∑† Ïä§ÏΩîÏñ¥ Ï∂îÏù¥Î•º Í∑∏ÎûòÌîÑÎ°ú Î≥¥Ïó¨Ï§çÎãàÎã§.",
    "#top10-title": "üí• ÎßàÏù∏ÎìúÏâêÏñ¥ Ìè≠Î∞ú Top 10 <span id='top10-count'></span>",
    "#grade-section-title": "üéö Îì±Í∏âÎ≥Ñ ÏÉÅÏúÑ Í≤åÏãúÍ∏Ä <span>(S~D)</span>",
    "#coach-title": "ü§ñ ÎßàÏù∏ÎìúÏâêÏñ¥ ÏΩîÏπò Î¥á <span style='font-size:11px;color:var(--text-muted);'>(Beta)</span>",
    "#coach-chip-text": "ÌòÑÏû¨ ÏÑ†ÌÉùÌïú Í∏∞Í∞Ñ Í∏∞Ï§Ä ¬∑ YAP Ïã†Ìò∏Îäî ÏµúÍ∑º 7Ïùº Ï†ïÌôïÎèÑ‚Üë Ìïú Ï§Ñ ÏöîÏïΩ + ÌîºÎìúÎ∞±",
    ".yap-label": "ÌòÑÏû¨ ÏÑ†ÌÉùÌïú Í∏∞Í∞Ñ Í∏∞Ï§Ä ¬∑ YAP Ïã†Ìò∏Îäî ÏµúÍ∑º 7Ïùº Ï†ïÌôïÎèÑ‚Üë",
    "#leader-note": "‚Äª ÏµúÏÜå ÏõêÍ∏Ä Ïàò 20Í∞ú Ïù¥ÏÉÅÏùº Îïå Î¶¨ÎçîÎ≥¥Îìú Ï†êÏàòÍ∞Ä Îçî Ï†ïÌôïÌï©ÎãàÎã§.",
    "#project-summary-title": "üìö ÌîÑÎ°úÏ†ùÌä∏ ÏöîÏïΩ + ÏõêÌòï Í∑∏ÎûòÌîÑ",
    "#project-summary-sub": "ÏΩîÎìú ÏÉÅÎã® <code>PROJECTS</code> Î∞∞Ïó¥Ïùò ÌÇ§ÏõåÎìúÎ•º ÎÑ§Í∞Ä Ìä∏Îäî ÌîÑÎ°úÏ†ùÌä∏Ïóê ÎßûÍ≤å Î∞îÍøîÏ§ò.",
    "#proj-chart-title-1": "ÌîÑÎ°úÏ†ùÌä∏Î≥Ñ Í≤åÏãúÍ∏Ä ÎπÑÏú®",
    "#proj-chart-title-2": "ÌîÑÎ°úÏ†ùÌä∏Î≥Ñ ÌèâÍ∑† Ï†êÏàò (Ìä∏Î¶ºÎìú Í∏∞Ï§Ä)",
    "#proj-chart-title-3": "ÏÑ†ÌÉù ÌîÑÎ°úÏ†ùÌä∏ S~D Îì±Í∏â Î∂ÑÌè¨"
  },
  en: {
    "#view-dashboard .top-title": "X Creator Mindshare Analyzer",
    "#view-dashboard .top-sub": "Dashboard to see your real impact using X Analytics CSV",
    ".hero-main-title": "Mindshare score ¬∑ S~D grades ¬∑ Leaderboard in one place",
    ".hero-desc": "Download CSV from X Analytics and upload here.<br>You can analyze mindshare scores, top posts, and leaderboard based on original posts only.",
    ".hero-pill": "<span class='hero-dot'></span> One CSV ‚Üí Full account analysis",
    ".file-input-fake": "üìÅ Choose CSV file",
    ".file-hint": "Upload account_analytics_content_YYYY-MM-DD_YYYY-MM-DD.csv as is",
    ".badge": "<span class='badge-dot'></span>KO/EN CSV auto-detect ¬∑ replies excluded, originals only",
    "#range-tabs button[data-range='ALL']": "All time",
    "#range-tabs button[data-range='7']": "Last 7 days",
    "#range-tabs button[data-range='30']": "Last 30 days",
    "#range-tabs button[data-range='90']": "Last 90 days",
    "#view-leaderboard .top-title": "Creator Mindshare Leaderboard",
    "#view-leaderboard .top-sub": "Check your rank, trimmed average score, and key tweet at a glance",
    "#view-projects .top-title": "Project-wise Mindshare",
    "#view-projects .top-sub": "Analyze impact and grades per project based on tweet text keywords.",
    ".side-badge": "Shall we blow up<br>mindshare again today? üí•",
    "#leaderboard-section .section-title": "üèÜ Creator Mindshare Leaderboard (Beta)",
    "#leader-handle::placeholder": "Enter X handle (e.g., @bud_dha__)",
    "#nav-dashboard-label": "Dashboard",
    "#nav-leaderboard-label": "Leaderboard",
    "#nav-projects-label": "Project Mindshare",
    "#nav-course-label": "Crypto Fullcourse",
    "#growth-title": "üìà Account Growth Chart",
    "#growth-sub": "Shows the trend of original post count and average score over time.",
    "#top10-title": "üí• Top 10 Mindshare Posts <span id='top10-count'></span>",
    "#grade-section-title": "üéö Top Posts by Grade <span>(S~D)</span>",
    "#coach-title": "ü§ñ Mindshare Coach Bot <span style='font-size:11px;color:var(--text-muted);'>(Beta)</span>",
    "#coach-chip-text": "One-line summary & feedback for the selected period",
    ".yap-label": "Based on the currently selected period ¬∑ YAP signal is most accurate over the last 7 days",
    "#leader-note": "‚Äª For best accuracy, use at least 20 original posts before saving to the leaderboard.",
    "#project-summary-title": "üìö Project Summary + Donut Chart",
    "#project-summary-sub": "Edit the <code>PROJECTS</code> array at the top of the code to match the projects you tweet about."
  },
};

function applyLang(lang) {
  CURRENT_LANG = lang;
  const dict = MS_I18N[lang] || MS_I18N.ko;
  Object.keys(dict).forEach(sel => {
    // placeholder Ï≤òÎ¶¨
    if (sel.endsWith("::placeholder")) {
      const realSel = sel.replace("::placeholder", "");
      const el = document.querySelector(realSel);
      if (el) el.setAttribute("placeholder", dict[sel]);
    } else {
      const el = document.querySelector(sel);
      if (el) el.innerHTML = dict[sel];
    }
  });
  document.documentElement.setAttribute("lang", lang);
  localStorage.setItem("ms_lang", lang);
  document.querySelectorAll(".lang-btn").forEach(btn => {
    btn.classList.toggle("active", btn.dataset.lang === lang);
  });
  // Ïñ∏Ïñ¥Í∞Ä Î∞îÎÄî Îïå ÏΩîÏπòÎ¥á ÌÖçÏä§Ìä∏ÎèÑ Î∞îÎ°ú Ïñ∏Ïñ¥Ïóê ÎßûÍ≤å Îã§Ïãú Î†åÎçîÎßÅ
  if (typeof updateCoach === "function") {
    try { updateCoach(); } catch(e) {}
  }
}

function initLangToggle() {
  const saved = localStorage.getItem("ms_lang") || "ko";
  applyLang(saved);
  document.querySelectorAll(".lang-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      applyLang(btn.dataset.lang);
    });
  });
}

initLangToggle();

/* ========== ÌÉ≠ & Ïù¥Î≤§Ìä∏ ========== */
document.querySelectorAll(".grade-tab").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll(".grade-tab").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    const g=btn.dataset.grade;
    CURRENT_GRADE = g;
    if(g==="ALL") renderGrade(CURRENT_LIST.slice(0,30));
    else renderGrade(buckets[g] || []);
  });
});

document.querySelectorAll(".range-tab").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll(".range-tab").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    CURRENT_RANGE = btn.dataset.range || "ALL";
    updateView();
  });
});

const sortSelect = document.getElementById("sort-key");
if(sortSelect){
  sortSelect.addEventListener("change", e=>{
    SORT_KEY = e.target.value || "score";
    if(!CURRENT_LIST.length) return;
    renderTop10(CURRENT_LIST);
    if(CURRENT_GRADE === "ALL") renderGrade(CURRENT_LIST.slice(0,30));
    else renderGrade(buckets[CURRENT_GRADE] || []);
  });
}

document.getElementById("leader-save-btn").addEventListener("click", saveToLeaderboard);
loadLeaderboard();

/* ========== ÏÇ¨Ïù¥ÎìúÎ∞î Î∑∞ ÌÜ†Í∏Ä ========== */


// ===== ÏÇ¨Ïù¥ÎìúÎ∞î ÌÉ≠ Ï†ÑÌôò Î°úÏßÅ (ÏµúÏ†ÅÌôî Î≤ÑÏ†Ñ) =====
document.addEventListener("DOMContentLoaded", () => {
  
const viewNavItems = document.querySelectorAll(".side-nav-item[data-view]");
  const viewDashboard = document.getElementById("view-dashboard");
  const viewGuide = document.getElementById("view-guide");
  const viewCsv = document.getElementById("view-csv");
  const viewLeaderboard = document.getElementById("view-leaderboard");
  const viewProjects = document.getElementById("view-projects");
  const viewHistory = document.getElementById("view-history");
  const viewYapping = document.getElementById("view-yapping");
  const viewInfofi = document.getElementById("view-infofi");
  const viewCookie = document.getElementById("view-cookie");


  function showView(target){
    if (!viewDashboard || !viewLeaderboard || !viewProjects) return;

    // Í∏∞Î≥∏Í∞í: Ï†ÑÎ∂Ä Ïà®Í∏∞Í∏∞
    viewDashboard.style.display = "none";
    if (viewGuide) viewGuide.style.display = "none";
    if (viewCsv) viewCsv.style.display = "none";
    viewLeaderboard.style.display = "none";
    viewProjects.style.display = "none";
    if (viewHistory) viewHistory.style.display = "none";
    if (viewYapping) viewYapping.style.display = "none";
    if (viewInfofi) viewInfofi.style.display = "none";
    if (viewCookie) viewCookie.style.display = "none";
    const viewCommunity = document.getElementById("view-community");
    if (viewCommunity) viewCommunity.style.display = "none";
    const viewYapGauge = document.getElementById("view-yap-gauge");
    if (viewYapGauge) viewYapGauge.style.display = "none";

    switch(target){
      case "leaderboard":
        viewLeaderboard.style.display = "block";
        if (typeof loadLeaderboard === "function") {
          loadLeaderboard();
        }
        break;
      case "projects":
        viewProjects.style.display = "block";
        break;
      case "history":
        if (viewHistory) {
          viewHistory.style.display = "block";
          if (typeof renderHistoryList === "function") {
            renderHistoryList();
          }
        }
        break;
      case "yapping":
        if (viewYapping) {
          viewYapping.style.display = "block";
        }
        break;
      case "yap-gauge":
        if (viewYapGauge) {
          viewYapGauge.style.display = "block";
        }
        break;
      case "cookie":
        if (viewCookie) {
          viewCookie.style.display = "block";
          if (typeof renderCookieLeaderboard === "function") {
            renderCookieLeaderboard();
          }
        }
        break;

      case "infofi":
        if (viewInfofi) {
          viewInfofi.style.display = "block";
        }
        break;
      case "community":
        if (viewCommunity) {
          viewCommunity.style.display = "block";
          if (typeof initCommunity === "function") {
            initCommunity();
          }
        }
        break;
      case "guide":
        if (viewGuide) {
          viewGuide.style.display = "block";
        }
        break;
      case "csv":
        if (viewCsv) {
          viewCsv.style.display = "block";
        }
        break;
      case "dashboard":
      default:
        viewDashboard.style.display = "block";
        if (typeof ensureDashboardInitialized === "function") {
          ensureDashboardInitialized();
        }
        break;
    }
  }

  // Ï≤òÏùå Î°úÎìúÏãú ÎåÄÏãúÎ≥¥Îìú Î≥¥Ïù¥ÎèÑÎ°ù
  showView("dashboard");
  viewNavItems.forEach(item => {
    item.addEventListener("click", () => {
      const view = item.dataset.view || "dashboard";

      // active ÌÅ¥ÎûòÏä§ ÌÜ†Í∏Ä
      viewNavItems.forEach(i => i.classList.remove("active"));
      item.classList.add("active");

      // Î∑∞ Ï†ÑÌôò
      showView(view);

      // üîç InfoFi ÌÉ≠ÏùÑ ÌÅ¥Î¶≠ÌïòÎ©¥ ÎÇ¥ Ìï∏Îì§Î°ú InfoFi + Kaito Î¶¨ÎçîÎ≥¥ÎìúÎ•º ÏûêÎèô Ï°∞Ìöå
      if (view === "infofi") {
        try {
          let handle = "";
          const infofiInput = document.getElementById("infofi-handle-input");
          const leaderInput = document.getElementById("leader-handle");
          // kaito Ï†ÑÏö© ÏûÖÎ†•ÏùÄ Ï†úÍ±∞Îê®

          if (infofiInput && infofiInput.value.trim()) {
            handle = infofiInput.value.trim();
          } else if (leaderInput && leaderInput.value.trim()) {
            handle = leaderInput.value.trim();
          }

          if (handle) {
            if (infofiInput) infofiInput.value = handle;
            if (kaitoInput) kaitoInput.value = handle;

            if (typeof handleInfofiSearch === "function") {
              handleInfofiSearch();
            }
            if (typeof fetchKaitoLeaderboard === "function") {
              fetchKaitoLeaderboard();
            }
          }
        } catch (err) {
          console.error("InfoFi auto search error:", err);
        }
      }
    });
  });
});




let COOKIE_INDEX = {};
// ÌîÑÎ°úÏ†ùÌä∏Î≥Ñ Î°úÍ≥† (X ÌîÑÎ°úÌïÑ / ÌîÑÎ°úÏ†ùÌä∏ Î°úÍ≥† URLÏùÑ ÏßÅÏ†ë ÎÑ£Ïñ¥Ï§òÏïº Ìï¥)
// ÏòàÏãú:
// const COOKIE_PROJECT_LOGOS = {
//   vooi: "https://pbs.twimg.com/profile_images/....jpg",
//   ten: "https://pbs.twimg.com/profile_images/....jpg"
// };
const COOKIE_PROJECT_LOGOS = {
  veera: "https://pbs.twimg.com/profile_images/1990352139168923648/PfeXQsSl_400x400.jpg",
  spaace: "https://pbs.twimg.com/profile_images/1651202265405898753/6PanR3uY_400x400.jpg",
  superform: "https://pbs.twimg.com/profile_images/1937588443166416896/4S5X6QSi_400x400.png",
  glint: "https://pbs.twimg.com/profile_images/1825445059375816705/th4KzmWL_400x400.jpg",
  "glint-analytics": "https://pbs.twimg.com/profile_images/1825445059375816705/th4KzmWL_400x400.jpg",
  solv: "https://pbs.twimg.com/profile_images/1971489442235092992/njLUqgMN_400x400.jpg",
  "solv-protocol": "https://pbs.twimg.com/profile_images/1971489442235092992/njLUqgMN_400x400.jpg",
  pacifica: "https://pbs.twimg.com/profile_images/1911022804159389696/THxMFj50_400x400.jpg",
  layerbank: "https://pbs.twimg.com/profile_images/1874059175967547396/p25s8fYo_400x400.jpg",
  tria: "https://pbs.twimg.com/profile_images/1947271337057079296/_smOX_4e_400x400.jpg",
  rayls: "https://pbs.twimg.com/profile_images/1787938574702116864/W_-vmST3_400x400.png",
  almanak: "https://pbs.twimg.com/profile_images/1933390399005208578/tBlaw9Jj_400x400.png",
  ten: "https://pbs.twimg.com/profile_images/1948670923596234752/CjzIhnby_400x400.jpg",
  vooi: "https://pbs.twimg.com/profile_images/1938271243876155393/fXAC9P_h_400x400.jpg"
};

let COOKIE_ENTRY_COUNT = 0;
let COOKIE_BUNDLE_LOADED = false;
let COOKIE_BUNDLE_LOADING = false;

function cookieNormalizeHandle(h){
  return String(h || "").trim().replace(/^@/, "").toLowerCase();
}

function cookieNormalizePeriodToken(t){
  const s = String(t || "").toLowerCase();
  if (s.includes("7daysago")) return "7D";
  if (s.includes("14daysago")) return "14D";
  if (s.includes("30daysago")) return "30D";
  if (s.includes("total")) return "Total";
  return "-";
}

function cookieParseFilenameMeta(name){
  const base = String(name || "").replace(/\.json$/i, "");
  const parts = base.split("_");
  const project = parts[0] || "?";
  const lang = parts[1] || "";
  let period = "-";
  for (const p of parts.slice(2)){
    const low = p.toLowerCase();
    if (low.includes("daysago") || low.includes("total")){
      period = cookieNormalizePeriodToken(p);
      break;
    }
  }
  return { project, lang, period };
}

function cookieSafeNumber(v){
  if (v === null || v === undefined) return null;
  const n = Number(v);
  return isNaN(n) ? null : n;
}

function cookieFirstDefined(){
  for (let i = 0; i < arguments.length; i++){
    const v = arguments[i];
    if (v !== undefined && v !== null) return v;
  }
  return null;
}

function cookiePickRank(u, type){
  const base = type === "Capital" ? "cSnaps" : "snaps";
  const direct = cookieSafeNumber(u[`${base}Rank`]);
  if (direct !== null) return direct;
  return cookieSafeNumber(u.rank);
}

function cookiePickPercent(u, type, period){
  const pref = type === "Mindshare" ? "snaps" : "cSnaps";
  if (period === "7D"){
    return cookieFirstDefined(
      u[`${pref}Percent7DaysAgo`],
      u[`${pref}Percent`],
      u[`${pref}PercentTotal`]
    );
  }
  if (period === "14D"){
    return cookieFirstDefined(
      u[`${pref}Percent14DaysAgo`],
      u[`${pref}Percent`],
      u[`${pref}PercentTotal`]
    );
  }
  if (period === "30D"){
    return cookieFirstDefined(
      u[`${pref}Percent30DaysAgo`],
      u[`${pref}Percent`],
      u[`${pref}PercentTotal`]
    );
  }
  return cookieFirstDefined(
    u[`${pref}PercentTotal`],
    u[`${pref}Percent`]
  );
}

function cookieAddUserToIndex(u, meta, type){
  const handleNorm = cookieNormalizeHandle(
    u.username || u.handle || u.screenName || u.twitter || u.x || u.user || u.name
  );
  if (!handleNorm) return 0;

  const rank = cookiePickRank(u, type);
  const percent = cookiePickPercent(u, type, meta.period);
  const percentNum = cookieSafeNumber(percent);
  if (percentNum === null) return 0;

  const key = handleNorm;
  if (!COOKIE_INDEX[key]) COOKIE_INDEX[key] = [];
  COOKIE_INDEX[key].push({
    project: meta.project,
    lang: meta.lang,
    period: meta.period,
    type,
    handle: "@" + handleNorm,
    rank: cookieSafeNumber(rank),
    percent: percentNum
  });
  COOKIE_ENTRY_COUNT += 1;
  return 1;
}

function cookieIndexFromJson(json, meta){
  let root = json;
  if (Array.isArray(json)) root = json[0];
  const data =
    root?.result?.data?.json ||
    root?.result?.data ||
    root?.json ||
    root;

  const snaps = Array.isArray(data?.snaps) ? data.snaps : [];
  const cSnaps = Array.isArray(data?.cSnaps) ? data.cSnaps : [];

  snaps.forEach(u => { cookieAddUserToIndex(u, meta, "Mindshare"); });
  cSnaps.forEach(u => { cookieAddUserToIndex(u, meta, "Capital"); });
}


function cookieIndexBundle(bundle){
  try{
    if (!bundle) return;
    // Î∞∞Ïó¥Ïù∏ Í≤ΩÏö∞: ÌååÏùº Îã®ÏúÑ Î¶¨Ïä§Ìä∏ÎùºÍ≥† Í∞ÄÏ†ï
    if (Array.isArray(bundle)){
      for (const file of bundle){
        const meta = cookieParseFilenameMeta(file.filename || file.name || "");
        const json = file.data || file.json || file;
        cookieIndexFromJson(json, meta);
      }
      return;
    }
    // Í∑∏ Ïô∏ÏóêÎäî Îã®Ïùº JSONÏúºÎ°ú Í∞ÑÏ£º
    cookieIndexFromJson(bundle, {});
  }catch(e){
    console.error("cookieIndexBundle error:", e);
    throw e;
  }
}

async function cookieLoadBundle(){
  if (COOKIE_BUNDLE_LOADED || COOKIE_BUNDLE_LOADING) return;
  COOKIE_BUNDLE_LOADING = true;

  const tbody = document.getElementById("cookie-leaderboard-body");
  const cardsWrap = document.getElementById("cookie-project-cards");
  if (tbody){
    tbody.innerHTML = '<tr><td colspan="6" class="infofi-empty">cookie_all_bundle.json Î∂àÎü¨Ïò§Îäî Ï§ë...</td></tr>';
  }
  if (cardsWrap){
    cardsWrap.innerHTML = '<div class="infofi-empty">cookie_all_bundle.json Î∂àÎü¨Ïò§Îäî Ï§ë...</div>';
  }


  try{
    // ZIP ÌååÏùº(cookie_all_bundle.zip)ÏóêÏÑú JSONÏùÑ ÏùΩÏñ¥Ïò§Îäî Î∞©Ïãù
    const res = await fetch("cookie_all_bundle.zip", { cache: "no-store" });
    if (!res.ok) throw new Error("HTTP " + res.status);
    const buf = await res.arrayBuffer();
    const zip = await JSZip.loadAsync(buf);
    // ZIP ÏïàÏóê Îì§Ïñ¥ÏûàÎäî JSON ÌååÏùº Ïù¥Î¶Ñ (ÌïÑÏöîÌïòÎ©¥ ÏàòÏ†ï)
    const file = zip.file("cookie_all_bundle.json");
    if (!file) throw new Error("ZIP ÏïàÏóê cookie_all_bundle.json Ïù¥ ÏóÜÏñ¥.");
    const text = await file.async("string");
    const bundle = JSON.parse(text);

    // Í≥µÌÜµ Ïù∏Îç±Ïã± Î°úÏßÅ
    cookieIndexBundle(bundle);
    COOKIE_BUNDLE_LOADED = true;
  } catch (err){
    console.error("cookie_all_bundle.json load error:", err);
    const errMsg = (err && err.message) ? err.message : String(err);

    if (tbody){
      tbody.innerHTML = '<tr><td colspan="6" class="infofi-empty">cookie_all_bundle.json Î°úÎìú ÏóêÎü¨: ' 
        + errMsg.replace(/'/g,"&#39;") + '<br>ÏïÑÎûòÏóêÏÑú ÏßÅÏ†ë cookie_all_bundle.json ÌååÏùºÏùÑ ÏÑ†ÌÉùÌï¥ÏÑú Î∂àÎü¨Ïò¨ ÏàòÎèÑ ÏûàÏñ¥.</td></tr>';
    }
    const cardsWrap2 = document.getElementById("cookie-project-cards");
    if (cardsWrap2){
      cardsWrap2.innerHTML = ''
        + '<div class="infofi-empty">cookie_all_bundle.json Î°úÎìú ÏóêÎü¨: ' + errMsg.replace(/'/g,"&#39;") + '</div>'
        + '<div class="infofi-empty" style="margin-top:8px;">ÏïÑÎûò Î≤ÑÌäºÏúºÎ°ú cookie_all_bundle.json ÏùÑ ÏßÅÏ†ë ÏÑ†ÌÉùÌï¥ÏÑú Î∂àÎü¨Ïò¨ Ïàò ÏûàÏñ¥.</div>'
        + '<div style="margin-top:12px;"><input type="file" id="cookie-json-file" accept=".json"></div>';
    }

    // ÌååÏùº ÏóÖÎ°úÎìú fallback Ìï∏Îì§Îü¨
    setTimeout(() => {
      const inp = document.getElementById("cookie-json-file");
      if (!inp) return;
      inp.addEventListener("change", (e) => {
        const f = e.target.files && e.target.files[0];
        if (!f) return;
        const reader = new FileReader();
        reader.onload = (ev) => {
          try{
            const text = ev.target.result;
            const parsed = JSON.parse(text);
            // Í∏∞Ï°¥ Ïù∏Îç±Ïä§ Ï¥àÍ∏∞Ìôî ÌõÑ Îã§Ïãú ÏÉùÏÑ±
            COOKIE_INDEX = {};
            COOKIE_ENTRY_COUNT = 0;
            cookieIndexBundle(parsed);
            COOKIE_BUNDLE_LOADED = true;
            // ÏÑ±Í≥µ Ïãú ÏïàÎÇ¥ Î¨∏Íµ¨ Í∞±Ïã†
            if (cardsWrap2){
              cardsWrap2.innerHTML = '<div class="infofi-empty">cookie_all_bundle.json ÏùÑ ÌååÏùº ÏóÖÎ°úÎìúÎ°ú ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Î∂àÎü¨ÏôîÏñ¥. Ïù¥Ï†ú Ìï∏Îì§ÏùÑ Í≤ÄÏÉâÌï¥Î¥ê.</div>';
            }
            if (tbody){
              tbody.innerHTML = '<tr><td colspan="6" class="infofi-empty">cookie_all_bundle.json ÏùÑ ÌååÏùº ÏóÖÎ°úÎìúÎ°ú ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Î∂àÎü¨ÏôîÏñ¥. Ïù¥Ï†ú Ìï∏Îì§ÏùÑ Í≤ÄÏÉâÌï¥Î¥ê.</td></tr>';
            }
          }catch(e2){
            console.error("ÌååÏùº ÏóÖÎ°úÎìú JSON ÌååÏã± ÏóêÎü¨:", e2);
            if (cardsWrap2){
              cardsWrap2.innerHTML = '<div class="infofi-empty">ÌååÏùº ÏóÖÎ°úÎìú JSON ÌååÏã± ÏóêÎü¨: ' + (e2.message || String(e2)) + '</div>';
            }
          }
        };
        reader.readAsText(f, "utf-8");
      });
    }, 0);
  } finally 
{
    COOKIE_BUNDLE_LOADING = false;
  }
}

function cookieGroupByProject(entries){
  const map = {};
  entries.forEach(e => {
    if (!e || !e.project) return;
    if (!map[e.project]) map[e.project] = [];
    map[e.project].push(e);
  });
  return map;
}

function cookieSummarizeProjectEntries(list){
  const result = {
    project: list[0]?.project || "?",
    handle: list[0]?.handle || "-",
    lang: list[0]?.lang || "",
    segments: {
      "Mindshare": { "7D": null, "14D": null, "30D": null, "Total": null },
      "Capital": { "7D": null, "14D": null, "30D": null, "Total": null }
    }
  };
  for (const e of list){
    const seg = e.type === "Capital" ? "Capital" : "Mindshare";
    const period = ["7D","14D","30D","Total"].includes(e.period) ? e.period : "Total";
    const current = result.segments[seg][period];
    if (!current){
      result.segments[seg][period] = { rank: e.rank, percent: e.percent };
    } else {
      if (e.rank != null && (current.rank == null || e.rank < current.rank)) {
        result.segments[seg][period] = { rank: e.rank, percent: e.percent };
      }
    }
  }
  return result;
}


function cookieRenderProjectCards(entries, handleNorm){
  const wrap = document.getElementById("cookie-project-cards");
  const labelEl = document.getElementById("cookie-handle-label");
  if (!wrap) return;

  if (!entries.length){
    wrap.innerHTML = '<div class="infofi-empty">Ìï¥Îãπ Ìï∏Îì§Î°ú Ï∞æÏùÄ Cookie ÌîÑÎ°úÏ†ùÌä∏ Ïπ¥ÎìúÍ∞Ä ÏóÜÏñ¥ (#200 Ïù¥ÎÇ¥, 0% Ï†úÏô∏).</div>';
    if (labelEl) labelEl.textContent = "";
    return;
  }

  const byProject = cookieGroupByProject(entries);
  const summaries = Object.values(byProject).map(list => cookieSummarizeProjectEntries(list));
  summaries.sort((a,b) => {
    const nameA = (a.project || "").toLowerCase();
    const nameB = (b.project || "").toLowerCase();
    if (nameA < nameB) return -1;
    if (nameA > nameB) return 1;
    return 0;
  });

  const periodOrder = ["7D","14D","30D","Total"];

  const cardsHtml = summaries.map(s => {
    const initials = (s.project || "?").slice(0,2).toUpperCase();
    const projectKey = (s.project || "").toLowerCase();
    const logoUrl = COOKIE_PROJECT_LOGOS[projectKey] || "";

    const msRows = periodOrder.map(p => {
      const v = s.segments.Mindshare[p];
      if (!v) return `<tr><td>${p}</td><td>-</td><td>-</td></tr>`;
      const pct = (v.percent == null ? "-" : (Number(v.percent).toFixed(6) + "%"));
      return `<tr><td>${p}</td><td>${pct}</td><td>${v.rank ?? "-"}</td></tr>`;
    }).join("");

    const capRows = periodOrder.map(p => {
      const v = s.segments.Capital[p];
      if (!v) return `<tr><td>${p}</td><td>-</td><td>-</td></tr>`;
      const pct = (v.percent == null ? "-" : (Number(v.percent).toFixed(6) + "%"));
      return `<tr><td>${p}</td><td>${pct}</td><td>${v.rank ?? "-"}</td></tr>`;
    }).join("");

    const logoHtml = logoUrl
      ? `<div class="cookie-project-logo has-img" style="background-image:url('${logoUrl}')"></div>`
      : `<div class="cookie-project-logo">${initials}</div>`;

    return `
      <div class="cookie-project-card">
        <div class="cookie-project-card-header">
          ${logoHtml}
          <div class="cookie-project-head-main">
            <div class="cookie-project-name">${s.project}</div>
            <div class="cookie-project-meta">
              ${s.handle} ¬∑ ${s.lang || "global"} ¬∑ Cookie Îû≠ÌÇπ ÏöîÏïΩ
            </div>
          </div>
        </div>
        <div class="cookie-project-card-body">
          <div class="cookie-project-segment">
            <div class="cookie-seg-title">Mindshare</div>
            <table class="muddha-seg-table">
              <thead><tr><th>Í∏∞Í∞Ñ</th><th>MS%</th><th>RANK</th></tr></thead>
              <tbody>${msRows}</tbody>
            </table>
          </div>
          <div class="cookie-project-segment">
            <div class="cookie-seg-title">Capital</div>
            <table class="muddha-seg-table">
              <thead><tr><th>Í∏∞Í∞Ñ</th><th>MS%</th><th>RANK</th></tr></thead>
              <tbody>${capRows}</tbody>
            </table>
          </div>
        </div>
      </div>
    `;
  }).join("");

  wrap.innerHTML = cardsHtml;
  if (labelEl){
    labelEl.textContent = "@" + handleNorm + " Í∏∞Ï§Ä Cookie ÌîÑÎ°úÏ†ùÌä∏ ÏöîÏïΩ Ïπ¥Îìú";
  }
}
async function renderCookieLeaderboard(handle){
  const tbody = document.getElementById("cookie-leaderboard-body");
  const labelEl = document.getElementById("cookie-handle-label");
  if (!tbody) return;

  let handleNorm = "";
  if (handle){
    handleNorm = cookieNormalizeHandle(handle);
  }

  if (!handleNorm){
    tbody.innerHTML = '<tr><td colspan="6" class="infofi-empty">Î®ºÏ†Ä ÏúÑÏóêÏÑú Ï°∞ÌöåÌï† @Ìï∏Îì§ÏùÑ ÏûÖÎ†•Ìï¥Ï§ò.</td></tr>';
    const cardsWrap = document.getElementById("cookie-project-cards");
    if (cardsWrap){
      cardsWrap.innerHTML = '<div class="infofi-empty">Î®ºÏ†Ä ÏúÑÏóêÏÑú Ï°∞ÌöåÌï† @Ìï∏Îì§ÏùÑ ÏûÖÎ†•Ìï¥Ï§ò.</div>';
    }
    if (labelEl) labelEl.textContent = "";
    return;
  }

  await cookieLoadBundle();
  if (!COOKIE_BUNDLE_LOADED){
    return;
  }

  const key = handleNorm;
  const listAll = COOKIE_INDEX[key] || [];
  // 1Ï∞® ÌïÑÌÑ∞: #200 Ïù¥ÎÇ¥ + 0% Ï¥àÍ≥ºÎßå
  let list = listAll.filter(e =>
    e &&
    e.rank != null &&
    e.rank <= 200 &&
    cookieSafeNumber(e.percent) !== null &&
    e.percent > 0
  );
  // ÎßåÏïΩ Ïù¥Î†áÍ≤å Ìï¥ÎèÑ ÏïÑÎ¨¥Í≤ÉÎèÑ Ïïà ÎÇòÏò§ÎäîÎç∞ raw Îç∞Ïù¥ÌÑ∞Îäî ÏûàÎã§Î©¥,
  // ÌïÑÌÑ∞Î•º ÌíÄÍ≥† raw Ï†ÑÏ≤¥Î•º Î≥¥Ïó¨Ï§ÄÎã§ (ÏòàÏô∏ ÏºÄÏù¥Ïä§Ïö©)
  if (!list.length && listAll.length){
    list = listAll.slice();
  }

  if (!list.length){
    tbody.innerHTML = '<tr><td colspan="6" class="infofi-empty">Ìï¥Îãπ Ìï∏Îì§Î°ú Ï∞æÏùÄ Cookie Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏñ¥ (#200 Ïù¥ÎÇ¥, 0% Ï†úÏô∏).</td></tr>';
    const cardsWrap = document.getElementById("cookie-project-cards");
    if (cardsWrap){
      cardsWrap.innerHTML = '<div class="infofi-empty">Ìï¥Îãπ Ìï∏Îì§Î°ú Ï∞æÏùÄ Cookie ÌîÑÎ°úÏ†ùÌä∏ Ïπ¥ÎìúÍ∞Ä ÏóÜÏñ¥ (#200 Ïù¥ÎÇ¥, 0% Ï†úÏô∏).</div>';
    }
    if (labelEl){
      labelEl.textContent = "@" + handleNorm + " Í∏∞Ï§Ä Cookie Îû≠ÌÇπ (Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå)";
    }
    return;
  }

  list.sort((a, b) => {
    if (a.period !== b.period){
      const order = { "7D": 0, "14D": 1, "30D": 2, "Total": 3 };
      const av = order[a.period] ?? 99;
      const bv = order[b.period] ?? 99;
      if (av !== bv) return av - bv;
    }
    if (a.type !== b.type){
      if (a.type === "Mindshare" && b.type !== "Mindshare") return -1;
      if (b.type === "Mindshare" && a.type !== "Mindshare") return 1;
    }
    if (a.rank != null && b.rank != null && a.rank !== b.rank){
      return a.rank - b.rank;
    }
    return (b.percent || 0) - (a.percent || 0);
  });

  const rowsHtml = list.map(e => {
    const rankText = e.rank != null ? e.rank : "-";
    const segment = e.type || "-";
    const windowLabel = e.period || "-";
    const percentText = (e.percent ?? 0) + "%";
    return `
      <tr>
        <td>${rankText}</td>
        <td>${e.project}</td>
        <td>${e.handle}</td>
        <td>${segment}</td>
        <td>${windowLabel}</td>
        <td>${percentText}</td>
      </tr>
    `;
  }).join("");

  tbody.innerHTML = rowsHtml;
  cookieRenderProjectCards(list, handleNorm);
}

function handleCookieSearch(){
  const input = document.getElementById("cookie-handle-input");
  if (!input){
    renderCookieLeaderboard();
    return;
  }
  let handle = (input.value || "").trim();
  if (!handle){
    const tbody = document.getElementById("cookie-leaderboard-body");
    if (tbody){
      tbody.innerHTML = '<tr><td colspan="6" class="infofi-empty">Î®ºÏ†Ä ÏúÑÏóêÏÑú Ï°∞ÌöåÌï† @Ìï∏Îì§ÏùÑ ÏûÖÎ†•Ìï¥Ï§ò.</td></tr>';
    }
    const cardsWrap = document.getElementById("cookie-project-cards");
    if (cardsWrap){
      cardsWrap.innerHTML = '<div class="infofi-empty">Î®ºÏ†Ä ÏúÑÏóêÏÑú Ï°∞ÌöåÌï† @Ìï∏Îì§ÏùÑ ÏûÖÎ†•Ìï¥Ï§ò.</div>';
    }
    const labelEl = document.getElementById("cookie-handle-label");
    if (labelEl) labelEl.textContent = "";
    return;
  }
  if (handle[0] !== "@") handle = "@" + handle;
  renderCookieLeaderboard(handle);
}
/* ===== ÏïºÌïë ÌîåÎûòÎÑà Î°úÏª¨ Ï†ÄÏû• / Î†åÎçîÎßÅ ===== */
const YAP_STORAGE_KEY = "mindshare_yapping_planner_v1";
let YAPS = [];

function loadYaps(){
  try{
    const raw = localStorage.getItem(YAP_STORAGE_KEY);
    if(!raw) return;
    const parsed = JSON.parse(raw);
    if(Array.isArray(parsed)) YAPS = parsed;
  }catch(e){
    console.warn("ÏïºÌïë ÌîåÎûòÎÑà Î°úÎìú Ïò§Î•ò", e);
  }
}

function saveYaps(){
  try{
    localStorage.setItem(YAP_STORAGE_KEY, JSON.stringify(YAPS));
  }catch(e){
    console.warn("ÏïºÌïë ÌîåÎûòÎÑà Ï†ÄÏû• Ïò§Î•ò", e);
  }
}

function renderYaps(){
  const wrap = document.getElementById("yap-list");
  if(!wrap) return;
  if(!YAPS.length){
    wrap.innerHTML = '<div class="yap-list-empty">Îì±Î°ùÎêú ÏïºÌïë Í≥ÑÌöçÏù¥ ÏóÜÏäµÎãàÎã§. ÏôºÏ™ΩÏóêÏÑú ÏÉà Í≥ÑÌöçÏùÑ Ï∂îÍ∞ÄÌï¥Ï§ò.</div>';
    return;
  }
  wrap.innerHTML = "";
  YAPS.forEach((yap, idx)=>{
    const div = document.createElement("div");
    div.className = "yap-item" + (yap.done ? " done" : "");
    div.innerHTML = `
      <input type="checkbox" data-idx="${idx}" ${yap.done ? "checked" : ""}>
      <div>
        <div style="font-weight:600;font-size:12px;">
          [${yap.type}] ${yap.kor || ""}${yap.kor && yap.project ? " / " : ""}${yap.project || ""}
        </div>
        <div class="yap-tags">
          ${yap.segment ? `<span class="yap-tag">Í≥ÑÏó¥: ${yap.segment}</span>` : ""}
          ${yap.frequency ? `<span class="yap-tag">Ï£ºÍ∏∞: ${yap.frequency}</span>` : ""}
          ${yap.reward ? `<span class="yap-tag">Î≥¥ÏÉÅ: ${yap.reward}</span>` : ""}
          ${yap.start ? `<span class="yap-tag">ÏãúÏûë: ${yap.start}</span>` : ""}
          ${yap.end ? `<span class="yap-tag">Ï¢ÖÎ£å: ${yap.end}</span>` : ""}
        </div>
        ${yap.memo ? `<div style="margin-top:4px;font-size:11px;">Î©îÎ™®: ${yap.memo}</div>` : ""}
      </div>
      <button class="yap-delete" data-del="${idx}">‚úï</button>
    `;
    wrap.appendChild(div);
  });

  wrap.querySelectorAll("input[type=checkbox]").forEach(chk=>{
    chk.addEventListener("change", e=>{
      const i = Number(e.target.dataset.idx);
      if(isNaN(i)) return;
      YAPS[i].done = !!e.target.checked;
      saveYaps();
      renderYaps();
    });
  });
  wrap.querySelectorAll(".yap-delete").forEach(btn=>{
    btn.addEventListener("click", e=>{
      const i = Number(e.target.dataset.del);
      if(isNaN(i)) return;
      YAPS.splice(i,1);
      saveYaps();
      renderYaps();
    });
  });
}

function setupYapForm(){
  const form = document.getElementById("yap-form");
  if(!form) return;
  form.addEventListener("submit", e=>{
    e.preventDefault();
    const kor   = document.getElementById("yap-kor").value.trim();
    const proj  = document.getElementById("yap-project").value.trim();
    const segment  = document.getElementById("yap-segment").value.trim();
    const type     = document.getElementById("yap-type").value;
    const freq     = document.getElementById("yap-frequency").value.trim();
    const reward   = document.getElementById("yap-reward").value.trim();
    const start    = document.getElementById("yap-start").value;
    const end      = document.getElementById("yap-end").value;
    const memo     = document.getElementById("yap-memo").value.trim();

    if(!kor && !proj){
      alert("ÏµúÏÜåÌïú ÌïúÍµ≠Î™Ö ÎòêÎäî ÌîÑÎ°úÏ†ùÌä∏Î™ÖÏùÄ ÏûÖÎ†•Ìï¥Ï§ò.");
      return;
    }

    YAPS.push({
      kor: kor,
      project: proj,
      segment,
      type,
      frequency: freq,
      reward,
      start,
      end,
      memo,
      done:false
    });
    saveYaps();
    renderYaps();
    form.reset();
  });
}

// Ï¥àÍ∏∞Ìôî
loadYaps();
setupYapForm();
renderYaps();

/* ÏÇ¨Ïù¥ÎìúÎ∞î Ï†ëÍ∏∞ / ÌéºÏπòÍ∏∞ */
const layout = document.querySelector(".layout");
const sidebarToggle = document.getElementById("sidebar-toggle");
sidebarToggle.addEventListener("click", () => {
  layout.classList.toggle("collapsed");
});
</script>
<script>

// ÌîÑÎ°úÏ†ùÌä∏Î≥Ñ Î°úÍ≥† URL Îß§Ìïë (ÏõêÌïòÎ©¥ Ïó¨Í∏∞ URL Ï±ÑÏõå ÎÑ£Í∏∞)

// ÌîÑÎ°úÏ†ùÌä∏Î≥Ñ X Ìï∏Îì§ Îß§Ìïë (X ÏïÑÎ∞îÌÉÄÎ•º Î°úÍ≥†Î°ú ÏûêÎèô ÏÇ¨Ïö©)
const INFOFI_PROJECT_X_HANDLES = {
  "MemeMax": "MemeMax_Fi",
  "Symphony": "symphonyio",
  "Kaito / Yapper": "KaitoAI_Labs",
  "Orderly": "OrderlyNetwork",
  "STBL": "stbldefi",
  "Theo": "TheoNetwork",
  "Sonic (L1)": "Sonic_onSui",
  "Tria": "useTria",
  "Superform": "superformxyz",
  "Glint Analytics": "GlintAnalytics",
  "Solv Protocol": "SolvProtocol",
  "Pacifica": "pacifica_fi",
  "LayerBank": "LayerBankFi",
  "Rayls": "RaylsLabs",
  "Velora": "VeloraDEX",
  "Antix": "antix_in",
  "Almanak": "AlmanakFi",
  "BOB (Build on Bit‚Ä¶)": "build_on_bob",
  "TEN": "tenprotocol",
  "vooi": "vooi_io"
};

const INFOFI_PROJECT_LOGOS = {
  // ÏòàÏãú) "MemeMax": "https://.../mememax-logo.png",
  //       "Symphony": "https://.../symphony-logo.png"
};

// ===== InfoFi Î¶¨ÎçîÎ≥¥Îìú Ïä§ÎÉÖÏÉ∑ DB =====
const INFOFI_SNAPSHOTS = [
  {
    handle: "bud_dha__",
    project: "MemeMax",
    segment: "Creator",
    eco: "MemeMax",
    window: "7D",
    rank: 93,
    mindshare: 0.2800,
    last: 0.2700,
    firstPercent: 2.03
  },
  {
    handle: "bud_dha__",
    project: "Symphony",
    segment: "Community",
    eco: "Symphony",
    window: "30D",
    rank: 7,
    mindshare: 8.20,
    last: 0.01,
    firstPercent: 8.20
  },
  {
    handle: "bud_dha__",
    project: "Symphony",
    segment: "Community",
    eco: "Symphony",
    window: "3M",
    rank: 7,
    mindshare: 2.90,
    last: 0.06,
    firstPercent: 2.90
  },
  {
    handle: "bud_dha__",
    project: "Symphony",
    segment: "Community",
    eco: "Symphony",
    window: "6M",
    rank: 10,
    mindshare: 1.40,
    last: 0.01,
    firstPercent: 1.40
  }
  // TODO: Ïó¨Í∏∞ ÏïÑÎûòÎ°ú Îã§Î•∏ Ìï∏Îì§/ÌîÑÎ°úÏ†ùÌä∏Îì§ Í≥ÑÏÜç Ï∂îÍ∞ÄÌïòÎ©¥ Îê®
];

// ===== InfoFi Î¶¨ÎçîÎ≥¥Îìú Í≤ÄÏÉâ =====
function normalizeHandle(raw){
  if(!raw) return "";
  return raw.trim().replace(/^@/, "").toLowerCase();
}

function handleInfofiSearch(){
  const input = document.getElementById("infofi-handle-input");
  const label = document.getElementById("infofi-handle-label");
  const wrap  = document.getElementById("infofi-result-wrap");
  if(!input || !wrap) return;

  const h = normalizeHandle(input.value);
  if(!h){
    label.textContent = "";
    wrap.innerHTML = '<div class="infofi-empty">Î®ºÏ†Ä @Ìï∏Îì§ÏùÑ ÏûÖÎ†•Ìï¥ Ï§ò.</div>';
    return;
  }

  // Í∞ôÏùÄ Ìï∏Îì§Î°ú Kaito Î¶¨ÎçîÎ≥¥ÎìúÎèÑ Ìï®Íªò Ï°∞Ìöå
  if (typeof fetchKaitoLeaderboard === "function") {
    fetchKaitoLeaderboard();
  }

  const rows = INFOFI_SNAPSHOTS.filter(r => normalizeHandle(r.handle) === h);
  label.innerHTML = `Í≤ÄÏÉâ Ìï∏Îì§: <b>@${h}</b>`;

  // Kaito Î¶¨ÎçîÎ≥¥ÎìúÎèÑ Ìï®Íªò Ï°∞Ìöå
  try {
    // kaito Ï†ÑÏö© ÏûÖÎ†•ÏùÄ Ï†úÍ±∞Îê®
    if (kaitoInput) {
      kaitoInput.value = "@" + h;
    }
    if (typeof fetchKaitoLeaderboard === "function") {
      fetchKaitoLeaderboard();
    }
  } catch (e) {
    console.error("Kaito auto fetch error:", e);
  }


  if(!rows.length){
    wrap.innerHTML = '';
    return;
  }

  // ÌîÑÎ°úÏ†ùÌä∏/ÏóêÏΩî Í∏∞Ï§ÄÏúºÎ°ú Í∑∏Î£πÌïë
  const groups = {};
  rows.forEach(r => {
    const key = (r.eco || r.project) + "|" + r.segment;
    if(!groups[key]){
      groups[key] = {
        project: r.project,
        eco: r.eco || "",
        segment: r.segment || "",
        rows: []
      };
    }
    groups[key].rows.push(r);
  });

  
  
  let html = "";
  Object.values(groups).forEach(g => {
    // Í∏∞Í∞Ñ Ï†ïÎ†¨
    g.rows.sort((a,b)=>{
      const order = ["24H","7D","30D","90D","3M","6M","1Y"];
      const ia = order.indexOf(a.window);
      const ib = order.indexOf(b.window);
      return (ia === -1 ? 999 : ia) - (ib === -1 ? 999 : ib);
    });

    // Í∞Å Í∏∞Í∞ÑÎ≥Ñ Ìñâ HTML
    let rowsHtml = "";
    g.rows.forEach(r => {
      const win = r.window || "";
      const rank = r.rank != null ? r.rank : "";
      const ms = (r.mindshare ?? 0).toFixed(4);
      const last = (r.last ?? 0).toFixed(4);
      const firstP = (r.firstPercent ?? 0).toFixed(4);

      rowsHtml += '<tr>'
        + '<td>' + win + '</td>'
        + '<td>#' + rank + '</td>'
        + '<td>' + ms + '%</td>'
        + '<td>' + last + '%</td>'
        + '<td>' + firstP + '%</td>'
        + '</tr>';
    });

    const eco = g.eco || "";
    const seg = g.segment || "";
    const metaText = eco + (eco && seg ? " ¬∑ " : "") + seg;

    // Î°úÍ≥†: Ïö∞ÏÑ† ÏàúÏúÑ
    // 1) INFOFI_PROJECT_LOGOSÏóê ÏßÅÏ†ë ÏßÄÏ†ïÎêú URL
    // 2) INFOFI_PROJECT_X_HANDLESÏóê Îì±Î°ùÎêú X Ìï∏Îì§Ïùò ÏïÑÎ∞îÌÉÄ (unavatar.io)
    // 3) Îëò Îã§ ÏóÜÏúºÎ©¥ ÌîÑÎ°úÏ†ùÌä∏ Ïù¥Î¶Ñ Ïù¥ÎãàÏÖú ÏõêÌòï Î±ÉÏßÄ
    const xHandles = (typeof INFOFI_PROJECT_X_HANDLES === "object") ? INFOFI_PROJECT_X_HANDLES : {};
    const logos = (typeof INFOFI_PROJECT_LOGOS === "object") ? INFOFI_PROJECT_LOGOS : {};
    const xHandle = xHandles[g.project] || "";
    let logoUrl = logos[g.project] || "";
    if (!logoUrl && xHandle) {
      logoUrl = "https://unavatar.io/twitter/" + encodeURIComponent(xHandle);
    }
    const initial = (g.project || "?").charAt(0).toUpperCase();
    let logoHtml = "";
    if (logoUrl) {
      logoHtml = '<div class="infofi-logo"><img src="' + logoUrl + '" alt="' + g.project + ' logo"></div>';
    } else {
      logoHtml = '<div class="infofi-logo">' + initial + '</div>';
    }

    html += ''
      + '<div class="infofi-project-card">'
        + '<div class="infofi-project-header">'
          + '<div class="infofi-header-left">'
            + logoHtml
            + '<div class="infofi-project-main">'
              + '<div class="infofi-project-name">' + g.project + '</div>'
              + '<div class="infofi-project-meta">' + metaText + '</div>'
            + '</div>'
          + '</div>'
          + '<div class="infofi-badge">ÌîÑÎ°úÏ†ùÌä∏ Î¶¨ÎçîÎ≥¥Îìú Ïä§ÎÉÖÏÉ∑</div>'
        + '</div>'
        + '<div class="infofi-table-wrap">'
          + '<table class="infofi-table">'
            + '<thead>'
              + '<tr>'
                + '<th>Í∏∞Í∞Ñ</th>'
                + '<th>Rank</th>'
                + '<th>Mindshare</th>'
                + '<th>ÎßàÏßÄÎßâ Ïä§ÎÉÖÏÉ∑</th>'
                + '<th>1ÏúÑ ÎåÄÎπÑ</th>'
              + '</tr>'
            + '</thead>'
            + '<tbody>'
              + rowsHtml +
            '</tbody>'
          + '</table>'
        + '</div>'
      + '</div>';
  });

  wrap.innerHTML = html;


}

// Enter ÌÇ§Î°ú Í≤ÄÏÉâ
document.addEventListener("DOMContentLoaded", ()=>{
  const input = document.getElementById("infofi-handle-input");
  if(input){
    input.addEventListener("keydown", e=>{
      if(e.key === "Enter"){
        e.preventDefault();
        handleInfofiSearch();
      }
    });
  }
});
</script>
<script>
    const KAITOPROXY_URL = "https://ejqrnapdwblbqvnperid.supabase.co/functions/v1/kaito-proxy";

    const KAITO_TOPIC_TWITTER_HANDLES = {
  "Aptos": "Aptos",
  "Beldex": "BeldexCoin",
  "Berachain": "berachain",
  "Camp Network": "campnetworkxyz",
  "Ethereum": "ethereum",
  "Fogo": "fogo",
  "Injective": "injective",
  "Irys": "irys_xyz",
  "Kaia": "KaiaChain",
  "MANTRA": "MANTRA_Chain",
  "Mavryk": "MavrykNetwork",
  "Mitosis": "MitosisOrg",
  "Monad": "monad",
  "Movement": "movementlabsxyz",
  "Near": "NEARProtocol",
  "PEAQ": "peaq",
  "Polkadot": "Polkadot",
  "Sei": "SeiNetwork",
  "Somnia": "Somnia_Network",
  "Sonic": "SonicLabs",
  "S": "SonicLabs",
  "Story": "StoryProtocol",
  "XION": "burnt_xion",
  "CreatorBid": "CreatorBid",
  "INFINIT": "Infinit_Labs",
  "Newton": "MagicNewton",
  "Surf": "SurfAI",
  "Symphony": "symphonyio",
  "Talus": "Talus_Labs",
  "Theoriq": "TheoriqAI",
  "Virtuals Protocol": "virtuals_io",
  "Warden Protocol": "wardenprotocol",
  "Wayfinder": "AIWayfinder",
  "ANIME": "animecoin",
  "Boop": "boopdotfun",
  "Doodles": "doodles",
  "MemeX": "MemeX_MRC20",
  "Moonbirds": "moonbirds",
  "PENGU": "pudgypenguins",
  "Corn": "use_corn",
  "GOAT Network": "GOATRollup",
  "Lombard": "Lombard_Finance",
  "Portal to BTC": "PortaltoBitcoin",
  "SatLayer": "satlayer",
  "Openmind": "openmind_agi",
  "Arbitrum": "arbitrum",
  "Katana": "katana",
  "Mantle": "0xMantle",
  "MegaETH": "megaeth",
  "Polygon": "0xPolygon",
  "SOON": "soon_svm",
  "Falcon Finance": "FalconStable",
  "Frax": "fraxfinance",
  "Huma": "humafinance",
  "MoreMarkets": "moremarketsxyz",
  "Multipli": "multiplifi",
  "Noble": "noble_xyz",
  "Orderly": "OrderlyNetwork",
  "Pyth": "PythNetwork",
  "Soul Protocol": "0xSoulProtocol",
  "STBL": "stbl_official",
  "Turtle Club": "turtleclubhouse",
  "Walrus": "WalrusProtocol",
  "Boundless": "boundless_xyz",
  "Brevis": "brevis_zk",
  "Cysic": "cysic_xyz",
  "Miden": "0xMiden",
  "Starknet": "Starknet",
  "Succinct": "SuccinctLabs",
  "Zcash": "Zcash",
  "zkPass": "zkPass",
  "Anoma": "anoma",
  "Bless": "theblessnetwork",
  "Bybit TradFi": "Bybit_Official",
  "Humanity Protocol": "Humanityprot",
  "Integra": "integra_layer",
  "Multibank": "multibank_io",
  "Thrive Protocol": "thriveprotocol",
  "ApeX": "OfficialApeXdex",
  "Bluefin": "bluefinapp",
  "dYdX": "dYdX",
  "Flipster": "flipster_io",
  "MemeMax": "MemeMax_Fi",
  "Momentum": "MMTFinance",
  "PARADEX": "paradex",
  "Kaito": "KaitoAI",
  "OG": "0G_labs",
  "Allora": "AlloraNetwork",
  "Billions Network": "billions_ntwk",
  "Edgen": "EdgenTech",
  "EverlynAI": "everlyn_ai",
  "IQ": "IQAIcom",
  "Kindred": "Kindred_AI",
  "Mira Network": "miranetwork",
  "Novastro": "Novastro_xyz",
  "NYT": "Novastro_xyz",
  "Noya.ai": "NetworkNoya",
  "OpenLedger": "OpenledgerHQ",
  "PiP World": "pip_world",
  "PlayAI": "playAInetwork",
  "Sapien": "JoinSapien",
  "Sentient": "SentientAGI",
  "UXLINK": "UXLINKofficial",
  "Tria": "useTria",
  "Anichess": "AnichessGame",
  "Bitdealer": "bitdealernet",
  "Defi App": "defiapp",
  "Hana": "HanaNetwork",
  "InfineX": "infinex",
  "Lumiterra": "LumiterraGame",
  "MapleStory Universe": "MaplestoryU",
  "Metawin": "MetaWin",
  "Parti": "jointheparti",
  "Puffpaw": "puffpaw",
  "Rainbow": "rainbowdotme",
  "Sidekick": "Sidekick_Labs",
  "SIXR Cricket": "SIXR_cricket",
  "Sophon": "Sophon",
  "Vultisig": "vultisig",
  "YEET": "yeet",
  "Caldera": "Calderaxyz",
  "Initia": "initia",
  "Skate": "skate_chain",
  "Union": "union_build",
  "KAIO": "KAIO_xyz",
  "Theo": "Theo_Network",
  "THEOTHEO": "Theo_Network"
};


async function fetchKaitoLeaderboard() {
  const input = document.getElementById("infofi-handle-input");
  const resultDiv = document.getElementById("kaito-result");

  if (!input || !resultDiv) {
    alert("ÏûÖÎ†• Ïπ∏ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.");
    return;
  }

  let handle = (input.value || "").trim();
  if (!handle) {
    if (resultDiv) resultDiv.textContent = "";
    return;
  }
  if (handle.startsWith("@")) {
    handle = handle.slice(1);
  }

  resultDiv.textContent = "Í≥∞Ìà¨(Kaito)ÏóêÏÑú Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...";

  try {
    const resp = await fetch(
      KAITOPROXY_URL + "?username=" + encodeURIComponent(handle),
      { method: "GET" }
    );

    if (!resp.ok) {
      resultDiv.textContent = "ÌîÑÎ°ùÏãú ÏùëÎãµ Ïò§Î•ò: " + resp.status;
      return;
    }

    const json = await resp.json();
    console.log("Kaito proxy raw:", json);

    if (!json || !Array.isArray(json.data) || json.data.length === 0) {
      resultDiv.textContent = "Î¶¨ÎçîÎ≥¥Îìú Îç∞Ïù¥ÌÑ∞Î•º Ï∞æÏßÄ Î™ªÌñàÏäµÎãàÎã§.";
      return;
    }

    // 7D / 30D / 3M Îßå ÏÇ¨Ïö©, topic_id Î≥ÑÎ°ú Í∑∏Î£πÌïë
    const allowed = ["7D", "30D", "3M"];
    const byTopic = {};
    json.data.forEach(item => {
      const dur = item.duration;
      if (!allowed.includes(dur)) return;
      const topic = item.topic_id || "UNKNOWN";
      if (!byTopic[topic]) byTopic[topic] = [];
      byTopic[topic].push(item);
    });

    const topicNames = Object.keys(byTopic);
    if (!topicNames.length) {
      resultDiv.textContent = "7D / 30D / 3M Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.";
      return;
    }

    // topic Ïù¥Î¶Ñ ÎåÄÏÜåÎ¨∏Ïûê Î¨¥ÏãúÌïòÍ≥† Îß§Ìïë Ï∞æÍ∏∞
    function findHandleForTopic(topic) {
      const t = (topic || "").toLowerCase();
      for (const key in KAITO_TOPIC_TWITTER_HANDLES) {
        if (key.toLowerCase() === t) return KAITO_TOPIC_TWITTER_HANDLES[key];
      }
      return "";
    }

    const durationOrder = ["7D", "30D", "3M"];
    function durationIndex(d) {
      const i = durationOrder.indexOf(d);
      return i === -1 ? 999 : i;
    }
    function rankValue(r) {
      if (typeof r === "number") return r;
      const n = parseInt(r, 10);
      return isNaN(n) ? 999999 : n;
    }

    
  const PROJECT_DISPLAY_NAME_OVERRIDES = {
  "S": "Sonic",
  "THEOTHEO": "Theo",
  "NYT": "Novastro"
};

const cardsHtml = topicNames.map(topic => {
      const displayTopic = PROJECT_DISPLAY_NAME_OVERRIDES[topic] || topic;
      const rows = byTopic[topic].slice().sort((a, b) => {
        const d = durationIndex(a.duration) - durationIndex(b.duration);
        if (d !== 0) return d;
        return rankValue(a.rank) - rankValue(b.rank);
      });

      const topicHandle = findHandleForTopic(topic);
      let logoUrl = "";
      if (topicHandle) {
        logoUrl = "https://unavatar.io/twitter/" + encodeURIComponent(topicHandle);
      }

      const initial = (topic || "?").charAt(0).toUpperCase();
      const logoHtml = logoUrl
        ? '<div style="width:32px;height:32px;border-radius:50%;overflow:hidden;display:flex;align-items:center;justify-content:center;background:#111827;margin-right:10px;"><img src="'
          + logoUrl
          + '" alt="' + topic + ' logo" style="width:100%;height:100%;object-fit:cover;"></div>'
        : '<div style="width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:#0f172a;color:#e5e7eb;font-size:14px;font-weight:700;margin-right:10px;">'
          + initial
          + '</div>';

      const rowsHtml = rows.map(item => {
        const dur = item.duration || "-";
        const rank = item.rank ?? "-";
        const rawTier = item.tier || "-";
        const tier = (rawTier.toLowerCase() === "tier2") ? "Wider Community"
                    : (rawTier.toLowerCase() === "tier1") ? "Creator"
                    : rawTier;
        const mindshare = item.mindshare ?? "-";
        return `
          <tr>
            <td style="padding:6px 8px;border-bottom:1px solid rgba(55,65,81,0.7);text-align:center;">${dur}</td>
            <td style="padding:6px 8px;border-bottom:1px solid rgba(55,65,81,0.7);text-align:center;">#${rank}</td>
            <td style="padding:6px 8px;border-bottom:1px solid rgba(55,65,81,0.7);text-align:center;">${tier}</td>
            <td style="padding:6px 8px;border-bottom:1px solid rgba(55,65,81,0.7);text-align:right;">${mindshare}</td>
          </tr>
        `;
      }).join("");

      return `
        <div style="
          margin-top:10px;
          padding:14px 16px;
          border-radius:16px;
          background:rgba(15,23,42,0.9);
          border:1px solid rgba(148,163,184,0.45);
          font-size:13px;
          line-height:1.6;
          color:#e5e7eb;
        ">
          <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;margin-bottom:10px;">
            <div style="display:flex;align-items:center;">
              ${logoHtml}
              <div>
                <div style="font-weight:700;font-size:13px;">${displayTopic}</div>
                <div style="font-size:12px;opacity:0.8;">@${handle}</div>
              </div>
            </div>
          </div>
          <div style="border-radius:12px;overflow:hidden;border:1px solid rgba(55,65,81,0.9);">
            <table style="width:100%;border-collapse:collapse;font-size:12px;">
              <thead>
                <tr style="background:rgba(31,41,55,0.95);">
                  <th style="padding:6px 8px;border-bottom:1px solid rgba(55,65,81,1);text-align:center;">Í∏∞Í∞Ñ</th>
                  <th style="padding:6px 8px;border-bottom:1px solid rgba(55,65,81,1);text-align:center;">Rank</th>
                  <th style="padding:6px 8px;border-bottom:1px solid rgba(55,65,81,1);text-align:center;">Tier</th>
                  <th style="padding:6px 8px;border-bottom:1px solid rgba(55,65,81,1);text-align:right;">Mindshare</th>
                </tr>
              </thead>
              <tbody>
                ${rowsHtml}
              </tbody>
            </table>
          </div>
        </div>
      `;
    }).join("");

    resultDiv.innerHTML = cardsHtml;
  } catch (err) {
    console.error(err);
    resultDiv.textContent = "ÏöîÏ≤≠ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.";
  }
}


// ÏóîÌÑ∞Î°úÎèÑ Ï°∞Ìöå
    window.addEventListener("DOMContentLoaded", function () {
      const input = document.getElementById("kaito-handle-input");
      if (input) {
        input.addEventListener("keydown", function (e) {
          if (e.key === "Enter") {
            fetchKaitoLeaderboard();
          }
        });
      }
    });
  

/* ========== "ÎßàÏßÄÎßâ CSVÎ°ú Ï°∞ÌöåÌïòÍ∏∞" Î≤ÑÌäº ========== */
document.addEventListener("DOMContentLoaded", () => {
  const btn = document.getElementById("btn-last-csv");
  updateLastSnapshotUI();
  if (!btn) return;
  btn.addEventListener("click", (e) => {
    e.preventDefault();
    restoreLastAnalysis();
  });
});
</script>
<script>
(function(){
  const PROFILE_KEY = "mindshare_profile_v1";

  function loadProfile(){
    try{
      const raw = localStorage.getItem(PROFILE_KEY);
      if(!raw) return { nickname: "Í≤åÏä§Ìä∏", handle: "" };
      const obj = JSON.parse(raw);
      if(!obj || typeof obj !== "object") return { nickname: "Í≤åÏä§Ìä∏", handle: "" };
      return {
        nickname: obj.nickname || "Í≤åÏä§Ìä∏",
        handle: (obj.handle || "").replace(/^@/,"")
      };
    }catch(e){
      return { nickname: "Í≤åÏä§Ìä∏", handle: "" };
    }
  }

  function saveProfile(p){
    try{
      localStorage.setItem(PROFILE_KEY, JSON.stringify({
        nickname: p.nickname || "Í≤åÏä§Ìä∏",
        handle: (p.handle || "").replace(/^@/,"")
      }));
    }catch(e){
      console.warn("Failed to save profile", e);
    }
  }

  function applyProfile(){
    const p = loadProfile();
    const nameEl   = document.getElementById("side-username");
    const linkEl   = document.getElementById("side-handle-link");
    const avatarEl = document.getElementById("side-avatar-img");

    if(nameEl){
      nameEl.textContent = p.nickname || "Í≤åÏä§Ìä∏";
    }

    if(linkEl){
      const handle = (p.handle || "").replace(/^@/,"");
      if(handle){
        linkEl.textContent = "@" + handle;
        linkEl.href = "https://twitter.com/" + handle;
      }else{
        linkEl.textContent = "@ÏùµÎ™Ö";
        linkEl.href = "https://twitter.com";
      }
    }

    if(avatarEl){
      const handle = (p.handle || "").replace(/^@/,"");
      if(handle){
        avatarEl.src = "https://unavatar.io/twitter/" + encodeURIComponent(handle);
      }else{
        avatarEl.src = "https://unavatar.io/twitter/bud_dha__";
      }
    }
  }

  function openProfilePrompt(){
    const current = loadProfile();
    const nick = window.prompt("ÎåÄÏãúÎ≥¥ÎìúÏóê ÌëúÏãúÌï† ÎãâÎÑ§ÏûÑÏùÑ Ï†ÅÏñ¥Ï§ò (Ïòà: MUDDHA, buddha Îì±)", current.nickname || "");
    if(nick === null) return; // Ï∑®ÏÜå
    const trimmedNick = nick.trim();

    const handle = window.prompt("Î∂ÑÏÑùÌï† X Ìï∏Îì§ÏùÑ Ï†ÅÏñ¥Ï§ò (@ ÏóÜÏù¥, Ïòà: bud_dha__ )\nÍ±¥ÎÑàÎõ∞Í≥† Ïã∂ÏúºÎ©¥ Í∑∏ÎÉ• ÎπàÏπ∏ÏúºÎ°ú ÎëêÍ≥† ÌôïÏù∏ ÎàåÎü¨.", current.handle || "");
    if(handle === null) return; // Ï∑®ÏÜå Ïú†ÏßÄ
    const cleanHandle = (handle || "").trim().replace(/^@/,"");

    const profile = {
      nickname: trimmedNick || "Í≤åÏä§Ìä∏",
      handle: cleanHandle
    };
    saveProfile(profile);
    applyProfile();
  }

  function ensureNickname(){
    const p = loadProfile();
    if(p.nickname && p.nickname !== "Í≤åÏä§Ìä∏"){
      return p;
    }
    const ok = window.confirm("ÏùµÎ™Ö ÎãâÎÑ§ÏûÑÏùÑ Î®ºÏ†Ä ÏÑ§Ï†ïÌï†Îûò? (ÌûàÏä§ÌÜ†Î¶¨/Î¶¨ÎçîÎ≥¥Îìú Ï†ÄÏû•Ïóê ÏÇ¨Ïö©Îèº)");
    if(!ok) return p;
    openProfilePrompt();
    return loadProfile();
  }

  // Ï†ÑÏó≠ÏóêÏÑú Ïì∏ Ïàò ÏûàÍ≤å ÎÖ∏Ï∂ú (ÌïÑÏöîÌïòÎ©¥ Îã§Î•∏ Ìï®ÏàòÏóêÏÑú ÏÇ¨Ïö©)
  window.mindshareProfile = {
    load: loadProfile,
    save: saveProfile,
    apply: applyProfile,
    ensure: ensureNickname,
    openPrompt: openProfilePrompt
  };

  document.addEventListener("DOMContentLoaded", function(){
    applyProfile();

    const btn = document.getElementById("nickname-btn");
    if(btn){
      btn.addEventListener("click", function(e){
        e.preventDefault();
        openProfilePrompt();
      });
    }

    // Î¶¨ÎçîÎ≥¥Îìú Ï†ÄÏû• Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú, ÎãâÎÑ§ÏûÑ Î®ºÏ†Ä Ïú†ÎèÑ
    const leaderSaveBtn = document.getElementById("leader-save-btn");
    if(leaderSaveBtn){
      leaderSaveBtn.addEventListener("click", function(){
        ensureNickname();
      }, { capture: true });
    }
  });
})();
</script>
<script>
document.addEventListener("DOMContentLoaded", function(){
  const csvInput = document.getElementById("csvInput");
  if(!csvInput) return;
  csvInput.addEventListener("change", function(e){
    const file = e.target.files[0];
    if(!file) return;
    const fr = new FileReader();
    fr.onload = function(ev){
      const csvText = ev.target.result || "";
      const subEl = document.getElementById("csv-server-top5-sub");
      const bodyEl = document.getElementById("csv-server-top5-body");
      if(subEl) subEl.textContent = "ÏÑúÎ≤ÑÎ°ú Î∂ÑÏÑù ÏöîÏ≤≠ Ï§ë...";
      if(bodyEl) bodyEl.innerHTML = "<div class='empty'>ÏöîÏ≤≠ Ï§ë...</div>";
      // load profile
      let nickname="Í≤åÏä§Ìä∏", handle="";
      try{
        if(window.mindshareProfile){
          const p=window.mindshareProfile.load();
          nickname=p.nickname||nickname;
          handle=(p.handle||"").replace(/^@/,"");
        }
      }catch(e){}
      fetch("http://localhost:4000/analyze-csv", {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({ csvText, nickname, handle })
      })
      .then(r=>r.json().catch(()=>({})))
      .then(data=>{
        let root=data;
        if(root && root.result) root=root.result;
        let top5=[];
        if(root){
          if(Array.isArray(root.top5)) top5=root.top5;
          if(!top5.length && root.projects){
            top5=Object.entries(root.projects)
              .sort((a,b)=>b[1]-a[1])
              .slice(0,5)
              .map(([name,count])=>({name,count}));
          }
          if(!top5.length && root.projectCounts){
            top5=Object.entries(root.projectCounts)
              .sort((a,b)=>b[1]-a[1])
              .slice(0,5)
              .map(([name,count])=>({name,count}));
          }
        }
        if(!top5.length){
          if(subEl) subEl.textContent="ÏÑúÎ≤ÑÏóêÏÑú Top5Î•º Ï∞æÏßÄ Î™ªÌñàÏäµÎãàÎã§.";
          if(bodyEl) bodyEl.textContent="ÏùëÎãµ: "+JSON.stringify(data);
          return;
        }
        if(subEl) subEl.textContent="ÏÑúÎ≤Ñ Í∏∞Ï§Ä Top5 Í≤∞Í≥º";
        if(bodyEl){
          bodyEl.innerHTML = top5.map(item=>
            "<div>"+item.name+" ‚Äî "+item.count+"</div>"
          ).join("");
        }
      })
      .catch(err=>{
        if(subEl) subEl.textContent="ÏÑúÎ≤Ñ ÌÜµÏã† Ïò§Î•ò";
        if(bodyEl) bodyEl.textContent=err;
      });
    };
    fr.readAsText(file);
  });
});
</script>
<script>

// Supabase Auth UI helpers
function updateAuthUI(user){
  const statusEl   = document.getElementById("auth-status");
  const loginBtn   = document.getElementById("auth-login-btn");
  const logoutBtn  = document.getElementById("auth-logout-btn");
  const sideName   = document.getElementById("side-username");
  const sideHandle = document.getElementById("side-handle-link");
  const avatarImg  = document.getElementById("side-avatar-img");

  if (!statusEl || !loginBtn || !logoutBtn) return;

  if (user){
    const email = user.email || "";
    const shortId = email ? email.split("@")[0] : "ÌöåÏõê";

    // ÏÇ¨Ïù¥Îìú Ïπ¥Îìú ÏÉÅÌÉú ÌÖçÏä§Ìä∏
    statusEl.textContent = "Î°úÍ∑∏Ïù∏Îê®";

    // Î≤ÑÌäº ÌÜ†Í∏Ä
    loginBtn.style.display = "none";
    logoutBtn.style.display = "inline-flex";

    // ÏÇ¨Ïù¥ÎìúÎ∞î ÌîÑÎ°úÌïÑÏóê Î°úÍ∑∏Ïù∏ Ï†ïÎ≥¥ Î∞òÏòÅ
    if (sideName){
      sideName.textContent = shortId;
    }
    if (sideHandle){
      sideHandle.textContent = email ? email : "Î°úÍ∑∏Ïù∏ Í≥ÑÏ†ï";
      sideHandle.href = "javascript:void(0)";
    }
    if (avatarImg){
      // Î°úÍ∑∏Ïù∏ Í≥ÑÏ†ïÏö© Ïã¨Ìîå ÏïÑÎ∞îÌÉÄ (Ïù¥Î©îÏùº ÏïûÎ∂ÄÎ∂Ñ Í∏∞Ï§Ä)
      const seed = encodeURIComponent(shortId || "mindshare-user");
      avatarImg.src = "https://unavatar.io/github/" + seed;
    }
  } else {
    // Î°úÍ∑∏ÏïÑÏõÉ/ÎπÑÎ°úÍ∑∏Ïù∏ ÏÉÅÌÉú
    statusEl.textContent = "Î°úÍ∑∏Ïù∏ Ïïà Îê®";
    loginBtn.style.display = "inline-flex";
    logoutBtn.style.display = "none";

    if (sideName){
      sideName.textContent = "Í≤åÏä§Ìä∏";
    }
    if (sideHandle){
      sideHandle.textContent = "@ÏùµÎ™Ö";
      sideHandle.href = "https://twitter.com";
    }
    if (avatarImg){
      avatarImg.src = "https://unavatar.io/twitter/bud_dha__";
    }
  }
}

async function initSupabaseAuth(){
  if (!supabaseClient) return;

  // ÌòÑÏû¨ Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú Î∞òÏòÅ
  try{
    const { data: { user }, error } = await supabaseClient.auth.getUser();
    if (error) {
      console.warn("Ï¥àÍ∏∞ ÏÇ¨Ïö©Ïûê Ï°∞Ìöå Ïò§Î•ò:", error.message);
    }
    updateAuthUI(user || null);
  } catch (err){
    console.error("initSupabaseAuth Ïò§Î•ò:", err);
  }

  const loginBtn   = document.getElementById("auth-login-btn");
  const logoutBtn  = document.getElementById("auth-logout-btn");
  const overlay    = document.getElementById("auth-overlay");
  const form       = document.getElementById("auth-form");
  const emailInput = document.getElementById("auth-email");
  const pwInput    = document.getElementById("auth-password");
  const closeBtn   = document.getElementById("auth-close-btn");

  function showAuthPanel(){
    if (!overlay) return;
    overlay.classList.add("visible");
    if (emailInput){
      setTimeout(()=>emailInput.focus(), 50);
    }
  }
  function hideAuthPanel(){
    if (!overlay) return;
    overlay.classList.remove("visible");
    if (form){
      form.reset();
    }
  }

  if (loginBtn){
    loginBtn.addEventListener("click", (e) => {
      e.preventDefault();
      showAuthPanel();
    });
  }

  if (closeBtn){
    closeBtn.addEventListener("click", (e) => {
      e.preventDefault();
      hideAuthPanel();
    });
  }

  if (overlay){
    overlay.addEventListener("click", (e) => {
      if (e.target === overlay){
        hideAuthPanel();
      }
    });
  }

  // Ïù¥Î©îÏùº Î°úÍ∑∏Ïù∏ / ÌöåÏõêÍ∞ÄÏûÖ Î™®Îìú Ï†ÑÌôò
  let currentAuthMode = "login";
  const loginTab  = document.getElementById("auth-tab-login");
  const signupTab = document.getElementById("auth-tab-signup");
  const modeLabel = document.getElementById("auth-mode-label");
  const submitBtn = document.getElementById("auth-submit-btn");
  const forgotBtn = document.getElementById("auth-forgot-password");

  function setAuthMode(mode){
    currentAuthMode = mode;
    if (modeLabel){
      modeLabel.textContent = (mode === "login") ? "Ïù¥Î©îÏùº Î°úÍ∑∏Ïù∏" : "ÏÉà Í≥ÑÏ†ï ÎßåÎì§Í∏∞";
    }
    if (submitBtn){
      submitBtn.textContent = (mode === "login") ? "Ïù¥Î©îÏùºÎ°ú Î°úÍ∑∏Ïù∏" : "Ïù¥ Ï†ïÎ≥¥Î°ú ÌöåÏõêÍ∞ÄÏûÖ";
    }
    if (loginTab && signupTab){
      if (mode === "login"){
        loginTab.classList.add("active");
        signupTab.classList.remove("active");
      } else {
        signupTab.classList.add("active");
        loginTab.classList.remove("active");
      }
    }
  }

  if (loginTab){
    loginTab.addEventListener("click", () => setAuthMode("login"));
  }
  if (signupTab){
    signupTab.addEventListener("click", () => setAuthMode("signup"));
  }
  // Ï¥àÍ∏∞ Î™®Îìú
  setAuthMode("login");

  if (forgotBtn){
    forgotBtn.addEventListener("click", () => {
      alert("ÌòÑÏû¨Îäî ÌÖåÏä§Ìä∏Ïö© Î°úÍ∑∏Ïù∏Ïù¥Îùº ÎπÑÎ∞ÄÎ≤àÌò∏ Ï∞æÍ∏∞ Í∏∞Îä•Ïù¥ Îî∞Î°ú ÏóÜÏñ¥Ïöî.\nÏù¥Î©îÏùºÏùÑ ÏûäÏñ¥Î≤ÑÎ†∏Îã§Î©¥ ÏÉà Ïù¥Î©îÏùºÎ°ú ÏÉà Í≥ÑÏ†ïÏùÑ ÎßåÎì§Ïñ¥ÏÑú ÏÇ¨Ïö©Ìï¥ Ï£ºÏÑ∏Ïöî.");
    });
  }

  if (form){
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      if (!supabaseClient) return;
      const email = (emailInput && emailInput.value.trim()) || "";
      const password = (pwInput && pwInput.value.trim()) || "";
      if (!email || !password){
        alert("Ïù¥Î©îÏùºÍ≥º ÎπÑÎ∞ÄÎ≤àÌò∏Î•º Î™®Îëê ÏûÖÎ†•Ìï¥Ï§ò.");
        return;
      }

      try {
        if (currentAuthMode === "login"){
          // Î°úÍ∑∏Ïù∏ Î™®Îìú
          const { data, error } = await supabaseClient.auth.signInWithPassword({ email, password });
          if (error){
            console.warn("Î°úÍ∑∏Ïù∏ Ïò§Î•ò:", error.message);
            const msg = (error.message || "").toLowerCase();
            if (msg.includes("email") && msg.includes("confirm")){
              alert("Ïù¥Î©îÏùº Ïù∏Ï¶ùÏù¥ ÏôÑÎ£åÎêòÏßÄ ÏïäÏùÄ Í≥ÑÏ†ïÏù¥ÏóêÏöî.\nSupabase Auth ÏÑ§Ï†ïÏóêÏÑú Ïù¥Î©îÏùº Ïù∏Ï¶ùÏùÑ ÎÅÑÍ±∞ÎÇò, Ïù∏Ï¶ù Î©îÏùºÏùò ÎßÅÌÅ¨Î•º ÎàåÎü¨Ï£ºÏÑ∏Ïöî.\n\nÏÉÅÏÑ∏ Ïò§Î•ò: " + error.message);
            } else if (msg.includes("invalid login") || msg.includes("invalid credentials")){
              alert("Ïù¥Î©îÏùº ÎòêÎäî ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§. Îã§Ïãú ÌôïÏù∏Ìï¥Ï§ò.");
            } else {
              alert("Î°úÍ∑∏Ïù∏ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏñ¥Ïöî: " + error.message);
            }
            return;
          }
          // Î∞©Í∏à ÏÇ¨Ïö©Ìïú Ïù¥Î©îÏùº Í∏∞Ï§ÄÏúºÎ°ú Î∞îÎ°ú UI ÏóÖÎç∞Ïù¥Ìä∏
          updateAuthUI({ email });
          hideAuthPanel();
          alert("Î°úÍ∑∏Ïù∏ ÏôÑÎ£å!");
        } else {
          // ÌöåÏõêÍ∞ÄÏûÖ Î™®Îìú
          const { data, error } = await supabaseClient.auth.signUp({ email, password });
          if (error){
            console.warn("ÌöåÏõêÍ∞ÄÏûÖ Ïò§Î•ò:", error.message);
            const msg = (error.message || "").toLowerCase();
            if (msg.includes("already registered") || msg.includes("already exists")){
              alert("Ïù¥ÎØ∏ Í∞ÄÏûÖÎêú Ïù¥Î©îÏùºÏù¥ÏóêÏöî. Î°úÍ∑∏Ïù∏ÏúºÎ°ú Ïù¥ÎèôÌï¥ÏÑú ÏãúÎèÑÌï¥Ï§ò.");
            } else if (msg.includes("password") && msg.includes("length")){
              alert("ÎπÑÎ∞ÄÎ≤àÌò∏ Ï°∞Í±¥ÏùÑ ÎßåÏ°±ÌïòÏßÄ ÏïäÏäµÎãàÎã§. Îçî Í∏∏Í≤å/Î≥µÏû°ÌïòÍ≤å ÏûÖÎ†•Ìï¥Ï§ò.");
            } else {
              alert("ÌöåÏõêÍ∞ÄÏûÖ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏñ¥Ïöî: " + error.message);
            }
            return;
          }
          // ÌöåÏõêÍ∞ÄÏûÖ ÏÑ±Í≥µ Ïãú ÏûêÎèô Î°úÍ∑∏Ïù∏ÎêúÎã§Í≥† Í∞ÄÏ†ïÌïòÍ≥† UI ÏóÖÎç∞Ïù¥Ìä∏
          updateAuthUI({ email });
          hideAuthPanel();
          alert("ÌöåÏõêÍ∞ÄÏûÖÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§. ÏûêÎèôÏúºÎ°ú Î°úÍ∑∏Ïù∏ÎêòÏóàÏñ¥Ïöî!");
        }
      } catch (err){
        console.error("Ïù∏Ï¶ù Ï≤òÎ¶¨ Ïò§Î•ò:", err);
        alert("Î°úÍ∑∏Ïù∏/ÌöåÏõêÍ∞ÄÏûÖ Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.");
      }
    });
  }

  if (logoutBtn){
    logoutBtn.addEventListener("click", async (e) => {
      e.preventDefault();
      if (!supabaseClient) return;
      try{
        await supabaseClient.auth.signOut();
        updateAuthUI(null);
        alert("Î°úÍ∑∏ÏïÑÏõÉ ÎêòÏóàÏäµÎãàÎã§.");
      } catch (err){
        console.error("Î°úÍ∑∏ÏïÑÏõÉ Ïò§Î•ò:", err);
      }
    });
  }
}


const SUPABASE_URL = "https://ftdpkgfwqmorldeptavl.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ0ZHBrZ2Z3cW1vcmxkZXB0YXZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQwMTA2MzAsImV4cCI6MjA3OTU4NjYzMH0.DBYUU7YvZMwg7fn10dPQBZBUhPce7VxUm9YOon7xZlk";

let supabaseClient = null;

// Supabase Ï¥àÍ∏∞Ìôî
document.addEventListener("DOMContentLoaded", async () => {
  if (!window.supabase || supabaseClient) return;
  try {
    supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    console.log("Supabase Ï¥àÍ∏∞Ìôî ÏôÑÎ£å");
    // Auth UI Ï¥àÍ∏∞Ìôî
    initSupabaseAuth();
  } catch (err) {
    console.error("Supabase Ï¥àÍ∏∞Ìôî Ïò§Î•ò:", err);
  }
});

// CSVÎ•º SupabaseÏóê Ï†ÄÏû•
async function saveCsvToSupabase(file){
  try {
    if (!supabaseClient) return;
    const { data: { user }, error: userError } = await supabaseClient.auth.getUser();
    if (userError) {
      console.warn("Supabase ÏÇ¨Ïö©Ïûê Ï°∞Ìöå Ïò§Î•ò:", userError.message);
      return;
    }
    if (!user) {
      console.log("Î°úÍ∑∏Ïù∏Ìïú ÏÇ¨Ïö©ÏûêÍ∞Ä ÏóÜÏñ¥ Supabase Ï†ÄÏû•ÏùÑ Í±¥ÎÑàÎúÅÎãàÎã§.");
      return;
    }
    const content = await file.text();
    const { error } = await supabaseClient
      .from("csv_uploads")
      .insert({
        user_id: user.id,
        filename: file.name || "unknown.csv",
        file_content: content
      });
    if (error) {
      console.error("Supabase csv_uploads Ï†ÄÏû• Ïò§Î•ò:", error.message);
    } else {
      console.log("Supabase csv_uploads Ï†ÄÏû• ÏôÑÎ£å");
    }
  } catch (err) {
    console.error("saveCsvToSupabase ÏàòÌñâ Ï§ë Ïò§Î•ò:", err);
  }
}
</script>
</body>
</html>


