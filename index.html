<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>X í¬ë¦¬ì—ì´í„° ë§ˆì¸ë“œì‰ì–´ ë¶„ì„ê¸° 4.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- CSV íŒŒì„œ -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    :root {
      --bg: #020617;
      --surface: rgba(15,23,42,0.9);
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --grade-s: #fbbf24;
      --grade-a: #38bdf8;
      --grade-b: #22c55e;
      --grade-c: #a855f7;
      --grade-d: #6b7280;
    }
    *{box-sizing:border-box}
    body{
      margin:0;padding:32px 16px 48px;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:
        radial-gradient(circle at 0% 0%, rgba(56,189,248,.14), transparent 60%),
        radial-gradient(circle at 100% 0%, rgba(248,250,252,.08), transparent 55%),
        radial-gradient(circle at 50% 100%, rgba(52,211,153,.12), transparent 55%),
        var(--bg);
      color:var(--text-main);min-height:100vh;
    }
    .app{max-width:1080px;margin:0 auto}
    .hero{
      background:radial-gradient(circle at top left,rgba(56,189,248,.18),transparent 55%),
                radial-gradient(circle at top right,rgba(234,179,8,.18),transparent 50%),
                linear-gradient(135deg,rgba(15,23,42,.95),rgba(15,23,42,.9));
      border-radius:28px;padding:28px 24px;
      border:1px solid rgba(148,163,184,.35);
      position:relative;overflow:hidden;
    }
    .hero-inner{position:relative;z-index:1}
    .hero-title{font-size:24px;font-weight:800;gap:10px;margin-bottom:6px;display:flex;align-items:center}
    .hero-pill{
      font-size:11px;font-weight:600;padding:4px 10px;border-radius:999px;
      background:rgba(15,23,42,.9);border:1px solid rgba(148,163,184,.6);
      display:inline-flex;gap:5px;align-items:center;
    }
    .hero-pill-dot{
      width:7px;height:7px;border-radius:999px;background:#22c55e;
      box-shadow:0 0 0 5px rgba(34,197,94,.35);
    }
    .hero-sub{font-size:13px;color:var(--text-muted);margin-bottom:16px;line-height:1.5}

    .upload-row{display:flex;flex-wrap:wrap;gap:12px;align-items:center;margin-bottom:10px;}
    .file-input-wrap{position:relative;display:inline-block;overflow:hidden}
    .file-input-wrap input[type="file"]{position:absolute;inset:0;opacity:0;cursor:pointer}
    .file-input-fake{
      padding:8px 14px;border-radius:999px;border:1px solid rgba(148,163,184,.65);
      font-size:13px;display:inline-flex;align-items:center;gap:8px;
      background:rgba(15,23,42,.85);cursor:pointer;white-space:nowrap;
    }
    .file-hint{font-size:11px;color:var(--text-muted)}

    .badge{
      display:inline-flex;gap:6px;padding:4px 9px;border-radius:999px;
      border:1px solid rgba(148,163,184,.5);font-size:11px;color:var(--text-muted);
      background:rgba(15,23,42,.9);margin-top:4px;
    }
    .badge-dot{width:7px;height:7px;border-radius:999px;background:rgba(148,163,184,.7)}

    .summary-grid{
      margin-top:18px;display:grid;
      grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
      gap:10px;
    }
    .summary-card{
      border-radius:16px;padding:10px 12px;font-size:11px;
      border:1px solid rgba(148,163,184,.35);
      background:radial-gradient(circle at top left,rgba(30,64,175,.24),transparent 65%),
                 linear-gradient(145deg,rgba(15,23,42,.95),rgba(15,23,42,.9));
    }
    .summary-label{color:var(--text-muted);margin-bottom:4px}
    .summary-value{font-size:16px;font-weight:700}
    .summary-sub{font-size:10px;color:var(--text-muted);margin-top:1px}

    .section-card{
      margin-top:24px;border-radius:22px;padding:16px 14px 18px;
      border:1px solid rgba(148,163,184,.3);background:rgba(15,23,42,.9);
    }
    .section-header{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;margin-bottom:12px}
    .section-title{font-size:15px;font-weight:700;display:flex;gap:8px;align-items:center}
    .grade-legend{display:flex;gap:6px;flex-wrap:wrap;font-size:10px;color:var(--text-muted)}
    .grade-dot{width:8px;height:8px;border-radius:999px}
    .grade-dot.s{background:var(--grade-s)}
    .grade-dot.a{background:var(--grade-a)}
    .grade-dot.b{background:var(--grade-b)}
    .grade-dot.c{background:var(--grade-c)}
    .grade-dot.d{background:var(--grade-d)}

    .grade-tabs{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px}
    .grade-tab{
      padding:4px 10px;border-radius:999px;font-size:11px;
      border:1px solid rgba(55,65,81,.9);background:rgba(15,23,42,.92);
      color:var(--text-muted);cursor:pointer;display:flex;gap:6px;align-items:center;
    }
    .grade-tab-dot{width:8px;height:8px;border-radius:999px}
    .grade-tab.active{
      background:radial-gradient(circle at top left,rgba(56,189,248,.35),transparent 60%),
                rgba(15,23,42,.96);
      border-color:rgba(56,189,248,1);color:#fff;
    }

    .table-wrap{
      width:100%;overflow:auto;border-radius:14px;
      border:1px solid rgba(30,64,175,.6);
      background:radial-gradient(circle at top left,rgba(30,64,175,.35),transparent 55%),
                 linear-gradient(135deg,rgba(15,23,42,.98),rgba(15,23,42,.96));
    }
th {
  background: rgba(15,23,42,0.96);
  color:#9ca3af;
  text-transform:uppercase;
  font-size:11px;
  position:sticky;
  top:0;
  z-index:1;
}

/* â–¼ ì—¬ê¸° ì¶”ê°€ (ì •ë‹µ ìœ„ì¹˜) */
th:last-child,
td:last-child {
  width: 80px;
  min-width: 80px;
  white-space: nowrap;
}

    table{width:100%;border-collapse:collapse;min-width:680px;font-size:11px}
    th,td{padding:8px;border-bottom:1px solid rgba(30,64,175,.4);vertical-align:top}
    th{background:rgba(15,23,42,.96);color:#9ca3af;text-transform:uppercase;font-size:11px}
    tr:last-child td{border-bottom:none}
    tbody tr:hover td{background:rgba(15,23,42,.85)}

    .grade-badge{
      display:inline-flex;min-width:24px;padding:3px 7px;border-radius:999px;
      font-size:11px;font-weight:700;justify-content:center;
    }
    .grade-badge.s{background:rgba(251,191,36,.16);border:1px solid rgba(251,191,36,.75);color:var(--grade-s)}
    .grade-badge.a{background:rgba(56,189,248,.14);border:1px solid rgba(56,189,248,.7);color:var(--grade-a)}
    .grade-badge.b{background:rgba(34,197,94,.14);border:1px solid rgba(34,197,94,.7);color:var(--grade-b)}
    .grade-badge.c{background:rgba(168,85,247,.18);border:1px solid rgba(168,85,247,.7);color:var(--grade-c)}
    .grade-badge.d{background:rgba(55,65,81,.5);border:1px solid rgba(75,85,99,.9);color:var(--grade-d)}

    .stat-chip{
      display:inline-flex;gap:3px;font-size:10px;color:var(--text-muted);
      padding:2px 6px;border-radius:999px;border:1px solid rgba(75,85,99,.85);
      background:rgba(15,23,42,.92);
    }
    .stat-chip strong{color:#fff}
    .link-pill{
      padding:3px 7px;border-radius:999px;font-size:10px;
      border:1px solid rgba(37,99,235,.8);
      background:rgba(30,64,175,.7);color:#dbeafe;text-decoration:none;
    }
  </style>
</head>

<body>

<div style="max-width:1080px;margin:0 auto;margin-top:20px;margin-bottom:20px;padding:16px 20px;border-radius:18px;background:rgba(15,23,42,.8);border:1px solid rgba(148,163,184,.25);backdrop-filter:blur(14px);display:flex;gap:14px;align-items:center">
  <img src="https://unavatar.io/twitter/bud_dha__" style="width:52px;height:52px;border-radius:999px;border:1px solid rgba(255,255,255,.2)"/>
  <div style="flex:1">
    <div style="font-size:18px;font-weight:700;color:#e5e7eb">ğŸ§˜â€â™‚ï¸ ë¶“ë‹¤ <a href="https://twitter.com/bud_dha__" target="_blank" style="font-size:14px;margin-left:6px;color:#60a5fa;text-decoration:none">@bud_dha__ â†—</a></div>
    <div style="font-size:13px;color:#9ca3af;margin-top:4px">Web3 Â· InfoFi Â· Agentic Crypto Research</div>
  </div>
</div>

<nav style="width:100%;padding:12px 0;display:flex;justify-content:center;background:rgba(15,23,42,.6);border-bottom:1px solid rgba(148,163,184,.25);backdrop-filter:blur(12px);position:sticky;top:0;z-index:999">
  <a href="https://buddha913.github.io/crypto-fullcourse/" style="color:#e5e7eb;font-size:14px;font-weight:600;padding:8px 18px;border-radius:999px;border:1px solid rgba(148,163,184,.5);background:rgba(30,41,59,.7);text-decoration:none">ğŸ“˜ í¬ë¦½í†  í’€ì½”ìŠ¤</a>
</nav>

<div class="app">

<header class="hero">
  <div class="hero-inner">
    <div class="hero-title">
      ì• ë„ë¦¬í‹±ìŠ¤ë¡œ ë³´ëŠ” ë§ˆì¸ë“œì‰ì–´ ë¶„ì„ê¸°
      <div class="hero-pill"><span class="hero-pill-dot"></span>CSV ì—…ë¡œë“œ â†’ ë§ˆì‰ í„°ì§„ ê¸€ ì°¾ê¸°</div>
    </div>

    <div class="hero-sub">
      X ì• ë„ë¦¬í‹±ìŠ¤ CSVì—ì„œ<br>
      <strong>â‘  ì½˜í…ì¸  ì˜¤ë¥¸ìª½ ìƒë‹¨</strong> ë‹¤ìš´ë¡œë“œ<br>
      <strong>â‘¡ ë§ˆì¸ë“œì‰ì–´ ì ìˆ˜ ê³„ì‚° â†’ Top10 + S~D ë“±ê¸‰</strong> ìë™ ë¶„ì„
    </div>

    <div class="upload-row">
      <div class="file-input-wrap">
        <div class="file-input-fake">ğŸ“ CSV íŒŒì¼ ì„ íƒí•˜ê¸°</div>
        <input type="file" id="csvInput" accept=".csv"/>
      </div>
      <span class="file-hint">account_analytics_content_YYYY-MM-DD_YYYY-MM-DD.csv ê·¸ëŒ€ë¡œ ì—…ë¡œë“œ</span>
    </div>

    <div class="badge"><span class="badge-dot"></span>í•œêµ­ì–´/ì˜ì–´ CSV ìë™ ì¸ì‹ ì§€ì›</div>

    <div id="summary" class="summary-grid" style="display:none"></div>
    <div id="error" class="error"></div>
  </div>
</header>

<!-- ğŸ”¥ ê²°ê³¼ êµ¬ì—­ -->
<section class="section-card">
  <div class="section-header">
    <div class="section-title">ğŸ’¥ ë§ˆì¸ë“œì‰ì–´ í­ë°œ Top 10 <span id="top10-count"></span></div>
    <div class="grade-chip">ì ìˆ˜ ê¸°ì¤€Â·<strong>ë§ˆì¸ë“œì‰ì–´ ìŠ¤ì½”ì–´</strong></div>
  </div>
  <div class="table-wrap" id="top10-table-wrap"></div>
</section>

<section class="section-card">
  <div class="section-header">
    <div class="section-title">ğŸš ë“±ê¸‰ë³„ ìƒìœ„ ê²Œì‹œê¸€ <span>(S~D)</span></div>
    <div class="grade-legend">
      <span><span class="grade-dot s"></span>S ìƒìœ„ 5%</span>
      <span><span class="grade-dot a"></span>A ìƒìœ„ 20%</span>
      <span><span class="grade-dot b"></span>B ìƒìœ„ 40%</span>
      <span><span class="grade-dot c"></span>C ìƒìœ„ 60%</span>
      <span><span class="grade-dot d"></span>D ê·¸ ì™¸</span>
    </div>
  </div>

  <div class="grade-tabs">
    <button class="grade-tab active" data-grade="ALL"><span class="grade-tab-dot" style="background:linear-gradient(90deg,var(--grade-s),var(--grade-a),var(--grade-b))"></span>ì „ì²´</button>
    <button class="grade-tab" data-grade="S"><span class="grade-tab-dot" style="background:var(--grade-s)"></span>S ë“±ê¸‰</button>
    <button class="grade-tab" data-grade="A"><span class="grade-tab-dot" style="background:var(--grade-a)"></span>A ë“±ê¸‰</button>
    <button class="grade-tab" data-grade="B"><span class="grade-tab-dot" style="background:var(--grade-b)"></span>B ë“±ê¸‰</button>
    <button class="grade-tab" data-grade="C"><span class="grade-tab-dot" style="background:var(--grade-c)"></span>C ë“±ê¸‰</button>
    <button class="grade-tab" data-grade="D"><span class="grade-tab-dot" style="background:var(--grade-d)"></span>D ë“±ê¸‰</button>
  </div>

  <div class="table-wrap" id="grade-table-wrap"></div>
</section>

</div><!-- app -->

<script>
/* -------------------------------------------------------------
  1) CSV í—¤ë” ìë™ ë§¤í•‘ (í•œêµ­ì–´/ì˜ì–´ ì§€ì›)
------------------------------------------------------------- */
function autoMap(row) {
  const map = {
    "ê²Œì‹œë¬¼ ë³¸ë¬¸": "text",
    "Post text": "text",
    "Tweet text": "text",

    "ë‚ ì§œ": "date",
    "Date": "date",

    "ê²Œì‹œë¬¼ ë§í¬": "link",
    "Tweet permalink": "link",
    "URL": "link",
    "Link": "link",

    "ê²Œì‹œë¬¼ ID": "id",
    "Tweet ID": "id",

    "ë…¸ì¶œìˆ˜": "impressions",
    "Impressions": "impressions",

    "ì°¸ì—¬ìˆ˜": "engagements",
    "Engagements": "engagements",

    "ë§ˆìŒì— ë“¤ì–´ìš”": "likes",
    "Likes": "likes",

    "ë¶ë§ˆí¬": "bookmarks",
    "Bookmarks": "bookmarks",

    "ì¬ê²Œì‹œ": "retweets",
    "Retweets": "retweets",
    "Reposts": "retweets",

    "ë‹µê¸€": "replies",
    "Replies": "replies",

    "ê³µìœ  ìˆ˜": "shares",
    "Shares": "shares",

    "ìƒˆë¡œìš´ íŒ”ë¡œìš°": "newFollows",
    "New follows": "newFollows",

    "í”„ë¡œí•„ ì¡°íšŒìˆ˜": "profileClicks",
    "Profile clicks": "profileClicks",

    "URL í´ë¦­ìˆ˜": "urlClicks",
    "URL clicks": "urlClicks",

    "ê³ ìœ  ë§í¬ í´ë¦­ìˆ˜": "uniqueClicks",
    "Unique link clicks": "uniqueClicks",
  };

  const result = {};
  for (const key in row) {
    const clean = key.trim();
    if (map[clean]) result[map[clean]] = row[key];
  }
  return result;
}

/* -------------------------------------------------------------
  ìˆ«ì ë³€í™˜
------------------------------------------------------------- */
function num(v) {
  if (!v) return 0;
  v = String(v).replace(/,/g,"").trim();
  const n = parseFloat(v);
  return isNaN(n)?0:n;
}

/* -------------------------------------------------------------
  ë§ˆì¸ë“œì‰ì–´ ì ìˆ˜ ê³„ì‚°
------------------------------------------------------------- */
function computeScore(p){
  const impres = p.impressions || 0;
  const raw =
      p.engagements +
      p.bookmarks * 3 +
      p.newFollows * 10 +
      p.profileClicks * 0.7 +
      p.urlClicks * 0.8 +
      p.uniqueClicks * 1.2 +
      p.likes * 1.2 +
      p.retweets * 2 +
      p.replies * 1.5 +
      p.shares * 1.8;

  return raw / Math.log10(impres + 10);
}

/* -------------------------------------------------------------
  ë“±ê¸‰ ë¶„ë¥˜
------------------------------------------------------------- */
function assignGrades(list){
  list.sort((a,b)=>b.score-a.score);
  const N = list.length;
  list.forEach((p,i)=>{
    const pct = 1 - i/(N-1);
    p.percentile = Math.round(pct*100);
    p.grade =
      pct>=0.95?"S":
      pct>=0.80?"A":
      pct>=0.60?"B":
      pct>=0.40?"C":"D";
  });
}

/* -------------------------------------------------------------
  UI: TOP10 ë Œë”
------------------------------------------------------------- */
function renderTop10(posts){
  const wrap = document.getElementById("top10-table-wrap");
  if(!posts.length){
    wrap.innerHTML = "<div class='empty'>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>";
    return;
  }
  const rows = posts.slice(0,10).map((p,i)=>`
    <tr>
      <td>#${i+1}</td>
      <td><div class="grade-badge ${p.grade.toLowerCase()}">${p.grade}</div></td>
      <td>
        <div class="text-main">${p.text}</div>
        <div class="text-meta">${p.date} Â· ìŠ¤ì½”ì–´ <strong>${p.score.toFixed(1)}</strong></div>
      </td>
      <td>
        <div class="stat-chip">ì°¸ì—¬ <strong>${p.engagements}</strong></div>
        <div class="stat-chip">ë…¸ì¶œ <strong>${p.impressions}</strong></div>
      </td>
      <td>
        <div class="stat-chip">íŒ”ë¡œìš° <strong>${p.newFollows}</strong></div>
        <div class="stat-chip">ë¶ë§ˆí¬ <strong>${p.bookmarks}</strong></div>
      </td>
      <td><a href="${p.link}" class="link-pill" target="_blank">íŠ¸ìœ— ë³´ê¸° â†—</a></td>
    </tr>
  `).join("");

  wrap.innerHTML = `
    <table>
      <thead><tr>
        <th>#</th><th>ë“±ê¸‰</th><th>ë³¸ë¬¸</th><th>ì°¸ì—¬/ë…¸ì¶œ</th><th>íŒ”ë¡œìš°/ë¶ë§ˆí¬</th><th>ë§í¬</th>
      </tr></thead>
      <tbody>${rows}</tbody>
    </table>`;
}

/* -------------------------------------------------------------
  UI: ë“±ê¸‰ë³„ ë Œë”
------------------------------------------------------------- */
function renderGrade(list){
  const wrap = document.getElementById("grade-table-wrap");
  const rows = list.map((p,i)=>`
    <tr>
      <td>#${i+1}</td>
      <td><div class="grade-badge ${p.grade.toLowerCase()}">${p.grade}</div></td>
      <td>
        <div class="text-main">${p.text}</div>
        <div class="text-meta">${p.date} Â· ìŠ¤ì½”ì–´ <strong>${p.score.toFixed(1)}</strong></div>
      </td>
      <td>
        <div class="stat-chip">ì°¸ì—¬ <strong>${p.engagements}</strong></div>
        <div class="stat-chip">ë…¸ì¶œ <strong>${p.impressions}</strong></div>
      </td>
      <td>
        <div class="stat-chip">íŒ”ë¡œìš° <strong>${p.newFollows}</strong></div>
        <div class="stat-chip">ë¶ë§ˆí¬ <strong>${p.bookmarks}</strong></div>
      </td>
      <td><a href="${p.link}" class="link-pill" target="_blank">íŠ¸ìœ— ë³´ê¸° â†—</a></td>
    </tr>`).join("");

  wrap.innerHTML = `
  <table>
    <thead><tr>
      <th>#</th><th>ë“±ê¸‰</th><th>ë³¸ë¬¸</th>
      <th>ì°¸ì—¬/ë…¸ì¶œ</th><th>íŒ”ë¡œìš°/ë¶ë§ˆí¬</th><th>ë§í¬</th>
    </tr></thead>
    <tbody>${rows}</tbody>
  </table>`;
}

/* -------------------------------------------------------------
  CSV ì—…ë¡œë“œ íŒŒì‹±
------------------------------------------------------------- */
let ALL = [];
let buckets = {S:[],A:[],B:[],C:[],D:[]};

document.getElementById("csvInput").addEventListener("change", e=>{
  const file = e.target.files[0];
  if(!file) return;

  Papa.parse(file,{
    header:true,
    skipEmptyLines:true,
    complete:res=>{
      ALL = [];

      res.data.forEach(row=>{
        const r = autoMap(row);
        const t = (r.text||"").trim();
        if(!t || t.startsWith("@")) return;

        const p = {
          text:t,
          date:r.date,
          link:r.link,
          impressions:num(r.impressions),
          engagements:num(r.engagements),
          likes:num(r.likes),
          bookmarks:num(r.bookmarks),
          newFollows:num(r.newFollows),
          replies:num(r.replies),
          retweets:num(r.retweets),
          shares:num(r.shares),
          profileClicks:num(r.profileClicks),
          urlClicks:num(r.urlClicks),
          uniqueClicks:num(r.uniqueClicks),
        };
        p.score = computeScore(p);
        ALL.push(p);
      });

      if(!ALL.length){
        document.getElementById("error").textContent = "CSVì—ì„œ ë¶„ì„ ê°€ëŠ¥í•œ ì›ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.";
        return;
      }

      document.getElementById("error").textContent="";

      // ë“±ê¸‰ ë¶„ë°°
      assignGrades(ALL);

      // ë²„í‚· ì±„ìš°ê¸°
      buckets = {S:[],A:[],B:[],C:[],D:[]};
      ALL.forEach(p=>{
        if(buckets[p.grade].length < 10) buckets[p.grade].push(p);
      });

      // ìš”ì•½ ë Œë”
      const total = ALL.length;
      const avgScore = (ALL.reduce((s,p)=>s+p.score,0)/total).toFixed(1);
      const avgEng = (ALL.reduce((s,p)=>s+p.engagements,0)/total).toFixed(1);
      const avgImp = Math.round(ALL.reduce((s,p)=>s+p.impressions,0)/total);
      const best = ALL[0];

      document.getElementById("summary").innerHTML = `
        <div class="summary-card"><div class="summary-label">ì›ê¸€ ê°œìˆ˜</div>
          <div class="summary-value">${total}</div><div class="summary-sub">ë‹µê¸€ ì œì™¸</div></div>

        <div class="summary-card"><div class="summary-label">í‰ê·  ìŠ¤ì½”ì–´</div>
          <div class="summary-value">${avgScore}</div></div>

        <div class="summary-card"><div class="summary-label">í‰ê·  ì°¸ì—¬ìˆ˜/ë…¸ì¶œìˆ˜</div>
          <div class="summary-value">${avgEng} / ${avgImp}</div></div>

        <div class="summary-card"><div class="summary-label">ê°€ì¥ í„°ì§„ ê¸€</div>
          <div class="summary-value">${best.score.toFixed(1)}</div>
          <div class="summary-sub">${best.date}</div></div>
      `;
      document.getElementById("summary").style.display="grid";

      // TOP10 ë Œë”
      renderTop10(ALL);

      // ë“±ê¸‰ ê¸°ë³¸ ALL
      renderGrade(ALL.slice(0,30));
    }
  });
});

/* -------------------------------------------------------------
  íƒ­ ì´ë²¤íŠ¸
------------------------------------------------------------- */
document.querySelectorAll(".grade-tab").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll(".grade-tab").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    const g = btn.dataset.grade;

    if(g==="ALL") renderGrade(ALL.slice(0,30));
    else renderGrade(buckets[g]);
  });
});
</script>

</body>
</html>
