<!doctype html> 
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>X í¬ë¦¬ì—ì´í„° ë§ˆì¸ë“œì‰ì–´ ë¶„ì„ê¸° 5.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- CSV íŒŒì„œ -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <!-- í”„ë¡œì íŠ¸ë³„ ì›í˜• ê·¸ë˜í”„ìš© -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- âœ… STEP 2 -->
  <style>
  html {
  scroll-behavior: smooth;
}

:root {
  --bg: #f3f7ff;
  --bg-soft: #f8fbff;
  --sidebar-bg: #ffffff;
  --card-bg: #ffffff;
  --card-soft: #f9fbff;
  --accent: #4f46e5;
  --accent-soft: #e0e7ff;
  --accent-2: #06b6d4;
  --accent-3: #22c55e;
  --text-main: #0f172a;
  --text-muted: #6b7280;
  --border-soft: rgba(148,163,184,.35);

  --grade-s: #f59e0b;
  --grade-a: #38bdf8;
  --grade-b: #22c55e;
  --grade-c: #a855f7;
  --grade-d: #9ca3af;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:
    radial-gradient(circle at 0% 0%, #e0f2fe, transparent 55%),
    radial-gradient(circle at 100% 0%, #ffe4f5, transparent 55%),
    linear-gradient(180deg,#eef4ff,#f9fafb);
  color:var(--text-main);
  min-height:100vh;
}

.layout{
  display:flex;
  min-height:100vh;
}

/* ========== SIDEBAR ========== */
.sidebar{
  width:230px;
  background:var(--sidebar-bg);
  backdrop-filter: blur(18px) saturate(160%);
  color:#111827;
  padding:20px 18px;
  display:flex;
  flex-direction:column;
  gap:24px;
  box-shadow: 10px 0 35px rgba(148,163,184,.45);
  position:relative;
  transition:width .2s ease;
  overflow:hidden;
  border-right:1px solid rgba(209,213,219,.9);
}

.sidebar-toggle{
  position:absolute;
  top:14px;
  right:12px;
  width:26px;
  height:26px;
  border-radius:999px;
  border:none;
  background:linear-gradient(135deg,#4f46e5,#06b6d4);
  color:#f9fafb;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:14px;
  cursor:pointer;
  box-shadow:0 10px 24px rgba(79,70,229,.65);
  z-index:10;
}

.side-profile{
  display:flex;
  gap:12px;
  align-items:center;
  margin-top:18px;
}
.side-login-btn{
  margin-top:6px;
  padding:4px 8px;
  font-size:11px;
  border-radius:999px;
  border:1px solid rgba(148,163,184,.6);
  background:rgba(248,250,252,.9);
  cursor:pointer;
}
.side-login-btn:hover{
  background:#e5edff;
}
.side-avatar{
  width:44px;height:44px;
  border-radius:999px;
  border:2px solid rgba(248,250,252,.9);
  overflow:hidden;
  box-shadow:0 8px 18px rgba(148,163,184,.7);
}
.side-avatar img{width:100%;height:100%;object-fit:cover}
.side-name{font-size:15px;font-weight:700;}
.side-handle{
  font-size:12px;color:#6b7280;
  text-decoration:none;
}

.side-nav{
  display:flex;
  flex-direction:column;
  gap:6px;
  margin-top:12px;
}
.side-nav-item{
  display:flex;
  align-items:center;
  gap:8px;
  padding:8px 10px;
  border-radius:12px;
  font-size:13px;
  color:#4b5563;
  cursor:pointer;
  text-decoration:none;
  transition:background .15s ease, transform .1s ease, box-shadow .15s ease;
}
.side-nav-item:hover{
  background:rgba(191,219,254,.6);
  transform:translateX(2px);
  box-shadow:0 6px 16px rgba(148,163,184,.4);
}
.side-nav-item span.icon{
  width:20px;height:20px;
  border-radius:9px;
  background:linear-gradient(135deg,#e0f2fe,#e5e7eb);
  display:flex;align-items:center;justify-content:center;
  font-size:12px;
  flex-shrink:0;
}
.side-label{
  white-space:nowrap;
}
.side-nav-item.active{
  background:linear-gradient(135deg,#4f46e5,#06b6d4);
  color:#f9fafb;
  box-shadow:0 10px 24px rgba(79,70,229,.7);
}
.side-nav-item.active span.icon{
  background:rgba(15,23,42,.9);
  color:#e5e7eb;
}

.side-footer{
  margin-top:auto;
  font-size:11px;
  color:#9ca3af;
}
.side-badge{
  margin-top:6px;
  padding:8px 10px;
  border-radius:14px;
  background:radial-gradient(circle at 0% 0%,#4f46e5,#06b6d4);
  font-size:12px;
  color:#f9fafb;
  text-align:left;
  box-shadow:0 14px 28px rgba(15,23,42,.65);
}

/* ========== SIDEBAR COLLAPSE ========== */
.layout.collapsed .sidebar{
  width:70px;
}
.layout.collapsed .side-name,
.layout.collapsed .side-handle,
.layout.collapsed .side-label,
.layout.collapsed .side-footer{
  display:none;
}
.layout.collapsed .side-profile{
  justify-content:center;
}
.layout.collapsed .sidebar-toggle{
  transform:rotate(180deg);
}

/* ========== MAIN AREA ========== */
.main{
  flex:1;
  padding:20px 24px 32px;
  max-width:calc(100vw - 230px);
  overflow-x:hidden;
  transition:max-width .2s ease;
}
.layout.collapsed .main{
  max-width:calc(100vw - 70px);
}

.top-nav{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:16px;
  flex-wrap:wrap;
  gap:8px;
}
.top-title{
  font-size:20px;
  font-weight:800;
}
.top-sub{
  font-size:12px;
  color:var(--text-muted);
}
.top-cta{
  display:flex;
  gap:8px;
  align-items:center;
}
.lang-toggle{
  display:flex;
  gap:4px;
  align-items:center;
  font-size:11px;
}

.lang-btn{
  border-radius:999px;
  border:1px solid rgba(209,213,219,1);
  background:#ffffff;
  padding:4px 8px;
  font-size:11px;
  cursor:pointer;
}

.lang-btn.active{
  background:linear-gradient(135deg,#4f46e5,#06b6d4);
  color:#f9fafb;
  border-color:transparent;
}

.top-link{
  font-size:12px;
  padding:7px 12px;
  border-radius:999px;
  border:1px solid #c7d2fe;
  background:var(--card-soft);
  color:var(--accent);
  text-decoration:none;
  display:inline-flex;
  align-items:center;
  gap:6px;
}

/* HERO */
.hero-card{
  background:
    radial-gradient(circle at 0% 0%, #c7d2fe, transparent 45%),
    radial-gradient(circle at 100% 0%, #a5f3fc, transparent 45%),
    linear-gradient(135deg,#f9fafb,#eef2ff);
  border-radius:24px;
  padding:18px 18px 16px;
  border:1px solid rgba(191,219,254,.9);
  display:flex;
  flex-direction:column;
  gap:10px;
  box-shadow:0 22px 45px rgba(148,163,184,.45);
}
.hero-top-row{
  display:flex;
  justify-content:space-between;
  gap:12px;
  align-items:flex-start;
  flex-wrap:wrap;
}
.hero-main-title{
  font-size:17px;
  font-weight:800;
  color:#111827;
}
.hero-desc{
  font-size:12px;
  color:#4b5563;
  margin-top:4px;
  line-height:1.4;
}
.hero-pill{
  font-size:11px;
  padding:5px 10px;
  border-radius:999px;
  background:rgba(255,255,255,.95);
  border:1px solid rgba(148,163,184,.5);
  display:inline-flex;
  align-items:center;
  gap:6px;
  margin-top:6px;
}
.hero-dot{
  width:8px;height:8px;border-radius:999px;
  background:#22c55e;
  box-shadow:0 0 0 5px rgba(34,197,94,.2);
}

.hero-upload-row{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  align-items:center;
  margin-top:4px;
}
.file-input-wrap{position:relative;display:inline-block;overflow:hidden}
.file-input-wrap input[type="file"]{position:absolute;inset:0;opacity:0;cursor:pointer}
.file-input-fake{
  padding:8px 14px;border-radius:999px;border:1px solid rgba(148,163,184,.7);
  font-size:12px;display:inline-flex;align-items:center;gap:8px;
  background:rgba(255,255,255,.95);cursor:pointer;white-space:nowrap;
  color:#111827;
}
.file-hint{font-size:11px;color:#4b5563}

.range-tabs{
  margin-top:10px;
  display:flex;
  gap:6px;
  flex-wrap:wrap;
}
.range-tab{
  padding:4px 10px;
  border-radius:999px;
  font-size:11px;
  border:1px solid rgba(148,163,184,.7);
  background:rgba(255,255,255,.9);
  color:#4b5563;
  cursor:pointer;
  transition:background .15s ease, transform .1s ease;
}
.range-tab:hover{
  transform:translateY(-1px);
}
.range-tab.active{
  background:linear-gradient(135deg,#4f46e5,#06b6d4);
  border-color:transparent;
  color:#f9fafb;
}

.badge{
  display:inline-flex;gap:6px;padding:4px 9px;border-radius:999px;
  border:1px solid rgba(148,163,184,.6);font-size:11px;color:#4b5563;
  background:rgba(255,255,255,.85);margin-top:2px;
}
.badge-dot{width:7px;height:7px;border-radius:999px;background:#a5b4fc}

.error{color:#ef4444;font-size:12px;margin-top:4px}

/* GRID (ëŒ€ì‹œë³´ë“œ) */
.grid-1{
  margin-top:18px;
  display:grid;
  grid-template-columns:2.2fr 1.4fr;
  gap:16px;
  align-items:flex-start;
}

.column-main{
  display:flex;
  flex-direction:column;
  gap:16px;
}
.column-side{
  display:flex;
  flex-direction:column;
  gap:16px;
}

.card{
  border-radius:18px;
  background:var(--card-bg);
  border:1px solid rgba(203,213,225,.8);
  padding:14px 14px 16px;
  box-shadow:0 10px 25px rgba(148,163,184,.25);
}
.card-soft{
  background:var(--card-soft);
}

.summary-grid{
  display:grid;
  grid-template-columns:repeat(4,minmax(0,1fr));
  gap:10px;
  margin-top:10px;
}

@media (max-width:1100px){
  .grid-1{
    grid-template-columns:1fr;
  }
}

@media (max-width:960px){
  .layout{
    flex-direction:column;
  }
  .sidebar{
    width:100%;
    flex-direction:row;
    align-items:center;
    justify-content:space-between;
  }
  .layout.collapsed .sidebar{
    width:100%;
  }
  .main{
    max-width:100%;
    padding:16px;
  }
}  /* ğŸ‘ˆ ì—¬ê¸°ì—ì„œ mediaë¥¼ ê¼­ ë‹«ì•„ì¤˜! */
/* ì„±ì¥ ê·¸ë˜í”„ ì¹´ë“œ */
.growth-card{
  margin-top:16px;
}

.growth-card-title{
  font-size:14px;
  font-weight:700;
  margin-bottom:4px;
}

.growth-card-sub{
  font-size:11px;
  color:var(--text-muted);
}

.growth-chart-wrap{
  margin-top:10px;
}

/* ìš”ì•½ ì¹´ë“œ (ì›ê¸€ ê°œìˆ˜ / í‰ê·  ìŠ¤ì½”ì–´ / íŠ¸ë¦¼ë“œ í‰ê·  / ê°€ì¥ í„°ì§„ ê¸€) */
.summary-grid{
  margin-top:14px;
  display:grid;
  grid-template-columns:repeat(4,minmax(0,1fr));
  gap:12px;
}

/* ìš”ì•½ ì¹´ë“œ (ì›ê¸€ ê°œìˆ˜ / í‰ê·  ìŠ¤ì½”ì–´ / íŠ¸ë¦¼ë“œ í‰ê·  / ê°€ì¥ í„°ì§„ ê¸€) */
.summary-grid{
  margin-top:14px;
  display:grid;
  grid-template-columns:repeat(4,minmax(0,1fr));
  gap:12px;
}

.summary-card{
  position:relative;
  overflow:hidden;
  border-radius:18px;
  padding:14px 16px;
  display:flex;
  align-items:center;
  gap:12px;
  color:#f9fafb;
  box-shadow:0 16px 40px rgba(15,23,42,.25);
  border:1px solid rgba(148,163,184,.45);
}

/* ì¹´ë“œë³„ ê·¸ë¼ë””ì–¸íŠ¸ ìƒ‰ */
.summary-card--posts{
  background:linear-gradient(135deg,#6366f1,#3b82f6);
}
.summary-card--avg{
  background:linear-gradient(135deg,#0ea5e9,#22c55e);
}
.summary-card--trimmed{
  background:linear-gradient(135deg,#ec4899,#8b5cf6);
}
.summary-card--best{
  background:linear-gradient(135deg,#14b8a6,#38bdf8);
}

/* ì™¼ìª½ ë™ê·¸ë€ ë§ */
.summary-ring{
  width:46px;
  height:46px;
  border-radius:999px;
  border:3px solid rgba(248,250,252,.75);
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(15,23,42,.18);
  backdrop-filter:blur(6px);
  flex-shrink:0;
}
.summary-ring span{
  font-size:18px;
}

.summary-text{
  display:flex;
  flex-direction:column;
  gap:2px;
}

.summary-label{
  font-size:11px;
  opacity:0.9;
}
.summary-value{
  font-size:18px;
  font-weight:800;
}
.summary-sub{
  font-size:10px;
  opacity:0.9;
}


.section-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;
  margin-bottom:10px;
  gap:8px;
}
.section-title{
  font-size:14px;
  font-weight:700;
  display:flex;
  gap:6px;
  align-items:center;
}
.section-sub{
  font-size:11px;
  color:var(--text-muted);
}

.grade-legend{
  display:flex;
  gap:6px;
  flex-wrap:wrap;
  font-size:10px;
  color:var(--text-muted);
}
.grade-dot{width:8px;height:8px;border-radius:999px}
.grade-dot.s{background:var(--grade-s)}
.grade-dot.a{background:var(--grade-a)}
.grade-dot.b{background:var(--grade-b)}
.grade-dot.c{background:var(--grade-c)}
.grade-dot.d{background:var(--grade-d)}

.grade-tabs{
  display:flex;
  gap:6px;
  flex-wrap:wrap;
  margin-bottom:10px;
}
.grade-tab{
  padding:4px 10px;
  border-radius:999px;
  font-size:11px;
  border:1px solid rgba(209,213,219,.9);
  background:#ffffff;
  color:var(--text-muted);
  cursor:pointer;
  display:flex;
  gap:6px;
  align-items:center;
  transition:background .15s ease, transform .1s ease;
}
.grade-tab:hover{
  transform:translateY(-1px);
}
.grade-tab-dot{width:8px;height:8px;border-radius:999px}
.grade-tab.active{
  background:linear-gradient(135deg,#4f46e5,#06b6d4);
  color:#f9fafb;
  border-color:transparent;
}

.table-wrap{
  width:100%;overflow:auto;border-radius:14px;
  border:1px solid rgba(226,232,240,.9);
  background:#ffffff;
}
table{width:100%;border-collapse:collapse;min-width:680px;font-size:11px}
th,td{padding:8px;border-bottom:1px solid rgba(226,232,240,1);vertical-align:top}
th{
  background:#f8fafc;
  color:#6b7280;
  text-transform:uppercase;
  font-size:10px;
  position:sticky;top:0;z-index:1;
}
tr:last-child td{border-bottom:none}
tbody tr:hover td{background:#f9fafb}

.grade-badge{
  display:inline-flex;min-width:24px;padding:3px 7px;border-radius:999px;
  font-size:11px;font-weight:700;justify-content:center;
}
.grade-badge.s{background:rgba(251,191,36,.12);border:1px solid rgba(251,191,36,.8);color:var(--grade-s)}
.grade-badge.a{background:rgba(56,189,248,.12);border:1px solid rgba(56,189,248,.8);color:var(--grade-a)}
.grade-badge.b{background:rgba(34,197,94,.12);border:1px solid rgba(34,197,94,.8);color:var(--grade-b)}
.grade-badge.c{background:rgba(168,85,247,.12);border:1px solid rgba(168,85,247,.8);color:var(--grade-c)}
.grade-badge.d{background:rgba(148,163,184,.16);border:1px solid rgba(148,163,184,1);color:var(--grade-d)}

.stat-chip{
  display:inline-flex;gap:3px;font-size:10px;color:var(--text-muted);
  padding:2px 6px;border-radius:999px;border:1px solid rgba(209,213,219,1);
  background:#f9fafb;
}
.stat-chip strong{color:#111827}
.link-pill{
  padding:3px 7px;border-radius:999px;font-size:10px;
  border:1px solid rgba(59,130,246,.9);
  background:rgba(239,246,255,1);color:#1d4ed8;text-decoration:none;
  white-space:nowrap;
}

.leader-input-row{
  margin-bottom:10px;display:flex;gap:8px;flex-wrap:wrap;align-items:center;
}
.leader-input{
  flex:1;min-width:200px;
  border-radius:999px;border:1px solid rgba(209,213,219,1);
  background:#ffffff;color:#111827;
  padding:8px 14px;font-size:12px;
}
.leader-btn{
  border-radius:999px;border:none;
  background:linear-gradient(135deg,#4f46e5,#06b6d4);
  color:white;font-size:12px;padding:8px 16px;
  cursor:pointer;font-weight:600;
  box-shadow:0 10px 22px rgba(79,70,229,.45);
}
.leader-btn:disabled{opacity:.5;cursor:default}
.leader-note{font-size:11px;color:var(--text-muted);margin-top:2px}
.empty{font-size:12px;color:var(--text-muted);padding:8px 4px;text-align:center}

.text-main{font-size:11px;word-break:break-word;}
.text-meta{font-size:10px;color:var(--text-muted);margin-top:2px;}
.grade-chip{font-size:11px;color:var(--text-muted);}

.sort-select{
  border-radius:999px;
  border:1px solid rgba(209,213,219,1);
  background:#ffffff;
  color:#374151;
  font-size:11px;
  padding:4px 8px;
}

/* í”„ë¡œì íŠ¸ ë·° ì¶”ê°€ ìŠ¤íƒ€ì¼ */
.project-charts-row{
  overflow:hidden;
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  justify-content:center;
}
.project-chart-single{
  flex:1;
  min-width:220px;
  max-width:320px;
}
.project-charts-row canvas{
  width:100% !important;
  height:160px;
}
.project-chart-title{
  font-size:13px;
  font-weight:600;
  color:var(--text-main);
  text-align:center;
  margin-bottom:8px;
}
.project-chart-wrap,
.project-grade-chart-wrap{
  width:100%;
  max-width:420px;
  margin:0 auto 12px;
}
.project-detail-controls{
  margin-top:14px;
  margin-bottom:8px;
  display:flex;
  gap:8px;
  align-items:center;
  flex-wrap:wrap;
  font-size:12px;
}
.project-select{
  border-radius:999px;
  border:1px solid rgba(209,213,219,1);
  background:#ffffff;
  padding:6px 10px;
  font-size:12px;
}

/* ì½”ì¹˜ ë´‡ ì¹´ë“œ */
.bot-card{
  background:
    radial-gradient(circle at 0% 0%, #e0f2fe, transparent 55%),
    radial-gradient(circle at 100% 0%, #ddd6fe, transparent 55%),
    #ffffff;
  position:relative;
  overflow:hidden;
}
.bot-chip{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:4px 9px;
  border-radius:999px;
  font-size:11px;
  background:rgba(15,23,42,.05);
  border:1px solid rgba(148,163,184,.5);
  margin-bottom:6px;
}
.bot-output{
  font-size:11px;
  color:#111827;
  line-height:1.5;
  white-space:pre-line;
}
.bot-hint{
  font-size:10px;
  color:var(--text-muted);
  margin-top:6px;
}
  </style>
</head>

<body>
<div class="layout">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <button id="sidebar-toggle" class="sidebar-toggle">âŸ¨</button>

    <div>
      <div class="side-profile">
        <div class="side-avatar">
          <img id="side-avatar-img" src="https://unavatar.io/twitter/bud_dha__" alt="avatar">
        </div>
        <div>
          <div class="side-name" id="side-username">ê²ŒìŠ¤íŠ¸</div>
          <a id="side-handle-link" href="https://twitter.com" target="_blank" class="side-handle">@ë¡œê·¸ì¸ í•„ìš”</a>
          <button type="button" class="side-login-btn" id="x-login-btn" onclick="handleAuthClick()">Googleë¡œ ë¡œê·¸ì¸</button>
        </div>
      </div>

      <div class="side-nav">
        <div class="side-nav-item active" data-view="dashboard">
          <span class="icon">ğŸ“Š</span><span class="side-label" id="nav-dashboard-label">Dashboard</span>
        </div>
        <div class="side-nav-item" data-view="leaderboard">
          <span class="icon">ğŸ†</span><span class="side-label" id="nav-leaderboard-label">ë¦¬ë”ë³´ë“œ</span>
        </div>
        <div class="side-nav-item" data-view="history">
          <span class="icon">ğŸ—‚</span><span class="side-label" id="nav-history-label">ë‚´ íˆìŠ¤í† ë¦¬</span>
        </div>
        <div class="side-nav-item" data-view="projects">
          <span class="icon">ğŸ“š</span><span class="side-label" id="nav-projects-label">í”„ë¡œì íŠ¸ë³„ ë§ˆì¸ë“œì‰ì–´</span>
        </div>
        <a class="side-nav-item" href="https://buddha913.github.io/crypto-fullcourse/" target="_blank">
          <span class="icon">ğŸ“˜</span><span class="side-label" id="nav-course-label">í¬ë¦½í†  í’€ì½”ìŠ¤</span>
        </a>
      </div>
    </div>

    <div class="side-footer">
      InfoFi Creator Console (Beta)
      <div class="side-badge">
        ì˜¤ëŠ˜ë„ í•œ ë²ˆ<br>ë§ˆì‰ í„°íŠ¸ë ¤ë³¼ê¹Œ? ğŸ’¥
      </div>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main">

    <!-- â–¼â–¼ Dashboard í™”ë©´ â–¼â–¼ -->
    <div id="view-dashboard">
      <div class="top-nav">
        <div>
          <div class="top-title">X í¬ë¦¬ì—ì´í„° ë§ˆì¸ë“œì‰ì–´ ë¶„ì„ê¸°</div>
          <div class="top-sub">ì• ë„ë¦¬í‹±ìŠ¤ CSVë¡œ ë‚´ ê³„ì •ì˜ ì§„ì§œ ì„íŒ©íŠ¸ë¥¼ ë³´ëŠ” ëŒ€ì‹œë³´ë“œ</div>
        </div>
        <div class="top-cta">
          <div class="lang-toggle">
            <button class="lang-btn" data-lang="ko">í•œêµ­ì–´</button>
            <button class="lang-btn" data-lang="en">EN</button>
          </div>
          <a class="top-link" href="https://analytics.twitter.com/user" target="_blank">
            X ì• ë„ë¦¬í‹±ìŠ¤ ì—´ê¸° â†—
          </a>
        </div>
      </div>

      <!-- HERO -->
      <section class="hero-card">
        <div class="hero-top-row">
          <div>
            <div class="hero-main-title">ë§ˆì¸ë“œì‰ì–´ ìŠ¤ì½”ì–´ Â· S~D ë“±ê¸‰ Â· ë¦¬ë”ë³´ë“œê¹Œì§€ í•œ ë²ˆì—</div>
            <div class="hero-desc">
              X ì• ë„ë¦¬í‹±ìŠ¤ì—ì„œ CSVë¥¼ ë‚´ë ¤ë°›ê³  ì´ê³³ì— ì—…ë¡œë“œí•˜ë©´,<br>
              ì›ê¸€ ê¸°ì¤€ìœ¼ë¡œ ë§ˆì¸ë“œì‰ì–´ ì ìˆ˜ì™€ ìƒìœ„ ê¸€, ë¦¬ë”ë³´ë“œê¹Œì§€ í•œ ë²ˆì— ë¶„ì„í•  ìˆ˜ ìˆì–´.
            </div>
            <div class="hero-pill"><span class="hero-dot"></span> CSV í•œ ë²ˆ â†’ ê³„ì • ë¶„ì„ ë</div>
          </div>
        </div>

        <div class="hero-upload-row">
          <div class="file-input-wrap">
            <div class="file-input-fake">ğŸ“ CSV íŒŒì¼ ì„ íƒí•˜ê¸°</div>
            <input type="file" id="csvInput" accept=".csv"/>
          </div>
          <span class="file-hint">account_analytics_content_YYYY-MM-DD_YYYY-MM-DD.csv ê·¸ëŒ€ë¡œ ì—…ë¡œë“œ</span>
        </div>

        <div class="badge"><span class="badge-dot"></span>í•œêµ­ì–´/ì˜ì–´ CSV ìë™ ì¸ì‹ Â· ë‹µê¸€ ì œì™¸ í›„ ì›ê¸€ë§Œ ë¶„ì„</div>

        <div id="range-tabs" class="range-tabs" style="display:none">
          <button class="range-tab active" data-range="ALL">ì „ì²´ ê¸°ê°„</button>
          <button class="range-tab" data-range="7">ìµœê·¼ 7ì¼</button>
          <button class="range-tab" data-range="30">ìµœê·¼ 30ì¼</button>
          <button class="range-tab" data-range="90">ìµœê·¼ 90ì¼</button>
        </div>

        <div id="summary" class="summary-grid" style="display:none"></div>
        <div id="error" class="error"></div>
      </section>

      <!-- ë©”ì¸ ê·¸ë¦¬ë“œ: ì™¼ìª½(í‘œ), ì˜¤ë¥¸ìª½(ë´‡/ìš”ì•½) -->
      <div class="grid-1">
        <div class="column-main">
<!-- ğŸ“ˆ ê³„ì • ì„±ì¥ ê·¸ë˜í”„ ì¹´ë“œ -->
    <section class="card growth-card">
      <div class="growth-card-title" id="growth-title">ğŸ“ˆ ê³„ì • ì„±ì¥ ê·¸ë˜í”„</div>
      <div class="growth-card-sub" id="growth-sub">
        ìµœê·¼ ê¸°ê°„ ë™ì•ˆ ì›ê¸€ ê°œìˆ˜ / í‰ê·  ìŠ¤ì½”ì–´ ì¶”ì´ë¥¼ ê·¸ë˜í”„ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤.
      </div>
      <div class="growth-chart-wrap">
        <!-- ë‚˜ì¤‘ì— JSì—ì„œ ì±„ìš¸ ìº”ë²„ìŠ¤ -->
        <canvas id="growth-chart" height="140"></canvas>
      </div>
    </section>
          <section class="card">
            <div class="section-header">
              <div class="section-title" id="top10-title">
                ğŸ’¥ ë§ˆì¸ë“œì‰ì–´ í­ë°œ Top 10 <span id="top10-count"></span>
              </div>
              <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
                <div class="grade-chip">ì ìˆ˜ ê¸°ì¤€ Â· <strong>ë§ˆì¸ë“œì‰ì–´ ìŠ¤ì½”ì–´</strong></div>
                <select id="sort-key" class="sort-select">
                  <option value="score">ì •ë ¬: ìŠ¤ì½”ì–´</option>
                  <option value="impressions">ì •ë ¬: ë…¸ì¶œìˆ˜</option>
                  <option value="engagements">ì •ë ¬: ì°¸ì—¬ìˆ˜</option>
                  <option value="bookmarks">ì •ë ¬: ë¶ë§ˆí¬</option>
                  <option value="newFollows">ì •ë ¬: ì‹ ê·œ íŒ”ë¡œìš°</option>
                </select>
              </div>
            </div>
            <div class="table-wrap" id="top10-table-wrap"></div>
          </section>

          <section class="card">
            <div class="section-header">
              <div class="section-title" id="grade-section-title">ğŸš ë“±ê¸‰ë³„ ìƒìœ„ ê²Œì‹œê¸€ <span>(S~D)</span></div>
              <div class="grade-legend">
                <span><span class="grade-dot s"></span>S ìƒìœ„ 5%</span>
                <span><span class="grade-dot a"></span>A ìƒìœ„ 20%</span>
                <span><span class="grade-dot b"></span>B ìƒìœ„ 40%</span>
                <span><span class="grade-dot c"></span>C ìƒìœ„ 60%</span>
                <span><span class="grade-dot d"></span>D ê·¸ ì™¸</span>
              </div>
            </div>

            <div class="grade-tabs">
              <button class="grade-tab active" data-grade="ALL"><span class="grade-tab-dot" style="background:linear-gradient(90deg,var(--grade-s),var(--grade-a),var(--grade-b))"></span>ì „ì²´</button>
              <button class="grade-tab" data-grade="S"><span class="grade-tab-dot" style="background:var(--grade-s)"></span>S ë“±ê¸‰</button>
              <button class="grade-tab" data-grade="A"><span class="grade-tab-dot" style="background:var(--grade-a)"></span>A ë“±ê¸‰</button>
              <button class="grade-tab" data-grade="B"><span class="grade-tab-dot" style="background:var(--grade-b)"></span>B ë“±ê¸‰</button>
              <button class="grade-tab" data-grade="C"><span class="grade-tab-dot" style="background:var(--grade-c)"></span>C ë“±ê¸‰</button>
              <button class="grade-tab" data-grade="D"><span class="grade-tab-dot" style="background:var(--grade-d)"></span>D ë“±ê¸‰</button>
            </div>

            <div class="table-wrap" id="grade-table-wrap"></div>
          </section>
        </div>

        <!-- ì˜¤ë¥¸ìª½: ì½”ì¹˜ ë´‡ -->
        <div class="column-side">
          <section class="card bot-card">
            <div class="section-header">
              <div class="section-title" id="coach-title">ğŸ¤– ë§ˆì¸ë“œì‰ì–´ ì½”ì¹˜ ë´‡ <span style="font-size:11px;color:var(--text-muted);">(Beta)</span></div>
            </div>
            <div class="bot-chip">
              <span>ğŸ“Œ</span><span id="coach-chip-text">í˜„ì¬ ì„ íƒí•œ ê¸°ê°„ ê¸°ì¤€ í•œ ì¤„ ìš”ì•½ + í”¼ë“œë°±</span>
            </div>
            <div id="coach-output" class="bot-output">
              ì•„ì§ CSVë¥¼ ì˜¬ë¦¬ì§€ ì•Šì•˜ì–´.<br>
              ìƒë‹¨ì—ì„œ ì• ë„ë¦¬í‹±ìŠ¤ CSVë¥¼ ì—…ë¡œë“œí•˜ê³  ê¸°ê°„ íƒ­(ì „ì²´/7/30/90ì¼)ì„ ë°”ê¾¸ë©´<br>
              ì´ êµ¬ê°„ì˜ ë§ˆì¸ë“œì‰ì–´ ìƒíƒœë¥¼ ì½”ì¹˜ ë´‡ì´ ìë™ìœ¼ë¡œ ìš”ì•½í•´ ì¤„ ê±°ì•¼.
            </div>
            <div class="bot-hint">
              * ì„œë²„/LLM í˜¸ì¶œ ì—†ì´, ë‚´ ì• ë„ë¦¬í‹±ìŠ¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê·œì¹™ì ìœ¼ë¡œ ìš”ì•½í•´ ì£¼ëŠ” ì˜¤í”„ë¼ì¸ ì½”ì¹˜ì•¼.
            </div>
          </section>
        </div>
      </div>
    </div>
    <!-- â–²â–² Dashboard ë â–²â–² -->


    <!-- â–¼â–¼ ë¦¬ë”ë³´ë“œ í™”ë©´ â–¼â–¼ -->
    <div id="view-leaderboard" style="display:none;">
      <div class="top-nav">
        <div>
          <div class="top-title">í¬ë¦¬ì—ì´í„° ë§ˆì¸ë“œì‰ì–´ ë¦¬ë”ë³´ë“œ</div>
          <div class="top-sub">ë‚´ ìˆœìœ„ Â· íŠ¸ë¦¼ë“œ í‰ê·  Â· ëŒ€í‘œ íŠ¸ìœ—ì„ í•œ ëˆˆì— ë³´ëŠ” ë­í‚¹ ë³´ë“œ</div>
        </div>
      </div>

      <section id="leaderboard-section" class="card" style="margin-top:8px;">
        <div class="section-header">
          <div class="section-title">ğŸ† í¬ë¦¬ì—ì´í„° ë§ˆì¸ë“œì‰ì–´ ë¦¬ë”ë³´ë“œ (Beta)</div>
        </div>

        <div class="leader-input-row">
          <input id="leader-handle" class="leader-input" placeholder="X í•¸ë“¤ ì…ë ¥ (ì˜ˆ: @bud_dha__)" />
          <button id="leader-save-btn" class="leader-btn">í˜„ì¬ ë¶„ì„ ê²°ê³¼ ì €ì¥</button>
        </div>
        <div class="leader-note" id="leader-note">â€» ìµœì†Œ ì›ê¸€ ìˆ˜ 20ê°œ ì´ìƒì¼ ë•Œ ë¦¬ë”ë³´ë“œ ì ìˆ˜ê°€ ë” ì •í™•í•©ë‹ˆë‹¤.</div>

        <div id="my-rank-wrap" style="margin-top:10px"></div>
        <div class="table-wrap" id="leaderboard-wrap" style="margin-top:10px"></div>
      </section>
    </div>
    <!-- â–²â–² ë¦¬ë”ë³´ë“œ í™”ë©´ ë â–²â–² -->


    <!-- â–¼â–¼ ë‚´ íˆìŠ¤í† ë¦¬ í™”ë©´ â–¼â–¼ -->
    <div id="view-history" style="display:none;">
      <div class="top-nav">
        <div>
          <div class="top-title">ë‚´ ë¶„ì„ íˆìŠ¤í† ë¦¬</div>
          <div class="top-sub">CSVë¥¼ ì—…ë¡œë“œí•  ë•Œë§ˆë‹¤ ì´ê³³ì— ìš”ì•½ ê¸°ë¡ì´ ìë™ìœ¼ë¡œ ìŒ“ì…ë‹ˆë‹¤.</div>
        </div>
      </div>

      <section class="card" style="margin-top:8px;">
        <div class="section-header">
          <div class="section-title">ğŸ“† ì—…ë¡œë“œ ê¸°ë¡</div>
          <div class="section-sub">ìµœê·¼ ì—…ë¡œë“œ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ë©ë‹ˆë‹¤. (ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥)</div>
        </div>
        <div class="table-wrap" id="history-wrap">
          <div class="empty">ì•„ì§ ì €ì¥ëœ ë¶„ì„ íˆìŠ¤í† ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤. CSVë¥¼ ì—…ë¡œë“œí•˜ë©´ ì—¬ê¸° ê¸°ë¡ì´ ìŒ“ì…ë‹ˆë‹¤.</div>
        </div>
      </section>
    </div>
    <!-- â–²â–² íˆìŠ¤í† ë¦¬ í™”ë©´ ë â–²â–² -->

    <!-- â–¼â–¼ í”„ë¡œì íŠ¸ë³„ ë§ˆì¸ë“œì‰ì–´ í™”ë©´ â–¼â–¼ -->
    <div id="view-projects" style="display:none;">
      <div class="top-nav">
        <div>
          <div class="top-title">í”„ë¡œì íŠ¸ë³„ ë§ˆì¸ë“œì‰ì–´</div>
          <div class="top-sub">íŠ¸ìœ— ë³¸ë¬¸ í‚¤ì›Œë“œ ê¸°ì¤€ìœ¼ë¡œ í”„ë¡œì íŠ¸ë³„ ì„íŒ©íŠ¸ì™€ ê²Œì‹œê¸€/ë“±ê¸‰ì„ ë¶„ì„í•©ë‹ˆë‹¤.</div>
        </div>
      </div>

      <section class="card card-soft">
        <div class="section-header">
          <div class="section-title" id="project-summary-title">ğŸ“š í”„ë¡œì íŠ¸ ìš”ì•½ + ì›í˜• ê·¸ë˜í”„</div>
          <div class="section-sub" id="project-summary-sub">ì½”ë“œ ìƒë‹¨ <code>PROJECTS</code> ë°°ì—´ì˜ í‚¤ì›Œë“œë¥¼ ë„¤ê°€ íŠ¸ëŠ” í”„ë¡œì íŠ¸ì— ë§ê²Œ ë°”ê¿”ì¤˜.</div>
        </div>

        <div class="project-charts-row">
          <div class="project-chart-single">
            <div class="project-chart-title" id="proj-chart-title-1">í”„ë¡œì íŠ¸ë³„ ê²Œì‹œê¸€ ë¹„ìœ¨</div>
            <canvas id="project-pie"></canvas>
          </div>
          <div class="project-chart-single">
            <div class="project-chart-title" id="proj-chart-title-2">ì„ íƒ ê¸°ê°„ ì „ì²´ S~D ë“±ê¸‰ ë¶„í¬</div>
            <canvas id="grade-distribution-pie"></canvas>
          </div>
          <div class="project-chart-single">
            <div class="project-chart-title" id="proj-chart-title-3">ì„ íƒ í”„ë¡œì íŠ¸ S~D ë“±ê¸‰ ë¶„í¬</div>
            <canvas id="project-grade-pie"></canvas>
          </div>
        </div>

        <div class="table-wrap" id="project-summary-wrap">
          <div class="empty">ë¨¼ì € Dashboardì—ì„œ CSVë¥¼ ì—…ë¡œë“œí•˜ê³  ë¶„ì„ì„ í•œ ë²ˆ ëŒë ¤ì¤˜.</div>
        </div>

        <div class="project-detail-controls">
          <span>ğŸ” í”„ë¡œì íŠ¸ë³„ ê²Œì‹œê¸€ ë³´ê¸°</span>
          <select id="project-select" class="project-select">
            <option value="">CSV ì—…ë¡œë“œ í›„ ìë™ í™œì„±í™”ë©ë‹ˆë‹¤.</option>
          </select>
        </div>
        <div class="table-wrap" id="project-detail-wrap">
          <div class="empty">í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•˜ë©´ í•´ë‹¹ í”„ë¡œì íŠ¸ì˜ ê²Œì‹œê¸€ê³¼ ë“±ê¸‰ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
        </div>
      </section>
    </div>
    <!-- â–²â–² í”„ë¡œì íŠ¸ í™”ë©´ ë â–²â–² -->

  </main>
</div>

<!-- Supabase JS (Google ë¡œê·¸ì¸ìš©) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
// ===== Supabase Google ë¡œê·¸ì¸ ì„¤ì • =====
const SUPABASE_URL = "https://ejqrnapdwblbqvnperid.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable_ltaNA7nnVozoSCOcZljg";

let supabaseClient = null;

// ì‚¬ì´ë“œë°”ì— ì‚¬ìš©ì ì •ë³´ ë°˜ì˜
function applyUserToSidebar(user){
  const nameSpan   = document.getElementById("side-username");
  const handleLink = document.getElementById("side-handle-link");
  const avatarImg  = document.getElementById("side-avatar-img");
  const btn        = document.getElementById("x-login-btn");
  if (!nameSpan || !handleLink || !btn) return;

  if (!user) {
    nameSpan.textContent = "ê²ŒìŠ¤íŠ¸";
    handleLink.textContent = "@ë¡œê·¸ì¸ í•„ìš”";
    handleLink.href = "https://twitter.com";
    if (avatarImg) {
      avatarImg.src = "https://unavatar.io/twitter/bud_dha__";
    }
    btn.textContent = "Googleë¡œ ë¡œê·¸ì¸";
  } else {
    const fullName = user.user_metadata?.name
                  || user.user_metadata?.full_name
                  || "X ì‚¬ìš©ì";
    const nick = user.user_metadata?.user_name
              || user.user_metadata?.preferred_username
              || "";
    const handle = nick ? "@" + nick : "@x-user";

    nameSpan.textContent = fullName;
    handleLink.textContent = handle + " â†—";
    handleLink.href = nick ? ("https://twitter.com/" + nick) : "https://twitter.com";

    if (avatarImg) {
      const avatarUrl = user.user_metadata?.avatar_url || user.user_metadata?.picture;
      if (avatarUrl) avatarImg.src = avatarUrl;
    }
    btn.textContent = "ë¡œê·¸ì•„ì›ƒ";
  }
}

// OAuth ë¦¬ë‹¤ì´ë ‰íŠ¸ code ì²˜ë¦¬ + ì„¸ì…˜ ë¡œë“œ
async function initSupabaseAuth(){
  if (typeof supabase === "undefined") {
    console.warn("Supabase JS ë¡œë“œ ì•ˆ ë¨");
    return;
  }

  if (!supabaseClient) {
    supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  }

  // 1) ë¦¬ë‹¤ì´ë ‰íŠ¸ë¡œ ëŒì•„ì˜¨ ê²½ìš° code â†’ ì„¸ì…˜ êµí™˜
  try {
    const url = new URL(window.location.href);
    const code = url.searchParams.get("code");
    const errorDesc = url.searchParams.get("error_description");

    if (errorDesc) {
      console.warn("OAuth error:", errorDesc);
    }

    if (code) {
      const { error } = await supabaseClient.auth.exchangeCodeForSession(url.href);
      if (error) {
        console.error("exchangeCodeForSession error", error);
      } else {
        // URL ì •ë¦¬ (code íŒŒë¼ë¯¸í„° ì œê±°)
        window.history.replaceState({}, document.title, url.origin + url.pathname + url.hash);
      }
    }
  } catch (e) {
    console.warn("OAuth ì½”ë“œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜", e);
  }

  // 2) í˜„ì¬ ì„¸ì…˜ ê¸°ì¤€ ì‚¬ì´ë“œë°” ì—…ë°ì´íŠ¸
  try {
    const { data, error } = await supabaseClient.auth.getUser();
    if (error) {
      console.warn("auth.getUser ì˜¤ë¥˜", error);
    }
    const user = data?.user || null;
    applyUserToSidebar(user);
  } catch (e) {
    console.warn("getUser í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜", e);
  }

  // 3) ë¡œê·¸ì¸ ìƒíƒœ ë³€ê²½ ì‹œë§ˆë‹¤ ì‚¬ì´ë“œë°” ìë™ ê°±ì‹ 
  try {
    supabaseClient.auth.onAuthStateChange((_event, session) => {
      applyUserToSidebar(session?.user ?? null);
    });
  } catch(e) {
    console.warn("onAuthStateChange ë“±ë¡ ì˜¤ë¥˜", e);
  }
}

// ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ì´ë²¤íŠ¸ ë“±ë¡
function setupAuthButton(){
  const btn = document.getElementById("x-login-btn");
  if (!btn) return;
  // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¡œ í•œ ë²ˆ, ì¸ë¼ì¸ onclickìœ¼ë¡œ í•œ ë²ˆ â€“ ë‘˜ ì¤‘ í•˜ë‚˜ë§Œ ë¨¹ì–´ë„ ë™ì‘í•˜ê²Œ
  btn.addEventListener("click", handleAuthClick);
}

async function handleAuthClick(){
  if (typeof supabase === "undefined") {
    alert("Supabase ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì˜¤ë¥˜ì…ë‹ˆë‹¤. (CDN ì°¨ë‹¨ ì—¬ë¶€ í™•ì¸)");
    return;
  }
  if (!supabaseClient) {
    supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  }

  try {
    const { data } = await supabaseClient.auth.getUser();
    const user = data?.user || null;

    if (user) {
      // ì´ë¯¸ ë¡œê·¸ì¸ ìƒíƒœë©´ ë¡œê·¸ì•„ì›ƒ
      await supabaseClient.auth.signOut();
      applyUserToSidebar(null);
      alert("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.");
    } else {
      // âœ… ê¼­ ë„¤ ì‹¤ì œ ì„œë¹„ìŠ¤ ì£¼ì†Œë¡œ ë°”ê¿” ë„£ì–´ì•¼ í•˜ëŠ” ë¶€ë¶„
      const FRONTEND_URL = "https://www.buddha-mindshare.com";

      const { data: signInData, error: signInErr } = await supabaseClient.auth.signInWithOAuth({
        provider: "google",
        options: {
          redirectTo: FRONTEND_URL,
          skipBrowserRedirect: true   // ìš°ë¦¬ê°€ ì§ì ‘ location ì´ë™
        }
      });
      if (signInErr) {
        console.error("Google ë¡œê·¸ì¸ ì˜¤ë¥˜", signInErr);
        alert("Google ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + (signInErr.message || signInErr));
      } else if (signInData?.url) {
        // Supabaseê°€ ì¤€ ë¡œê·¸ì¸ URLë¡œ ê°•ì œ ì´ë™
        window.location.href = signInData.url;
      } else {
        alert("ë¡œê·¸ì¸ URLì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. Supabase ì„¤ì •ì„ ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”.");
      }
    }
  } catch(e) {
    console.warn("ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜", e);
    alert("ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + (e.message || e));
  }
}
// í˜ì´ì§€ ë¡œë“œ í›„ ì´ˆê¸°í™”
document.addEventListener("DOMContentLoaded", () => {
  try {
    initSupabaseAuth();
  } catch(e) {
    console.warn("Supabase ì´ˆê¸°í™” ì‹¤íŒ¨", e);
  }
  setupAuthButton();
});
</script>


<script>
/* ========= ì„¤ì • ========= */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw0yJIOdUoeRNwMn9fys-5ePI6UX6wkqBVhWNLrZ-gomO1sGNgTUJbhO0Kfj0n2QgdC/exec";
const MIN_POSTS_FOR_LEADERBOARD = 20;
const TRIM_RATIO = 0.1;
let CURRENT_LANG = "ko";

/* í”„ë¡œì íŠ¸ í‚¤ì›Œë“œ (ì›í•˜ë©´ ì—¬ê¸° ìˆ˜ì •) */
/* í”„ë¡œì íŠ¸ í‚¤ì›Œë“œ (ì´ë¯¸ì§€ì— ë‚˜ì˜¨ í”„ë¡œì íŠ¸ + ì£¼ìš” ì•¼í•‘ í”„ë¡œì íŠ¸) */
const PROJECTS = [
  // --- L0 / L1 ---
  { id: "aptos",       label: "Aptos",                  category: "L0/L1", keywords: ["aptos"] },
  { id: "beldex",      label: "Beldex",                 category: "L0/L1", keywords: ["beldex"] },
  { id: "berachain",   label: "Berachain",              category: "L0/L1", keywords: ["berachain"] },
  { id: "camp",        label: "Camp Network",           category: "L0/L1", keywords: ["camp network","campnet"] },
  { id: "ethereum",    label: "Ethereum",               category: "L0/L1", keywords: ["ethereum","eth "] },
  { id: "fogo",        label: "Fogo",                   category: "L0/L1", keywords: ["fogo"] },
  { id: "injective",   label: "Injective",              category: "L0/L1", keywords: ["injective","inj "] },
  { id: "irys",        label: "Irys",                   category: "L0/L1", keywords: ["irys"] },
  { id: "kaia",        label: "Kaia",                   category: "L0/L1", keywords: ["kaia"] },
  { id: "mantra",      label: "MANTRA",                 category: "L0/L1", keywords: ["mantra"] },
  { id: "mavryk",      label: "Mavryk",                 category: "L0/L1", keywords: ["mavryk"] },
  { id: "mitosis",     label: "Mitosis",                category: "L0/L1", keywords: ["mitosis"] },
  { id: "monad",       label: "Monad",                  category: "L0/L1", keywords: ["monad"] },
  { id: "movement",    label: "Movement",               category: "L0/L1", keywords: ["movement"] },
  { id: "near",        label: "Near",                   category: "L0/L1", keywords: ["near"] },
  { id: "peaq",        label: "PEAQ",                   category: "L0/L1", keywords: ["peaq"] },
  { id: "polkadot",    label: "Polkadot",               category: "L0/L1", keywords: ["polkadot","dot "] },
  { id: "sei",         label: "Sei",                    category: "L0/L1", keywords: ["sei "] },
  { id: "somnia",      label: "Somnia",                 category: "L0/L1", keywords: ["somnia"] },
  { id: "sonic",       label: "Sonic (L1)",             category: "L0/L1", keywords: ["sonic chain","sonic l1","sonic mainnet"] },
  { id: "story",       label: "Story",                  category: "L0/L1", keywords: ["story protocol","story chain"] },
  { id: "xion",        label: "XION",                   category: "L0/L1", keywords: ["xion"] },

  // --- L2 ---
  { id: "arbitrum",    label: "Arbitrum",               category: "L2",    keywords: ["arbitrum","arb "] },
  { id: "katana",      label: "Katana",                 category: "L2",    keywords: ["katana"] },
  { id: "mantle",      label: "Mantle",                 category: "L2",    keywords: ["mantle"] },
  { id: "megaeth",     label: "MegaETH",                category: "L2",    keywords: ["megaeth"] },
  { id: "polygon",     label: "Polygon",                category: "L2",    keywords: ["polygon","matic"] },
  { id: "soon",        label: "SOON",                   category: "L2",    keywords: ["soon network","soon chain"] },

  // --- DeFi / Infra ---
  { id: "falcon",      label: "Falcon Finance",         category: "DeFi",  keywords: ["falcon finance","falconfi"] },
  { id: "frax",        label: "Frax",                   category: "DeFi",  keywords: ["frax"] },
  { id: "huma",        label: "Huma",                   category: "DeFi",  keywords: ["huma"] },
  { id: "moremarkets", label: "MoreMarkets",            category: "DeFi",  keywords: ["moremarkets","more markets"] },
  { id: "multipli",    label: "Multipli",               category: "DeFi",  keywords: ["multipli"] },
  { id: "noble",       label: "Noble",                  category: "DeFi",  keywords: ["noble chain","noble network"] },
  { id: "orderly",     label: "Orderly",                category: "DeFi",  keywords: ["orderly","orderly network","orderly omni"] },
  { id: "pyth",        label: "Pyth",                   category: "DeFi",  keywords: ["pyth oracle","pyth network"] },
  { id: "soul",        label: "Soul Protocol",          category: "DeFi",  keywords: ["soul protocol"] },
  { id: "stbl",        label: "STBL",                   category: "DeFi",  keywords: ["stbl","usst","yld","stablecoin 2.0"] },
  { id: "turtle",      label: "Turtle Club",            category: "DeFi",  keywords: ["turtle club"] },
  { id: "walrus",      label: "Walrus",                 category: "DeFi",  keywords: ["walrus"] },

  // --- AI Agents / Agent Infra ---
  { id: "creatorbid",  label: "CreatorBid",             category: "AI Agents", keywords: ["creatorbid"] },
  { id: "infinit",     label: "INFINIT",                category: "AI Agents", keywords: ["infinit"] },
  { id: "newton",      label: "Newton",                 category: "AI Agents", keywords: ["newton ai"] },
  { id: "surf",        label: "Surf",                   category: "AI Agents", keywords: ["surf ai","surf agent"] },
  { id: "symphony",    label: "Symphony",               category: "AI Agents", keywords: ["symphony","symphony finance","symphony router"] },
  { id: "talus",       label: "Talus",                  category: "AI Agents", keywords: ["talus"] },
  { id: "theoriq",     label: "Theoriq",                category: "AI Agents", keywords: ["theoriq"] },
  { id: "virtuals",    label: "Virtuals Protocol",      category: "AI Agents", keywords: ["virtuals","virtuals protocol"] },
  { id: "warden",      label: "Warden Protocol",        category: "AI Agents", keywords: ["warden protocol"] },
  { id: "wayfinder",   label: "Wayfinder",              category: "AI Agents", keywords: ["wayfinder"] },

  // --- Culture / NFT ---
  { id: "anime",       label: "ANIME",                  category: "Culture", keywords: ["anime token","anime protocol"] },
  { id: "boop",        label: "Boop",                   category: "Culture", keywords: ["boop"] },
  { id: "doodles",     label: "Doodles",                category: "Culture", keywords: ["doodles"] },
  { id: "memex",       label: "MemeX",                  category: "Culture", keywords: ["memex"] },
  { id: "moonbirds",   label: "Moonbirds",              category: "Culture", keywords: ["moonbirds"] },
  { id: "pengu",       label: "PENGU",                  category: "Culture", keywords: ["pengu"] },

  // --- BTCFi ---
  { id: "corn",        label: "Corn",                   category: "BTCFi",  keywords: ["corn"] },
  { id: "goat",        label: "GOAT Network",           category: "BTCFi",  keywords: ["goat network"] },
  { id: "lombard",     label: "Lombard",                category: "BTCFi",  keywords: ["lombard"] },
  { id: "portalbtc",   label: "Portal to BTC",          category: "BTCFi",  keywords: ["portal to btc","portal btc"] },
  { id: "satlayer",    label: "SatLayer",               category: "BTCFi",  keywords: ["satlayer"] },

  // --- Robotics ---
  { id: "openmind",    label: "Openmind",               category: "Robotics", keywords: ["openmind"] },

  // --- ZK ---
  { id: "boundless",   label: "Boundless",              category: "ZK", keywords: ["boundless"] },
  { id: "brevis",      label: "Brevis",                 category: "ZK", keywords: ["brevis"] },
  { id: "cysic",       label: "Cysic",                  category: "ZK", keywords: ["cysic"] },
  { id: "miden",       label: "Miden",                  category: "ZK", keywords: ["miden"] },
  { id: "starknet",    label: "Starknet",               category: "ZK", keywords: ["starknet"] },
  { id: "succinct",    label: "Succinct",               category: "ZK", keywords: ["succinct"] },
  { id: "zcash",       label: "Zcash",                  category: "ZK", keywords: ["zcash"] },
  { id: "zkpass",      label: "zkPass",                 category: "ZK", keywords: ["zkpass"] },

  // --- Others ---
  { id: "anoma",       label: "Anoma",                  category: "Others", keywords: ["anoma"] },
  { id: "bless",       label: "Bless",                  category: "Others", keywords: ["bless protocol"] },
  { id: "bybittradfi", label: "Bybit TradFi",           category: "Others", keywords: ["bybit tradfi"] },
  { id: "humanity",    label: "Humanity Protocol",      category: "Others", keywords: ["humanity protocol"] },
  { id: "integra",     label: "Integra",                category: "Others", keywords: ["integra"] },
  { id: "multibank",   label: "Multibank",              category: "Others", keywords: ["multibank"] },
  { id: "thrive",      label: "Thrive Protocol",        category: "Others", keywords: ["thrive protocol"] },

  // --- Exchange / Perp ---
  { id: "apex",        label: "ApeX",                   category: "Exchange", keywords: ["apex pro","apex dex"] },
  { id: "bluefin",     label: "Bluefin",                category: "Exchange", keywords: ["bluefin"] },
  { id: "dydx",        label: "dYdX",                   category: "Exchange", keywords: ["dydx"] },
  { id: "flipster",    label: "Flipster",               category: "Exchange", keywords: ["flipster"] },
  { id: "mememax",     label: "MemeMax",                category: "Exchange", keywords: ["mememax","mememax_fi","@mememax_fi","memax"] },
  { id: "momentum",    label: "Momentum",               category: "Exchange", keywords: ["momentum"] },
  { id: "paradex",     label: "PARADEX",                category: "Exchange", keywords: ["paradex"] },

  // --- AI / InfoFi ---
  { id: "kaito",       label: "Kaito / Yapper",         category: "AI", keywords: ["kaito","kaito ai","yapper","yap points","infofi"] },
  { id: "og",          label: "OG",                     category: "AI", keywords: ["og protocol"] },
  { id: "allora",      label: "Allora",                 category: "AI", keywords: ["allora"] },
  { id: "billions",    label: "Billions Network",       category: "AI", keywords: ["billions network"] },
  { id: "edgen",       label: "Edgen",                  category: "AI", keywords: ["edgen"] },
  { id: "everlynai",   label: "EverlynAI",              category: "AI", keywords: ["everlynai"] },
  { id: "iq",          label: "IQ",                     category: "AI", keywords: ["iq ai","iq token"] },
  { id: "kindred",     label: "Kindred",                category: "AI", keywords: ["kindred"] },
  { id: "mira",        label: "Mira Network",           category: "AI", keywords: ["mira network"] },
  { id: "novastro",    label: "Novastro",               category: "AI", keywords: ["novastro"] },
  { id: "noya",        label: "Noya.ai",                category: "AI", keywords: ["noya.ai","noya ai"] },
  { id: "openledger",  label: "OpenLedger",             category: "AI", keywords: ["openledger"] },
  { id: "pipworld",    label: "PiP World",              category: "AI", keywords: ["pip world","pipworld"] },
  { id: "playai",      label: "PlayAI",                 category: "AI", keywords: ["playai","play ai"] },
  { id: "sapien",      label: "Sapien",                 category: "AI", keywords: ["sapien"] },
  { id: "sentient",    label: "Sentient",               category: "AI", keywords: ["sentient"] },
  { id: "uxlink",      label: "UXLINK",                 category: "AI", keywords: ["uxlink"] },

  // --- Consumer / Apps ---
  { id: "tria",        label: "Tria",                   category: "Consumer", keywords: ["tria","use tria","@useTria"] },
  { id: "anichess",    label: "Anichess",               category: "Consumer", keywords: ["anichess"] },
  { id: "bitdealer",   label: "Bitdealer",              category: "Consumer", keywords: ["bitdealer"] },
  { id: "defiapp",     label: "Defi App",               category: "Consumer", keywords: ["defi app"] },
  { id: "hana",        label: "Hana",                   category: "Consumer", keywords: ["hana app"] },
  { id: "infinex",     label: "Infinex",                category: "Consumer", keywords: ["infinex"] },
  { id: "lumiterra",   label: "Lumiterra",              category: "Consumer", keywords: ["lumiterra"] },
  { id: "maplestory",  label: "MapleStory Universe",    category: "Consumer", keywords: ["maplestory universe","msu"] },
  { id: "metawin",     label: "Metawin",                category: "Consumer", keywords: ["metawin"] },
  { id: "parti",       label: "Parti",                  category: "Consumer", keywords: ["parti"] },
  { id: "puffpaw",     label: "Puffpaw",                category: "Consumer", keywords: ["puffpaw"] },
  { id: "rainbow",     label: "Rainbow",                category: "Consumer", keywords: ["rainbow wallet","rainbow app"] },
  { id: "sidekick",    label: "Sidekick",               category: "Consumer", keywords: ["sidekick"] },
  { id: "sixr",        label: "SIXR Cricket",           category: "Consumer", keywords: ["sixr cricket","sixr"] },
  { id: "sophon",      label: "Sophon",                 category: "Consumer", keywords: ["sophon"] },
  { id: "vultisig",    label: "Vultisig",               category: "Consumer", keywords: ["vultisig"] },
  { id: "yeet",        label: "YEET",                   category: "Consumer", keywords: ["yeet"] },

  // --- Interop ---
  { id: "caldera",     label: "Caldera",                category: "Interop", keywords: ["caldera"] },
  { id: "initia",      label: "Initia",                 category: "Interop", keywords: ["initia"] },
  { id: "skate",       label: "Skate",                  category: "Interop", keywords: ["skate"] },
  { id: "union",       label: "Union",                  category: "Interop", keywords: ["union"] },

  // --- RWA ---
  { id: "kaio",        label: "KAIO",                   category: "RWA", keywords: ["kaio","kaio network"] },
  { id: "theo",        label: "Theo Network",           category: "RWA", keywords: ["theo","theo network","thbill","tultra"] },

  // --- Snapper / Campaign style(ë§ˆì¸ë“œì‰ì–´ìš©) ---
  { id: "superform",   label: "Superform",              category: "Campaign", keywords: ["superform","superformxyz","@superformxyz"] },
  { id: "glint",       label: "Glint Analytics",        category: "Campaign", keywords: ["glint analytics","@glintanalytics"] },
  { id: "solv",        label: "Solv Protocol",          category: "Campaign", keywords: ["solv protocol","@solvprotocol"] },
  { id: "pacifica",    label: "Pacifica",               category: "Campaign", keywords: ["pacifica_fi","@pacifica_fi","pacifica fi"] },
  { id: "layerbank",   label: "LayerBank",              category: "Campaign", keywords: ["layerbank","layerbankfi","@layerbankfi"] },
  { id: "rayls",       label: "Rayls",                  category: "Campaign", keywords: ["rayls","@RaylsLabs","raylslabs"] },
  { id: "velora",      label: "Velora",                 category: "Campaign", keywords: ["velora","veloradex","@veloradex"] },
  { id: "antix",       label: "Antix",                  category: "Campaign", keywords: ["antix","@antix_in"] },
  { id: "almanak",     label: "Almanak",                category: "Campaign", keywords: ["almanak","@Almanak"] },
  { id: "bob",         label: "BOB",                    category: "Campaign", keywords: ["bob","build on bitcoin","@build_on_bob"] },
  { id: "ten",         label: "TEN Protocol",           category: "Campaign", keywords: ["ten protocol","@tenprotocol","ten app"] },
  { id: "vooi",        label: "Vooi",                   category: "Campaign", keywords: ["vooi","@vooi_io","vooi io"] },

  // --- ë„ˆ ì „ìš©(ì´ë¯¸ CSVì—ì„œ ìì£¼ ì“°ëŠ” ê²ƒë“¤) ---
  { id: "river",       label: "River / satUSD",         category: "Stable", keywords: ["river","satusd","sat usd","river4fun","river4 fun","@riverhq"] },
  { id: "cookie",      label: "Cookie.fun",             category: "InfoFi", keywords: ["cookie.fun","cookie fun","cookie leaderboard","@cookie_fun"] },
  { id: "bnkr",        label: "BNKR / BANKR",           category: "Social", keywords: ["bnkr","bankr","bankr leaderboard","@bnkr_network"] }
];


let ANALYSIS = null;
let ALL_BASE = [];
let CURRENT_LIST = [];
let buckets = { S:[], A:[], B:[], C:[], D:[] };
let CURRENT_RANGE = "ALL";
let CURRENT_GRADE = "ALL";
let SORT_KEY = "score";

/* í”„ë¡œì íŠ¸ í†µê³„/ì°¨íŠ¸ìš© */
let PROJECT_STATS = [];
let projectChart = null;
let globalGradeChart = null;
let projectGradeChart = null;

/* ========== CSV í—¤ë” ë§¤í•‘/ìˆ«ì ========== */
function autoMap(row) {
  const map = {
    "ê²Œì‹œë¬¼ ë³¸ë¬¸": "text", "Post text": "text", "Tweet text": "text",
    "ãƒ„ã‚¤ãƒ¼ãƒˆãƒ†ã‚­ã‚¹ãƒˆ": "text", "ãƒ„ã‚¤ãƒ¼ãƒˆæœ¬æ–‡": "text", "æ¨æ–‡æ–‡æœ¬": "text", "å¸–å­æ–‡æœ¬": "text",
    "ë‚ ì§œ": "date", "Date": "date", "æ—¥ä»˜": "date", "æ—¥æœŸ": "date",
    "ê²Œì‹œë¬¼ ë§í¬": "link", "Tweet permalink": "link","URL":"link","Link":"link",
    "ãƒ„ã‚¤ãƒ¼ãƒˆãƒªãƒ³ã‚¯": "link", "æ¨æ–‡é“¾æ¥": "link",
    "ê²Œì‹œë¬¼ ID":"id","Tweet ID":"id",
    "ë…¸ì¶œìˆ˜":"impressions","Impressions":"impressions","ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³æ•°":"impressions","å±•ç¤ºæ¬¡æ•°":"impressions","æ›å…‰æ¬¡æ•°":"impressions",
    "ì°¸ì—¬ìˆ˜":"engagements","Engagements":"engagements","ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆæ•°":"engagements","äº’åŠ¨æ¬¡æ•°":"engagements",
    "ë§ˆìŒì— ë“¤ì–´ìš”":"likes","Likes":"likes","ã„ã„ã­":"likes","ç‚¹èµæ•°":"likes",
    "ë¶ë§ˆí¬":"bookmarks","Bookmarks":"bookmarks","ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯":"bookmarks","ä¹¦ç­¾":"bookmarks",
    "ì¬ê²Œì‹œ":"retweets","Retweets":"retweets","Reposts":"retweets","ãƒªãƒ„ã‚¤ãƒ¼ãƒˆ":"retweets","è½¬æ¨":"retweets","è½‰æ¨":"retweets","è½¬å‘":"retweets",
    "ë‹µê¸€":"replies","Replies":"replies","è¿”ä¿¡":"replies","å›å¤":"replies",
    "ê³µìœ  ìˆ˜":"shares","Shares":"shares","ã‚·ã‚§ã‚¢":"shares","åˆ†äº«":"shares",
    "ìƒˆë¡œìš´ íŒ”ë¡œìš°":"newFollows","New follows":"newFollows","æ–°ã—ã„ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼":"newFollows","æ–°å…³æ³¨è€…":"newFollows",
    "í”„ë¡œí•„ ì¡°íšŒìˆ˜":"profileClicks","Profile clicks":"profileClicks","ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚¯ãƒªãƒƒã‚¯æ•°":"profileClicks","ä¸ªäººèµ„æ–™ç‚¹å‡»æ¬¡æ•°":"profileClicks",
    "URL í´ë¦­ìˆ˜":"urlClicks","URL clicks":"urlClicks","URL ã‚¯ãƒªãƒƒã‚¯æ•°":"urlClicks","URL ç‚¹å‡»æ¬¡æ•°":"urlClicks",
    "ê³ ìœ  ë§í¬ í´ë¦­ìˆ˜":"uniqueClicks","Unique link clicks":"uniqueClicks","ãƒ¦ãƒ‹ãƒ¼ã‚¯ãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯æ•°":"uniqueClicks","å”¯ä¸€é“¾æ¥ç‚¹å‡»æ¬¡æ•°":"uniqueClicks",
  };
  const result = {};
  for (const key in row) {
    const clean = key.trim();
    if (map[clean]) result[map[clean]] = row[key];
  }

  // ë‚ ì§œ & ë§í¬ & ë³¸ë¬¸ì„ ì¢€ ë” ìœ ì—°í•˜ê²Œ ì°¾ê¸°
  if (!result.date) {
    for (const key in row) {
      const l = key.trim().toLowerCase();
      if (l.includes("ë‚ ì§œ") || l === "date" || l.startsWith("date ")) {
        result.date = row[key];
        break;
      }
    }
  }
  if (!result.link) {
    for (const key in row) {
      const l = key.trim().toLowerCase();
      if (l.includes("ë§í¬") || l.includes("permalink") || l === "url" || l.includes("url")) {
        result.link = row[key];
        break;
      }
    }
  }
  if (!result.text) {
    for (const key in row) {
      const l = key.trim().toLowerCase();
      if (l.includes("text") || l.includes("ë³¸ë¬¸")) {
        result.text = row[key];
        break;
      }
    }
  }
  return result;
}
function num(v){
  if(!v) return 0;
  v = String(v).replace(/,/g,"").trim();
  const n = parseFloat(v);
  return isNaN(n)?0:n;
}

/* ========== ë‚ ì§œ/ê¸°ê°„ ì²˜ë¦¬ (í•œêµ­ì‹ ë‚ ì§œ í¬í•¨) ========== */
function parseDateValue(v){
  if(!v) return null;
  let s = String(v).trim();

  // 1) YYYY-MM-DD, YYYY/MM/DD, etc.
  let m = s.match(/(\d{4})[^\d]?(\d{1,2})[^\d]?(\d{1,2})/);
  if(m){
    const year = parseInt(m[1],10);
    const month = parseInt(m[2],10)-1;
    const day = parseInt(m[3],10);
    const d = new Date(year, month, day);
    if(!isNaN(d.getTime())) return d;
  }

  // 2) MM-DD-YYYY or DD-MM-YYYY í˜•íƒœ ë³´ì™„
  m = s.match(/(\d{1,2})[^\d]?(\d{1,2})[^\d]?(\d{4})/);
  if(m){
    const a = parseInt(m[1],10);
    const b = parseInt(m[2],10);
    const year = parseInt(m[3],10);
    // ì›”/ì¼ ì¶”ì • (a>12ë©´ a=day, b=month ë¡œ ê°€ì •)
    let month, day;
    if(a > 12){
      day = a;
      month = b - 1;
    }else{
      month = a - 1;
      day = b;
    }
    const d = new Date(year, month, day);
    if(!isNaN(d.getTime())) return d;
  }

  // 3) Date.parseê°€ ê°€ëŠ¥í•œ ë¬¸ìì—´ì´ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
  const parsed = Date.parse(s);
  if(!isNaN(parsed)){
    const d = new Date(parsed);
    if(!isNaN(d.getTime())) return d;
  }
  return null;
}

function applyDateFilter(list, range){
  if(range === "ALL") return list.slice();
  const days = Number(range);
  if(!days || !list.length) return list.slice();

  // ë‚ ì§œê°€ ìˆëŠ” ë°ì´í„°ë§Œ ìš°ì„  ì‚¬ìš©
  const withDates = list.filter(p => p.dateObj);
  if(!withDates.length){
    // ë‚ ì§œ íŒŒì‹±ì´ ì•ˆ ëœ ê²½ìš°: ë‹¨ìˆœíˆ ë’¤ì—ì„œ Nê°œë§Œ ë³´ì—¬ì£¼ëŠ” fallback
    const count = Math.min(list.length, days);
    return list.slice(list.length - count);
  }

  const dates = withDates.map(p=>p.dateObj);
  const latestTime = Math.max.apply(null, dates.map(d=>d.getTime()));
  const latest = new Date(latestTime);
  const ms = 24*60*60*1000;
  const threshold = new Date(latest.getTime() - (days-1)*ms);

  // ê¸°ê°„ í•„í„°ì—ì„œëŠ” ë‚ ì§œ ì—†ëŠ” ê¸€ì€ ì œì™¸ (ALLì—ì„œë§Œ í¬í•¨)
  return list.filter(p => p.dateObj && p.dateObj >= threshold);
}

/* ========== ìŠ¤ì½”ì–´/ë“±ê¸‰ ========== */
function computeScore(p){
  const impres = p.impressions || 0;
  const raw =
      p.engagements +
      p.bookmarks * 3 +
      p.newFollows * 10 +
      p.profileClicks * 0.7 +
      p.urlClicks * 0.8 +
      p.uniqueClicks * 1.2 +
      p.likes * 1.2 +
      p.retweets * 2 +
      p.replies * 1.5 +
      p.shares * 1.8;
  return raw / Math.log10(impres + 10);
}
function assignGrades(list){
  list.sort((a,b)=>b.score-a.score);
  const N = list.length || 1;
  list.forEach((p,i)=>{
    const pct = N>1 ? 1 - i/(N-1) : 1;
    p.percentile = Math.round(pct*100);
    p.grade =
      pct>=0.95?"S":
      pct>=0.80?"A":
      pct>=0.60?"B":
      pct>=0.40?"C":"D";
  });
}
function computeTrimmedAverage(list, ratio){
  if(!list.length) return 0;
  const scores = list.map(p=>p.score).sort((a,b)=>a-b);
  const n = scores.length;
  let k = Math.floor(n*ratio);
  if(k*2>=n) k = 0;
  const trimmed = scores.slice(k, n-k);
  const sum = trimmed.reduce((s,v)=>s+v,0);
  return sum / trimmed.length;
}
function sortForView(list){
  const key = SORT_KEY || "score";
  list.sort((a,b)=>{
    let va, vb;
    switch(key){
      case "impressions": va = a.impressions; vb = b.impressions; break;
      case "engagements": va = a.engagements; vb = b.engagements; break;
      case "bookmarks":  va = a.bookmarks;  vb = b.bookmarks;  break;
      case "newFollows": va = a.newFollows; vb = b.newFollows; break;
      case "score":
      default:
        va = a.score; vb = b.score; break;
    }
    if(va < vb) return 1;
    if(va > vb) return -1;
    return 0;
  });
  return list;
}

/* ========== í”„ë¡œì íŠ¸ íƒœê¹…/ì§‘ê³„ ========== */
function tagProjectsForPost(p){
  const text = (p.text || "").toLowerCase();
  const tags = [];
  PROJECTS.forEach(proj=>{
    const hit = proj.keywords.some(kw => text.includes(kw.toLowerCase()));
    if(hit) tags.push(proj.id);
  });
  p.projects = tags;
}

function computeProjectStats(list){
  const stats = {};
  PROJECTS.forEach(proj=>{
    stats[proj.id] = {
      id: proj.id,
      label: proj.label,
      count: 0,
      avgScore: 0,
      trimmedAvg: 0,
      bestScore: 0,
      bestDate: "",
      bestLink: "",
      posts: []
    };
  });

  list.forEach(post=>{
    (post.projects || []).forEach(pid=>{
      const s = stats[pid];
      if(!s) return;
      s.count++;
      s.posts.push(post);
      if(!s.bestScore || post.score > s.bestScore){
        s.bestScore = post.score;
        s.bestDate = post.date;
        s.bestLink = post.link;
      }
    });
  });

  const result = [];
  Object.values(stats).forEach(s=>{
    if(!s.posts.length) return;
    const total = s.posts.length;
    s.avgScore = s.posts.reduce((sum,p)=>sum+p.score,0)/total;
    s.trimmedAvg = computeTrimmedAverage(s.posts, TRIM_RATIO);
    result.push(s);
  });
  return result;
}

/* í”„ë¡œì íŠ¸ ìš”ì•½ í…Œì´ë¸” */
function renderProjectSummary(list){
  const wrap = document.getElementById("project-summary-wrap");
  if(!wrap) return;
  if(!list.length){
    wrap.innerHTML = "<div class='empty'>í”„ë¡œì íŠ¸ í‚¤ì›Œë“œì— ë§¤ì¹­ëœ ê¸€ì´ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.</div>";
    return;
  }
  list.sort((a,b)=>(b.trimmedAvg||0)-(a.trimmedAvg||0));
  const rows = list.map((s,idx)=>`
    <tr>
      <td>#${idx+1}</td>
      <td>${s.label}</td>
      <td>${s.count}</td>
      <td>${s.avgScore ? s.avgScore.toFixed(1) : "-"}</td>
      <td>${s.trimmedAvg ? s.trimmedAvg.toFixed(1) : "-"}</td>
      <td>${s.bestLink ? `<a href="${s.bestLink}" class="link-pill" target="_blank">ëŒ€í‘œ íŠ¸ìœ— â†—</a>` : ""}</td>
    </tr>
  `).join("");
  wrap.innerHTML = `
    <table>
      <thead>
        <tr>
          <th>ìˆœìœ„</th>
          <th>í”„ë¡œì íŠ¸</th>
          <th>ê²Œì‹œê¸€ ìˆ˜</th>
          <th>í‰ê·  ìŠ¤ì½”ì–´</th>
          <th>íŠ¸ë¦¼ë“œ í‰ê· </th>
          <th>ëŒ€í‘œ íŠ¸ìœ—</th>
        </tr>
      </thead>
      <tbody>${rows}</tbody>
    </table>
  `;
}

/* í”„ë¡œì íŠ¸ë³„ ìƒì„¸ ì…€ë ‰íŠ¸ & í…Œì´ë¸” */
function buildProjectSelect(list){
  const select = document.getElementById("project-select");
  const detailWrap = document.getElementById("project-detail-wrap");
  if(!select || !detailWrap) return;

  if(!list.length){
    select.innerHTML = `<option value="">ë§¤ì¹­ëœ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</option>`;
    detailWrap.innerHTML = `<div class="empty">í”„ë¡œì íŠ¸ í‚¤ì›Œë“œì— ë§¤ì¹­ëœ ê¸€ì´ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.</div>`;
    renderProjectGradePie(null);
    return;
  }

  select.innerHTML = list.map(p=>`<option value="${p.id}">${p.label} (${p.count})</option>`).join("");
  select.onchange = () => {
    const stat = PROJECT_STATS.find(p=>p.id===select.value);
    if(stat) renderProjectGradePie(stat);
    renderProjectDetail(select.value);
  };
  const first = list[0];
  select.value = first.id;
  renderProjectDetail(first.id);
  renderProjectGradePie(first);
}

function renderProjectDetail(projectId){
  const wrap = document.getElementById("project-detail-wrap");
  if(!wrap) return;
  const proj = PROJECT_STATS.find(p=>p.id===projectId);
  if(!proj || !proj.posts.length){
    wrap.innerHTML = `<div class="empty">ì„ íƒí•œ í”„ë¡œì íŠ¸ì— í•´ë‹¹í•˜ëŠ” ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
    return;
  }
  const posts = proj.posts.slice().sort((a,b)=>b.score-a.score);
  const rows = posts.map((p,idx)=>`
    <tr>
      <td>#${idx+1}</td>
      <td><div class="grade-badge ${p.grade.toLowerCase()}">${p.grade}</div></td>
      <td>
        <div class="text-main">${p.text}</div>
        <div class="text-meta">${p.date} Â· ìŠ¤ì½”ì–´ <strong>${p.score.toFixed(1)}</strong></div>
      </td>
      <td>
        <div class="stat-chip">ì°¸ì—¬ <strong>${p.engagements}</strong></div>
        <div class="stat-chip">ë…¸ì¶œ <strong>${p.impressions}</strong></div>
      </td>
      <td>
        <div class="stat-chip">íŒ”ë¡œìš° <strong>${p.newFollows}</strong></div>
        <div class="stat-chip">ë¶ë§ˆí¬ <strong>${p.bookmarks}</strong></div>
      </td>
      <td>${p.link ? `<a href="${p.link}" class="link-pill" target="_blank">íŠ¸ìœ— ë³´ê¸° â†—</a>` : ""}</td>
    </tr>
  `).join("");

  wrap.innerHTML = `
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>ë“±ê¸‰</th>
          <th>ë³¸ë¬¸</th>
          <th>ì°¸ì—¬/ë…¸ì¶œ</th>
          <th>íŒ”ë¡œìš°/ë¶ë§ˆí¬</th>
          <th>ë§í¬</th>
        </tr>
      </thead>
      <tbody>${rows}</tbody>
    </table>
  `;
}

/* í”„ë¡œì íŠ¸ ë„ë„› ì°¨íŠ¸ */
function renderProjectPieChart(list){
  const canvas = document.getElementById("project-pie");
  if(!canvas) return;
  const ctx = canvas.getContext("2d");

  if(projectChart){
    projectChart.destroy();
    projectChart = null;
  }
  if(!list.length) return;

  const labels = list.map(p=>p.label);
  const data = list.map(p=>p.count);

  projectChart = new Chart(ctx, {
    type: "doughnut",
    data: {
      labels,
      datasets: [{
        data,
        backgroundColor: [
          "rgba(59,130,246,0.9)",
          "rgba(45,212,191,0.9)",
          "rgba(251,191,36,0.9)",
          "rgba(244,114,182,0.9)",
          "rgba(129,140,248,0.9)",
          "rgba(16,185,129,0.9)",
          "rgba(249,115,22,0.9)",
          "rgba(236,72,153,0.9)"
        ]
      }]
    },
    options: {
      responsive:false,
      maintainAspectRatio:false,
      plugins: {
        legend: { position: "bottom" }
      },
      cutout:"55%",
      onClick(evt, elements){
        if(!elements.length) return;
        const idx = elements[0].index;
        const proj = list[idx];
        if(!proj) return;
        const select = document.getElementById("project-select");
        if(select){
          select.value = proj.id;
        }
        renderProjectDetail(proj.id);
        const stat = PROJECT_STATS.find(p=>p.id===proj.id);
        if(stat){
          renderProjectGradePie(stat);
        }
      }
    }
  });
}

function renderGlobalGradePie(stats){
  const canvas = document.getElementById("grade-distribution-pie");
  if(!canvas) return;
  const ctx = canvas.getContext("2d");

  if(globalGradeChart){
    globalGradeChart.destroy();
    globalGradeChart = null;
  }

  if(!stats || !stats.length){
    canvas.style.display = "none";
    return;
  }
  canvas.style.display = "block";

  const labels = stats.map(p=>p.label);
  const data = stats.map(p=> (p.trimmedAvg || p.avgScore || 0));

  globalGradeChart = new Chart(ctx, {
    type: "doughnut",
    data: {
      labels,
      datasets: [{
        data,
        backgroundColor: [
          "rgba(59,130,246,0.9)",
          "rgba(45,212,191,0.9)",
          "rgba(251,191,36,0.9)",
          "rgba(244,114,182,0.9)",
          "rgba(129,140,248,0.9)",
          "rgba(16,185,129,0.9)",
          "rgba(249,115,22,0.9)",
          "rgba(236,72,153,0.9)"
        ]
      }]
    },
    options: {
      responsive:false,
      maintainAspectRatio:false,
      plugins: {
        legend: { position: "bottom" }
      },
      cutout:"55%"
    }
  });
}

function renderProjectGradePie(stat){
  const canvas = document.getElementById("project-grade-pie");
  if(!canvas) return;
  const ctx = canvas.getContext("2d");

  if(projectGradeChart){
    projectGradeChart.destroy();
    projectGradeChart = null;
  }

  if(!stat || !stat.posts || !stat.posts.length){
    canvas.style.display = "none";
    return;
  }
  canvas.style.display = "block";

  const counts = { S:0, A:0, B:0, C:0, D:0 };
  stat.posts.forEach(p=>{
    if(counts[p.grade] !== undefined){
      counts[p.grade]++;
    }
  });

  const labels = ["S","A","B","C","D"];
  const data = labels.map(g=>counts[g]);

  projectGradeChart = new Chart(ctx, {
    type: "doughnut",
    data: {
      labels,
      datasets: [{
        data,
        backgroundColor: [
          "rgba(245,158,11,0.9)",  // S
          "rgba(56,189,248,0.9)",  // A
          "rgba(34,197,94,0.9)",   // B
          "rgba(168,85,247,0.9)",  // C
          "rgba(148,163,184,0.9)"  // D
        ]
      }]
    },
    options: {
      responsive:false,
      maintainAspectRatio:false,
      plugins: {
        legend: { position: "bottom" }
      },
      cutout:"55%"
    }
  });
}

/* ========== Top10 / ë“±ê¸‰ë³„ ë Œë”ë§ ========== */
function renderTop10(posts){
  const wrap=document.getElementById("top10-table-wrap");
  const countSpan = document.getElementById("top10-count");
  if(!posts.length){
    wrap.innerHTML="<div class='empty'>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>";
    if(countSpan) countSpan.textContent = "";
    return;
  }
  const base = sortForView(posts.slice());
  const top = base.slice(0,10);
  if(countSpan) countSpan.textContent = `(${top.length} / ${posts.length})`;
  const rows=top.map((p,i)=>`
    <tr>
      <td>#${i+1}</td>
      <td><div class="grade-badge ${p.grade.toLowerCase()}">${p.grade}</div></td>
      <td>
        <div class="text-main">${p.text}</div>
        <div class="text-meta">${p.date} Â· ìŠ¤ì½”ì–´ <strong>${p.score.toFixed(1)}</strong></div>
      </td>
      <td>
        <div class="stat-chip">ì°¸ì—¬ <strong>${p.engagements}</strong></div>
        <div class="stat-chip">ë…¸ì¶œ <strong>${p.impressions}</strong></div>
      </td>
      <td>
        <div class="stat-chip">íŒ”ë¡œìš° <strong>${p.newFollows}</strong></div>
        <div class="stat-chip">ë¶ë§ˆí¬ <strong>${p.bookmarks}</strong></div>
      </td>
      <td>${p.link ? `<a href="${p.link}" class="link-pill" target="_blank">íŠ¸ìœ— ë³´ê¸° â†—</a>` : ""}</td>
    </tr>`).join("");
  wrap.innerHTML=`
    <table>
      <thead><tr>
        <th>#</th><th>ë“±ê¸‰</th><th>ë³¸ë¬¸</th><th>ì°¸ì—¬/ë…¸ì¶œ</th><th>íŒ”ë¡œìš°/ë¶ë§ˆí¬</th><th>ë§í¬</th>
      </tr></thead>
      <tbody>${rows}</tbody>
    </table>`;
}
function renderGrade(list){
  const wrap=document.getElementById("grade-table-wrap");
  if(!list.length){
    wrap.innerHTML="<div class='empty'>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>";
    return;
  }
  const base = sortForView(list.slice());
  const rows=base.map((p,i)=>`
    <tr>
      <td>#${i+1}</td>
      <td><div class="grade-badge ${p.grade.toLowerCase()}">${p.grade}</div></td>
      <td>
        <div class="text-main">${p.text}</div>
        <div class="text-meta">${p.date} Â· ìŠ¤ì½”ì–´ <strong>${p.score.toFixed(1)}</strong></div>
      </td>
      <td>
        <div class="stat-chip">ì°¸ì—¬ <strong>${p.engagements}</strong></div>
        <div class="stat-chip">ë…¸ì¶œ <strong>${p.impressions}</strong></div>
      </td>
      <td>
        <div class="stat-chip">íŒ”ë¡œìš° <strong>${p.newFollows}</strong></div>
        <div class="stat-chip">ë¶ë§ˆí¬ <strong>${p.bookmarks}</strong></div>
      </td>
      <td>${p.link ? `<a href="${p.link}" class="link-pill" target="_blank">íŠ¸ìœ— ë³´ê¸° â†—</a>` : ""}</td>
    </tr>`).join("");
  wrap.innerHTML=`
    <table>
      <thead><tr>
        <th>#</th><th>ë“±ê¸‰</th><th>ë³¸ë¬¸</th><th>ì°¸ì—¬/ë…¸ì¶œ</th><th>íŒ”ë¡œìš°/ë¶ë§ˆí¬</th><th>ë§í¬</th>
      </tr></thead>
      <tbody>${rows}</tbody>
    </table>`;
}

/* ========== ì½”ì¹˜ ë´‡ ì¶œë ¥ ========== */
function updateCoach(){
  const el = document.getElementById("coach-output");
  if(!el) return;

  if(!ALL_BASE.length){
    if(CURRENT_LANG === "en"){
      el.textContent =
        "No CSV has been uploaded yet.\n" +
        "Download your X Analytics CSV and upload it above,\n" +
        "then the coach bot will summarize your mindshare status for this period.";
    }else{
      el.textContent =
        "ì•„ì§ CSVë¥¼ ì˜¬ë¦¬ì§€ ì•Šì•˜ì–´.\n" +
        "ìƒë‹¨ì—ì„œ ì• ë„ë¦¬í‹±ìŠ¤ CSVë¥¼ ì—…ë¡œë“œí•˜ë©´\n" +
        "ì´ êµ¬ê°„ì˜ ë§ˆì¸ë“œì‰ì–´ ìƒíƒœë¥¼ ì½”ì¹˜ ë´‡ì´ ìš”ì•½í•´ ì¤„ ê±°ì•¼.";
    }
    return;
  }
  if(!CURRENT_LIST.length || !ANALYSIS){
    el.textContent = (CURRENT_LANG === "en")
      ? "There is no data for the selected period, so I can't analyze it."
      : "ì„ íƒí•œ ê¸°ê°„ì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ê°€ ì—†ì–´ì„œ ë¶„ì„í•  ìˆ˜ ì—†ì–´.";
    return;
  }

  const gradeCounts = { S:0, A:0, B:0, C:0, D:0 };
  CURRENT_LIST.forEach(p=>{
    if(gradeCounts[p.grade] !== undefined){
      gradeCounts[p.grade]++;
    }
  });

  const tAvg = ANALYSIS.trimmedAvg || 0;
  let overallGrade, moodKo, moodEn;
  if(tAvg >= 80){
    overallGrade = "S";
    moodKo = "ì´ë²ˆ êµ¬ê°„ì€ ì‚¬ì‹¤ìƒ í­ë°œ êµ¬ê°„ì´ì•¼. ì§€ê¸ˆ í˜ì´ìŠ¤ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ë©´ì„œ, í„°ì¡Œë˜ íŒ¨í„´ì„ ë°˜ë³µí•˜ë©´ ë¼.";
    moodEn = "This period is basically an explosion zone. Keep this pace and repeat the patterns that already worked.";
  }else if(tAvg >= 60){
    overallGrade = "A";
    moodKo = "ìƒìœ„ê¶Œì—ì„œ ì˜ ë²„í‹°ê³  ìˆì–´. ì¡°ê¸ˆë§Œ ë” ì •êµí•˜ê²Œ ì‹¤í—˜í•˜ë©´ ì–¸ì œë“  Së¡œ ì˜¬ë¼ê°ˆ ìˆ˜ ìˆëŠ” ìœ„ì¹˜ì•¼.";
    moodEn = "You are holding solid in the upper tier. With a bit more fineâ€‘tuned experimentation, you can jump into S range.";
  }else if(tAvg >= 45){
    overallGrade = "B";
    moodKo = "ë¬´ë‚œí•˜ê²Œ ìš°ìƒí–¥ ì¤€ë¹„ ì¤‘ì¸ êµ¬ê°„ì´ì•¼. ëª‡ ê°œ ê°•í•œ ì‹œê·¸ë„ì„ ë” ë§Œë“¤ë©´ í•œ ë‹¨ê³„ ìœ„ë¡œ ì˜¬ë¼ê°ˆ ìˆ˜ ìˆì–´.";
    moodEn = "This is a steady preparation phase for an uptrend. A few stronger signals could push you to the next tier.";
  }else if(tAvg >= 30){
    overallGrade = "C";
    moodKo = "ì‹¤í—˜ì€ ë§ì´ í–ˆì§€ë§Œ ì•„ì§ ë¹µ í„°ì¹˜ëŠ” íŒ¨í„´ì´ ë¶€ì¡±í•œ êµ¬ê°„ì´ì•¼. ì˜ í„°ì§„ ê¸€ ê¸°ì¤€ìœ¼ë¡œ ê³µí†µ íŒ¨í„´ì„ ë½‘ì•„ë³´ì.";
    moodEn = "Youâ€™re experimenting a lot, but lack a consistently explosive pattern. Try extracting common traits from your bestâ€‘performing posts.";
  }else{
    overallGrade = "D";
    moodKo = "ë°ì´í„°ê°€ ìŒ“ì´ëŠ” ë‹¨ê³„ë¼ì„œ, ì§€ê¸ˆì€ â€˜í…ŒìŠ¤íŠ¸ ê¸°ê°„â€™ì´ë¼ ë³´ë©´ ë¼. ë‹¤ì–‘í•œ í˜•ì‹ì„ ë¶€ë‹´ ì—†ì´ ë˜ì§€ëŠ” ê²Œ ì¢‹ì•„.";
    moodEn = "This is still a dataâ€‘gathering phase. Treat it as a test period and throw out various formats without overthinking.";
  }

  const bestPost = CURRENT_LIST.slice().sort((a,b)=>b.score-a.score)[0];

  let projectKo = "ì•„ì§ í”„ë¡œì íŠ¸ í‚¤ì›Œë“œì— ë§¤ì¹­ëœ ê¸€ì´ ì—†ì–´ì„œ í”„ë¡œì íŠ¸ë³„ í‰ê°€ëŠ” ìƒëµí• ê²Œ.";
  let projectEn = "No posts matched the configured project keywords yet, so Iâ€™ll skip projectâ€‘level evaluation for now.";
  if(PROJECT_STATS && PROJECT_STATS.length){
    const bestProj = PROJECT_STATS.slice().sort((a,b)=> (b.trimmedAvg||0)-(a.trimmedAvg||0))[0];
    projectKo = `í”„ë¡œì íŠ¸ ì¤‘ì—ì„œëŠ” ã€Œ${bestProj.label}ã€ê°€ ê°€ì¥ ê°•í•˜ê²Œ ë‚˜ì™€. ì´ êµ¬ê°„ì—ì„œ í‰ê·  ìŠ¤ì½”ì–´ëŠ” ëŒ€ëµ ${bestProj.trimmedAvg.toFixed(1)}ì ì´ì•¼.`;
    projectEn = `Among your projects, â€œ${bestProj.label}â€ stands out the most, with an average score around ${bestProj.trimmedAvg.toFixed(1)} in this period.`;
  }

  let text;
  if(CURRENT_LANG === "en"){
    text =
`â— Oneâ€‘line summary for this period
- Trimmed average score: about ${tAvg.toFixed(1)} â†’ roughly in the ${overallGrade} band
- Grade distribution: S ${gradeCounts.S} / A ${gradeCounts.A} / B ${gradeCounts.B} / C ${gradeCounts.C} / D ${gradeCounts.D}

â— Coach comment
- ${moodEn}

â— Bestâ€‘performing post
- Date: ${bestPost.date || "-"}
- Score: ${bestPost.score.toFixed(1)}
${bestPost.link ? "- Link: " + bestPost.link : ""}

â— Projectâ€‘level note
- ${projectEn}

â€» Tip: Collect your S/Aâ€‘tier posts and compare length, tone, meme usage, time of posting, hashtags, and innerâ€‘circle tags.
Thatâ€™s the fastest way to reverseâ€‘engineer your own â€œmindshare patternâ€.`;
  }else{
    text =
`â— ì´ë²ˆ ê¸°ê°„ í•œ ì¤„ ìš”ì•½
- ì „ì²´ íŠ¸ë¦¼ë“œ í‰ê· : ì•½ ${tAvg.toFixed(1)}ì  â†’ ì²´ê° ë“±ê¸‰ìœ¼ë¡œëŠ” ${overallGrade} êµ¬ê°„ì´ì•¼.
- ë“±ê¸‰ ë¶„í¬: S ${gradeCounts.S} / A ${gradeCounts.A} / B ${gradeCounts.B} / C ${gradeCounts.C} / D ${gradeCounts.D}

â— ì½”ì¹˜ ì½”ë©˜íŠ¸
- ${moodKo}

â— ê°€ì¥ ì˜ í„°ì§„ ê¸€
- ë‚ ì§œ: ${bestPost.date || "-"}
- ìŠ¤ì½”ì–´: ${bestPost.score.toFixed(1)}
${bestPost.link ? "- ë§í¬: " + bestPost.link : ""}

â— í”„ë¡œì íŠ¸ ê´€ì  í•œ ì¤„ í‰
- ${projectKo}

â€» íŒ: ìƒìœ„ S/A ê¸€ë“¤ë§Œ ëª¨ì•„ì„œ â€œê¸¸ì´, í†¤, ë°ˆ ì‚¬ìš© ì—¬ë¶€, ì‹œê°„ëŒ€, í•´ì‹œíƒœê·¸, ì´ë„ˆì„œí´ íƒœê·¸ ì—¬ë¶€â€ë¥¼ ë¹„êµí•´ ë³´ë©´,
ì§€ê¸ˆ ê³„ì •ë§Œì˜ ë§ˆì‰ íŒ¨í„´ì„ ë” ë¹¨ë¦¬ ì°¾ì„ ìˆ˜ ìˆì–´.`;
  }

  el.textContent = text;
}
/* ========== ì „ì²´ ë·° ì—…ë°ì´íŠ¸ (ê¸°ê°„ í•„í„° ì ìš©) ========== */
function updateView(){
  if(!ALL_BASE.length) return;
  const summaryEl = document.getElementById("summary");
  const errorEl = document.getElementById("error");
  const filtered = applyDateFilter(ALL_BASE, CURRENT_RANGE);
  CURRENT_LIST = filtered;

  if(!filtered.length){
    ANALYSIS = null;
    summaryEl.innerHTML = "";
    summaryEl.style.display = "none";
    errorEl.textContent = "ì„ íƒí•œ ê¸°ê°„ì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.";
    document.getElementById("top10-table-wrap").innerHTML = "<div class='empty'>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>";
    document.getElementById("grade-table-wrap").innerHTML = "<div class='empty'>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>";
    PROJECT_STATS = [];
    renderProjectSummary([]);
    buildProjectSelect([]);
    renderProjectPieChart([]);
    const countSpan = document.getElementById("top10-count");
    if(countSpan) countSpan.textContent = "";
    updateCoach();
    return;
  }

  errorEl.textContent = "";
  assignGrades(filtered);

  buckets = { S:[], A:[], B:[], C:[], D:[] };
  filtered.forEach(p=>{
    const g = p.grade;
    if(buckets[g] && buckets[g].length < 10){
      buckets[g].push(p);
    }
  });

  const total = filtered.length;
  const avgScore = filtered.reduce((s,p)=>s+p.score,0)/total;
  const trimmedAvg = computeTrimmedAverage(filtered, TRIM_RATIO);
  const best = filtered[0];

  ANALYSIS = {
    trimmedAvg,
    avgScore,
    bestScore: best.score,
    bestDate: best.date,
    bestLink: best.link,
    totalPosts: total
  };

    summaryEl.innerHTML = `
    <div class="summary-card summary-card--posts">
      <div class="summary-ring"><span>ğŸ“</span></div>
      <div class="summary-text">
        <div class="summary-label">ì›ê¸€ ê°œìˆ˜</div>
        <div class="summary-value">${total}</div>
        <div class="summary-sub">ë‹µê¸€ ì œì™¸ Â· ê¸°ê°„ í•„í„° ì ìš©</div>
      </div>
    </div>

    <div class="summary-card summary-card--avg">
      <div class="summary-ring"><span>ğŸ“ˆ</span></div>
      <div class="summary-text">
        <div class="summary-label">í‰ê·  ìŠ¤ì½”ì–´</div>
        <div class="summary-value">${avgScore.toFixed(1)}</div>
        <div class="summary-sub">í˜„ì¬ ì„ íƒëœ ê¸°ê°„ì˜ ì „ì²´ ì›ê¸€ ê¸°ì¤€</div>
      </div>
    </div>

    <div class="summary-card summary-card--trimmed">
      <div class="summary-ring"><spanâš–ï¸</span></div>
      <div class="summary-text">
        <div class="summary-label">íŠ¸ë¦¼ë“œ í‰ê· </div>
        <div class="summary-value">${trimmedAvg.toFixed(1)}</div>
        <div class="summary-sub">ìƒÂ·í•˜ìœ„ 10% ì œê±° í›„ í‰ê· </div>
      </div>
    </div>

    <div class="summary-card summary-card--best">
      <div class="summary-ring"><span>ğŸ’¥</span></div>
      <div class="summary-text">
        <div class="summary-label">ê°€ì¥ í„°ì§„ ê¸€</div>
        <div class="summary-value">${best.score.toFixed(1)}</div>
        <div class="summary-sub">${best.date || ""}</div>
      </div>
    </div>
  `;

  summaryEl.style.display="grid";

  renderGrowthChart(filtered);
  renderTop10(filtered);
  if(CURRENT_GRADE === "ALL"){
    renderGrade(filtered.slice(0,30));
  }else{
    renderGrade(buckets[CURRENT_GRADE] || []);
  }

  PROJECT_STATS = computeProjectStats(filtered);
  renderProjectSummary(PROJECT_STATS);
  buildProjectSelect(PROJECT_STATS);
  renderProjectPieChart(PROJECT_STATS);
  renderGlobalGradePie(PROJECT_STATS);

  updateCoach();
}
/* ========== ë¡œì»¬ ë¶„ì„ íˆìŠ¤í† ë¦¬ ì €ì¥ ========== */
function getHistoryList(){
  try{
    const raw = localStorage.getItem("ms_history");
    if(!raw) return [];
    const parsed = JSON.parse(raw);
    return Array.isArray(parsed) ? parsed : [];
  }catch(e){
    console.warn("íˆìŠ¤í† ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸° ì¤‘ ì˜¤ë¥˜", e);
    return [];
  }
}

function saveHistoryEntry(){
  try{
    if(!ANALYSIS || !ALL_BASE.length) return;
    const entry = {
      timestamp: new Date().toISOString(),
      range: CURRENT_RANGE || "ALL",
      trimmedAvg: ANALYSIS.trimmedAvg,
      avgScore: ANALYSIS.avgScore,
      bestScore: ANALYSIS.bestScore,
      bestDate: ANALYSIS.bestDate,
      totalPosts: ANALYSIS.totalPosts
    };
    const list = getHistoryList();
    list.push(entry);
    const trimmed = list.slice(-50); // ìµœê·¼ 50ê°œë§Œ ìœ ì§€
    localStorage.setItem("ms_history", JSON.stringify(trimmed));
  }catch(e){
    console.warn("íˆìŠ¤í† ë¦¬ ì €ì¥ ì‹¤íŒ¨", e);
  }
}

function renderHistoryList(){
  const wrap = document.getElementById("history-wrap");
  if(!wrap) return;
  const list = getHistoryList();
  if(!list.length){
    wrap.innerHTML = "<div class='empty'>ì•„ì§ ì €ì¥ëœ ë¶„ì„ íˆìŠ¤í† ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤. CSVë¥¼ ì—…ë¡œë“œí•˜ë©´ ì—¬ê¸° ê¸°ë¡ì´ ìŒ“ì…ë‹ˆë‹¤.</div>";
    return;
  }

  const rows = list
    .slice()
    .sort((a,b)=> new Date(b.timestamp) - new Date(a.timestamp))
    .map((item, idx)=>{
      const d = new Date(item.timestamp);
      const dateStr = isNaN(d.getTime())
        ? (item.timestamp || "")
        : [
            d.getFullYear(),
            String(d.getMonth()+1).padStart(2,"0"),
            String(d.getDate()).padStart(2,"0")
          ].join("-") + " " +
          String(d.getHours()).padStart(2,"0") + ":" +
          String(d.getMinutes()).padStart(2,"0");

      const avg = Number(item.avgScore || 0);
      const trimmed = Number(item.trimmedAvg || 0);
      const best = Number(item.bestScore || 0);

      return `
        <tr>
          <td>${idx+1}</td>
          <td>${dateStr}</td>
          <td>${item.range || "ALL"}</td>
          <td>${item.totalPosts || 0}</td>
          <td>${avg.toFixed(1)}</td>
          <td>${trimmed.toFixed(1)}</td>
          <td>${best.toFixed(1)}</td>
          <td>${item.bestDate || ""}</td>
        </tr>
      `;
    }).join("");

  wrap.innerHTML = `
    <table class="data-table">
      <thead>
        <tr>
          <th>#</th>
          <th>ì—…ë¡œë“œ ì‹œê°</th>
          <th>ê¸°ê°„ í•„í„°</th>
          <th>ì›ê¸€ ìˆ˜</th>
          <th>í‰ê·  ìŠ¤ì½”ì–´</th>
          <th>íŠ¸ë¦¼ë“œ í‰ê· </th>
          <th>ê°€ì¥ í„°ì§„ ê¸€</th>
          <th>ë² ìŠ¤íŠ¸ ë‚ ì§œ</th>
        </tr>
      </thead>
      <tbody>
        ${rows}
      </tbody>
    </table>
  `;
}

/* ========= ê³„ì • ì„±ì¥ ê·¸ë˜í”„ ========== */
let growthChart = null;

function renderGrowthChart(list) {
  const canvas = document.getElementById("growth-chart");
  if (!canvas) return;
  const ctx = canvas.getContext("2d");

  // ê¸°ì¡´ ì°¨íŠ¸ ì œê±°
  if (growthChart) {
    growthChart.destroy();
    growthChart = null;
  }

  // ë°ì´í„° ì—†ìœ¼ë©´ ìˆ¨ê¹€
  if (!list || list.length < 4) {
    canvas.style.display = "none";
    return;
  }
  canvas.style.display = "block";

  // ë‚ ì§œ ê¸°ì¤€ ì •ë ¬
  const arr = list.slice().sort((a, b) => {
    if (a.dateObj && b.dateObj) return a.dateObj - b.dateObj;
    return 0;
  });

  // xì¶•: ë‚ ì§œ
  const labels = arr.map(p =>
    p.dateObj
      ? `${p.dateObj.getMonth() + 1}/${p.dateObj.getDate()}`
      : ""
  );

  // yì¶•: ì ìˆ˜(ìŠ¤ì½”ì–´)
  const scores = arr.map(p => p.score);

  // ê·¸ë˜ë””ì–¸íŠ¸ ìƒì„±
  const gradient = ctx.createLinearGradient(0, 0, 0, 200);
  gradient.addColorStop(0, "rgba(59,130,246,0.4)");   // íŒŒë‘ 40%
  gradient.addColorStop(1, "rgba(59,130,246,0.05)");  // ì•„ì£¼ ì—°í•¨

  const pointShadow = {
    id: "pointShadow",
    afterDraw(chart, args, options) {
      const ctx = chart.ctx;
      ctx.save();
      ctx.shadowColor = "rgba(59,130,246,0.6)";
      ctx.shadowBlur = 12;
      ctx.shadowOffsetX = 0;
      ctx.shadowOffsetY = 0;
    }
  };

  growthChart = new Chart(ctx, {
    type: "line",
    data: {
      labels,
      datasets: [
        {
          label: "ê³„ì • ì„±ì¥ ìŠ¤ì½”ì–´",
          data: scores,
          fill: true,
          backgroundColor: gradient,
          borderColor: "rgba(59,130,246,1)",
          borderWidth: 3,
          tension: 0.35,
          pointRadius: 0,
          pointBackgroundColor: "rgba(59,130,246,1)",
          pointBorderColor: "rgba(59,130,246,1)",
          pointHoverRadius: 6,
          pointHitRadius: 18
        }
      ]
    },
    options: {
      plugins: {
        legend: { display: false }
      },
      scales: {
        x: {
          ticks: { color: "#9ca3af" },
          grid: { display: false }
        },
        y: {
          ticks: { color: "#9ca3af" },
          grid: { color: "rgba(148,163,184,0.1)" }
        }
      }
    },
    plugins: [pointShadow]
  });
}

/* ========== CSV ì—…ë¡œë“œ ========== */
document.getElementById("csvInput").addEventListener("change", e=>{
  const file=e.target.files[0]; if(!file) return;
  Papa.parse(file,{
    header:true,skipEmptyLines:true,
    complete:res=>{
      ALL_BASE=[];
      res.data.forEach(row=>{
        const r=autoMap(row);
        const t=(r.text||"").trim();
        if(!t || t.startsWith("@")) return;
        const dateObj = parseDateValue(r.date);

        // ë§í¬ê°€ ì—†ê³  íŠ¸ìœ— IDë§Œ ìˆëŠ” ê²½ìš° ë³´ì™„
        let link = r.link;
        if((!link || !String(link).trim()) && r.id){
          const id = String(r.id).trim();
          if(id){
            link = `https://twitter.com/i/web/status/${id}`;
          }
        }

        const p={
          text:t,
          date:r.date || "",
          dateObj,
          link,
          impressions:num(r.impressions),
          engagements:num(r.engagements),
          likes:num(r.likes),
          bookmarks:num(r.bookmarks),
          newFollows:num(r.newFollows),
          replies:num(r.replies),
          retweets:num(r.retweets),
          shares:num(r.shares),
          profileClicks:num(r.profileClicks),
          urlClicks:num(r.urlClicks),
          uniqueClicks:num(r.uniqueClicks),
        };
        p.score=computeScore(p);
        tagProjectsForPost(p);
        ALL_BASE.push(p);
      });

      if(!ALL_BASE.length){
        document.getElementById("error").textContent="CSVì—ì„œ ë¶„ì„ ê°€ëŠ¥í•œ ì›ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.";
      }else{
        document.getElementById("error").textContent="";
        CURRENT_RANGE = "ALL";
        CURRENT_GRADE = "ALL";
        const rangeTabs = document.getElementById("range-tabs");
        if(rangeTabs) rangeTabs.style.display = "flex";
        updateView();
        saveHistoryEntry();
      }
    }
  });
});

/* ========== ë¦¬ë”ë³´ë“œ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° ========== */
async function saveToLeaderboard(){
  if(!ANALYSIS){
    alert("ë¨¼ì € CSVë¥¼ ì—…ë¡œë“œí•´ì„œ ë¶„ì„ì„ ëŒë ¤ì¤˜.");
    return;
  }
  const handleInput = document.getElementById("leader-handle");
  const handle = (handleInput.value || "").trim();
  if(!handle){
    alert("X í•¸ë“¤ì„ ì…ë ¥í•´ì¤˜. (ì˜ˆ: @bud_dha__)");
    handleInput.focus();
    return;
  }
  if(ANALYSIS.totalPosts < MIN_POSTS_FOR_LEADERBOARD){
    if(!confirm(`ì›ê¸€ì´ ${ANALYSIS.totalPosts}ê°œì…ë‹ˆë‹¤. ìµœì†Œ ${MIN_POSTS_FOR_LEADERBOARD}ê°œ ì´ìƒì¼ ë•Œ ì¶”ì²œí•´.\nê·¸ë˜ë„ ì €ì¥í• ë˜?`)) return;
  }

  const bestPost = CURRENT_LIST.slice().sort((a,b)=>b.score-a.score)[0];

  const payload = {
    handle,
    trimmedAvg: ANALYSIS.trimmedAvg,
    avgScore: ANALYSIS.avgScore,
    bestScore: ANALYSIS.bestScore,
    bestDate: ANALYSIS.bestDate,
    bestLink: ANALYSIS.bestLink,
    bestText: bestPost?.text || "",
    bestGrade: bestPost?.grade || "",
    totalPosts: ANALYSIS.totalPosts
  };

  try{
    await fetch(SCRIPT_URL, {
      method: "POST",
      headers: { "Content-Type": "text/plain;charset=utf-8" },
      body: JSON.stringify(payload)
    });
    alert("ë¦¬ë”ë³´ë“œì— ê¸°ë¡ ì €ì¥ ì™„ë£Œ! ğŸ”¥");
    loadLeaderboard(handle);
  }catch(err){
    console.error(err);
    alert("ë¦¬ë”ë³´ë“œ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤.");
  }
}
async function loadLeaderboard(handle){
  const tableWrap = document.getElementById("leaderboard-wrap");
  const myRankWrap = document.getElementById("my-rank-wrap");
  if(!tableWrap) return;
  try{
    const url = handle
      ? `${SCRIPT_URL}?handle=${encodeURIComponent(handle)}`
      : SCRIPT_URL;
    const res  = await fetch(url);
    const data = await res.json();
    const list   = Array.isArray(data) ? data : (data.top || []);
    const myRank = !Array.isArray(data) ? data.myRank : null;
    if(myRankWrap) myRankWrap.innerHTML = "";

    if(!list || !list.length){
      tableWrap.innerHTML = "<div class='empty'>ì•„ì§ ë¦¬ë”ë³´ë“œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>";
      return;
    }
    if(myRank && myRankWrap){
      const trimmedAvg = Number(myRank.trimmedAvg || 0).toFixed(1);
      const avgScore   = Number(myRank.avgScore   || 0).toFixed(1);
      const totalPosts = myRank.totalPosts || 0;
      myRankWrap.innerHTML = `
        <div style="padding:10px 12px;margin-bottom:8px;border-radius:14px;border:1px solid rgba(209,213,219,1);background:#f9fafb;font-size:12px;">
          <div style="font-size:13px;font-weight:700;margin-bottom:4px;">ë‚´ í˜„ì¬ ìˆœìœ„</div>
          <div style="display:flex;flex-wrap:wrap;gap:8px;align-items:center;">
            <span style="font-weight:700;color:#f97316;">#${myRank.rank}ìœ„</span>
            <span>Â· íŠ¸ë¦¼ë“œ í‰ê·  <strong>${trimmedAvg}</strong></span>
            <span>Â· í‰ê·  ìŠ¤ì½”ì–´ <strong>${avgScore}</strong></span>
            <span>Â· ì›ê¸€ ìˆ˜ <strong>${totalPosts}</strong></span>
          </div>
        </div>
      `;
    }

    const rows = list.map((item, idx) => {
      const handle      = item.handle || "";
      const handleClean = handle.replace("@","").trim();
      const trimmedAvg  = Number(item.trimmedAvg || 0).toFixed(1);
      const avgScore    = Number(item.avgScore   || 0).toFixed(1);
      const totalPosts  = item.totalPosts || 0;
      const bestLink    = item.bestLink || (handleClean ? `https://twitter.com/${handleClean}` : "#");
      return `
        <tr>
          <td>#${idx+1}</td>
          <td>
            <a href="${bestLink}" target="_blank" style="display:inline-flex;align-items:center;gap:6px;text-decoration:none;color:#111827">
              <img src="https://unavatar.io/twitter/${handleClean}" style="width:20px;height:20px;border-radius:999px;border:1px solid rgba(209,213,219,1)"/>
              <span>${handle}</span>
            </a>
          </td>
          <td>${trimmedAvg}</td>
          <td>${avgScore}</td>
          <td>${totalPosts}</td>
          <td>${item.bestLink ? `<a href="${item.bestLink}" class="link-pill" target="_blank">ëŒ€í‘œ íŠ¸ìœ— ë³´ê¸° â†—</a>` : ""}</td>
        </tr>`;
    }).join("");
    tableWrap.innerHTML = `
      <table>
        <thead>
          <tr>
            <th>ìˆœìœ„</th>
            <th>í•¸ë“¤</th>
            <th>íŠ¸ë¦¼ë“œ í‰ê· </th>
            <th>í‰ê·  ìŠ¤ì½”ì–´</th>
            <th>ì›ê¸€ ìˆ˜</th>
            <th>ëŒ€í‘œ íŠ¸ìœ—</th>
          </tr>
        </thead>
        <tbody>${rows}</tbody>
      </table>`;
  }catch(err){
    console.error(err);
    tableWrap.innerHTML = "<div class='empty'>ë¦¬ë”ë³´ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤.</div>";
  }
}


/* ========== ë‹¤êµ­ì–´ UI (KO/EN/JA/ZH) ========== */
const MS_I18N = {
  ko: {
    "#view-dashboard .top-title": "X í¬ë¦¬ì—ì´í„° ë§ˆì¸ë“œì‰ì–´ ë¶„ì„ê¸°",
    "#view-dashboard .top-sub": "ì• ë„ë¦¬í‹±ìŠ¤ CSVë¡œ ë‚´ ê³„ì •ì˜ ì§„ì§œ ì„íŒ©íŠ¸ë¥¼ ë³´ëŠ” ëŒ€ì‹œë³´ë“œ",
    ".hero-main-title": "ë§ˆì¸ë“œì‰ì–´ ìŠ¤ì½”ì–´ Â· S~D ë“±ê¸‰ Â· ë¦¬ë”ë³´ë“œê¹Œì§€ í•œ ë²ˆì—",
    ".hero-desc": "X ì• ë„ë¦¬í‹±ìŠ¤ì—ì„œ CSVë¥¼ ë‚´ë ¤ë°›ê³  ì´ê³³ì— ì—…ë¡œë“œí•˜ë©´,<br>ì›ê¸€ ê¸°ì¤€ìœ¼ë¡œ ë§ˆì¸ë“œì‰ì–´ ì ìˆ˜ì™€ ìƒìœ„ ê¸€, ë¦¬ë”ë³´ë“œê¹Œì§€ í•œ ë²ˆì— ë¶„ì„í•  ìˆ˜ ìˆì–´.",
    ".hero-pill": "<span class='hero-dot'></span> CSV í•œ ë²ˆ â†’ ê³„ì • ë¶„ì„ ë",
    ".file-input-fake": "ğŸ“ CSV íŒŒì¼ ì„ íƒí•˜ê¸°",
    ".file-hint": "account_analytics_content_YYYY-MM-DD_YYYY-MM-DD.csv ê·¸ëŒ€ë¡œ ì—…ë¡œë“œ",
    ".badge": "<span class='badge-dot'></span>í•œêµ­ì–´Â·ì˜ì–´ CSV ìë™ ì¸ì‹ Â· ë‹µê¸€ ì œì™¸ í›„ ì›ê¸€ë§Œ ë¶„ì„",
    "#range-tabs button[data-range='ALL']": "ì „ì²´ ê¸°ê°„",
    "#range-tabs button[data-range='7']": "ìµœê·¼ 7ì¼",
    "#range-tabs button[data-range='30']": "ìµœê·¼ 30ì¼",
    "#range-tabs button[data-range='90']": "ìµœê·¼ 90ì¼",
    "#view-leaderboard .top-title": "í¬ë¦¬ì—ì´í„° ë§ˆì¸ë“œì‰ì–´ ë¦¬ë”ë³´ë“œ",
    "#view-leaderboard .top-sub": "ë‚´ ìˆœìœ„ Â· íŠ¸ë¦¼ë“œ í‰ê·  Â· ëŒ€í‘œ íŠ¸ìœ—ì„ í•œ ëˆˆì— ë³´ëŠ” ë­í‚¹ ë³´ë“œ",
    "#view-projects .top-title": "í”„ë¡œì íŠ¸ë³„ ë§ˆì¸ë“œì‰ì–´",
    "#view-projects .top-sub": "íŠ¸ìœ— ë³¸ë¬¸ í‚¤ì›Œë“œ ê¸°ì¤€ìœ¼ë¡œ í”„ë¡œì íŠ¸ë³„ ì„íŒ©íŠ¸ì™€ ê²Œì‹œê¸€/ë“±ê¸‰ì„ ë¶„ì„í•©ë‹ˆë‹¤.",
    ".side-badge": "ì˜¤ëŠ˜ë„ í•œ ë²ˆ<br>ë§ˆì‰ í„°íŠ¸ë ¤ë³¼ê¹Œ? ğŸ’¥",
    "#leaderboard-section .section-title": "ğŸ† í¬ë¦¬ì—ì´í„° ë§ˆì¸ë“œì‰ì–´ ë¦¬ë”ë³´ë“œ (Beta)",
    "#leader-handle::placeholder": "X í•¸ë“¤ ì…ë ¥ (ì˜ˆ: @bud_dha__)",
    "#nav-dashboard-label": "Dashboard",
    "#nav-leaderboard-label": "ë¦¬ë”ë³´ë“œ",
    "#nav-projects-label": "í”„ë¡œì íŠ¸ë³„ ë§ˆì¸ë“œì‰ì–´",
    "#nav-course-label": "í¬ë¦½í†  í’€ì½”ìŠ¤",
    "#growth-title": "ğŸ“ˆ ê³„ì • ì„±ì¥ ê·¸ë˜í”„",
    "#growth-sub": "ìµœê·¼ ê¸°ê°„ ë™ì•ˆ ì›ê¸€ ê°œìˆ˜ / í‰ê·  ìŠ¤ì½”ì–´ ì¶”ì´ë¥¼ ê·¸ë˜í”„ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤.",
    "#top10-title": "ğŸ’¥ ë§ˆì¸ë“œì‰ì–´ í­ë°œ Top 10 <span id='top10-count'></span>",
    "#grade-section-title": "ğŸš ë“±ê¸‰ë³„ ìƒìœ„ ê²Œì‹œê¸€ <span>(S~D)</span>",
    "#coach-title": "ğŸ¤– ë§ˆì¸ë“œì‰ì–´ ì½”ì¹˜ ë´‡ <span style='font-size:11px;color:var(--text-muted);'>(Beta)</span>",
    "#coach-chip-text": "í˜„ì¬ ì„ íƒí•œ ê¸°ê°„ ê¸°ì¤€ í•œ ì¤„ ìš”ì•½ + í”¼ë“œë°±",
    "#leader-note": "â€» ìµœì†Œ ì›ê¸€ ìˆ˜ 20ê°œ ì´ìƒì¼ ë•Œ ë¦¬ë”ë³´ë“œ ì ìˆ˜ê°€ ë” ì •í™•í•©ë‹ˆë‹¤.",
    "#project-summary-title": "ğŸ“š í”„ë¡œì íŠ¸ ìš”ì•½ + ì›í˜• ê·¸ë˜í”„",
    "#project-summary-sub": "ì½”ë“œ ìƒë‹¨ <code>PROJECTS</code> ë°°ì—´ì˜ í‚¤ì›Œë“œë¥¼ ë„¤ê°€ íŠ¸ëŠ” í”„ë¡œì íŠ¸ì— ë§ê²Œ ë°”ê¿”ì¤˜.",
    "#proj-chart-title-1": "í”„ë¡œì íŠ¸ë³„ ê²Œì‹œê¸€ ë¹„ìœ¨",
    "#proj-chart-title-2": "í”„ë¡œì íŠ¸ë³„ í‰ê·  ì ìˆ˜ (íŠ¸ë¦¼ë“œ ê¸°ì¤€)",
    "#proj-chart-title-3": "ì„ íƒ í”„ë¡œì íŠ¸ S~D ë“±ê¸‰ ë¶„í¬"
  },
  en: {
    "#view-dashboard .top-title": "X Creator Mindshare Analyzer",
    "#view-dashboard .top-sub": "Dashboard to see your real impact using X Analytics CSV",
    ".hero-main-title": "Mindshare score Â· S~D grades Â· Leaderboard in one place",
    ".hero-desc": "Download CSV from X Analytics and upload here.<br>You can analyze mindshare scores, top posts, and leaderboard based on original posts only.",
    ".hero-pill": "<span class='hero-dot'></span> One CSV â†’ Full account analysis",
    ".file-input-fake": "ğŸ“ Choose CSV file",
    ".file-hint": "Upload account_analytics_content_YYYY-MM-DD_YYYY-MM-DD.csv as is",
    ".badge": "<span class='badge-dot'></span>KO/EN CSV auto-detect Â· replies excluded, originals only",
    "#range-tabs button[data-range='ALL']": "All time",
    "#range-tabs button[data-range='7']": "Last 7 days",
    "#range-tabs button[data-range='30']": "Last 30 days",
    "#range-tabs button[data-range='90']": "Last 90 days",
    "#view-leaderboard .top-title": "Creator Mindshare Leaderboard",
    "#view-leaderboard .top-sub": "Check your rank, trimmed average score, and key tweet at a glance",
    "#view-projects .top-title": "Project-wise Mindshare",
    "#view-projects .top-sub": "Analyze impact and grades per project based on tweet text keywords.",
    ".side-badge": "Shall we blow up<br>mindshare again today? ğŸ’¥",
    "#leaderboard-section .section-title": "ğŸ† Creator Mindshare Leaderboard (Beta)",
    "#leader-handle::placeholder": "Enter X handle (e.g., @bud_dha__)",
    "#nav-dashboard-label": "Dashboard",
    "#nav-leaderboard-label": "Leaderboard",
    "#nav-projects-label": "Project Mindshare",
    "#nav-course-label": "Crypto Fullcourse",
    "#growth-title": "ğŸ“ˆ Account Growth Chart",
    "#growth-sub": "Shows the trend of original post count and average score over time.",
    "#top10-title": "ğŸ’¥ Top 10 Mindshare Posts <span id='top10-count'></span>",
    "#grade-section-title": "ğŸš Top Posts by Grade <span>(S~D)</span>",
    "#coach-title": "ğŸ¤– Mindshare Coach Bot <span style='font-size:11px;color:var(--text-muted);'>(Beta)</span>",
    "#coach-chip-text": "One-line summary & feedback for the selected period",
    "#leader-note": "â€» For best accuracy, use at least 20 original posts before saving to the leaderboard.",
    "#project-summary-title": "ğŸ“š Project Summary + Donut Chart",
    "#project-summary-sub": "Edit the <code>PROJECTS</code> array at the top of the code to match the projects you tweet about."
  },
};

function applyLang(lang) {
  CURRENT_LANG = lang;
  const dict = MS_I18N[lang] || MS_I18N.ko;
  Object.keys(dict).forEach(sel => {
    // placeholder ì²˜ë¦¬
    if (sel.endsWith("::placeholder")) {
      const realSel = sel.replace("::placeholder", "");
      const el = document.querySelector(realSel);
      if (el) el.setAttribute("placeholder", dict[sel]);
    } else {
      const el = document.querySelector(sel);
      if (el) el.innerHTML = dict[sel];
    }
  });
  document.documentElement.setAttribute("lang", lang);
  localStorage.setItem("ms_lang", lang);
  document.querySelectorAll(".lang-btn").forEach(btn => {
    btn.classList.toggle("active", btn.dataset.lang === lang);
  });
  // ì–¸ì–´ê°€ ë°”ë€” ë•Œ ì½”ì¹˜ë´‡ í…ìŠ¤íŠ¸ë„ ë°”ë¡œ ì–¸ì–´ì— ë§ê²Œ ë‹¤ì‹œ ë Œë”ë§
  if (typeof updateCoach === "function") {
    try { updateCoach(); } catch(e) {}
  }
}

function initLangToggle() {
  const saved = localStorage.getItem("ms_lang") || "ko";
  applyLang(saved);
  document.querySelectorAll(".lang-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      applyLang(btn.dataset.lang);
    });
  });
}

initLangToggle();

/* ========== íƒ­ & ì´ë²¤íŠ¸ ========== */
document.querySelectorAll(".grade-tab").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll(".grade-tab").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    const g=btn.dataset.grade;
    CURRENT_GRADE = g;
    if(g==="ALL") renderGrade(CURRENT_LIST.slice(0,30));
    else renderGrade(buckets[g] || []);
  });
});

document.querySelectorAll(".range-tab").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll(".range-tab").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    CURRENT_RANGE = btn.dataset.range || "ALL";
    updateView();
  });
});

const sortSelect = document.getElementById("sort-key");
if(sortSelect){
  sortSelect.addEventListener("change", e=>{
    SORT_KEY = e.target.value || "score";
    if(!CURRENT_LIST.length) return;
    renderTop10(CURRENT_LIST);
    if(CURRENT_GRADE === "ALL") renderGrade(CURRENT_LIST.slice(0,30));
    else renderGrade(buckets[CURRENT_GRADE] || []);
  });
}

document.getElementById("leader-save-btn").addEventListener("click", saveToLeaderboard);
loadLeaderboard();

/* ========== ì‚¬ì´ë“œë°” ë·° í† ê¸€ ========== */
const viewNavItems = document.querySelectorAll(".side-nav-item[data-view]");
const viewDashboard = document.getElementById("view-dashboard");
const viewLeaderboard = document.getElementById("view-leaderboard");
const viewProjects = document.getElementById("view-projects");
const viewHistory = document.getElementById("view-history");

viewNavItems.forEach(item => {
  item.addEventListener("click", () => {
    const view = item.dataset.view;

    viewNavItems.forEach(i => i.classList.remove("active"));
    item.classList.add("active");

    if (view === "leaderboard") {
      viewDashboard.style.display = "none";
      viewLeaderboard.style.display = "block";
      viewProjects.style.display = "none";
      if (viewHistory) viewHistory.style.display = "none";
      loadLeaderboard();
    } else if (view === "projects") {
      viewDashboard.style.display = "none";
      viewLeaderboard.style.display = "none";
      viewProjects.style.display = "block";
      if (viewHistory) viewHistory.style.display = "none";
    } else if (view === "history") {
      viewDashboard.style.display = "none";
      viewLeaderboard.style.display = "none";
      viewProjects.style.display = "none";
      if (viewHistory) {
        viewHistory.style.display = "block";
        renderHistoryList();
      }
    } else {
      viewDashboard.style.display = "block";
      viewLeaderboard.style.display = "none";
      viewProjects.style.display = "none";
      if (viewHistory) viewHistory.style.display = "none";
    }
  });
});


/* ì‚¬ì´ë“œë°” ì ‘ê¸° / í¼ì¹˜ê¸° */
const layout = document.querySelector(".layout");
const sidebarToggle = document.getElementById("sidebar-toggle");
sidebarToggle.addEventListener("click", () => {
  layout.classList.toggle("collapsed");
});
</script>
</script>
</body>
</html>

